(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[2819],{35865:(e,n,t)=>{"use strict";t.d(n,{x:()=>i});var o=t(36373),a=t(41397);const i=(0,o.h)((e=>({devHoverData:null,oneProjectLayoutScrollPosition:0,pageContextMenu:null,openedMenuSections:[],selectedMenuSection:{key:"pageProperties",containerIndex:null,elementIndex:null,pageActionIndex:null,isGlobalContainer:!1,modeIndex:void 0},showBoundingBox:!0,isSubpageEditor:!1,isStaticEditor:!1,previewMode:"landscape",isConsoleOpen:!1,consoleLogs:[],pageSearchString:void 0,subPageSearchString:void 0,setDevHoverData:n=>{e((()=>({devHoverData:n})))},setMainMenuData:n=>{e((e=>({...e,...n})))},setPreviewMode:n=>{e((()=>({previewMode:n})))},setPageContextMenu:n=>{e((()=>({pageContextMenu:n})))},updateConsoleLog:n=>{e((e=>{const t=[...e.consoleLogs,n];return t.length>100&&t.splice(0,t.length-100),{consoleLogs:t}}))},clearConsoleLog:()=>{e((()=>({consoleLogs:[]})))}})),a.isEqual)},77524:(e,n,t)=>{"use strict";t.d(n,{t:()=>i});var o=t(13753),a=t(89321);const i=(0,t(19458).vt)((e=>({themesList:[],fetchAndFillThemesList:async()=>{const n=await(async()=>await o.axiosInstance.get("/api/themes?sort=createdAt:asc&populate=deep,3",{headers:(0,a.A)()}).then((e=>{var n;return null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.data?e.data.data:null})).catch((e=>{console.log("Get news error occurred:",e)})))();e({themesList:n||[]})}})))},29297:(e,n,t)=>{"use strict";t.d(n,{D:()=>l});var o=t(36373),a=t(11758),i=t(27623),r=t(41397);const l=(0,o.h)()((0,a.Zr)((e=>({xPanelStatus:"disconnected",lastErrorMessage:"",manualStartConnect:!1,updateXpanelStore:n=>{e((e=>({...e,...n})))}})),{name:"xpanelStore",storage:{getItem:i.Gq,setItem:i.SO,removeItem:i.Ai}}),r.isEqual)},53853:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});var o=t(97592);const a=e=>("build"===o.Q.getState().envState?"./":"http://api.avstudio.local")+e},7985:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var o=t(12916),a=t(44414);const i=e=>{let{type:n,style:t,sub:i,crestronLikeTypesNaming:r=!0}=e,l="",s=n;switch(n){case"d":case"boolean":l="blue",s="d";break;case"s":case"string":l="purple",s="s";break;case"a":case"number":l="orange",s="a";break;case"r":l="cyan";break;case"v":l="magenta";break;case"o":case"co":l="lime";break;default:l=""}let c=r?s:n;return c="co"===c?"close":c,(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{color:l,style:{fontSize:10,padding:"2px 3px",lineHeight:"10px",marginLeft:5,minWidth:15,textAlign:"center",textTransform:"lowercase",...t},children:c}),i&&(0,a.jsx)(o.A,{style:{fontSize:10,padding:"2px 3px",lineHeight:"10px",minWidth:18,textAlign:"center",textTransform:"lowercase",...t,marginLeft:5},children:i})]})}},56109:(e,n,t)=>{"use strict";t.d(n,{A:()=>l,E:()=>r});var o=t(64983),a=t(53853),i=t(9950);const r=()=>{const e=document.getElementById("custom-fonts");e&&null!==e&&void 0!==e&&e.parentNode&&e.parentNode.removeChild(e)},l=()=>{const e=(0,o.f)((e=>{var n,t,o,a,i;return null!==(n=null===(t=e.workingProject)||void 0===t||null===(o=t.attributes)||void 0===o||null===(a=o.media)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.filter((e=>e.attributes.mime.includes("font"))))&&void 0!==n?n:[]}));(0,i.useEffect)((()=>{(async e=>{try{let n=document.getElementById("custom-fonts");n||(n=document.createElement("style"),n.id="custom-fonts",n.type="text/css",document.head.appendChild(n));const t=e.map((async e=>{try{const t=await fetch(e.url,{credentials:"include"}),o=await t.blob(),a=URL.createObjectURL(o),i="\n                @font-face {\n                  font-family: '".concat(e.name,"';\n                  src: url(").concat(a,") format('truetype');\n                }\n              ");n.innerHTML+=i}catch(t){console.error("Error loading font ".concat(e.name," from ").concat(e.url,":"),t)}}));await Promise.all(t)}catch(n){console.error("Error loading custom fonts:",n)}})(e.map((e=>{let n="noFontName";try{n=e.attributes.name.split(".")[0]}catch(t){console.log("error",t)}return{name:n,url:(0,a.A)(e.attributes.url)}})))}),[e])}},39165:(e,n,t)=>{"use strict";t.d(n,{A:()=>i,I:()=>a});var o=t(64983);const a=e=>{var n;let{pageId:t}=e;return null===(n=o.f.getState().workingProject)||void 0===n?void 0:n.attributes.pages.data.find((e=>String(e.id)===String(t)))},i=e=>{let{pageId:n}=e;return(0,o.f)((e=>{var t;return null===(t=e.workingProject)||void 0===t?void 0:t.attributes.pages.data.find((e=>String(e.id)===String(n)))}))}},66963:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var o=t(9950),a=t(53705);const i=e=>{let{projectId:n,isEditor:t,jwt:i,autoConnect:r}=e;const[l,s]=(0,o.useState)(null);return(0,o.useEffect)((()=>{let e;if(!l&&i&&n&&r){console.log("before live connect",{socketInstance:l,autoConnect:r,jwt:i,projectId:n,isEditor:t});const o="".concat("http://api.avstudio.local","?isEditor=").concat(t?"true":"false","&projectId=").concat(n);e=(0,a.io)(o,{forceNew:!0,auth:{token:i}}),s(e)}}),[r,t,i,n,l]),(0,o.useEffect)((()=>{n||(null===l||void 0===l||l.off(),null===l||void 0===l||l.disconnect(),s(null))}),[n,l]),l}},16722:(e,n,t)=>{"use strict";t.d(n,{A:()=>m});var o=t(27379),a=t(9950),i=t(44677),r=t(68513),l=t(29297),s=t(64983),c=t(92759),d=t(97592),u=t(74744),h=t.n(u),g=t(44414);const m=()=>{const e=(0,s.f)((e=>{var n;return null===(n=e.workingProject)||void 0===n?void 0:n.attributes.webXpanel})),[n,t]=(0,a.useState)(e),u=(0,a.useMemo)((()=>(0,i.getWebXPanel)(!(0,i.runsInContainerApp)())),[]),{isActive:m,WebXPanel:p,WebXPanelEvents:f}=u,{xPanelStatus:v,manualStartConnect:x,updateXpanelStore:b}=(0,l.D)(),j=(0,d.Q)((e=>e.envState)),y=(0,s.f)((e=>{var n;return null===(n=e.workingProject)||void 0===n?void 0:n.attributes.env})),A=(0,s.f)((e=>{var n;return null===(n=e.workingProject)||void 0===n?void 0:n.attributes.selectedEnv})),w=(0,a.useMemo)((()=>null===y||void 0===y?void 0:y.find((e=>e.envId===A))),[y,A]);(0,a.useEffect)((()=>{let n=e;if(A){var o;const t=null!==(o=null===w||void 0===w?void 0:w.webXpanel)&&void 0!==o?o:{};n={...e,...t}}t((e=>h().diff(e,n)?n:e))}),[e,y,A,w]),(0,a.useEffect)((()=>{const e=d.Q.getState().envState;let t=!1;"build"!==e&&"live"!==e||(t=!0),b({xPanelStatus:"disconnected",lastErrorMessage:"",manualStartConnect:t}),console.info("XPanel config changed to: ",n)}),[n,b]),(0,a.useEffect)((()=>{var e;console.info("Current Environment: ",null!==(e=null===w||void 0===w?void 0:w.envName)&&void 0!==e?e:"Default");const n=d.Q.getState().envState;"editor"!==n&&"preview"!==n||b({xPanelStatus:"disconnected",lastErrorMessage:"",manualStartConnect:!1})}),[w,b]),(0,a.useEffect)((()=>{console.info("xPanelStatus: ",v)}),[v]),(0,a.useEffect)((()=>{var e;"live"===j&&(document.title=m?"xPanel: ".concat(v,",env: ").concat(null!==(e=null===w||void 0===w?void 0:w.envName)&&void 0!==e?e:"Default"):"xPanel no active")}),[j,m,w,v]);const[C,S]=(0,a.useState)("");(0,a.useEffect)((()=>{if(!m)return b({xPanelStatus:"disconnected",lastErrorMessage:"WebXPanel is not active",manualStartConnect:!1}),void console.info("WebXPanel is not active");if(!n)return b({xPanelStatus:"disconnected",lastErrorMessage:"No xPanel config provided",manualStartConnect:!1}),void console.info("No xPanel config provided");if(x&&!C&&m){if(b({xPanelStatus:"connecting",lastErrorMessage:""}),null===n||void 0===n||!n.host)return b({xPanelStatus:"disconnected",lastErrorMessage:"No webXpanel connnection host provided",manualStartConnect:!1}),console.info("No webXpanel connnection host provided"),void c.Ay.warning("No webXpanel connnection host provided");if(null===n||void 0===n||!n.ipId)return b({xPanelStatus:"disconnected",lastErrorMessage:"No webXpanel connnection ipId provided",manualStartConnect:!1}),console.info("No webXpanel connnection ipId provided"),void c.Ay.warning("No webXpanel connnection ipId provided");console.info("Connection initialization...",n),p.initialize(n)}}),[p,m,x,C,b,n]),(0,a.useEffect)((()=>{"connecting"!==v&&b({lastErrorMessage:""})}),[b,v]),(0,a.useEffect)((()=>{p.addEventListener(f.CONNECT_CIP,(e=>{let{detail:n}=e;const{url:t,ipId:o,roomId:a}=n;console.info("Connected to ".concat(t,", 0x").concat(o.toString(16),", ").concat(a)),b({xPanelStatus:"connected",manualStartConnect:!1}),c.Ay.success("Connected to ".concat(t,", 0x").concat(o.toString(16),", ").concat(a))})),p.addEventListener(f.DISCONNECT_CIP,(e=>{let{detail:n}=e;const{reason:t}=n;"disconnected"!==l.D.getState().xPanelStatus&&(console.info("Disconnected from CIP. Reason: ".concat(t)),b({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:"Disconnected from CIP. Reason: ".concat(t)}))})),p.addEventListener(f.ERROR_WS,(()=>{b({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:"WebSocket CIP Error"}),console.warn("xPanel WebSocket Error")})),p.addEventListener(f.FETCH_TOKEN_FAILED,(()=>{b({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:"WebSocket CIP FETCH_TOKEN_FAILED"}),console.info("FETCH_TOKEN_FAILED")})),p.addEventListener(f.NOT_AUTHORIZED,(e=>{let{detail:n}=e;const{redirectTo:t}=n;console.log("Received a redirect to: ".concat(t)),console.info("Crestron auth needed"),S(t),b({manualStartConnect:!1})}))}),[p,f.CONNECT_CIP,f.DISCONNECT_CIP,f.ERROR_WS,f.FETCH_TOKEN_FAILED,f.NOT_AUTHORIZED,b]),(0,a.useEffect)((()=>{C&&(0,r.A)({icon:(0,g.jsx)(o.A,{}),title:"Auth on Crestron Proccessor",content:"In order to continue connecting to Crestron Proccessor you will be redirected to auth page.",okText:"Proceed",cancelText:"Cancel",onOk:()=>{window.location.href=C},onCancel:()=>{console.info("Auth process aborted."),S(""),b({xPanelStatus:"disconnected",manualStartConnect:!1})}})}),[C,b])}},15791:(e,n,t)=>{"use strict";t.d(n,{Df:()=>s,IR:()=>l,nU:()=>c});var o=t(13753),a=t(92759),i=t(89321),r=t(64983);const l=async(e,n)=>{const t={data:{project:e,...n}};await o.axiosInstance.post("/api/modificators",t,{headers:(0,i.A)()}).then((e=>{const{workingProject:n,updateProjectWithHistory:t}=r.f.getState();if(!n)return;let o=structuredClone(n.attributes.modificators.data);return o.push(e.data.data),t({modificators:{data:o}},!1)})).then((()=>{a.Ay.success("Function created")})).catch((e=>{console.log("An error occured during function creation:",e),a.Ay.error("Error adding new function")}))},s=async e=>{await o.axiosInstance.delete("/api/modificators/".concat(e),{headers:(0,i.A)()}).then((()=>{const{workingProject:n,updateProjectWithHistory:t}=r.f.getState();if(!n)return;let o=n.attributes.modificators.data;return o=o.filter((n=>n.id!==e)),t({modificators:{data:o}},!1)})).then((()=>{a.Ay.success("Function deleted")})).catch((e=>{console.log("An error occured during function removing:",e.response),a.Ay.error("Error deleting function")}))},c=async(e,n)=>await o.axiosInstance.put("/api/modificators/".concat(n),{data:e},{headers:(0,i.A)()}).then((e=>{var t;const{workingProject:o,updateProjectWithHistory:a}=r.f.getState();if(!o||null===e||void 0===e||null===(t=e.data)||void 0===t||!t.data)return;let i=structuredClone(o.attributes.modificators.data);return i.map((t=>(t.id===n&&(t.attributes=e.data.data.attributes),t))),a({modificators:{data:i}},!1)})).then((()=>{a.Ay.success("Function updated")})).catch((e=>{console.log("An error occured during function update:",e.response),a.Ay.error("Error updating function")}))},15369:(e,n,t)=>{"use strict";t.d(n,{BG:()=>m,CG:()=>p,I$:()=>v,a3:()=>g,gw:()=>f});var o=t(92759),a=t(13753),i=t(89321),r=t(48362),l=t(93072),s=t(9418),c=t(64983),d=t(18288);const u=t(21215);function h(e){var n,t;return null===(n=c.f.getState().workingProject)||void 0===n||null===(t=n.attributes.pages.data.find((n=>String(n.id)===String(e))))||void 0===t?void 0:t.attributes.numericPageId}const g=async e=>{try{var n,t;const o={data:{containers:[{...l.GN}],...e}},s=await a.axiosInstance.post("/api/pages?&replacePageId=true",o,{headers:(0,i.A)()}),u=null===s||void 0===s||null===(n=s.data)||void 0===n?void 0:n.data;if(!u)throw new Error("No new page data");const{workingProject:h,updateProjectWithHistory:g,addPageHash:m}=c.f.getState();if(!h)throw new Error("No workingProject");const p=structuredClone(h.attributes.pages.data);p.push(u);const f=(0,d.A)(u);m({pageId:u.id,savedHash:f,currentHash:f});const v=u.attributes.parameters;let x=[];null!==v&&void 0!==v&&v.length&&(x=v.map((e=>({...e,pageId:u.id}))));const b=null!==(t=h.attributes.variables)&&void 0!==t?t:[];await(0,r.Qx)({projectId:h.id,inputData:{variables:[...b,...x]}}),await g({pages:{data:p}},!1)}catch(s){console.error("An error occurred while creating a page:",s),o.Ay.error("Error creating new page")}},m=async e=>{let{pageCloneData:n}=e,t=structuredClone(n.attributes);t.name=t.name+"_clone",t.url=t.url+"_clone";const{createdAt:o,updatedAt:a,publishedAt:i,uid:r,...l}=t,s=c.f.getState().workingProject;if(!s)throw new Error("No workingProject");return await g({...l,project:s.id})},p=async(e,n)=>{var t;const l=h(n);if(!l)return void console.error("No numeric page id found for ".concat(n));let d=structuredClone(null===(t=c.f.getState().workingProject)||void 0===t?void 0:t.attributes.globalContainers);d&&d.forEach((e=>{e.hiddenOnPages&&e.hiddenOnPages.length&&(e.hiddenOnPages=e.hiddenOnPages.filter((e=>e!==n))),e.visibleOnPages&&e.visibleOnPages.length&&(e.visibleOnPages=e.visibleOnPages.filter((e=>e!==n)))}));const g=u.stringify({populate:"*"},{encodeValuesOnly:!0});return await a.axiosInstance.delete("/api/pages/".concat(l,"?").concat(g),{headers:(0,i.A)()}).then((()=>{var t;let a={globalContainers:d};(0,r.Qx)({projectId:e,inputData:a}).then((()=>{(0,s.aM)({projectId:e,pageId:n}).then((()=>{o.Ay.success("Page deleted")}))}));const{updateProjectWithHistory:i,workingProject:l}=c.f.getState();if(!l)throw new Error("No workingProject");let u=null===l||void 0===l?void 0:l.attributes.pages.data;if(!u||0===(null===(t=u)||void 0===t?void 0:t.length))throw new Error("No pages data");return u=u.filter((e=>e.id!==n)),i({pages:{data:u}},!1)})).catch((e=>{console.log("DeletePage error occurred:",e.response),o.Ay.error("Error deleting page")}))},f=async e=>{let{projectId:n,pageId:t,inputData:r}=e;const l=h(t);if(!l)return void console.error("No numeric page id found for ".concat(t));const s=u.stringify({populate:"*",replacePageId:"true"},{encodeValuesOnly:!0});return await a.axiosInstance.put("/api/pages/".concat(l,"?").concat(s),{data:r},{headers:(0,i.A)()}).then((e=>{var n;if(null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.data){var o;if(null===e||void 0===e||null===(o=e.data)||void 0===o||!o.data)throw new Error("No data returned from server");const{updateProjectWithHistory:n,workingProject:a}=c.f.getState();let i=structuredClone(null===a||void 0===a?void 0:a.attributes.pages.data);if(!i||0===(null===i||void 0===i?void 0:i.length))throw new Error("No pages data returned from server");return null===i||void 0===i||i.map((n=>(n.id===t&&(n.attributes=e.data.data.attributes),n))),n({pages:{data:i}},!1)}})).catch((e=>{console.log("updatePage error occurred:",e.response),o.Ay.error("Error updating page")}))};function v(e){let{evt:n,navigate:t,pageId:o}=e;const a=c.f.getState().addNewTab;n.metaKey||n.ctrlKey?a(o):t("page/".concat(o))}},32566:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var o=t(33490),a=t(9950);const i=e=>{let{initVariableArr:n}=e;const t=(0,a.useMemo)((()=>null!==n&&void 0!==n&&n.length?n.filter((e=>e.joinValueSetter_signal_fb)):[]),[n]);(0,a.useEffect)((()=>{const e=o.c.getState().setInitialVariablesArray;e(n||[])}),[n]),(0,a.useEffect)((()=>{let e=[];if(null!==t&&void 0!==t&&t.length){const n=o.c.getState().setVariableNewValue;return t.forEach((t=>{let o;e.push({subscribe:function(){o=CrComLib.subscribeState(t.type,t.joinValueSetter_signal_fb,(e=>{n({name:t.name,currentValue:e})}))},unsubscribe:function(){CrComLib.unsubscribeState(t.type,t.joinValueSetter_signal_fb,o)}})})),e.map((e=>e.subscribe())),()=>{e.map((e=>e.unsubscribe()))}}}),[t])}},78914:(e,n,t)=>{"use strict";t.d(n,{C2:()=>g,Dz:()=>u,LL:()=>m,Lx:()=>f,QX:()=>h,aA:()=>p});var o,a,i,r,l,s,c=t(57528),d=t(86006);const u=d.Ay.div(o||(o=(0,c.A)(["\n  --appLeftSidebar-width: 300px;\n  --appContent-width: 1fr;\n  --appRightSidebar-width: 350px;\n  --appConsoleSidebar-width: auto;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n  max-width: 100%;\n  max-height: 100%;\n  overflow: hidden;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: auto 1fr;\n  gap: 0px 0px;\n\n  .scrollable {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    max-height: 100%;\n    overflow: auto;\n    z-index: 10;\n    min-height: 100%;\n    height: 100%;\n  }\n"]))),h=d.Ay.div(a||(a=(0,c.A)(["\n  position: relative;\n  background-color: hsla(217, 81%, 36%, 0.06);\n  border-bottom: 1px solid hsla(217, 81%, 36%, 0.08);\n  display: flex;\n  align-items: center;\n  gap: 5px;\n"]))),g=d.Ay.div(i||(i=(0,c.A)(["\n  position: relative;\n  display: flex;\n\n  .appLayoutContent {\n    position: relative;\n    overflow: hidden;\n    flex: 1;\n    background-color: rgb(246, 246, 249);\n  }\n"]))),m=d.Ay.div(r||(r=(0,c.A)(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: 1fr min-content;\n  gap: 0px 0px;\n\n  width: var(--appLeftSidebar-width);\n  border-right-width: 0.5px;\n  border-right-style: solid;\n  border-right-color: rgba(197, 197, 211, 0.5);\n\n  .expandSidebarSection {\n    position: relative;\n    min-height: 0;\n  }\n"]))),p=d.Ay.div(l||(l=(0,c.A)(["\n  position: relative;\n  width: var(--appRightSidebar-width);\n  border-left-width: 0.5px;\n  border-left-style: solid;\n  border-left-color: rgba(197, 197, 211, 0.5);\n"]))),f=d.Ay.div(s||(s=(0,c.A)(["\n  position: relative;\n  background-color: #151414;\n  display: flex;\n  flex-flow: column;\n\n  .consoleClearArea {\n    padding: 5px;\n    button {\n      border-width: 0.5px;\n    }\n  }\n\n  .feedScroller {\n    flex: 1;\n    position: relative;\n    width: 300px;\n\n    .inner {\n      position: absolute;\n      left: 0;\n      top: 10px;\n      right: 0;\n      bottom: 10px;\n      overflow-y: scroll;\n    }\n  }\n"])))},59798:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>Gn});var o,a=t(71069),i=t(77524),r=t(64983),l=t(9950),s=t(57528),c=t(40895),d=t(72429),u=t(48323),h=t(48538),g=t(70171),m=t(74947),p=t(81541),f=t(17811),v=t(42466),x=t(27379),b=t(26142),j=t(43078),y=t(46062),A=t(2260),w=t(79378),C=t(8371),S=t(24513),k=t(12678),I=t(8750),E=t(35821),P=t(31170),F=t(28429),N=t(86945),M=t(7318),V=t(48738),D=t.n(V),L=t(35865),T=t(12271),O=t(29297),R=t(16722),B=t(15224),z=t(36485),_=t(66276),q=t(26762),U=t(86006),W=t(33626),H=t(44414);const K=l.lazy((()=>t.e(408).then(t.bind(t,50408)))),G=l.lazy((()=>t.e(5301).then(t.bind(t,65301)))),X=U.Ay.div(o||(o=(0,s.A)(["\n  font-size: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 5px;\n  padding: 5px 10px 0 10px;\n  position: relative;\n  background-color: var(--ant-primary-5);\n  color: rgba(255, 255, 255, 0.8);\n  cursor: pointer;\n  min-width: 120px;\n\n  &::after {\n    content: 'env';\n    position: absolute;\n    left: 10px;\n    top: 2px;\n    font-size: 9px;\n    color: #fff;\n    line-height: 100%;\n  }\n"]))),J=e=>{let{setEditProjectModalId:n,projectId:t}=e;const o=(0,r.f)((e=>{var n;return null===(n=e.workingProject)||void 0===n?void 0:n.attributes.env})),a=(0,r.f)((e=>{var n;return null===(n=e.workingProject)||void 0===n?void 0:n.attributes.selectedEnv})),i=(0,l.useMemo)((()=>{var e,n;return a&&null!==(e=null===o||void 0===o||null===(n=o.find((e=>e.envId===a)))||void 0===n?void 0:n.envName)&&void 0!==e?e:"Default"}),[o,a]),s=e=>{let{envUidToSelect:n}=e;(0,r.f.getState().updateProjectWithHistory)({selectedEnv:n},!1)},h=(0,l.useMemo)((()=>{if(null===o||void 0===o||!o.length)return[];return o.map((e=>({key:e.envId,label:(0,H.jsx)("div",{onClick:()=>s({envUidToSelect:e.envId}),children:e.envName}),icon:(0,H.jsx)(z.A,{})})))}),[o]),g=[{key:"default",label:(0,H.jsx)("div",{onClick:()=>s({envUidToSelect:""}),children:"Default"}),icon:(0,H.jsx)(z.A,{})},...null!==h&&void 0!==h?h:[],{key:"env divider",label:(0,H.jsx)(c.A,{style:{margin:0}})},{key:"env settings",label:(0,H.jsx)("div",{onClick:()=>n(Number(t)),children:"Project ENV settings"}),icon:(0,H.jsx)(_.A,{})}];return(0,H.jsx)(d.A,{dropdownRender:()=>(0,H.jsx)(u.A,{items:g,style:{whiteSpace:"nowrap"}}),trigger:["click"],children:(0,H.jsxs)(X,{children:[(0,H.jsxs)("span",{children:[(0,H.jsx)(z.A,{style:{marginRight:5}}),i]}),(0,H.jsx)(q.A,{})]})})},Y=e=>{let{children:n,isSubpage:t,isStatic:o,isActive:a,onClick:i,onClose:r,tabIcon:l,showDot:s}=e;const c=D()({isActive:a});return(0,H.jsxs)(N.HQ,{$showDot:s,onClick:()=>i(),className:c,children:[l&&l,t&&(0,H.jsxs)("small",{children:["sub ",o&&(0,H.jsx)("i",{style:{marginLeft:3},children:"static"})]}),(0,H.jsx)("div",{className:"tabText",children:(0,H.jsxs)("div",{className:"textOverflow",children:[" ",n]})}),(0,H.jsx)("svg",{onClick:e=>function(e){e.stopPropagation(),r()}(e),className:"closeIco",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,H.jsx)("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"m7 7l10 10M7 17L17 7"})})]})},Q=()=>{(0,R.A)();const{xPanelStatus:e="disconnected",lastErrorMessage:n}=(0,O.D)(),t=O.D.getState().updateXpanelStore;const o=(0,H.jsx)(h.A,{icon:"disconnected"===e?n?(0,H.jsx)(x.A,{style:{color:"red"}}):(0,H.jsx)(b.A,{}):(0,H.jsx)(j.A,{}),loading:"connecting"===e,onClick:()=>{t({manualStartConnect:!0})},children:e.charAt(0).toUpperCase()+e.slice(1)});return n?(0,H.jsx)(g.A,{placement:"bottomLeft",title:"Last connect message",content:n,trigger:"hover",children:o}):o},$=e=>{let{workingProject:n,pageId:t}=e;const o=(0,F.Zp)(),a=(0,r.f)((e=>e.tabs)),i=(0,r.f)((e=>e.pagesHashes)),l=null===n||void 0===n?void 0:n.attributes.pages.data,{removeTab:s}=r.f.getState();if(!a.length||null===l||void 0===l||!l.length||!n)return null;const c=a.map((e=>{const a=l.find((n=>String(n.id)===e.pageId));if(!a)return console.log("targetPage is not found"),null;const r=a.attributes.name,c=String(a.id)===t,d=a.attributes.isSubpage,u=a.attributes.isStatic;let h=!1;const g=i.find((n=>String(n.pageId)===String(e.pageId)));return g?h=g.currentHash!==g.savedHash:console.error("hashData is not found"),(0,H.jsx)(Y,{showDot:h,isSubpage:!!d,isStatic:!!u,tabIcon:(0,H.jsx)("svg",{style:{height:"auto",minWidth:"1em"},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 48 48",children:(0,H.jsxs)("g",{fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"4",children:[(0,H.jsx)("rect",{width:"36",height:"36",x:"6",y:"6",rx:"3"}),(0,H.jsx)("path",{"stroke-linecap":"round",d:"M6 17h36M17 42V17"})]})}),isActive:c,onClose:()=>function(e,t){e?(o("/projects/".concat(null===n||void 0===n?void 0:n.id)),s(t.pageId)):s(t.pageId)}(c,e),onClick:()=>o("/projects/".concat(null===n||void 0===n?void 0:n.id,"/page/").concat(e.pageId)),children:r},e.pageId)}));return(0,H.jsx)(H.Fragment,{children:c})},Z=l.memo((()=>{const e=L.x.getState().setMainMenuData,n=(0,L.x)((e=>e.isConsoleOpen)),t=(0,L.x)((e=>e.consoleLogs));return(0,H.jsx)(m.A,{color:"purple",size:"small",count:(null===t||void 0===t?void 0:t.length)||0,style:{zIndex:10,fontSize:10},children:(0,H.jsx)(p.A,{title:"Show/Hide Console",children:(0,H.jsx)(h.A,{onFocus:e=>e.target.blur(),type:n?"primary":"default",onClick:()=>{e({isConsoleOpen:!n})},icon:(0,H.jsx)(y.A,{})})})})})),ee=e=>{let{setEditProjectModalId:n}=e,t=(0,F.Zp)();const{projectId:o}=(0,F.g)(),{pageId:a}=(0,F.g)(),i=(0,F.zy)().pathname.includes("profile"),s=(0,r.f)((e=>e.workingProject)),c=(0,r.f)((e=>e.currentProjectHash))===(0,r.f)((e=>e.savedProjectHash)),u=(0,L.x)((e=>e.previewMode)),g=(0,L.x)((e=>e.showBoundingBox)),{setPreviewMode:m,setMainMenuData:p}=L.x.getState(),[x,b]=(0,l.useState)(!1),j=()=>{const e=(0,B.k)((e=>{var n;return null===(n=e.user)||void 0===n?void 0:n.email}));let n="My Projects";return o?n=null!==s&&void 0!==s&&s.attributes.name?s.attributes.name:(0,H.jsx)(A.A,{}):i&&(n=(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(w.A,{}),e]})),(0,H.jsx)(H.Fragment,{children:n})};return(0,H.jsxs)(N.Qx,{onContextMenu:e=>e.preventDefault(),children:[o&&s?(0,H.jsxs)(N.$4,{children:[(0,H.jsx)(Y,{showDot:!c,tabIcon:(0,H.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 15 15",children:(0,H.jsx)("path",{fill:"currentColor",d:"M1.5 0A1.5 1.5 0 0 0 0 1.5v4A1.5 1.5 0 0 0 1.5 7h4A1.5 1.5 0 0 0 7 5.5v-4A1.5 1.5 0 0 0 5.5 0zm8 0A1.5 1.5 0 0 0 8 1.5v4A1.5 1.5 0 0 0 9.5 7h4A1.5 1.5 0 0 0 15 5.5v-4A1.5 1.5 0 0 0 13.5 0zm-8 8A1.5 1.5 0 0 0 0 9.5v4A1.5 1.5 0 0 0 1.5 15h4A1.5 1.5 0 0 0 7 13.5v-4A1.5 1.5 0 0 0 5.5 8zm8 0A1.5 1.5 0 0 0 8 9.5v4A1.5 1.5 0 0 0 9.5 15h4a1.5 1.5 0 0 0 1.5-1.5v-4A1.5 1.5 0 0 0 13.5 8z"})}),isActive:!a,onClose:()=>t("/projects/"),onClick:()=>t("/projects/".concat(o)),children:"Project"}),(0,H.jsx)("div",{className:"tabsScroller",children:(0,H.jsx)(T.Ay,{className:"inner",children:(0,H.jsx)($,{pageId:a,workingProject:s})})}),(0,H.jsx)(J,{projectId:o,setEditProjectModalId:n})]}):null,(0,H.jsxs)(N.VY,{style:g?{}:{backgroundColor:"rgb(66, 32, 201)",color:"#fff"},children:[(0,H.jsxs)("section",{className:"left",style:{fontSize:14},children:[(0,H.jsx)("img",{onClick:()=>t("/projects"),style:{width:"auto",height:23,cursor:"pointer"},src:M,alt:"avgator studio"}),(0,H.jsx)(j,{})]}),(0,H.jsx)("section",{className:"center",children:a?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(f.Ay.Group,{style:{whiteSpace:"nowrap"},value:u,onChange:e=>m(e.target.value),buttonStyle:"solid",children:[(0,H.jsxs)(f.Ay.Button,{value:"portrait",children:[(0,H.jsx)(C.A,{})," Portrait"]}),(0,H.jsxs)(f.Ay.Button,{value:"landscape",children:[(0,H.jsx)(C.A,{rotate:90})," Landscape"]})]}),(0,H.jsxs)(f.Ay.Group,{style:{whiteSpace:"nowrap"},value:g,onChange:e=>p({showBoundingBox:e.target.value}),buttonStyle:"solid",children:[(0,H.jsxs)(f.Ay.Button,{value:!0,children:[(0,H.jsx)(S.A,{})," Editor"]}),(0,H.jsxs)(f.Ay.Button,{style:g?{}:{backgroundColor:"red",color:"#fff",borderColor:"red"},className:"previewButton",value:!1,children:[(0,H.jsx)(k.A,{})," Preview"]})]}),(0,H.jsx)(Q,{}),(0,H.jsx)(Z,{})]}):null}),(0,H.jsxs)("section",{className:"right",style:{display:"flex",gap:5},children:[o||i?null:(0,H.jsx)(h.A,{icon:(0,H.jsx)(I.A,{}),onClick:()=>b(!0),type:"primary",children:"New Project"}),!o&&!i&&(0,H.jsx)(d.A,{menu:{items:[{key:"Profile",label:(0,H.jsx)("div",{onClick:()=>t("/profile"),children:"Profile"})},{key:"Logout",label:(0,H.jsx)("div",{onClick:()=>(0,v.je)(),children:"Change Account"})}]},placement:"bottomRight",arrow:!0,children:(0,H.jsx)(h.A,{icon:(0,H.jsx)(w.A,{})})}),i&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(h.A,{icon:(0,H.jsx)(E.A,{}),onClick:()=>t("/projects"),children:"Back to projects"}),(0,H.jsx)(h.A,{onClick:()=>(0,v.je)(),icon:(0,H.jsx)(P.A,{}),children:"Logout"})]}),o&&(0,H.jsx)(l.Suspense,{fallback:null,children:(0,H.jsx)(K,{})})]}),(0,H.jsx)("div",{style:{position:"absolute"},children:x?(0,H.jsx)(l.Suspense,{fallback:(0,H.jsx)(W.A,{}),children:(0,H.jsx)(G,{setOpenNewProjectModal:b})}):null})]})]})};var ne=t(78914),te=t(42074),oe=t(92759),ae=t(44719),ie=t(48362);const re=()=>{const e=(0,B.k)((e=>e.jwt)),n=(0,r.f)((e=>e.currentProjectHash)),t=(0,r.f)((e=>e.savedProjectHash)),o=r.f.getState().resetWorkingProject,{projectId:a}=(0,F.g)(),[i,s]=(0,l.useState)(!0);(0,l.useEffect)((()=>{s(!(!e||!a||n===t))}),[n,a,t,e]);const c=(0,F.KP)((e=>{let{nextLocation:n}=e;const t=function(e){return!!e.match(/\/projects\/(\d+)/)}(n.pathname);return!(!i||t)}));(0,l.useEffect)((()=>{const e=e=>{i&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[c.state,i]);return{ConfirmModal:()=>{function e(){(null===c||void 0===c?void 0:c.reset)&&c.reset()}const[n,t]=(0,l.useState)(!1);return"blocked"===c.state?(0,H.jsx)(ae.A,{maskClosable:!1,title:(0,H.jsxs)("div",{style:{color:"rgb(255 113 77)"},children:[(0,H.jsx)(x.A,{})," Unsaved changes"]}),open:!0,onCancel:()=>{e()},footer:[(0,H.jsx)(h.A,{onClick:()=>e(),children:"Stay here"},"back"),(0,H.jsx)(h.A,{loading:n,type:"primary",onClick:()=>function(){t(!0);const e=r.f.getState().workingProject;e?(0,ie.$H)({projectData:e}).then((()=>{oe.Ay.success("Project saved successfully"),(null===c||void 0===c?void 0:c.proceed)&&c.proceed(),o()})).catch((e=>{console.error(e),oe.Ay.error("Error while saving project")})):(oe.Ay.error("Error while saving project: not found"),t(!1))}(),children:"Save and exit"},"saveAndExit"),(0,H.jsx)(h.A,{type:"primary",danger:!0,onClick:()=>((null===c||void 0===c?void 0:c.proceed)&&c.proceed(),void o()),children:"Leave without saving"},"submit")],children:(0,H.jsx)("div",{children:"Are you really want to leave editor? All unsaved changes will be lost."})}):null}}};var le=t(97592),se=t(66963),ce=t(39165),de=t(32566),ue=t(87827),he=t(56952),ge=t(93072);const me=e=>{let{cloneItemModal:n,setCloneItemModal:t,onFinish:o}=e;const[a]=ue.A.useForm(),i=()=>{a.submit()};return(0,H.jsx)(ae.A,{destroyOnClose:!0,afterClose:()=>a.resetFields(),maskClosable:!1,title:"Clonning ".concat(n.nodeType),open:!!n,onOk:i,onCancel:()=>t(null),footer:[(0,H.jsx)(h.A,{onClick:()=>t(null),children:"Cancel"},"back"),(0,H.jsxs)(h.A,{type:"primary",onClick:i,children:["Clone ",n.nodeType]},"submit")],children:(0,H.jsx)(ue.A,{labelCol:{xs:{span:6}},wrapperCol:{xs:{span:16}},form:a,onFinish:e=>o(e),initialValues:{copiesCount:1},scrollToFirstError:!0,children:(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:"copiesCount",label:"How many copies",rules:[{required:!0,message:"This field is required."}],children:(0,H.jsx)(he.A,{min:1,max:10})})})})},pe=()=>{const[e,n]=(0,l.useState)(null),{pageId:t}=(0,F.g)();return{CloneModal:e?(0,H.jsx)(me,{onFinish:o=>{let{copiesCount:a}=o;const{containerIndex:i,elementIndex:r,nodeType:l,isGlobal:s}=e||{};void 0!==i&&("container"===l?(0,ge.aO)({action:"clone",containerIndex:i,copiesCount:a,pageId:t}).then((()=>n(null))):void 0!==r&&(0,ge.ld)({containerIndex:i,elementIndex:r,copiesCount:a,isGlobal:s,pageId:t,action:"clone"}).then((()=>n(null))))},setCloneItemModal:n,cloneItemModal:e}):null,setCloneItemModal:n}};var fe=t(581),ve=t(41397),xe=t(36373);const be={sourceContainerIndex:null,sourceContainerType:null,destinationContainerIndex:null,destinationContainerType:null,sourceElementIndex:null,destinationElementIndex:null,destinationElementCorner:null,destinationContainerFlow:null},je=(0,xe.h)(((e,n)=>({selectedElementRef:null,staticEementsGuidesClasses:[],activeStaticElementKey:null,dragData:be,updateDragStore:t=>{const o=n().dragData,a={...o,...t};(0,ve.isEqual)(o,a)||e((()=>({dragData:a})))},resetDragStore:()=>{e((()=>({dragData:be})))},setSelectedElementRef:n=>{e((()=>({selectedElementRef:n})))},setActiveStaticElementKey:n=>{e((()=>({activeStaticElementKey:n})))},setStaticEementsGuidesClasses:n=>{e((e=>{const t=e.staticEementsGuidesClasses;return t.includes(n)?e:{staticEementsGuidesClasses:[...t,n]}}))}})),ve.isEqual);var ye=t(1158),Ae=t(12916),we=t(13753),Ce=(t(97732),t(54800)),Se=t.n(Ce),ke=t(11758),Ie=t(27623),Ee=t(89321);const Pe=(0,xe.h)()((0,ke.Zr)((e=>({versions:[],fetchVersions:async()=>await we.axiosInstance.get("/api/versions?sort=version:desc",{headers:(0,Ee.A)()}).then((n=>{var t;return null!==n&&void 0!==n&&null!==(t=n.data)&&void 0!==t&&t.data?(e({versions:n.data.data}),n.data.data):null})).catch((e=>{console.log("Error fetching versions:",e.response),oe.Ay.error("Error fetching versions")}))})),{name:"versionStore",storage:{getItem:Ie.Gq,setItem:Ie.SO,removeItem:Ie.Ai}}),ve.isEqual);var Fe,Ne,Me,Ve,De,Le=t(56109),Te=t(98412),Oe=t(62863),Re=t(1578),Be=t(77645),ze=t(52765),_e=t(87094),qe=t(41988),Ue=t(25933),We=t(35023),He=t(48563),Ke=t(60716),Ge=t(13700),Xe=t(37866),Je=t(59907),Ye=t(87998),Qe=t(82278),$e=t(27911),Ze=t(67956),en=t(68513),nn=t(44358),tn=t(15791);const{Panel:on}=Te.A,an=(0,U.Ay)(ae.A)(Fe||(Fe=(0,s.A)(["\n  height: calc(100vh - 4%) !important;\n  width: 100% !important;\n\n  .ant-modal-content {\n    height: 100%;\n    position: relative;\n    display: flex;\n    flex-flow: column;\n\n    .dsForm {\n      height: 100%;\n      flex: 1;\n      position: relative;\n      display: flex;\n      flex-flow: column;\n    }\n\n    .ant-modal-body {\n      flex: 1;\n      position: relative;\n      padding: 0;\n      display: flex;\n      flex-flow: column;\n    }\n\n    .ant-collapse-header {\n      font-weight: normal !important;\n      user-select: none;\n      text-transform: uppercase;\n      font-size: 12px;\n    }\n\n    .ant-form-item-label {\n      flex-basis: 160px;\n    }\n  }\n"]))),rn=U.Ay.div(Ne||(Ne=(0,s.A)(["\n  position: relative;\n  height: 100%;\n  padding-top: 17px;\n  /* overflow: hidden; */\n  min-height: 200px;\n\n  .monaco-editor {\n    position: absolute !important;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n  }\n"]))),ln=(0,U.Ay)(Oe.A)(Me||(Me=(0,s.A)(["\n  position: relative;\n  flex: 1;\n\n  .ant-tabs-content {\n    position: relative;\n    height: 100%;\n  }\n\n  .ant-tabs-tabpane {\n    height: 100%;\n    background-color: #1e1e1e;\n  }\n\n  .ant-tabs-nav {\n    margin: 0;\n  }\n\n  .ant-tabs-tab {\n    border: 0 !important;\n\n    &.ant-tabs-tab-active {\n      background-color: #1e1e1e;\n\n      .ant-tabs-tab-btn {\n        color: #fff;\n        user-select: none;\n      }\n    }\n  }\n"]))),sn=U.Ay.div(Ve||(Ve=(0,s.A)(["\n  color: #fff;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]))),cn=U.Ay.div(De||(De=(0,s.A)(["\n  position: relative;\n  display: flex;\n  color: #fff;\n  height: 100%;\n\n  .functionBox {\n    min-width: 300px;\n    position: relative;\n    height: 100%;\n    display: flex;\n    flex-flow: column;\n\n    .functionBoxControls {\n      padding: 17px;\n      padding-right: 0;\n      padding-bottom: 0;\n      font-size: 12px;\n      display: flex;\n      gap: 5px;\n      justify-content: space-between;\n    }\n  }\n\n  .resultBox {\n    flex: 1;\n  }\n"]))),dn=e=>{var n,o,a,i,s,d,u,m,f,v,b,j,y,w,C,S,I;let{setNewDatasourceVisible:E,newDatasourceVisible:P}=e;const N="number"===typeof P?P:null,M=null===(n=r.f.getState().workingProject)||void 0===n?void 0:n.attributes.datasources.data.find((e=>e.id===N)),V=null===(o=r.f.getState().workingProject)||void 0===o?void 0:o.attributes.modificators.data,[D]=ue.A.useForm(),{projectId:L}=(0,F.g)(),T=(0,l.useMemo)((()=>{var e,n;let t=null!==(e=null===(n=r.f.getState().workingProject)||void 0===n?void 0:n.attributes.datasources.data)&&void 0!==e?e:[];M&&(t=t.filter((e=>e.id!==M.id)));return t.map((e=>e.attributes.name))}),[M]),O=(0,l.useMemo)((()=>{var e;const n=null===(e=r.f.getState().workingProject)||void 0===e?void 0:e.attributes.modificators.data,t=null===n||void 0===n?void 0:n.map((e=>({value:e.id,label:e.attributes.name})));return null!==t&&void 0!==t?t:[]}),[]),{headerKey:R,headerValue:B,hostname:z}=null!==(a=(0,nn.lT)())&&void 0!==a?a:{},[_,q]=(0,l.useState)("local"),[U,W]=(0,l.useState)(null),[K,G]=(0,l.useState)(null),X=ue.A.useWatch("sourceLink",D),J=ue.A.useWatch("useBaseUrl",D),Y=ue.A.useWatch("headerKey",D),Q=ue.A.useWatch("headerValue",D),$=null!==Y,Z=null!==Q,ee=ue.A.useWatch("sourceObject",D),ne=ue.A.useWatch("modificatorId",D),te=!!X||!!J,[ae,ie]=(0,l.useState)(!1),[re,le]=(0,l.useState)(!1),[se,ce]=(0,l.useState)("local"),de=(0,nn.Yf)({data:{useBaseUrl:J,sourceLink:X,headerKey:Y,headerValue:Q}}),he=(0,l.useMemo)((()=>te&&!ee?"remote":te&&ee?"mixed":"local"),[te,ee]),ge=(0,l.useMemo)((()=>ne?null===V||void 0===V?void 0:V.find((e=>e.id===ne)):null),[ne,V]),me=(0,l.useCallback)((()=>{ge&&(D.setFieldValue("modificatorFunctionString",ge.attributes.function),le(!1))}),[D,ge]);(0,l.useEffect)((()=>{me()}),[me]);const[pe,ve]=(0,l.useState)(!1),[xe,be]=(0,l.useState)([]),[je,ye]=(0,l.useState)([]),we=e=>{be(e)},Ce=e=>{ye(e)},Se=e=>{let{formKey:n,value:t}=e;const o=D.getFieldValue(n);function a(){D.setFieldsValue({[n]:t?"":null})}!t&&o?(0,en.A)({icon:(0,H.jsx)(x.A,{}),title:"Are you sure?",content:"Disabling this option will clear the value of the field. Are you sure you want to proceed?",okButtonProps:{danger:!0},okText:"Proceed",cancelText:"Cancel",onOk:()=>{a()},onCancel:()=>{}}):a()},ke=(0,l.useCallback)((()=>xe.length>0?(0,H.jsx)(g.A,{trigger:"hover",title:"invalid JSON",content:"JSON data contains errors",children:(0,H.jsx)(x.A,{style:{fontSize:14,margin:"0 0 0 5px",color:"red",cursor:"help"}})}):null),[xe.length]),Ie=t(59051)().format("YYYY-MM-DD_HH-mm"),Ee=M?{name:M.attributes.name,sourceLink:null!==(i=null===(s=M.attributes.production)||void 0===s?void 0:s.sourceLink)&&void 0!==i?i:"",useBaseUrl:null!==(d=null===(u=M.attributes.production)||void 0===u?void 0:u.useBaseUrl)&&void 0!==d&&d,headerKey:null!==(m=null===(f=M.attributes.production)||void 0===f?void 0:f.headerKey)&&void 0!==m?m:null,headerValue:null!==(v=null===(b=M.attributes.production)||void 0===b?void 0:b.headerValue)&&void 0!==v?v:null,modificatorId:null!==(j=null===(y=M.attributes.production)||void 0===y?void 0:y.modificatorId)&&void 0!==j?j:0,sourceObject:null!==(w=null===(C=M.attributes.production)||void 0===C?void 0:C.sourceObject)&&void 0!==w?w:"",modificatorFunctionString:"",isImagePreloadSource:null!==(S=null===(I=M.attributes.production)||void 0===I?void 0:I.isImagePreloadSource)&&void 0!==S&&S}:{name:"New datasource "+Ie,sourceLink:"",useBaseUrl:!1,headerKey:null,headerValue:null,modificatorId:0,sourceObject:"",modificatorFunctionString:"",isImagePreloadSource:!1},Pe=(0,l.useCallback)((async e=>{let{beforeFetch:n,successFetch:t,errorFetch:o,finallyFetch:a,applyFunction:i}=e;n();const{sourceLink:r,headerKey:l,headerValue:s}=de;try{await(0,nn.Fd)(r,l,s).then((e=>{let n="";if(i){const t=D.getFieldValue("modificatorFunctionString");if(t)try{const o=(0,nn.I_)([e],null,void 0,t);console.log("dataAfterFunctionApply",o),n=JSON.stringify(o,null,2)}catch(o){}}else n=JSON.stringify(e,null,2);t(n)}))}catch(c){oe.Ay.error("Failed to fetch data"),o()}finally{null===a||void 0===a||a()}}),[de,D]);(0,l.useEffect)((()=>{"remote"!==_||te||q("local"),"modified"!==_||ne||q("local"),G(null)}),[_,te,ne]);const Fe=(0,l.useMemo)((()=>{const e=()=>"local"===se?ee?(0,H.jsx)(h.A,{style:{textTransform:"capitalize"},icon:(0,H.jsx)(He.A,{}),loading:"loading"===K,onClick:()=>{(()=>{G("loading");try{const e=D.getFieldValue("modificatorFunctionString"),n=JSON.parse(ee),t=(0,nn.I_)([n],null,void 0,e);G(JSON.stringify(t,null,2))}catch(e){console.log(e),G(null)}})()},ghost:!0,children:"Calculate Local Modified Data"}):(0,H.jsx)("p",{children:"Your local source is empty"}):"remote"===se?te?(0,H.jsx)(h.A,{style:{textTransform:"capitalize"},icon:(0,H.jsx)(He.A,{}),loading:"loading"===K,onClick:()=>Pe({applyFunction:!0,beforeFetch:()=>{G("loading")},successFetch:e=>{G(e)},errorFetch:()=>{G(null)}}),ghost:!0,children:"Calculate Remote Modified Data"}):(0,H.jsx)("p",{children:"Remote URL is not presented in ENV or datasource settings"}):void 0;return[{label:(0,H.jsxs)(H.Fragment,{children:["Set Local Source ",ke()]}),key:"local",children:(0,H.jsx)(rn,{hasErrors:!!xe.length,children:(0,H.jsx)(ue.A.Item,{noStyle:!0,name:"sourceObject",validateStatus:xe.length?"error":void 0,rules:[()=>({validator:(e,n)=>xe.length?Promise.reject():Promise.resolve()})],normalize:e=>void 0===e?"":e,children:(0,H.jsx)(We.KE,{className:"monaco-editor",language:"json",loading:(0,H.jsx)(A.A,{}),options:{readOnly:!1,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"json",onValidate:we})})})},{label:"Test Remote Source",disabled:!te,key:"remote",children:null===U||"loading"===U?(0,H.jsx)(sn,{children:(0,H.jsx)(h.A,{icon:(0,H.jsx)(He.A,{}),loading:"loading"===U,onClick:()=>Pe({beforeFetch:()=>{W("loading")},successFetch:e=>{W(e)},errorFetch:()=>{W(null)}}),ghost:!0,children:"Retreive Remote Data"})}):(0,H.jsx)(rn,{hasErrors:!!xe.length,children:(0,H.jsx)(We.KE,{className:"monaco-editor",language:"json",loading:(0,H.jsx)(A.A,{}),options:{readOnly:!0,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"json",value:U})})},{label:(0,H.jsxs)(H.Fragment,{children:["Test Function",!!je.length&&(0,H.jsx)(g.A,{trigger:"hover",title:"invalid Function",content:"Function contains errors",children:(0,H.jsx)(x.A,{style:{fontSize:14,margin:"0 0 0 5px",color:"red",cursor:"help"}})})]}),disabled:!ne,key:"modified",children:(0,H.jsxs)(cn,{children:[(0,H.jsx)("div",{className:"functionBox",children:(0,H.jsx)("div",{style:{flex:1},children:(0,H.jsx)(rn,{hasErrors:!1,children:(0,H.jsx)(ue.A.Item,{name:"modificatorFunctionString",validateStatus:je.length?"error":void 0,rules:[()=>({validator:(e,n)=>je.length?Promise.reject():Promise.resolve()})],normalize:e=>void 0===e?"":e,noStyle:!0,children:(0,H.jsx)(We.KE,{className:"monaco-editor",language:"json",loading:(0,H.jsx)(A.A,{}),options:{readOnly:!1,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",lineNumbers:"off",wordWrap:"on",glyphMargin:!1,folding:!0,lineDecorationsWidth:0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"javascript",onValidate:Ce})})})})}),(0,H.jsx)("div",{className:"resultBox",children:null===K||"loading"===K?(0,H.jsx)(sn,{children:(0,H.jsx)(e,{})}):(0,H.jsx)(rn,{hasErrors:!!xe.length,children:(0,H.jsx)(We.KE,{className:"monaco-editor",language:"json",loading:(0,H.jsx)(A.A,{}),options:{readOnly:!0,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"json",value:K})})})]})}]}),[xe.length,ke,D,je.length,Pe,te,ne,K,se,ee,U]),Ne=(0,l.useMemo)((()=>{switch(_){case"local":return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(h.A,{size:"small",disabled:!te,icon:(0,H.jsx)(Ke.A,{}),type:"dashed",style:{marginLeft:10},loading:ae,onClick:()=>Pe({beforeFetch:()=>{ie(!0)},successFetch:e=>{D.setFieldsValue({sourceObject:e})},errorFetch:()=>{},finallyFetch:()=>{ie(!1)}}),children:"Fill from remote source"}),(0,H.jsx)(h.A,{size:"small",onClick:()=>{D.setFieldsValue({sourceObject:null})},disabled:!(ee&&!ae),danger:!0,icon:(0,H.jsx)(Ge.A,{}),type:"dashed",style:{marginLeft:10},children:"Clear"})]});case"remote":return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(h.A,{onClick:()=>Pe({beforeFetch:()=>{W("loading")},successFetch:e=>{W(e)},errorFetch:()=>{W(null)}}),loading:"loading"===U,size:"small",icon:(0,H.jsx)(Xe.A,{}),type:"dashed",style:{marginLeft:10},disabled:null===U||"loading"===U,children:"Refresh Remote Data"}),(0,H.jsx)(h.A,{size:"small",onClick:()=>{W(null)},disabled:null===U||"loading"===U,danger:!0,icon:(0,H.jsx)(Ge.A,{}),type:"dashed",style:{marginLeft:10},children:"Clear Preview"})]});case"modified":return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(h.A,{onClick:()=>G(null),loading:"loading"===K,size:"small",icon:(0,H.jsx)(Ge.A,{}),type:"dashed",style:{marginLeft:10},disabled:null===K||"loading"===K,children:"Clear"}),(0,H.jsx)(h.A,{size:"small",onClick:()=>me(),disabled:!re,danger:!0,icon:(0,H.jsx)(Ge.A,{}),type:"dashed",style:{marginLeft:10},children:"Discard function changes"}),(0,H.jsx)(Re.A,{size:"small",value:se,style:{marginLeft:10},onChange:e=>{ce(e),G(null)},options:[{value:"local",label:"Use Local Source"},{value:"remote",label:"Use Remote Source"}]})]});default:return null}}),[_,ae,D,Pe,re,te,K,se,me,ee,U]);return(0,H.jsx)(an,{destroyOnClose:!0,maskClosable:!1,centered:!0,title:M?"Edit datasource: ".concat(M.attributes.name):"Add new datasource",open:!0,onCancel:()=>E(!1),footer:[(0,H.jsx)(h.A,{onClick:()=>E(!1),children:"Cancel"},"back"),(0,H.jsxs)(h.A,{loading:pe,type:"primary",onClick:()=>{D.submit()},children:[M?"Save datasource":"Add datasource"," ",re?"& Update Function":""]},"submit")],children:(0,H.jsxs)(ue.A,{onValuesChange:e=>{const n=Object.keys(e);n.includes("modificatorFunctionString")&&!re&&le(!0),n.includes("modificatorId")&&(le(!1),G(null))},onFinish:async e=>{if(!L)return;const{name:n,sourceLink:t,useBaseUrl:o,headerKey:a,headerValue:i,modificatorId:r,sourceObject:l,modificatorFunctionString:s,isImagePreloadSource:c}=e;console.log("formData",e);let d={name:n||"New datasouce",production:{sourceLink:t,useBaseUrl:o,headerKey:a,headerValue:i,modificatorId:r||null,sourceObject:l,storageType:he,isImagePreloadSource:c},uid:(0,Ze.A)()};if(ve(!0),re&&null!==ge&&void 0!==ge&&ge.id&&await(0,tn.nU)({function:s},ge.id).catch((()=>{oe.Ay.error("Failed to update function"),ve(!1)})),M){const{uid:e,...n}=d;(0,fe.r$)({...n},M.id).then((()=>E(!1))).then((()=>(0,fe.$v)())).finally((()=>ve(!1)))}else(0,fe.G4)(L,d).then((()=>E(!1))).then((()=>(0,fe.$v)())).finally((()=>ve(!1)))},className:"dsForm",form:D,initialValues:Ee,scrollToFirstError:!0,children:[(0,H.jsx)(Te.A,{destroyInactivePanel:!1,expandIcon:e=>{let{isActive:n}=e;return n?(0,H.jsx)(Je.A,{}):(0,H.jsx)(Ye.A,{})},defaultActiveKey:N?[]:["form"],ghost:!0,children:(0,H.jsxs)(on,{forceRender:!0,extra:(0,H.jsx)(Ae.A,{color:"local"===he?"gold":"green",style:{marginInlineEnd:0,textTransform:"none"},children:he}),header:"DataSource Settings",children:[(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,label:"Name",name:"name",rules:[{required:!0,message:"This field is required."},()=>({validator:(e,n)=>Promise.all([(0,$e.Gl)({input:n,searchArray:T})])})],children:(0,H.jsx)(Be.A,{})}),(0,H.jsx)(c.A,{plain:!0,orientationMargin:160,orientation:"left",children:"Remote fetch settings"}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,label:"Remote URL",name:"sourceLink",children:(0,H.jsx)(ue.A.Item,{noStyle:!0,colon:!1,required:!1,name:"sourceLink",normalize:e=>void 0===e?"":e,children:(0,H.jsx)(Be.A,{allowClear:!0,spellCheck:!1,placeholder:J?"End of URL":"URL",addonBefore:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(ue.A.Item,{valuePropName:"checked",name:"useBaseUrl",noStyle:!0,children:(0,H.jsx)(ze.A,{children:(0,H.jsx)("span",{style:{userSelect:"none"},children:"Include Base Url"})})}),(0,H.jsx)(g.A,{content:(0,H.jsxs)(H.Fragment,{children:["BaseUrl: ",z||"Empty"]}),children:(0,H.jsx)(k.A,{})})]})})})}),te&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(ue.A.Item,{label:"Request Header key",colon:!1,children:(0,H.jsxs)(_e.A,{gutter:8,children:[(0,H.jsx)(qe.A,{flex:"auto",children:(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,noStyle:!0,name:"headerKey",normalize:e=>void 0===e?"":e,children:(0,H.jsx)(Be.A,{addonBefore:(0,H.jsx)("div",{style:{textTransform:"uppercase",fontSize:9,color:"gray",width:70,cursor:"default"},children:$?"custom key":(0,H.jsx)(p.A,{placement:"topLeft",title:"Value inherited from Project Environment settings",arrowPointAtCenter:!0,children:"inherited"})}),placeholder:$?"Empty":R||"Empty",allowClear:!0,spellCheck:!1,disabled:!$})})}),(0,H.jsx)(qe.A,{style:{alignSelf:"center"},children:(0,H.jsx)(ue.A.Item,{noStyle:!0,colon:!1,required:!1,valuePropName:"checked",children:(0,H.jsx)(Ue.A,{onChange:e=>{Se({formKey:"headerKey",value:e})},checked:$,size:"small"})})})]})}),(0,H.jsx)(ue.A.Item,{label:"Request Header value",colon:!1,children:(0,H.jsxs)(_e.A,{gutter:8,children:[(0,H.jsx)(qe.A,{flex:"auto",children:(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,noStyle:!0,name:"headerValue",normalize:e=>void 0===e?"":e,children:(0,H.jsx)(Be.A,{addonBefore:(0,H.jsx)("div",{style:{textTransform:"uppercase",fontSize:9,color:"gray",width:70,cursor:"default"},children:Z?"custom value":(0,H.jsx)(p.A,{placement:"topLeft",title:"Value inherited from Project Environment settings",arrowPointAtCenter:!0,children:"inherited"})}),placeholder:Z?"Empty":B||"Empty",allowClear:!0,spellCheck:!1,disabled:!Z})})}),(0,H.jsx)(qe.A,{style:{alignSelf:"center"},children:(0,H.jsx)(ue.A.Item,{noStyle:!0,colon:!1,required:!1,valuePropName:"checked",children:(0,H.jsx)(Ue.A,{onChange:e=>{Se({formKey:"headerValue",value:e})},checked:Z,size:"small"})})})]})})]}),(0,H.jsx)(c.A,{plain:!0,orientationMargin:160,orientation:"left",children:"Datasource postprocessing & manipulation"}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,label:"Modify Function",name:"modificatorId",children:(0,H.jsx)(Re.A,{options:[{value:0,label:"None"},...O]})}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,label:(0,H.jsxs)("div",{style:{width:200},children:["Image preload",(0,H.jsx)(g.A,{placement:"topLeft",title:"Datasource for Image preloading",content:"URLs array will be used to preload & cache images",trigger:"hover",arrowPointAtCenter:!0,children:(0,H.jsx)(Qe.A,{style:{marginLeft:7}})})]}),name:"isImagePreloadSource",valuePropName:"checked",children:(0,H.jsx)(Ue.A,{})})]},"form")}),(0,H.jsx)(ln,{activeKey:_,onChange:e=>{q(e)},tabBarExtraContent:{right:(0,H.jsx)("div",{style:{paddingRight:17},children:Ne})},animated:!1,type:"card",items:Fe})]})})};var un=t(73780),hn=t(7985),gn=t(67743);const mn=t(59051),{Option:pn}=Re.A,fn=l.memo((e=>{let{name:n,envIndex:t,label:o,placeholder:a,rules:i,addonAfter:r,form:s,setIsFormChanged:c}=e;const d=!("number"===typeof t),u=s.getFieldValue(["env",t,...n]),[h,g]=(0,l.useState)(void 0!==u);return d?(0,H.jsx)(ue.A.Item,{isListField:!1,label:o,colon:!1,required:!1,name:[...n],rules:i,children:(0,H.jsx)(Be.A,{addonAfter:r,placeholder:a})}):(0,H.jsx)(ue.A.Item,{colon:!1,label:o,children:(0,H.jsxs)(_e.A,{style:{flexWrap:"nowrap"},gutter:8,children:[(0,H.jsx)(qe.A,{flex:"auto",children:(0,H.jsx)(ue.A.Item,{noStyle:!0,isListField:h,label:o,colon:!1,required:!1,name:h?["env",t,...n]:n,rules:i,children:(0,H.jsx)(Be.A,{disabled:!h,addonAfter:r,placeholder:a,addonBefore:h?null:(0,H.jsx)("div",{style:{textTransform:"uppercase",fontSize:9,color:"gray"},children:"inherited"})})})}),(0,H.jsx)(qe.A,{style:{alignSelf:"center"},children:(0,H.jsx)(Ue.A,{onChange:e=>{(e=>{e?s.setFieldValue(["env",t,...n],""):s.setFieldValue(["env",t,...n],void 0),g(e),c(!0)})(e)},checked:h,size:"small"})})]})})})),vn=l.memo((e=>{let{form:n,envIndex:t,setIsFormChanged:o}=e;const a=!("number"===typeof t);return(0,H.jsxs)(H.Fragment,{children:[a?(0,H.jsx)(ue.A.Item,{colon:!0,label:"Environment name",children:(0,H.jsx)("div",{children:"Default"})}):(0,H.jsx)(ue.A.Item,{isListField:!0,colon:!1,required:!1,name:["env",t,"envName"],label:"Environment name",children:(0,H.jsx)(Be.A,{placeholder:"Environment name"})}),(0,H.jsx)(c.A,{plain:!0,orientation:"left",children:(0,H.jsx)("span",{style:{textTransform:"uppercase",fontSize:10,opacity:.7},children:"Build Options"})}),(0,H.jsx)(ue.A.Item,{isListField:!a,colon:!1,required:!1,label:"Enable console",valuePropName:"checked",name:a?["debugOptions","showConsoleOnLoad"]:["env",t,"debugOptions","showConsoleOnLoad"],children:(0,H.jsx)(Ue.A,{})}),(0,H.jsx)(fn,{setIsFormChanged:o,form:n,label:"Archive Name",placeholder:"Archive Name",envIndex:t,name:["archiveName"],rules:[()=>({validator:(e,n)=>(0,$e.fp)(n)})],addonAfter:".ch5z"}),(0,H.jsx)(c.A,{plain:!0,orientation:"left",children:(0,H.jsx)("span",{style:{textTransform:"uppercase",fontSize:10,opacity:.7},children:"Connection Options"})}),(0,H.jsx)(fn,{setIsFormChanged:o,form:n,label:"Host",placeholder:"Ip or Hostname",envIndex:t,name:["webXpanel","host"]}),(0,H.jsx)(fn,{setIsFormChanged:o,label:"ipId",form:n,placeholder:"IpId",envIndex:t,name:["webXpanel","ipId"]}),(0,H.jsx)(fn,{setIsFormChanged:o,label:"Room ID",form:n,placeholder:"Room ID",envIndex:t,name:["webXpanel","roomId"]}),(0,H.jsx)(fn,{setIsFormChanged:o,label:"Auth Token",form:n,placeholder:"Auth Token",envIndex:t,name:["webXpanel","authToken"]}),(0,H.jsx)(c.A,{plain:!0,orientation:"left",children:(0,H.jsx)("span",{style:{textTransform:"uppercase",fontSize:10,opacity:.7},children:"Dataset Options"})}),(0,H.jsx)(fn,{setIsFormChanged:o,label:"Dataset base URL",placeholder:"Dataset base URL",form:n,envIndex:t,name:["datasetOptions","hostname"]}),(0,H.jsx)(fn,{setIsFormChanged:o,label:"Authorization header key",placeholder:"Authorization header key",form:n,envIndex:t,name:["datasetOptions","headerKey"]}),(0,H.jsx)(fn,{setIsFormChanged:o,label:"Authorization header value",placeholder:"Authorization header value",form:n,envIndex:t,name:["datasetOptions","headerValue"]})]})})),xn=l.memo((e=>{var n;let{editProjectModalId:t,setEditProjectModalId:o}=e;const a=(0,i.t)((e=>e.themesList)),s=r.f.getState().workingProject,{name:d,theme:u,env:g,webXpanel:m,datasetOptions:p,debugOptions:f,archiveName:v,globalJoins:b}=null!==(n=null===s||void 0===s?void 0:s.attributes)&&void 0!==n?n:{},j={env:g,webXpanel:m,datasetOptions:p,debugOptions:f,archiveName:v,globalJoins:b,name:d,theme:null===u||void 0===u?void 0:u.data.id},[y]=ue.A.useForm(),A=ue.A.useWatch("env",y),[w,C]=(0,l.useState)(!1),[S,k]=(0,l.useState)(!1),{refreshSingleDataSource_signal_s_fb:I}=(null===s||void 0===s?void 0:s.attributes.globalJoins)||{},E=()=>(0,H.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,H.jsx)("div",{children:"Project Settings"}),(0,H.jsx)(h.A,{icon:(0,H.jsx)(gn.A,{}),loading:w,disabled:!S,onClick:()=>{y.submit()},type:"primary",children:"Save Project Settings"})]});return s?(0,H.jsx)(un.A,{closable:!0,maskClosable:!0,width:"min(600px, 85vw)",title:(0,H.jsx)(E,{}),placement:"right",onClose:()=>{S?(0,en.A)({icon:(0,H.jsx)(x.A,{}),title:"Exit project settings?",content:"Close without saving project settings?",okText:"Close without save",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>{C(!1),o(null)},onCancel:()=>{C(!1)}}):o(null)},destroyOnClose:!0,open:null!==t,children:(0,H.jsxs)(ue.A,{onValuesChange:e=>{k(!0),console.log(y.getFieldsValue())},style:{maxHeight:"100%",overflowY:"auto"},labelCol:{xs:{span:8}},wrapperCol:{xs:{span:14}},form:y,initialValues:j,onFinish:e=>{C(!0),t&&(0,ie.Qx)({projectId:t,inputData:e}).then((()=>{k(!1),oe.Ay.success("Project settings saved")})).finally((()=>C(!1)))},scrollToFirstError:!0,children:[(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:"name",label:"Name",rules:[{required:!0,message:"This field is required."}],children:(0,H.jsx)(Be.A,{})}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:"theme",label:"Theme",rules:[{required:!0,message:"This field is required."}],children:(0,H.jsx)(Re.A,{children:null===a||void 0===a?void 0:a.map((e=>(0,H.jsx)(pn,{value:e.id,children:e.attributes.name},e.id)))})}),(0,H.jsx)(c.A,{plain:!0,orientation:"left",children:(0,H.jsx)("span",{style:{textTransform:"uppercase",fontSize:10,opacity:.7},children:"Global joins"})}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:["globalJoins","analogPageFlip_signal_a_fb"],label:"Analog flip page signal",children:(0,H.jsx)(Be.A,{addonBefore:(0,H.jsx)("div",{style:{marginRight:0,marginTop:-2},children:(0,H.jsx)(hn.A,{style:{margin:0},type:"a"})}),placeholder:"Analog signal name"})}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:["globalJoins","serialPageFlip_signal_s_fb"],label:"Serial flip page signal",children:(0,H.jsx)(Be.A,{addonBefore:(0,H.jsx)("div",{style:{marginRight:0,marginTop:-2},children:(0,H.jsx)(hn.A,{style:{margin:0},type:"s"})}),placeholder:"Serial signal name"})}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:["globalJoins","notification_signal_s_fb"],label:"Notification signal",children:(0,H.jsx)(Be.A,{addonBefore:(0,H.jsx)("div",{style:{marginRight:0,marginTop:-2},children:(0,H.jsx)(hn.A,{style:{margin:0},type:"s"})}),placeholder:"Serial signal name"})}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:["globalJoins","refreshDataSources_signal_d_fb"],label:"Refresh All DataSources",children:(0,H.jsx)(Be.A,{addonBefore:(0,H.jsx)("div",{style:{marginRight:0,marginTop:-2},children:(0,H.jsx)(hn.A,{style:{margin:0},type:"d"})}),placeholder:"Digital signal name"})}),(0,H.jsx)(ue.A.Item,{colon:!1,initialValue:I,required:!1,name:["globalJoins","refreshSingleDataSource_signal_s_fb"],label:"Refresh Single DataSource",children:(0,H.jsx)(Be.A,{addonBefore:(0,H.jsx)("div",{style:{marginRight:0,marginTop:-2},children:(0,H.jsx)(hn.A,{style:{margin:0},type:"s"})}),placeholder:"Serial signal name"})}),(0,H.jsx)(c.A,{plain:!0}),(0,H.jsx)("div",{style:{fontSize:14,fontWeight:500,paddingBottom:20},children:"Project Environments"}),(0,H.jsx)(ue.A.List,{name:"env",children:()=>null}),(0,H.jsx)(Oe.A,{destroyInactiveTabPane:!1,className:"envProjectTabs",size:"small",type:"editable-card",onEdit:(e,n)=>{if(!s||!t)return;let o=[...null!==A&&void 0!==A?A:[]];if("add"===n){const e={envName:"ENV_"+mn().format("YYYY-MM-DD_HH-mm"),envId:(0,Ze.A)()};o.push(e),y.setFieldValue("env",o),k(!0)}else if("remove"===n&&"string"===typeof e)try{const n=Number(e);o.splice(n,1),y.setFieldValue("env",o),k(!0)}catch(a){console.log(a)}},items:[{label:"Default",key:"Default",forceRender:!0,children:(0,H.jsx)(vn,{setIsFormChanged:k,form:y})},...(null!==A&&void 0!==A?A:[]).map(((e,n)=>({label:e.envName||"no_name",key:String(n),forceRender:!0,children:(0,H.jsx)(vn,{setIsFormChanged:k,form:y,envIndex:n})})))]})]})}):null})),bn=xn,jn=e=>{let{setNewGlobalContainerVisible:n,newGlobalContainerVisible:t}=e;const{projectId:o}=(0,F.g)(),a=(0,r.f)((e=>e.workingProject)),i=null===a||void 0===a?void 0:a.attributes.globalContainers;const[l]=ue.A.useForm(),s=()=>{l.submit()};return(0,H.jsx)("div",{onKeyUp:e=>{"Enter"===e.key&&s()},children:(0,H.jsx)(ae.A,{afterClose:()=>l.resetFields(),maskClosable:!1,title:"Add New Global Container",open:!0,onCancel:()=>n(!1),footer:[(0,H.jsx)(h.A,{onClick:()=>n(!1),children:"Cancel"},"back"),(0,H.jsx)(h.A,{type:"primary",onClick:s,children:"Add global container"},"submit")],children:(0,H.jsxs)(ue.A,{labelCol:{xs:{span:8}},wrapperCol:{xs:{span:14}},form:l,onFinish:e=>{let{name:t,visibleByDefault:a,position:r}=e;let l=[{name:t||"Global Container",visibleByDefault:void 0===a||a,visibleOnPages:[],hiddenOnPages:[],elements:[],useOrientation:!1,cssClass:"globalContainer",landscapePosition:r||"top",portraitPosition:r||"top",landscape:{flow:"row",padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},align:"center",distribution:"center",border:null,size:{manualMode:!1,value:void 0,unit:"%"},backgroundColor:""},portrait:{flow:"row",padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},align:"center",distribution:"center",border:null,size:{manualMode:!1,value:void 0,unit:"%"},backgroundColor:""}}];i&&Array.isArray(i)&&(l=[...i,...l]),o&&(0,ie.Qx)({projectId:o,inputData:{globalContainers:l}}).then((()=>{n(!1)}))},initialValues:{name:"Global Container",visibleByDefault:!0},scrollToFirstError:!0,children:[(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,label:"Name",name:"name",rules:[{required:!0,message:"This field is required."},()=>({validator(e,n){return n&&(t=n,null===i||void 0===i||!i.some((e=>e.name===t)))?Promise.resolve():Promise.reject(new Error("Container name must be unique"));var t}})],children:(0,H.jsx)(Be.A,{})}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:"position",label:"Default Position",initialValue:"top",children:(0,H.jsx)(Re.A,{style:{width:"100%"},options:[{value:"top",label:"Top"},{value:"right",label:"Right"},{value:"bottom",label:"Bottom"},{value:"left",label:"Left"}]})}),(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:"visibleByDefault",label:"Default Visibility",valuePropName:"checked",children:(0,H.jsx)(Ue.A,{checkedChildren:"Visible",unCheckedChildren:"Hidden"})})]})})})};var yn,An,wn,Cn,Sn,kn,In,En=t(4976),Pn=t(77484),Fn=t(33490),Nn=t(57783);const{Panel:Mn}=Te.A,Vn=(0,U.Ay)(Oe.A)(yn||(yn=(0,s.A)(["\n  position: relative;\n  flex: 1;\n\n  .ant-tabs-content {\n    position: relative;\n    height: 100%;\n  }\n\n  .ant-tabs-tabpane {\n    height: 100%;\n    background-color: #1e1e1e;\n  }\n\n  .ant-tabs-nav {\n    margin: 0;\n  }\n\n  .ant-tabs-tab {\n    border: 0 !important;\n    min-width: 70px;\n\n    &.ant-tabs-tab-active {\n      background-color: #1e1e1e;\n\n      .ant-tabs-tab-btn {\n        color: #fff;\n        user-select: none;\n      }\n    }\n  }\n"]))),Dn=function(e){return e.trim().toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,((e,n)=>n.toUpperCase()))},Ln=(0,U.Ay)(ae.A)(An||(An=(0,s.A)(["\n  height: calc(100vh - 4%) !important;\n  width: 100% !important;\n\n  .ant-modal-content {\n    height: 100%;\n    position: relative;\n    display: flex;\n    flex-flow: column;\n\n    .modificatorForm {\n      height: 100%;\n      flex: 1;\n      position: relative;\n      display: flex;\n      flex-flow: column;\n    }\n\n    .ant-modal-body {\n      flex: 1;\n      position: relative;\n      padding: 0;\n      display: flex;\n      flex-flow: column;\n    }\n\n    .ant-collapse-header {\n      font-weight: normal !important;\n      user-select: none;\n      text-transform: uppercase;\n      font-size: 12px;\n    }\n\n    .ant-form-item-label {\n      flex-basis: 160px;\n    }\n  }\n"]))),Tn=U.Ay.div(wn||(wn=(0,s.A)(["\n  position: relative;\n  flex: 1;\n  height: 100%;\n  /* overflow: hidden; */\n  min-height: 200px;\n  border-top: 10px rgb(30, 30, 30) solid;\n  background-color: rgb(30, 30, 30);\n\n  .monaco-editor {\n    position: absolute !important;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n  }\n\n  .monaco-editor.showUnused .squiggly-inline-unnecessary {\n    text-decoration: underline;\n    text-decoration-style: wavy;\n    text-decoration-color: #ff0000;\n    opacity: 1;\n  }\n"]))),On=U.Ay.div(Cn||(Cn=(0,s.A)(["\n  position: relative;\n  display: flex;\n  height: 100%;\n"]))),Rn=U.Ay.div(Sn||(Sn=(0,s.A)(["\n  display: flex;\n  flex-flow: column;\n  flex: 1;\n"]))),Bn=U.Ay.div(kn||(kn=(0,s.A)(["\n  display: flex;\n  flex-flow: column;\n  width: 40vw;\n"]))),zn=U.Ay.div(In||(In=(0,s.A)(["\n  position: relative;\n\n  small {\n    position: absolute;\n    bottom: 17px;\n    text-transform: uppercase;\n    font-size: 7px;\n  }\n"]))),_n=e=>{var n;let{setNewModificatorVisible:t,newModificatorVisible:o}=e;const a="number"===typeof o?o:null,i=null===(n=r.f.getState().workingProject)||void 0===n?void 0:n.attributes.modificators.data.find((e=>e.id===a));console.log("editMdData",i);const[s,d]=(0,l.useState)(!1),{projectId:u}=(0,F.g)(),[m,p]=(0,l.useState)([]),[f]=ue.A.useForm(),v=ue.A.useWatch("name",f),b="RunFunction",[j,y]=(0,l.useState)(b),w=ue.A.useWatch("argumentsTestData",f),{addValueToStore:C,getValueFromStore:S}=Nn.B.getState(),{setVariableNewValue:k}=Fn.c.getState(),E=(0,l.useRef)(null),P=(0,l.useRef)(null),N=e=>{P.current=e},M=()=>{if(j===b)return(0,H.jsxs)("div",{style:{paddingRight:17,display:"flex",gap:5},children:[(0,H.jsx)(h.A,{onClick:()=>{new Promise(((e,n)=>{const t=f.getFieldValue("function");if(!t)return void n(new Error("No function found."));let o=(null===w||void 0===w?void 0:w.map((e=>{let n=null===e||void 0===e?void 0:e.testData;try{return JSON.parse(n)}catch(t){return n}})))||[];try{var a;const n=(0,nn.Cy)(t);console.log("userFunction",n);let i=n(...o,(0,nn.UN)(),C,S,k);i="object"===typeof i?JSON.stringify(i):String(i),null===(a=P.current)||void 0===a||a.getModel().setValue(i),e(i)}catch(r){var i;console.error("Error when calling finalFunction:",r);const e="Error when calling ".concat(Dn(null!==v&&void 0!==v?v:""),": ").concat(null===r||void 0===r?void 0:r.message);null===(i=P.current)||void 0===i||i.getModel().setValue(e),n(r)}})).catch((e=>{console.log(e)}))},icon:(0,H.jsx)(En.A,{}),ghost:!0,type:"primary",children:"Run"}),(0,H.jsx)(h.A,{onClick:()=>{var e;null===(e=P.current)||void 0===e||e.getModel().setValue("")},danger:!0,icon:(0,H.jsx)(Ge.A,{}),type:"dashed"})]});{var e;const n=Number(j.split("_")[1]),t=!(null===w||void 0===w||null===(e=w[n])||void 0===e||!e.testData);return(0,H.jsx)("div",{style:{paddingRight:17},children:(0,H.jsx)(h.A,{disabled:!t,onClick:()=>{(e=>{try{let n=[...w];n[e].testData="",f.setFieldsValue({argumentsTestData:n})}catch(n){console.log(n)}})(n)},danger:!0,icon:(0,H.jsx)(Ge.A,{}),type:"dashed"})})}};(0,l.useEffect)((()=>{if(j===b)return;const e=Number(j.split("_")[1]);null!==w&&void 0!==w&&w[e]||y(b)}),[w,j]),(0,l.useEffect)((()=>{var e;if(!v)return;const n=f.getFieldValue("function");if(!n)return;const t=null!==(e=null===w||void 0===w?void 0:w.map((e=>e.name)))&&void 0!==e?e:[];let o=n.split("\n");const a="function ".concat(Dn(v),"(").concat(t.join(","),"){");o[0]=a,f.setFieldsValue({function:o.join("\n")})}),[f,v,w]);const V=(0,l.useMemo)((()=>{var e;let n=[];return n=null===w||void 0===w||!w.length||null!==w&&void 0!==w&&w.some((e=>void 0===e))?[]:null===w||void 0===w?void 0:w.map(((e,n)=>({label:(0,H.jsxs)(zn,{children:[(0,H.jsx)("small",{children:"test data"}),e.name]}),key:"argument_"+n,children:(0,H.jsx)(Tn,{hasErrors:!1,children:(0,H.jsx)(ue.A.Item,{isListField:!0,preserve:!1,noStyle:!0,name:["argumentsTestData",n,"testData"],validateStatus:"success",normalize:e=>void 0===e?"":e,children:(0,H.jsx)(We.KE,{className:"monaco-editor",loading:(0,H.jsx)(A.A,{}),options:{readOnly:!1,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark"})},n)})}))),[{label:"Test Function",key:"RunFunction",children:(0,H.jsx)(Tn,{hasErrors:!1,children:(0,H.jsx)(We.KE,{value:"",onMount:N,className:"monaco-editor",language:"javascript",loading:(0,H.jsx)(A.A,{}),options:{readOnly:!0,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"javascript"})},"RunFunctionKey")},...null!==(e=n)&&void 0!==e?e:[]]}),[w]),D=i?{name:i.attributes.name,function:i.attributes.function,argumentsTestData:""===i.attributes.function.substring(i.attributes.function.indexOf("(")+1,i.attributes.function.indexOf(")")).trim()?[]:i.attributes.function.substring(i.attributes.function.indexOf("(")+1,i.attributes.function.indexOf(")")).split(",").map((e=>({name:e.trim(),testData:null})))}:{name:"My function",function:["function ".concat(Dn("My function"),"(){"),"//write your code here","","}"].join("\n"),argumentsTestData:[]},L=()=>m.length>0?(0,H.jsx)(g.A,{trigger:"hover",title:"Validation error",content:"Function contains errors",children:(0,H.jsx)(x.A,{style:{fontSize:14,margin:"0 0 0 5px",color:"red",cursor:"help"}})}):null;return(0,H.jsx)(Ln,{destroyOnClose:!0,maskClosable:!1,centered:!0,title:"Add new function",open:!0,onCancel:()=>t(!1),onOk:()=>{f.submit()},footer:[(0,H.jsx)(h.A,{onClick:()=>t(!1),children:"Cancel"},"back"),(0,H.jsx)(h.A,{disabled:m.length>0,loading:s,type:"primary",onClick:()=>{f.submit()},children:m.length>0?"Function contains errors":"Save"},"submit")],children:(0,H.jsxs)(ue.A,{onFinish:e=>{let{name:n,function:o,argumentsTestData:i}=e;d(!0),new Promise(((e,n)=>{const t=f.getFieldValue("function");if(!t)return void n(new Error("No function found."));let o=!0,a=(null===w||void 0===w?void 0:w.map((e=>{null!==e&&void 0!==e&&e.testData||(o=!1);let n=null===e||void 0===e?void 0:e.testData;try{return JSON.parse(n)}catch(t){return n}})))||[];try{const n=(0,nn.Cy)(t);if(console.log("userFunction",n),o){var i;let t=n(...a,(0,nn.UN)(),C,S,k);t="object"===typeof t?JSON.stringify(t):String(t),null===(i=P.current)||void 0===i||i.getModel().setValue(t),e(t)}else e("No arguments")}catch(l){var r;console.error("Error when calling finalFunction:",l);const e="Error when calling ".concat(Dn(null!==v&&void 0!==v?v:""),": ").concat(null===l||void 0===l?void 0:l.message);null===(r=P.current)||void 0===r||r.getModel().setValue(e),n(l)}})).then((()=>{const e={name:n||"New function",function:o};a?(0,tn.nU)({...e},a).then((()=>{t(!1)})):u&&(0,tn.IR)(u,{...e,argumentsTestData:i}).then((()=>{t(!1)}))})).catch((e=>{y(b),oe.Ay.error("Function test failed: "+e.message),console.log(e)})).finally((()=>{d(!1)}))},className:"modificatorForm",form:f,initialValues:D,scrollToFirstError:!0,children:[(0,H.jsx)(Te.A,{destroyInactivePanel:!1,expandIcon:e=>{let{isActive:n}=e;return n?(0,H.jsx)(Je.A,{}):(0,H.jsx)(Ye.A,{})},defaultActiveKey:["form"],ghost:!0,children:(0,H.jsxs)(Mn,{forceRender:!0,header:"Function Settings",children:[(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,label:"Name",name:"name",rules:[{required:!0,message:"This field is required."},()=>({validator:(e,n)=>Promise.all([(0,$e.Gl)({input:n,searchArray:[]}),(0,$e.cv)(n),(0,$e.Ld)(n||"")])})],children:(0,H.jsx)(Be.A,{spellCheck:!1})}),(0,H.jsx)(c.A,{plain:!0,orientationMargin:160,orientation:"left",children:"Function Arguments"}),(0,H.jsx)(ue.A.List,{name:"argumentsTestData",children:(e,n)=>{let{add:t,remove:o}=n;return(0,H.jsxs)(H.Fragment,{children:[e.map(((e,n)=>(0,H.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"flex-start",marginBottom:15},children:[(0,H.jsx)(ue.A.Item,{...e,label:"Argument #"+(n+1),name:[e.name,"name"],validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."},()=>({validator:(e,t)=>Promise.all([(0,$e.Gl)({input:t,searchArray:w.filter(((e,t)=>t!==n))||[],searchKey:"name"}),(0,$e.fp)(t),(0,$e.cv)(t),(0,$e.Ld)(t||"")])})],style:{marginBottom:0,flex:1,maxWidth:600},children:(0,H.jsx)(Be.A,{spellCheck:!1,autoFocus:!0})}),(0,H.jsx)(Pn.A,{style:{marginTop:10},onClick:()=>o(e.name)})]},e.key))),(0,H.jsx)(ue.A.Item,{style:{maxWidth:600},label:" ",colon:!1,children:(0,H.jsx)(h.A,{type:"dashed",onClick:()=>t({name:"arg".concat(w.length+1),testData:void 0}),style:{width:"100%"},block:!0,icon:(0,H.jsx)(I.A,{}),children:"Add Function Argument"})})]})}})]},"form")}),(0,H.jsxs)(On,{children:[(0,H.jsxs)(Rn,{children:[(0,H.jsxs)(c.A,{plain:!0,orientationMargin:17,style:{paddingRight:17,marginBottom:9.5},orientation:"left",children:["Function Body editor",(0,H.jsx)(L,{})]}),(0,H.jsx)(Tn,{hasErrors:!!m.length,children:(0,H.jsx)(ue.A.Item,{noStyle:!0,name:"function",dependencies:["name"],validateStatus:m.length?"error":void 0,rules:[()=>({validator:(e,n)=>m.length?Promise.reject():Promise.resolve()})],normalize:e=>void 0===e?"":e,children:(0,H.jsx)(We.KE,{onMount:e=>{E.current=e,e.onKeyDown((e=>{const n=E.current&&E.current.getPosition().lineNumber,t=E.current&&E.current.getModel().getLineCount(),o=E.current.getSelection(),{startLineNumber:a,endLineNumber:i,selectionStartLineNumber:r}=o;1!==n&&n!==t&&1!==a&&a!==t&&1!==i&&i!==t&&1!==r&&r!==t||(e.stopPropagation(),e.preventDefault())}))},className:"monaco-editor",language:"javascript",loading:(0,H.jsx)(A.A,{}),options:{readOnly:!1,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0},showUnused:!0},theme:"vs-dark",defaultLanguage:"javascript",onValidate:e=>{p(e)}})})})]}),(0,H.jsx)(Bn,{children:(0,H.jsx)(Vn,{activeKey:j,onChange:e=>{y(e)},tabBarExtraContent:{right:(0,H.jsx)(M,{})},animated:!1,type:"card",items:V})})]})]})})};var qn=t(15369);const Un=e=>{var n;let{setNewPageModalVisible:t,newPageModalVisible:o}=e;const a=(null===(n=r.f.getState().workingProject)||void 0===n?void 0:n.attributes.pages.data)||[],{projectId:i}=(0,F.g)(),[s]=ue.A.useForm(),c=ue.A.useWatch("isStatic",s);return(0,l.useEffect)((()=>{c&&oe.Ay.warning("Crestron old farts mode activated!")}),[c]),(0,H.jsx)(ae.A,{afterClose:()=>s.resetFields(),maskClosable:!1,title:"Add new ".concat(o),open:!0,onCancel:()=>t(null),footer:[(0,H.jsx)(h.A,{onClick:()=>t(null),children:"Cancel"},"back"),(0,H.jsxs)(h.A,{type:"primary",onClick:()=>{s.submit()},children:["Add new ",o]},"submit")],children:(0,H.jsx)(ue.A,{labelCol:{xs:{span:9}},wrapperCol:{xs:{span:12}},form:s,initialValues:{name:"page name",url:"mypage"},onFinish:e=>{let{name:n,isStatic:a,width:r,height:l}=e;i&&(0,qn.a3)({name:n,project:i,isSubpage:"subpage"===o,isStatic:!!a,width:{width:{value:r,unit:"px"}},height:{height:{value:l,unit:"px"}}}).then((()=>t(null)))},scrollToFirstError:!0,children:(0,H.jsx)(ue.A.Item,{colon:!1,required:!1,name:"name",label:"Name",rules:[{required:!0,message:"This field is required."},()=>({validator:(e,n)=>(0,$e.Gl)({input:n,searchArray:a,searchKey:["attributes","name"]})})],children:(0,H.jsx)(Be.A,{})})})})};var Wn=t(89264),Hn=t(41967);const Kn=(0,l.lazy)((()=>t.e(7578).then(t.bind(t,77578)))),Gn=()=>{const e=(0,B.k)((e=>e.jwt)),n=(0,F.zy)(),t=(0,F.Zp)(),[o,s]=(0,te.ok)();(0,l.useEffect)((()=>{if(o.size){function e(){s({})}const n=o.get("paymentFeedback");if(n)switch(n){case"buyBuildError":ae.A.error({icon:null,maskClosable:!1,content:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)("div",{style:{color:"red",paddingBottom:5},children:(0,H.jsx)(x.A,{})}),"We can't process your payment. Please try again later."]}),okText:"Close",onOk:()=>e()});break;case"buyBuildOk":ae.A.success({icon:null,maskClosable:!1,content:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)("div",{style:{color:"green",paddingBottom:5},children:(0,H.jsx)(Hn.A,{})}),"Thank you for your purchase! Now project have unlimited builds."]}),okText:"Close",onOk:()=>e()});break;default:ae.A.error({icon:null,maskClosable:!1,content:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)("div",{style:{color:"red",paddingBottom:5},children:(0,H.jsx)(x.A,{})}),"Unknown payment feedback: ",n]}),okText:"Close",onOk:()=>e()}),console.error("Unknown payment feedback: ",n)}}return()=>{ae.A.destroyAll()}}),[o,s]);const d=(0,l.useMemo)((()=>e?Se()(e):void 0),[e]);we.axiosInstance.interceptors.response.use((e=>e.data&&(200===e.status||201===e.status)?e:Promise.reject(e)),(e=>(401===e.response.status&&(0,v.je)(),Promise.reject(e))));const u="avstudio.local";(0,l.useEffect)((()=>{0}),[u]),(0,l.useEffect)((()=>{n.pathname,0}),[u,n.pathname]),(0,l.useEffect)((()=>{e||t("/login")}),[n.pathname,e,t]);const{projectId:g}=(0,F.g)(),{pageId:m}=(0,F.g)(),{ConfirmModal:p}=re(),{fillProjectsList:f}=a.F.getState(),{fetchAndFill:b,resetWorkingProject:j,clearHistory:y}=r.f.getState(),A=(0,r.f)((e=>e.workingProject)),w=null===A||void 0===A?void 0:A.attributes.datasources.data,[C,S]=(0,l.useState)(!1),[k,I]=(0,l.useState)(!1),E=(0,l.useRef)(!1);(0,l.useEffect)((()=>{function n(){ye.A.destroy(),E.current=!1}if(!g&&e&&!E.current){const e=Pe.getState().fetchVersions;try{e().then((e=>{if(null!==e&&void 0!==e&&e.length){var t;const o="0.41.0",a=null===e||void 0===e?void 0:e[0],{version:i,text:r}=null!==(t=null===a||void 0===a?void 0:a.attributes)&&void 0!==t?t:{};if(!o||!i)return;let l=!1;Number(o.replace(/\./g,""))<Number(i.replace(/\./g,""))&&(l=!0),l&&(E.current=!0,ye.A.destroy(),ye.A.info({message:"New version available",onClose:n,description:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)("div",{style:{marginBottom:5},children:(0,H.jsxs)(Ae.A,{children:["Current ",o," => New ",i]})}),r," ",(0,H.jsx)(c.A,{style:{margin:"15px 0"}})," ",(0,H.jsx)(h.A,{onClick:()=>{!async function(e){await fetch(e,{headers:{Pragma:"no-cache",Expires:"-1","Cache-Control":"no-cache"}}),window.location.href=e,window.location.reload()}(window.location.href)},style:{marginRight:5},type:"primary",children:"Refresh to update"}),(0,H.jsx)(h.A,{onClick:()=>n(),children:"Later"})]}),onClick:()=>{},placement:"top",duration:null}))}}))}catch(t){console.log(t)}}}),[g,e]),(0,de.A)({initVariableArr:null===A||void 0===A?void 0:A.attributes.variables}),(0,l.useEffect)((()=>{null===w||void 0===w||!w.length||C||k||(S(!0),(0,fe.$v)().then((()=>{I(!0),S(!1)})))}),[w]);const P=(0,ce.A)({pageId:m}),N=(0,L.x)((e=>e.showBoundingBox)),{setMainMenuData:M}=L.x.getState(),{addNewTab:V,clearTabs:D}=r.f.getState(),T=le.Q.getState().setEnvState,O=(0,se.A)({projectId:d,isEditor:!0,jwt:e,autoConnect:!0}),R=(0,L.x)((e=>e.selectedMenuSection.elementIndex));(0,l.useEffect)((()=>{if(null===R){(0,je.getState().setSelectedElementRef)({current:null})}}),[R]),(0,l.useEffect)((()=>{M({pageSearchString:void 0,subPageSearchString:void 0})}),[g,M]),(0,l.useEffect)((()=>{null!==P&&void 0!==P&&P.attributes.isSubpage?M({isSubpageEditor:!0}):M({isSubpageEditor:!1})}),[null===P||void 0===P?void 0:P.attributes.isSubpage,M]),(0,l.useEffect)((()=>{null!==P&&void 0!==P&&P.attributes.isStatic?(M({isStaticEditor:!0}),oe.Ay.info("You are in static editor mode")):M({isStaticEditor:!1})}),[null===P||void 0===P?void 0:P.attributes.isStatic,M]);const z=(0,l.useRef)();(0,l.useEffect)((()=>(O&&d&&(console.log("liveUid-instance",d),O.on("connect",(()=>{console.log("Socket EDITOR connected!")})),O.on("disconnect",(()=>{console.log("Socket EDITOR disconnected!")})),O.on("requestProject",(e=>{const n=r.f.getState().workingProject;n&&(z.current=setTimeout((()=>{clearTimeout(z.current),O.emit("project",{...n,id:d}),console.log("requestProject initiated - initial data project pushed to: ",d,"requested from",e)}),500))}))),()=>{z.current&&clearTimeout(z.current)})),[O,d]),(0,l.useEffect)((()=>(O&&A&&d&&(z.current=setTimeout((()=>{clearTimeout(z.current),O.emit("project",{...A,id:d}),console.log("project data pushed to: ",d)}),500)),()=>{z.current&&clearTimeout(z.current)})),[d,O,A]),(0,l.useEffect)((()=>{m&&T(N?"editor":"preview")}),[m,T,N]),(0,l.useEffect)((()=>{m&&A&&V(m)}),[V,m,A]),(0,l.useLayoutEffect)((()=>{if(!e)return;(0,i.t.getState().fetchAndFillThemesList)()}),[e]),(0,l.useEffect)((()=>{y()}),[y,m]),(0,l.useEffect)((()=>{g||(0,Le.E)()}),[g]);const _=(0,l.useRef)(!1);(0,l.useLayoutEffect)((()=>{e&&(g?(A&&String(A.id)!==g&&j(),A||_.current||(_.current=!0,b(g).then((()=>{_.current=!1})))):(f(),D(),y()))}),[b,f,g,j,null===A||void 0===A?void 0:A.id,D,y,A,e]);const[q,U]=(0,l.useState)(null),[K,G]=(0,l.useState)(null),[X,J]=(0,l.useState)(!1),[Y,Q]=(0,l.useState)(!1),[$,Z]=(0,l.useState)(!1),[ie,ue]=(0,l.useState)(null),[he,ge]=(0,l.useState)(!1),{CloneModal:me,setCloneItemModal:ve}=pe(),xe={editProjectModalId:q,setEditProjectModalId:U,newPageModalVisible:K,setNewPageModalVisible:G,newGlobalContainerVisible:he,setNewGlobalContainerVisible:ge,setNewDatasourceVisible:Q,newDatasourceVisible:Y,setNewModificatorVisible:Z,newModificatorVisible:$,setEditModificator:ue,editModificator:ie,newVariableModalVisible:X,setNewVariableModalVisible:J,CloneModal:me,setCloneItemModal:ve},be=je((e=>e.selectedElementRef)),Ce=(0,L.x)((e=>e.isStaticEditor)),ke=je((e=>e.staticEementsGuidesClasses)),Ie=je((e=>e.activeStaticElementKey)),Ee=ke.filter((e=>e!==Ie));return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(ne.Dz,{children:[(0,H.jsx)(ne.QX,{children:(0,H.jsx)(ee,{setEditProjectModalId:U})}),(0,H.jsx)(ne.C2,{children:(0,H.jsx)(F.sv,{context:xe})})]}),q&&(0,H.jsx)(bn,{editProjectModalId:q,setEditProjectModalId:U},g+"_EditProjectModal"),K&&(0,H.jsx)(Un,{newPageModalVisible:K,setNewPageModalVisible:G},g+"_NewPageModal"),X&&(0,H.jsx)(Wn.A,{setNewVariableModalVisible:J},g+"_NewVariableModal"),he&&(0,H.jsx)(jn,{setNewGlobalContainerVisible:ge,newGlobalContainerVisible:he},g+"_NewGlobalContainerModal"),$&&(0,H.jsx)(_n,{setNewModificatorVisible:Z,newModificatorVisible:$},g+"_NewModificatorModal"),Y&&(0,H.jsx)(dn,{setNewDatasourceVisible:Q,newDatasourceVisible:Y},g+"_NewDatasourceModal"),me,(0,H.jsx)(p,{}),Ce&&(0,H.jsx)(l.Suspense,{fallback:(0,H.jsx)(W.A,{}),children:(0,H.jsx)(Kn,{target:N?be:null,zoom:1,snappable:!0,snapThreshold:5,snapContainer:".page",bounds:{left:0,top:0,right:0,bottom:0,position:"css"},isDisplaySnapDigit:!0,isDisplayInnerSnapDigit:!1,snapGap:!0,snapDirections:{top:!0,left:!0,bottom:!0,right:!0,center:!0,middle:!0},elementSnapDirections:{top:!0,left:!0,bottom:!0,right:!0,center:!0,middle:!0},dragTargetSelf:!1,elementGuidelines:Ee,useMutationObserver:!0,origin:!1,throttleResize:0,throttleDrag:0,throttleRotate:0,startDragRotate:0,throttleDragRotate:0,draggable:!0,resizable:!1,scalable:!1,keepRatio:!0,rotatable:!1,padding:10,onDrag:e=>{const{target:n,transform:t}=e;n.style.transform=t}})})]})}},86945:(e,n,t)=>{"use strict";t.d(n,{$4:()=>w,HQ:()=>C,Jy:()=>b,Qx:()=>y,Td:()=>k,VY:()=>A,Zp:()=>x,iq:()=>j,nb:()=>I,oS:()=>S,ze:()=>E});var o,a,i,r,l,s,c,d,u,h,g,m,p=t(57528),f=t(86006);const v=(0,f.i7)(o||(o=(0,p.A)(["\n  from {\nopacity: 0;\ntransform: scaleY(0.8) translateY(-100%);\nheight: 0;\n  }\n\n  to {\n   opacity: 1;\n   transform: scaleY(1) translateY(0);\n   height: auto;\n  }\n"]))),x=f.Ay.div(a||(a=(0,p.A)(["\n  position: relative;\n\n  display: flex;\n  flex-flow: column;\n\n  .ant-card-body {\n    flex: 1;\n  }\n\n  .ant-card-meta {\n    display: block;\n  }\n\n  .ant-table-tbody > tr:last-child > td {\n    border-bottom: 0;\n  }\n\n  .ant-table-tbody > tr {\n    overflow: hidden;\n    transition: 200ms;\n    animation-name: ",";\n    animation-timing-function: linear;\n    animation-duration: 300ms;\n  }\n\n  .ant-card-actions > li > span {\n    cursor: default;\n  }\n\n  .lastProjectLink {\n    color: var(--ant-primary-5);\n    cursor: pointer;\n  }\n\n  .projectCardActionsBox {\n    display: flex;\n    gap: 20px;\n  }\n"])),v),b=f.Ay.div(i||(i=(0,p.A)(["\n  position: absolute;\n  left: 2px;\n  top: 2px;\n  right: 2px;\n  height: 5px;\n  background-color: gray;\n  border-radius: 2px;\n"]))),j=f.Ay.div(r||(r=(0,p.A)(["\n  display: grid;\n  gap: 1vmax;\n  /* grid-template-columns: repeat(auto-fit, minmax(250px, 400px)); */\n  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\n"]))),y=f.Ay.div(l||(l=(0,p.A)(["\n  position: relative;\n  display: flex;\n  flex-flow: column;\n  user-select: none;\n  flex: 1;\n"]))),A=f.Ay.div(s||(s=(0,p.A)(["\n  position: relative;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px;\n\n  & > section {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    gap: 5px;\n\n    &.center {\n      justify-content: center;\n    }\n    &.right {\n      justify-content: flex-end;\n    }\n  }\n"]))),w=f.Ay.div(c||(c=(0,p.A)(["\n  position: relative;\n  background-color: rgb(77 75 84);\n  display: flex;\n  align-items: stretch;\n\n  .tabsScroller {\n    width: 100%;\n    flex: 1;\n    align-items: stretch;\n    position: relative;\n\n    .inner {\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      overflow: hidden;\n      overflow-y: visible !important;\n      display: flex;\n    }\n  }\n"]))),C=f.Ay.button(d||(d=(0,p.A)(["\n  --tab-padding: 12px;\n\n  position: relative;\n  background-color: transparent;\n  border-width: 0;\n  padding: var(--tab-padding);\n  font-size: 13px;\n  border-radius: 0;\n  color: rgba(255, 255, 255, 0.65);\n  cursor: pointer;\n  transition: 200ms;\n  min-width: 100px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 5px;\n  min-width: min-content;\n\n  small {\n    position: absolute;\n    left: calc(var(--tab-padding) + 18px);\n    top: 5px;\n    font-size: 7px;\n    text-transform: uppercase;\n\n    color: rgb(223 164 255);\n  }\n\n  .tabText {\n    position: relative;\n    white-space: nowrap;\n    max-width: 200px;\n    min-height: fit-content;\n\n    .textOverflow {\n      position: relative;\n      width: 100%;\n      height: auto;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      line-height: 120%;\n    }\n\n    &::after {\n      content: '';\n      position: absolute;\n      right: -0.5em;\n      top: -0.2em;\n      width: 5px;\n      height: 5px;\n      border-radius: 50%;\n      background-color: #fc5d5d;\n      transition: 200ms;\n      scale: ",";\n    }\n  }\n\n  &::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    width: 100%;\n    height: 0.5px;\n    bottom: 2px;\n    transition: 200ms;\n  }\n\n  &::after {\n    content: '';\n    position: absolute;\n    left: 0;\n    width: 100%;\n    height: 2px;\n    bottom: 0;\n    transition: 200ms;\n  }\n\n  &.isActive {\n    background-color: rgba(0, 0, 0, 0.2);\n    &::after {\n      background-color: var(--ant-primary-5);\n    }\n    &::before {\n      background-color: rgba(255, 255, 255, 0.7);\n    }\n  }\n\n  .closeIco {\n    margin-left: 10px;\n    scale: 0;\n    will-change: scale;\n    transition: 200ms;\n    font-size: 0.9em;\n\n    &:hover {\n      color: #fff;\n    }\n  }\n\n  &:hover {\n    color: rgba(255, 255, 255, 0.9);\n    background-color: rgba(0, 0, 0, 0.2);\n\n    .closeIco {\n      scale: 1;\n    }\n  }\n"])),(e=>{let{$showDot:n}=e;return n?1:0})),S=f.Ay.div(u||(u=(0,p.A)(["\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background-color: #262626;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]))),k=f.Ay.div(h||(h=(0,p.A)(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n  background-color: #fff;\n"]))),I=f.Ay.div(g||(g=(0,p.A)(["\n  position: fixed;\n  z-index: 100;\n  pointer-events: none;\n  transition: 200ms;\n  outline: 0.5px rgb(153, 255, 20) dashed;\n  outline-offset: 7px;\n  will-change: left, top, width, height, opacity;\n\n  .infoBar {\n    position: absolute;\n    left: -7.5px;\n    bottom: calc(100% + 10px);\n    display: flex;\n    gap: 2px;\n\n    & > div {\n      font-size: 11px;\n      padding: 0.3em;\n      border-radius: 2px;\n      width: fit-content;\n    }\n  }\n\n  .elementTypeName {\n    background-color: rgb(153, 255, 20);\n    color: #000;\n  }\n\n  .elementActiveModeIndex {\n    background-color: rgb(216, 20, 255);\n    color: #fff;\n  }\n"]))),E=f.Ay.div(m||(m=(0,p.A)(["\n  position: relative;\n  display: flex;\n  white-space: nowrap;\n  align-items: center;\n  gap: 5px;\n\n  .innerBox {\n    flex: 1;\n    position: relative;\n\n    .ant-input {\n      width: '100%';\n    }\n  }\n"])))},89264:(e,n,t)=>{"use strict";t.d(n,{A:()=>j});var o=t(87827),a=t(92759),i=t(44719),r=t(48538),l=t(77645),s=t(17811),c=t(84649),d=t(25933),u=t(7985),h=t(27911),g=t(9418),m=t(9950),p=t(28429),f=t(39165),v=t(64983),x=t(93072),b=t(44414);const j=e=>{let{setNewVariableModalVisible:n,isParameterCreation:t}=e;const{projectId:j}=(0,p.g)(),{pageId:y}=(0,p.g)(),A=(0,f.A)({pageId:y}),w=(0,v.f)((e=>e.workingProject)),C=(null===w||void 0===w?void 0:w.attributes.variables)||[],{parameters:S}=(null===A||void 0===A?void 0:A.attributes)||{},[k]=o.A.useForm(),I=()=>{k.submit()},[E,P]=(0,m.useState)(!1),F={name:"newVariable",type:"boolean",defaultValue_boolean:"false",defaultValue_number:0,defaultValue_string:"",joinValueSetter_signal_fb:"",waitForLoadingUi:!1},[N,M]=(0,m.useState)(F);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(i.A,{maskClosable:!1,title:"Add new variable",open:!0,width:"50vw",onOk:I,onCancel:()=>n(!1),footer:[(0,b.jsx)(r.A,{onClick:()=>n(!1),children:"Cancel"},"back"),(0,b.jsx)(r.A,{loading:E,type:"primary",onClick:I,children:"Add new variable"},"submit")],children:(0,b.jsxs)(o.A,{onValuesChange:e=>M({...N,...e}),labelCol:{xs:{span:9}},wrapperCol:{xs:{span:12}},form:k,initialValues:F,onFinish:e=>{let{type:o,defaultValue_boolean:i,defaultValue_number:r,defaultValue_string:l,name:s,joinValueSetter_signal_fb:c,waitForLoadingUi:d}=e,u={name:s,type:o,joinValueSetter_signal_fb:c};switch(u.type){case"boolean":u={...u,defaultValue:"true"===i,waitForLoadingUi:d};break;case"string":u={...u,defaultValue:l};break;case"number":u={...u,defaultValue:r}}if(P(!0),t){let e={...u,pageId:y};(0,g.rz)({newVariable:e,projectId:j}).then((()=>{let e=u;(0,x.yd)({newPageAttributes:{parameters:[...S||[],e]},pageId:y}).then((()=>{k.resetFields(),n(!1),P(!1),a.Ay.success("Parameter created successfully")}))}))}else{let e=u;(0,g.rz)({newVariable:e,projectId:j}).then((()=>{n(!1),P(!1),a.Ay.success("Variable created successfully")}))}},scrollToFirstError:!0,children:[(0,b.jsx)(o.A.Item,{colon:!1,name:"name",label:"Name",rules:[{required:!0,message:"This field is required."},()=>({validator:(e,n)=>Promise.all([(0,h.Gl)({input:n,searchArray:C,searchKey:"name"}),(0,h.fp)(n),(0,h.cv)(n),(0,h.Ld)(n)])})],children:(0,b.jsx)(l.A,{spellCheck:!1})}),(0,b.jsx)(o.A.Item,{colon:!1,name:"type",label:"Type",rules:[{required:!1}],children:(0,b.jsxs)(s.Ay.Group,{className:"radioFullWidth",buttonStyle:"solid",children:[(0,b.jsx)(s.Ay.Button,{value:"boolean",children:"Boolean"}),(0,b.jsx)(s.Ay.Button,{value:"string",children:"String"}),(0,b.jsx)(s.Ay.Button,{value:"number",children:"Number"})]})}),"string"===N.type&&(0,b.jsx)(o.A.Item,{colon:!1,name:"defaultValue_string",label:"Default Value",children:(0,b.jsx)(l.A,{spellCheck:!1})}),"boolean"===N.type&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.A.Item,{colon:!1,name:"defaultValue_boolean",label:"Default Value",children:(0,b.jsx)(c.A,{block:!0,options:["true","false"]})}),(0,b.jsx)(o.A.Item,{label:"Use for loading UI (exprerimental)",name:"waitForLoadingUi",colon:!1,required:!1,valuePropName:"checked",children:(0,b.jsx)(d.A,{})})]}),"number"===N.type&&(0,b.jsx)(o.A.Item,{colon:!1,name:"defaultValue_number",initialValue:0,label:"Default Value",rules:[()=>({validator:(e,n)=>Promise.all([(0,h.z2)(n),(0,h.mC)(n)])})],children:(0,b.jsx)(l.A,{style:{width:"100%"}})}),!t&&N.type&&(0,b.jsx)(o.A.Item,{extra:(0,b.jsx)(b.Fragment,{children:"Use signal feedback to modify variable"}),colon:!1,name:"joinValueSetter_signal_fb",label:(0,b.jsx)(b.Fragment,{children:"Set value Signal "}),rules:[()=>({validator:(e,n)=>(0,h.fp)(n)})],children:(0,b.jsx)(l.A,{suffix:(0,b.jsx)("div",{style:{marginRight:-5,marginTop:-2},children:(0,b.jsx)(u.A,{style:{margin:0},type:N.type,sub:"FB"})}),spellCheck:!1})})]})})})}},42634:()=>{}}]);