import{r as O,a as oe,j as nt,ac as it}from"./index-BWO8qd00.js";import{u as be}from"./variablesAPI-D_uU0Jyf.js";import{g as rt}from"./useCustomFonts--hfI8X19.js";import{u as Ie}from"./useWindowAvgatorStudioComposer-LuIThOM1.js";import{a as se,u as ae,S as ot}from"./editorApp-BQHhAWNR.js";const P=Object.create(null);P.open="0";P.close="1";P.ping="2";P.pong="3";P.message="4";P.upgrade="5";P.noop="6";const K=Object.create(null);Object.keys(P).forEach(i=>{K[P[i]]=i});const le={type:"error",data:"parser error"},Oe=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",De=typeof ArrayBuffer=="function",we=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,_e=({type:i,data:t},n,e)=>Oe&&t instanceof Blob?n?e(t):Se(t,e):De&&(t instanceof ArrayBuffer||we(t))?n?e(t):Se(new Blob([t]),e):e(P[i]+(t||"")),Se=(i,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(i)};function ye(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let ce;function st(i,t){if(Oe&&i.data instanceof Blob)return i.data.arrayBuffer().then(ye).then(t);if(De&&(i.data instanceof ArrayBuffer||we(i.data)))return t(ye(i.data));_e(i,!1,n=>{ce||(ce=new TextEncoder),t(ce.encode(n))})}const ve="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",j=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<ve.length;i++)j[ve.charCodeAt(i)]=i;const at=i=>{let t=i.length*.75,n=i.length,e,r=0,s,a,c,l;i[i.length-1]==="="&&(t--,i[i.length-2]==="="&&t--);const T=new ArrayBuffer(t),E=new Uint8Array(T);for(e=0;e<n;e+=4)s=j[i.charCodeAt(e)],a=j[i.charCodeAt(e+1)],c=j[i.charCodeAt(e+2)],l=j[i.charCodeAt(e+3)],E[r++]=s<<2|a>>4,E[r++]=(a&15)<<4|c>>2,E[r++]=(c&3)<<6|l&63;return T},ct=typeof ArrayBuffer=="function",ge=(i,t)=>{if(typeof i!="string")return{type:"message",data:ke(i,t)};const n=i.charAt(0);return n==="b"?{type:"message",data:xt(i.substring(1),t)}:K[n]?i.length>1?{type:K[n],data:i.substring(1)}:{type:K[n]}:le},xt=(i,t)=>{if(ct){const n=at(i);return ke(n,t)}else return{base64:!0,data:i}},ke=(i,t)=>{switch(t){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},Le="",ut=(i,t)=>{const n=i.length,e=new Array(n);let r=0;i.forEach((s,a)=>{_e(s,!1,c=>{e[a]=c,++r===n&&t(e.join(Le))})})},lt=(i,t)=>{const n=i.split(Le),e=[];for(let r=0;r<n.length;r++){const s=ge(n[r],t);if(e.push(s),s.type==="error")break}return e};function ht(){return new TransformStream({transform(i,t){st(i,n=>{const e=n.length;let r;if(e<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,e);else if(e<65536){r=new Uint8Array(3);const s=new DataView(r.buffer);s.setUint8(0,126),s.setUint16(1,e)}else{r=new Uint8Array(9);const s=new DataView(r.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(e))}i.data&&typeof i.data!="string"&&(r[0]|=128),t.enqueue(r),t.enqueue(n)})}})}let xe;function q(i){return i.reduce((t,n)=>t+n.length,0)}function Y(i,t){if(i[0].length===t)return i.shift();const n=new Uint8Array(t);let e=0;for(let r=0;r<t;r++)n[r]=i[0][e++],e===i[0].length&&(i.shift(),e=0);return i.length&&e<i[0].length&&(i[0]=i[0].slice(e)),n}function ft(i,t){xe||(xe=new TextDecoder);const n=[];let e=0,r=-1,s=!1;return new TransformStream({transform(a,c){for(n.push(a);;){if(e===0){if(q(n)<1)break;const l=Y(n,1);s=(l[0]&128)===128,r=l[0]&127,r<126?e=3:r===126?e=1:e=2}else if(e===1){if(q(n)<2)break;const l=Y(n,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),e=3}else if(e===2){if(q(n)<8)break;const l=Y(n,8),T=new DataView(l.buffer,l.byteOffset,l.length),E=T.getUint32(0);if(E>Math.pow(2,21)-1){c.enqueue(le);break}r=E*Math.pow(2,32)+T.getUint32(4),e=3}else{if(q(n)<r)break;const l=Y(n,r);c.enqueue(ge(s?l:xe.decode(l),t)),e=0}if(r===0||r>i){c.enqueue(le);break}}}})}const Pe=4;function m(i){if(i)return dt(i)}function dt(i){for(var t in m.prototype)i[t]=m.prototype[t];return i}m.prototype.on=m.prototype.addEventListener=function(i,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(t),this};m.prototype.once=function(i,t){function n(){this.off(i,n),t.apply(this,arguments)}return n.fn=t,this.on(i,n),this};m.prototype.off=m.prototype.removeListener=m.prototype.removeAllListeners=m.prototype.removeEventListener=function(i,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+i];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var e,r=0;r<n.length;r++)if(e=n[r],e===t||e.fn===t){n.splice(r,1);break}return n.length===0&&delete this._callbacks["$"+i],this};m.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+i],e=1;e<arguments.length;e++)t[e-1]=arguments[e];if(n){n=n.slice(0);for(var e=0,r=n.length;e<r;++e)n[e].apply(this,t)}return this};m.prototype.emitReserved=m.prototype.emit;m.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};m.prototype.hasListeners=function(i){return!!this.listeners(i).length};const ee=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),w=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),pt="arraybuffer";function Be(i,...t){return t.reduce((n,e)=>(i.hasOwnProperty(e)&&(n[e]=i[e]),n),{})}const Et=w.setTimeout,_t=w.clearTimeout;function te(i,t){t.useNativeTimers?(i.setTimeoutFn=Et.bind(w),i.clearTimeoutFn=_t.bind(w)):(i.setTimeoutFn=w.setTimeout.bind(w),i.clearTimeoutFn=w.clearTimeout.bind(w))}const gt=1.33;function Tt(i){return typeof i=="string"?Ct(i):Math.ceil((i.byteLength||i.size)*gt)}function Ct(i){let t=0,n=0;for(let e=0,r=i.length;e<r;e++)t=i.charCodeAt(e),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(e++,n+=4);return n}function Ue(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Nt(i){let t="";for(let n in i)i.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(i[n]));return t}function bt(i){let t={},n=i.split("&");for(let e=0,r=n.length;e<r;e++){let s=n[e].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}class It extends Error{constructor(t,n,e){super(t),this.description=n,this.context=e,this.type="TransportError"}}class Te extends m{constructor(t){super(),this.writable=!1,te(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,e){return super.emitReserved("error",new It(t,n,e)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=ge(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=Nt(t);return n.length?"?"+n:""}}class St extends Te{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||n()})),this.writable||(e++,this.once("drain",function(){--e||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=e=>{if(this.readyState==="opening"&&e.type==="open"&&this.onOpen(),e.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)};lt(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,ut(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Ue()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let We=!1;try{We=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const yt=We;function vt(){}class Rt extends St{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let e=location.port;e||(e=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||e!==t.port}}doWrite(t,n){const e=this.request({method:"POST",data:t});e.on("success",n),e.on("error",(r,s)=>{this.onError("xhr post error",r,s)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,e)=>{this.onError("xhr poll error",n,e)}),this.pollXhr=t}}class L extends m{constructor(t,n,e){super(),this.createRequest=t,te(this,e),this._opts=e,this._method=e.method||"GET",this._uri=n,this._data=e.data!==void 0?e.data:null,this._create()}_create(){var t;const n=Be(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const e=this._xhr=this.createRequest(n);try{e.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{e.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(e),"withCredentials"in e&&(e.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(e.timeout=this._opts.requestTimeout),e.onreadystatechange=()=>{var r;e.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(e.getResponseHeader("set-cookie"))),e.readyState===4&&(e.status===200||e.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof e.status=="number"?e.status:0)},0))},e.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=L.requestsCount++,L.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=vt,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete L.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}L.requestsCount=0;L.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Re);else if(typeof addEventListener=="function"){const i="onpagehide"in w?"pagehide":"unload";addEventListener(i,Re,!1)}}function Re(){for(let i in L.requests)L.requests.hasOwnProperty(i)&&L.requests[i].abort()}const mt=function(){const i=Fe({xdomain:!1});return i&&i.responseType!==null}();class At extends Rt{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=mt&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new L(Fe,this.uri(),t)}}function Fe(i){const t=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||yt))return new XMLHttpRequest}catch{}if(!t)try{return new w[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Ge=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ot extends Te{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,e=Ge?{}:Be(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(e.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,e)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const e=t[n],r=n===t.length-1;_e(e,this.supportsBinary,s=>{try{this.doWrite(e,s)}catch{}r&&ee(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Ue()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const ue=w.WebSocket||w.MozWebSocket;class Dt extends Ot{createSocket(t,n,e){return Ge?new ue(t,n,e):n?new ue(t,n):new ue(t)}doWrite(t,n){this.ws.send(n)}}class wt extends Te{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=ft(Number.MAX_SAFE_INTEGER,this.socket.binaryType),e=t.readable.pipeThrough(n).getReader(),r=ht();r.readable.pipeTo(t.writable),this._writer=r.writable.getWriter();const s=()=>{e.read().then(({done:c,value:l})=>{c||(this.onPacket(l),s())}).catch(c=>{})};s();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const e=t[n],r=n===t.length-1;this._writer.write(e).then(()=>{r&&ee(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const kt={websocket:Dt,webtransport:wt,polling:At},Lt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Pt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function he(i){if(i.length>8e3)throw"URI too long";const t=i,n=i.indexOf("["),e=i.indexOf("]");n!=-1&&e!=-1&&(i=i.substring(0,n)+i.substring(n,e).replace(/:/g,";")+i.substring(e,i.length));let r=Lt.exec(i||""),s={},a=14;for(;a--;)s[Pt[a]]=r[a]||"";return n!=-1&&e!=-1&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Bt(s,s.path),s.queryKey=Ut(s,s.query),s}function Bt(i,t){const n=/\/{2,9}/g,e=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&e.splice(0,1),t.slice(-1)=="/"&&e.splice(e.length-1,1),e}function Ut(i,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,r,s){r&&(n[r]=s)}),n}const fe=typeof addEventListener=="function"&&typeof removeEventListener=="function",z=[];fe&&addEventListener("offline",()=>{z.forEach(i=>i())},!1);class U extends m{constructor(t,n){if(super(),this.binaryType=pt,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const e=he(t);n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)}else n.host&&(n.hostname=he(n.host).host);te(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(e=>{const r=e.prototype.name;this.transports.push(r),this._transportsByName[r]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=bt(this.opts.query)),fe&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},z.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=Pe,n.transport=t,this.id&&(n.sid=this.id);const e=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](e)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&U.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",U.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let e=0;e<this.writeBuffer.length;e++){const r=this.writeBuffer[e].data;if(r&&(n+=Tt(r)),e>0&&n>this._maxPayload)return this.writeBuffer.slice(0,e);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,ee(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,e){return this._sendPacket("message",t,n,e),this}send(t,n,e){return this._sendPacket("message",t,n,e),this}_sendPacket(t,n,e,r){if(typeof n=="function"&&(r=n,n=void 0),typeof e=="function"&&(r=e,e=null),this.readyState==="closing"||this.readyState==="closed")return;e=e||{},e.compress=e.compress!==!1;const s={type:t,data:n,options:e};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),r&&this.once("flush",r),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},e=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?e():t()}):this.upgrading?e():t()),this}_onError(t){if(U.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),fe&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=z.indexOf(this._offlineEventListener);e!==-1&&z.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}U.protocol=Pe;class Wt extends U{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),e=!1;U.priorWebsocketSuccess=!1;const r=()=>{e||(n.send([{type:"ping",data:"probe"}]),n.once("packet",p=>{if(!e)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;U.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{e||this.readyState!=="closed"&&(E(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const _=new Error("probe error");_.transport=n.name,this.emitReserved("upgradeError",_)}}))};function s(){e||(e=!0,E(),n.close(),n=null)}const a=p=>{const _=new Error("probe error: "+p);_.transport=n.name,s(),this.emitReserved("upgradeError",_)};function c(){a("transport closed")}function l(){a("socket closed")}function T(p){n&&p.name!==n.name&&s()}const E=()=>{n.removeListener("open",r),n.removeListener("error",a),n.removeListener("close",c),this.off("close",l),this.off("upgrading",T)};n.once("open",r),n.once("error",a),n.once("close",c),this.once("close",l),this.once("upgrading",T),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{e||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let e=0;e<t.length;e++)~this.transports.indexOf(t[e])&&n.push(t[e]);return n}}let Ft=class extends Wt{constructor(t,n={}){const e=typeof t=="object"?t:n;(!e.transports||e.transports&&typeof e.transports[0]=="string")&&(e.transports=(e.transports||["polling","websocket","webtransport"]).map(r=>kt[r]).filter(r=>!!r)),super(t,e)}};function Gt(i,t="",n){let e=i;n=n||typeof location<"u"&&location,i==null&&(i=n.protocol+"//"+n.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=n.protocol+i:i=n.host+i),/^(https?|wss?):\/\//.test(i)||(typeof n<"u"?i=n.protocol+"//"+i:i="https://"+i),e=he(i)),e.port||(/^(http|ws)$/.test(e.protocol)?e.port="80":/^(http|ws)s$/.test(e.protocol)&&(e.port="443")),e.path=e.path||"/";const s=e.host.indexOf(":")!==-1?"["+e.host+"]":e.host;return e.id=e.protocol+"://"+s+":"+e.port+t,e.href=e.protocol+"://"+s+(n&&n.port===e.port?"":":"+e.port),e}const Mt=typeof ArrayBuffer=="function",Vt=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,Me=Object.prototype.toString,Ht=typeof Blob=="function"||typeof Blob<"u"&&Me.call(Blob)==="[object BlobConstructor]",jt=typeof File=="function"||typeof File<"u"&&Me.call(File)==="[object FileConstructor]";function Ce(i){return Mt&&(i instanceof ArrayBuffer||Vt(i))||Ht&&i instanceof Blob||jt&&i instanceof File}function $(i,t){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let n=0,e=i.length;n<e;n++)if($(i[n]))return!0;return!1}if(Ce(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return $(i.toJSON(),!0);for(const n in i)if(Object.prototype.hasOwnProperty.call(i,n)&&$(i[n]))return!0;return!1}function Jt(i){const t=[],n=i.data,e=i;return e.data=de(n,t),e.attachments=t.length,{packet:e,buffers:t}}function de(i,t){if(!i)return i;if(Ce(i)){const n={_placeholder:!0,num:t.length};return t.push(i),n}else if(Array.isArray(i)){const n=new Array(i.length);for(let e=0;e<i.length;e++)n[e]=de(i[e],t);return n}else if(typeof i=="object"&&!(i instanceof Date)){const n={};for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&(n[e]=de(i[e],t));return n}return i}function Xt(i,t){return i.data=pe(i.data,t),delete i.attachments,i}function pe(i,t){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<t.length)return t[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let n=0;n<i.length;n++)i[n]=pe(i[n],t);else if(typeof i=="object")for(const n in i)Object.prototype.hasOwnProperty.call(i,n)&&(i[n]=pe(i[n],t));return i}const qt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Yt=5;var N;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(N||(N={}));class Kt{constructor(t){this.replacer=t}encode(t){return(t.type===N.EVENT||t.type===N.ACK)&&$(t)?this.encodeAsBinary({type:t.type===N.EVENT?N.BINARY_EVENT:N.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===N.BINARY_EVENT||t.type===N.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=Jt(t),e=this.encodeAsString(n.packet),r=n.buffers;return r.unshift(e),r}}function me(i){return Object.prototype.toString.call(i)==="[object Object]"}class Ne extends m{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const e=n.type===N.BINARY_EVENT;e||n.type===N.BINARY_ACK?(n.type=e?N.EVENT:N.ACK,this.reconstructor=new zt(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Ce(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const e={type:Number(t.charAt(0))};if(N[e.type]===void 0)throw new Error("unknown packet type "+e.type);if(e.type===N.BINARY_EVENT||e.type===N.BINARY_ACK){const s=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const a=t.substring(s,n);if(a!=Number(a)||t.charAt(n)!=="-")throw new Error("Illegal attachments");e.attachments=Number(a)}if(t.charAt(n+1)==="/"){const s=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););e.nsp=t.substring(s,n)}else e.nsp="/";const r=t.charAt(n+1);if(r!==""&&Number(r)==r){const s=n+1;for(;++n;){const a=t.charAt(n);if(a==null||Number(a)!=a){--n;break}if(n===t.length)break}e.id=Number(t.substring(s,n+1))}if(t.charAt(++n)){const s=this.tryParse(t.substr(n));if(Ne.isPayloadValid(e.type,s))e.data=s;else throw new Error("invalid payload")}return e}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case N.CONNECT:return me(n);case N.DISCONNECT:return n===void 0;case N.CONNECT_ERROR:return typeof n=="string"||me(n);case N.EVENT:case N.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&qt.indexOf(n[0])===-1);case N.ACK:case N.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class zt{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=Xt(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const $t=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ne,Encoder:Kt,get PacketType(){return N},protocol:Yt},Symbol.toStringTag,{value:"Module"}));function k(i,t,n){return i.on(t,n),function(){i.off(t,n)}}const Qt=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ve extends m{constructor(t,n,e){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,e&&e.auth&&(this.auth=e.auth),this._opts=Object.assign({},e),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[k(t,"open",this.onopen.bind(this)),k(t,"packet",this.onpacket.bind(this)),k(t,"error",this.onerror.bind(this)),k(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var e,r,s;if(Qt.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:N.EVENT,data:n};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const E=this.ids++,p=n.pop();this._registerAckCallback(E,p),a.id=E}const c=(r=(e=this.io.engine)===null||e===void 0?void 0:e.transport)===null||r===void 0?void 0:r.writable,l=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!c||(l?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(t,n){var e;const r=(e=this.flags.timeout)!==null&&e!==void 0?e:this._opts.ackTimeout;if(r===void 0){this.acks[t]=n;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===t&&this.sendBuffer.splice(c,1);n.call(this,new Error("operation has timed out"))},r),a=(...c)=>{this.io.clearTimeoutFn(s),n.apply(this,c)};a.withError=!0,this.acks[t]=a}emitWithAck(t,...n){return new Promise((e,r)=>{const s=(a,c)=>a?r(a):e(c);s.withError=!0,n.push(s),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const e={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((r,...s)=>e!==this._queue[0]?void 0:(r!==null?e.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(r)):(this._queue.shift(),n&&n(null,...s)),e.pending=!1,this._drainQueue())),this._queue.push(e),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:N.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(e=>String(e.id)===t)){const e=this.acks[t];delete this.acks[t],e.withError&&e.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case N.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case N.EVENT:case N.BINARY_EVENT:this.onevent(t);break;case N.ACK:case N.BINARY_ACK:this.onack(t);break;case N.DISCONNECT:this.ondisconnect();break;case N.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const e of n)e.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let e=!1;return function(...r){e||(e=!0,n.packet({type:N.ACK,id:t,data:r}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:N.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let e=0;e<n.length;e++)if(t===n[e])return n.splice(e,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let e=0;e<n.length;e++)if(t===n[e])return n.splice(e,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const e of n)e.apply(this,t.data)}}}function V(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}V.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*i);i=Math.floor(t*10)&1?i+n:i-n}return Math.min(i,this.max)|0};V.prototype.reset=function(){this.attempts=0};V.prototype.setMin=function(i){this.ms=i};V.prototype.setMax=function(i){this.max=i};V.prototype.setJitter=function(i){this.jitter=i};class Ee extends m{constructor(t,n){var e;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,te(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((e=n.randomizationFactor)!==null&&e!==void 0?e:.5),this.backoff=new V({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const r=n.parser||$t;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Ft(this.uri,this.opts);const n=this.engine,e=this;this._readyState="opening",this.skipReconnect=!1;const r=k(n,"open",function(){e.onopen(),t&&t()}),s=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),t?t(c):this.maybeReconnectOnOpen()},a=k(n,"error",s);if(this._timeout!==!1){const c=this._timeout,l=this.setTimeoutFn(()=>{r(),s(new Error("timeout")),n.close()},c);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(a),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(k(t,"ping",this.onping.bind(this)),k(t,"data",this.ondata.bind(this)),k(t,"error",this.onerror.bind(this)),k(t,"close",this.onclose.bind(this)),k(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){ee(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let e=this.nsps[t];return e?this._autoConnect&&!e.active&&e.connect():(e=new Ve(this,t,n),this.nsps[t]=e),e}_destroy(t){const n=Object.keys(this.nsps);for(const e of n)if(this.nsps[e].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let e=0;e<n.length;e++)this.engine.write(n[e],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var e;this.cleanup(),(e=this.engine)===null||e===void 0||e.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const e=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(r=>{r?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",r)):t.onreconnect()}))},n);this.opts.autoUnref&&e.unref(),this.subs.push(()=>{this.clearTimeoutFn(e)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const H={};function Q(i,t){typeof i=="object"&&(t=i,i=void 0),t=t||{};const n=Gt(i,t.path||"/socket.io"),e=n.source,r=n.id,s=n.path,a=H[r]&&s in H[r].nsps,c=t.forceNew||t["force new connection"]||t.multiplex===!1||a;let l;return c?l=new Ee(e,t):(H[r]||(H[r]=new Ee(e,t)),l=H[r]),n.query&&!t.query&&(t.query=n.queryKey),l.socket(n.path,t)}Object.assign(Q,{Manager:Ee,Socket:Ve,io:Q,connect:Q});const sn=({projectId:i,isEditor:t,jwt:n,autoConnect:e})=>{const[r,s]=O.useState(null);return O.useEffect(()=>{let a;if(!r&&n&&i&&e){console.log("before live connect",{socketInstance:r,autoConnect:e,jwt:n,projectId:i,isEditor:t});const c=`undefined?isEditor=${t?"true":"false"}&projectId=${i}`;a=Q(c,{forceNew:!0,auth:{token:n}}),s(a)}},[e,t,n,i,r]),O.useEffect(()=>{i||(r==null||r.off(),r==null||r.disconnect(),s(null))},[i,r]),r},an=({initVariableArr:i})=>{const t=O.useMemo(()=>i!=null&&i.length?i.filter(n=>n.joinValueSetter_signal_fb):[],[i]);O.useEffect(()=>{const n=be.getState().setInitialVariablesArray;n(i||[])},[i]),O.useEffect(()=>{let n=[];if(t!=null&&t.length){const e=be.getState().setVariableNewValue;return t.forEach(r=>{let s;n.push({subscribe:function(){s=CrComLib.subscribeState(r.type,r.joinValueSetter_signal_fb,a=>{e({name:r.name,currentValue:a})})},unsubscribe:function(){CrComLib.unsubscribeState(r.type,r.joinValueSetter_signal_fb,s)}})}),n.map(r=>r.subscribe()),()=>{n.map(r=>r.unsubscribe())}}},[t])};var Z={exports:{}};Z.exports;(function(i,t){var n=["getInstance","setDiagnosticIntegerSender","LOG","DISCONNECT_WS","error","href","setLogLevel","getDebuggingState","warn","BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE","Worker","SET_BASE_PATH","MSBlobBuilder","redirectTo","dispatchEvent","sendNumber","instance",`/*!
 * Copyright (C) 2020 to the present, Crestron Electronics, Inc.
 * All rights reserved.
 * No part of this software may be reproduced in any form, machine
 * or natural, without the express written consent of Crestron Electronics.
 * Use of this source code is subject to the terms of the Crestron Software License Agreement
 * under which you licensed this source code.
 * 
 * 
 */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var i,o;n.r(t),function(e){e.INITIALIZE_WS="INITIALIZE_WS",e.CONNECT_WS="CONNECT_WS",e.DISCONNECT_WS="DISCONNECT_WS",e.WEBSOCKET_EVENT="WEBSOCKET_EVENT",e.SET_BASE_PATH="SET_BASE_PATH",e.SET_JWT="SET_JWT",e.AUTHENTICATE="AUTHENTICATE",e.LOGGER_EVENT="LOGGER_EVENT",e.BRIDGE_SEND_BOOLEAN_TO_NATIVE="BRIDGE_SEND_BOOLEAN_TO_NATIVE",e.BRIDGE_SEND_INTEGER_TO_NATIVE="BRIDGE_SEND_INTEGER_TO_NATIVE",e.BRIDGE_SEND_STRING_TO_NATIVE="BRIDGE_SEND_STRING_TO_NATIVE",e.BRIDGE_SEND_OBJECT_TO_NATIVE="BRIDGE_SEND_OBJECT_TO_NATIVE",e.BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE="BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE",e.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE="BRIDGE_RECEIVE_INTEGER_FROM_NATIVE",e.BRIDGE_RECEIVE_STRING_FROM_NATIVE="BRIDGE_RECEIVE_STRING_FROM_NATIVE",e.BRIDGE_RECEIVE_OBJECT_FROM_NATIVE="BRIDGE_RECEIVE_OBJECT_FROM_NATIVE",e.CCS_DIAGNOSTICS="CCS_DIAGNOSTICS",e.LICENSE_EVENT="LICENSE_EVENT",e.VALIDATION_EVENT="VALIDATION_EVENT",e.INTERNAL_EVENT="INTERNAL_EVENT"}(i||(i={})),function(e){e.IDLE="IDLE",e.WAIT_PROGRAM_READY="WAIT_PROGRAM_READY",e.WAIT_CONNECT_RESPONSE="WAIT_CONNECT_RESPONSE",e.WAIT_AUTHENTICATE_RESPONSE="WAIT_AUTHENTICATE_RESPONSE",e.RECONNECT_AFTER_DELAY="RECONNECT_AFTER_DELAY",e.WAIT_CLEAR_ALL="WAIT_CLEAR_ALL",e.CONNECTION_REFUSED="CONNECTION_REFUSED",e.CONNECTION_FAILED="CONNECTION_FAILED",e.SSL_HANDSHAKE_FAILED="SSL_HANDSHAKE_FAILED",e.READ_FAILED="READ_FAILED",e.AUTHENTICATION_FAILED="AUTHENTICATION_FAILED",e.IN_UPDATE="IN_UPDATE",e.HEARTBEAT_EXPIRED="HEARTBEAT_EXPIRED",e.CONNECTED="CONNECTED",e.DISCONNECT_PENDING="DISCONNECT_PENDING",e.DISCONNECT_REQUESTED="DISCONNECT_REQUESTED"}(o||(o={}));var r,a=o,s=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],a=0,s=r.length;a<s;a++,o++)i[o]=r[a];return i};!function(e){e[e.LOG=0]="LOG",e[e.DEBUG=1]="DEBUG",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(r||(r={}));var c,E=function(){function e(){}return e.getLogLevel=function(){return this.logLevel},e.setLogLevel=function(e){this.logLevel=e},e.enableDebugging=function(){e.debugging=!0},e.disableDebugging=function(){e.debugging=!1},e.getDebuggingState=function(){return e.debugging},e.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!e.getDebuggingState()||this.logLevel>r.LOG||console.log.apply(console,s([e.LOGGER_KEY,(new Date).toISOString()],t))},e.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!e.getDebuggingState()||e.logLevel>r.WARN||console.warn.apply(console,s([e.LOGGER_KEY,(new Date).toISOString()],t))},e.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.getDebuggingState()&&console.error.apply(console,s([e.LOGGER_KEY,(new Date).toISOString()],t))},e.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!e.getDebuggingState()||e.logLevel>r.DEBUG||console.debug.apply(console,s([e.LOGGER_KEY,(new Date).toISOString()],t))},e.LOGGER_KEY="[WXP]",e.logLevel=r.WARN,e.debugging=!0,e}();function u(e){for(var t="",n=e.length,i=0;i<n;i++){var o=e[i].toString(16);1===o.length&&(o="0"+o),t+=o+" "}return t}function _(e){if(E.debug("Received a PROGRAM_READY packet: "+u(e)),this.cipClient.state===a.WAIT_PROGRAM_READY)switch(e[3]){case 0:E.debug("Status 0x00: Reconnecting after 15s delay"),this.cipClient.transitionTo(a.RECONNECT_AFTER_DELAY),this.cipClient.webSocketClient.disconnect("CONTROL_SYSTEM_NOT_READY"),this.cipClient.webSocketClient.connectAfterDelay(15e3);break;case 1:E.debug("Status 0x01: Waiting for another PROGRAM_READY...");break;case 2:E.debug("Status 0x02: Sending connect event"),this.cipClient.connectToCCS(),this.cipClient.transitionTo(a.WAIT_CONNECT_RESPONSE);break;default:throw new Error("Received an invalid status for PROGRAM_READY")}else E.error("Received PROGRAM_READY in an invalid state!")}!function(e){e.CONNECT_WS="CONNECT_WS",e.DISCONNECT_WS="DISCONNECT_WS",e.ERROR_WS="ERROR_WS",e.WEB_WORKER_FAILED="WEB_WORKER_FAILED",e.FETCH_TOKEN_FAILED="FETCH_TOKEN_FAILED",e.CONNECT_CIP="CONNECT_CIP",e.DISCONNECT_CIP="DISCONNECT_CIP",e.INVALID_MAC_ADDRESS="INVALID_MAC_ADDRESS",e.INVALID_CREDENTIALS="INVALID_CREDENTIALS",e.AUTHENTICATION_FAILED="AUTHENTICATION_FAILED",e.AUTHENTICATION_REQUIRED="AUTHENTICATION_REQUIRED",e.CCS_OFFLINE="CCS_OFFLINE",e.CCS_ONLINE="CCS_ONLINE",e.CCS_TRIAL_PERIOD_ON="CCS_TRIAL_PERIOD_ON",e.CCS_TRIAL_PERIOD_OFF="CCS_TRIAL_PERIOD_OFF",e.CCS_TRIAL_PERIOD_DAYS="CCS_TRIAL_PERIOD_DAYS",e.CCS_LICENSE_VALID="CCS_LICENSE_VALID",e.CCS_LICENSE_INVALID="CCS_LICENSE_INVALID",e.CCS_LICENSE_SUPPORT_ON="CCS_LICENSE_SUPPORT_ON",e.CCS_LICENSE_SUPPORT_OFF="CCS_LICENSE_SUPPORT_OFF",e.CCS_LICENSE_DAYS="CCS_LICENSE_DAYS",e.CCS_NO_LICENCE_REQ="CCS_NO_LICENCE_REQ",e.LICENSE_WS="LICENSE_WS",e.NOT_AUTHORIZED="NOT_AUTHORIZED"}(c||(c={}));var l=c;function T(e){postMessage(e)}var C,p=function(e,t,n){T({type:e,payload:{eventName:t,data:n}})},d=function(e){p(i.CCS_DIAGNOSTICS,e)};function N(e){if(E.debug("Received an AUTHENTICATE packet: "+u(e)),this.cipClient.state!==a.WAIT_AUTHENTICATE_RESPONSE)return E.error("Received an AUTHENTICATE_RESPONSE packet in an invalid state!"),void d(l.CCS_OFFLINE);var t=e[5];switch(t){case 0:E.error("CIP Authentication failed!"),this.cipClient.transitionTo(a.AUTHENTICATION_FAILED),T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.AUTHENTICATION_FAILED}}),d(l.CCS_OFFLINE);break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:E.log("Authentication succeeded. Access level is "+t),this.cipClient.transitionTo(a.WAIT_CLEAR_ALL),this.cipClient.initializeUpdateRequest(),this.cipClient.initializeHeartBeat(),d(l.CCS_ONLINE);break;default:throw d(l.CCS_OFFLINE),new Error("Invalid access level received on AUTHENTICATE_RESPONSE!")}}!function(e){e[e.DIGITAL_IO=0]="DIGITAL_IO",e[e.ANALOG_IO=1]="ANALOG_IO",e[e.COMMAND_PACKETS=3]="COMMAND_PACKETS",e[e.SYMMETRICAL_ANALOG_PACKETS=20]="SYMMETRICAL_ANALOG_PACKETS",e[e.SERIAL_IO_INDIRECT_TEXT=21]="SERIAL_IO_INDIRECT_TEXT",e[e.REPEAT_DIGITAL_IO=39]="REPEAT_DIGITAL_IO",e[e.GENERAL_RCB=30]="GENERAL_RCB",e[e.EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT=52]="EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT",e[e.UNMANGLED_INDIRECT_TEXT_SUPPORT=42]="UNMANGLED_INDIRECT_TEXT_SUPPORT",e[e.SMART_OBJECT=56]="SMART_OBJECT",e[e.EXTENDED_SMART_OBJECT=57]="EXTENDED_SMART_OBJECT",e[e.TIME_AND_DATE=8]="TIME_AND_DATE"}(C||(C={}));var I=C,h=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},f=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};function R(e){return h(this,void 0,void 0,(function(){var t,n,i;return f(this,(function(o){switch(o.label){case 0:return t=e+"config/contract.cse2j",[4,fetch(t)];case 1:n=o.sent(),o.label=2;case 2:return o.trys.push([2,5,,6]),n.ok?[4,n.json()]:[3,4];case 3:return i=o.sent(),E.debug("Contract file loaded successfully."),[2,i];case 4:return[2,Promise.reject(new Error("Contract file not found at "+t+"."))];case 5:return o.sent(),[2,Promise.reject(new Error("Contract file contains invalid JSON."))];case 6:return[2]}}))}))}var A,S=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},O=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};!function(e){e.NUMERIC="numeric",e.BOOLEAN="boolean",e.STRING="string",e.REPEAT_DIGITAL="repeatdigital"}(A||(A={}));var v={boolean:{0:{18494:"Csig.All_Control_Systems_Online_fb",18495:"Csig.Control_Systems_Offline_fb"}}},g={string:{"Csig.Browser_URL":{joinId:28601,smartObjectId:0}}},D=function(){function e(){}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.loadContractFile=function(){var e=this;this.setContractFile().catch((function(t){E.warn(t.message,"Using empty contract file."),e.contract={signals:{events:{},states:{}}}})).finally((function(){e.initialized=!0}))},e.prototype.setContractFile=function(){return S(this,void 0,void 0,(function(){var t;return O(this,(function(n){switch(n.label){case 0:return t=this,[4,R(e.basePath)];case 1:return t.contract=n.sent(),[2]}}))}))},e.prototype.mapEvent=function(e,t){var n,i;if(!this.initialized)throw new Error("Contract file not loaded!");var o=e===A.REPEAT_DIGITAL?A.BOOLEAN:e,r=(null===(n=g[o])||void 0===n?void 0:n[t])||(null===(i=this.contract.signals.events[o])||void 0===i?void 0:i[t]);if(!r){var a=parseInt(t,10);return isNaN(a)||a<0?(E.debug("Event "+t+" not found in the contract file!"),null):{joinId:a,smartObjectId:0}}return r},e.prototype.mapState=function(e,t,n){var i,o,r,a;if(void 0===t&&(t=0),!this.initialized)throw new Error("Contract file not loaded!");var s=(null===(o=null===(i=v[e])||void 0===i?void 0:i[t])||void 0===o?void 0:o[n])||(null===(a=null===(r=this.contract.signals.states[e])||void 0===r?void 0:r[t])||void 0===a?void 0:a[n]);return s||"fb"+n},e}(),b=D.getInstance(),y=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],a=0,s=r.length;a<s;a++,o++)i[o]=r[a];return i};function P(e,t){return t?(e[0]<<8)+e[1]:e[0]}function L(e,t){void 0===t&&(t=0);for(var n=P(e,!1),o=2;o<n;o+=2){var r=((127&e[o+1])<<8)+e[o]+1,a=b.mapState(A.BOOLEAN,t,r);128&e[o+1]?(E.log("0x00 - handleDigitalIO",{signalName:a,value:!1,joinId:r,smartObjectId:t}),T({type:i.BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE,payload:{signalName:a,value:!1}})):(E.log("0x00 - handleDigitalIO",{signalName:a,value:!0,joinId:r,smartObjectId:t}),T({type:i.BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE,payload:{signalName:a,value:!0}}))}}function m(e,t){void 0===t&&(t=0);var n,o,r=P(e,!1),a=!1;switch(r){case 3:n=e[3],o=e[2]+1;break;case 4:n=(e[3]<<8)+e[4],o=e[2]+1;break;case 5:n=(e[4]<<8)+e[5],o=(e[2]<<8)+e[3]+1;break;default:a=!0;for(var s=2;s<r;s+=4){n=(e[s+2]<<8)+e[s+3],o=(e[s]<<8)+e[s+1]+1;var c=b.mapState(A.NUMERIC,t,o);E.log("0x01 - handleAnalogIO",{signalName:c,value:n,joinId:o}),T({type:i.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE,payload:{signalName:c,value:n}})}}if(!a){c=b.mapState(A.NUMERIC,t,o);E.log("0x01 - handleAnalogIO",{signalName:c,value:n,joinId:o}),T({type:i.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE,payload:{signalName:c,value:n}})}}function k(e,t,n){E.log("handleStateSynchronization");var o={id:e.cipProgramIdentifier,state:t,value:n};T({type:i.BRIDGE_RECEIVE_OBJECT_FROM_NATIVE,payload:{signalName:"Csig.State_Synchronization",value:JSON.stringify(o)}})}function B(e,t){void 0===t&&(t=0);for(var n=P(e,!1),o=2;o<n;o+=4){var r=(e[o]<<8)+e[o+1]+1,a=(e[o+2]<<8)+e[o+3],s=b.mapState(A.NUMERIC,t,r);E.log("0x14 - symmetricalAnalogPackets",{signalName:s,value:a,joinId:r}),T({type:i.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE,payload:{signalName:s,value:a}})}}var U={};function G(e,t){void 0===t&&(t=0);for(var n="",o=P(e,!0),r=(e[3]<<8)+e[4]+1,a=e[5],s=b.mapState(A.STRING,t,r),c=6;c<o+2;c+=4&a?2:1){var E=void 0;E=4&a?(e[c+1]<<8)+e[c]:e[c],n+=String.fromCharCode(E)}U[s]=1&a?n:U[s]?U[s]+n:n,2&a&&T({type:i.BRIDGE_RECEIVE_STRING_FROM_NATIVE,payload:{signalName:s,value:U[s]}})}function w(e,t){void 0===t&&(t=0),E.log("0x15 - serialIOIndirecttext, handled by 0x34"),G(new Uint8Array(y([0],e)),t)}function W(e,t){void 0===t&&(t=0);for(var n=P(e,!1),o={0:"1",1:"0"},r=10*((e[2]<<24)+(e[3]<<16)+(e[4]<<8)+e[5]),a=6;a<n;a+=5){var s=(e[a]<<8)+e[a+1]+1,c=e[a+4],u=void 0;if(1&c)u=(e[a+2]<<8)+e[a+3],"1"===("0".repeat(16-u.toString(2).length)+u.toString(2))[0]&&(u=-1*(parseInt(u.toString(2).replace(/0|1/gi,(function(e){return o[e]})),2)+1));else u=(e[a+2]<<8)+e[a+3];var _=b.mapState(A.NUMERIC,t,s);E.log("0x1E - handleGeneralRCB",{signalName:_,time:r,value:u,joinId:s,flags:c}),T({type:i.BRIDGE_RECEIVE_OBJECT_FROM_NATIVE,payload:{signalName:_,value:JSON.stringify({rcb:{value:u,time:r}})}})}}var F,H={};function M(e){switch(E.debug("Received a DATA packet: "+u(e)+"."),e[6]){case I.DIGITAL_IO:L(e.slice(5));break;case I.ANALOG_IO:m(e.slice(5));break;case I.COMMAND_PACKETS:!function(e,t){switch(t[2]){case 0:E.log("START OF UPDATE"),k(e,"StartOfUpdate",{excludePrefixes:["Csig"]});break;case 22:E.log("END OF UPDATE"),k(e,"EndOfUpdate");break;case 25:case 26:case 27:break;case 28:E.log("End of join status query"),e.initializeEndOfJoinStatusResponse()}}(this.cipClient,e.slice(5));break;case I.SYMMETRICAL_ANALOG_PACKETS:B(e.slice(5));break;case I.SERIAL_IO_INDIRECT_TEXT:w(e.slice(5));break;case I.GENERAL_RCB:W(e.slice(5));break;case I.UNMANGLED_INDIRECT_TEXT_SUPPORT:!function(e){for(var t="",n=P(e,!1),o=(e[2]<<8)+e[3]+1,r=e[4],a=b.mapState(A.STRING,0,o),s=5;s<=n;s++)t+=String.fromCharCode(e[s]);E.log("0x2A - unmangledIndirectTextSupport",{signalName:a,joinId:o,flags:r,extendedUnmangledIndirectText:t}),H[a]=1&r?t:H[a]?H[a]+t:t,T({type:i.BRIDGE_RECEIVE_STRING_FROM_NATIVE,payload:{signalName:a,value:H[a]}})}(e.slice(5));break;case I.SMART_OBJECT:!function(e){E.log("0x38 - Smart Object");for(var t=e[0],n=2;n<t;){var i=(e[n]<<24)+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3],o=e[n+4],r=e[n+5],a=n+4,s=a+o+1,c=e.slice(a,s);switch(r){case I.DIGITAL_IO:L(c,i);break;case I.ANALOG_IO:m(c,i);break;case I.SYMMETRICAL_ANALOG_PACKETS:B(c,i);break;case I.SERIAL_IO_INDIRECT_TEXT:w(c,i);break;case I.GENERAL_RCB:W(c,i);break;default:E.error("0x38, unhandled packet "+u(e))}n+=o+4+1}}(e.slice(5));break;case I.TIME_AND_DATE:break;default:E.error("Unknown packet received in DATA: "+u(e))}}function V(e){E.debug("Received a DISCONNECT packet: "+u(e)),T({type:i.CCS_DIAGNOSTICS,payload:{connectionStatus:!1}}),this.cipClient.tryReconnect()}function j(e){E.debug("Received a DISCONNECT_RESPONSE packet: "+u(e));var t=e[6];this.cipClient.transitionTo(a.DISCONNECT_PENDING),this.cipClient.webSocketClient.disconnect(t.toString()),this.cipClient.tryReconnect()}function x(e){switch(E.debug("Received an EXTENDED_DATA packet: "+u(e)),e[7]){case I.EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT:G(e.slice(5));break;case I.EXTENDED_SMART_OBJECT:!function(e){E.log("0x39 - Extended Smart Object");for(var t=P(e,!0),n=3;n<t;){var i=(e[n]<<24)+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3],o=(e[n+4]<<8)+e[n+5],r=e[n+6],a=n+4,s=a+o+2,c=e.slice(a,s);switch(r){case I.EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT:G(c,i);break;default:E.error("0x39, unhandled packet "+u(e))}n+=o+6}}(e.slice(5));break;default:E.warn("Unknown packet received in EXTENDED DATA "+u(e))}}function Y(e){E.debug("Received a HEARTBEAT_RESPONSE packet: "+u(e))}!function(e){e[e.DUMMY=0]="DUMMY",e[e.CONNECT=1]="CONNECT",e[e.CONNECT_RESPONSE=2]="CONNECT_RESPONSE",e[e.DISCONNECT=3]="DISCONNECT",e[e.DISCONNECT_RESPONSE=4]="DISCONNECT_RESPONSE",e[e.DATA=5]="DATA",e[e.CONNECT_DHCP=10]="CONNECT_DHCP",e[e.AUTHENTICATE=11]="AUTHENTICATE",e[e.AUTHENTICATE_RESPONSE=12]="AUTHENTICATE_RESPONSE",e[e.HEARTBEAT=13]="HEARTBEAT",e[e.HEARTBEAT_RESPONSE=14]="HEARTBEAT_RESPONSE",e[e.PROGRAM_READY=15]="PROGRAM_READY",e[e.CRESNET_DATA=16]="CRESNET_DATA",e[e.EXTENDED_DATA=18]="EXTENDED_DATA",e[e.DEVICE_ROUTER_CONNECT=38]="DEVICE_ROUTER_CONNECT",e[e.DEVICE_ROUTER_CONNECT_RESPONSE=39]="DEVICE_ROUTER_CONNECT_RESPONSE",e[e.LICENSE_INFORMATION_RESPONSE=42]="LICENSE_INFORMATION_RESPONSE",e[e.CRPC_CONNECT=19]="CRPC_CONNECT",e[e.CRPC_DATA=20]="CRPC_DATA"}(F||(F={}));var J=F,X=64,K=1,z=64,q=128,Q=48,Z=1,$=1,ee=16,te=32,ne=64,ie=1024,oe=2048,re=4096,ae=256;var se,ce={host:location.hostname,ipId:"0x03",port:49200,roomId:"",tokenUrl:location.origin+"/cws/websocket/getWebSocketToken",tokenSource:"CSSelf",authToken:""},Ee=function(){function e(){this.setParameters()}return e.prototype.setParameters=function(e){this._url=null==e?void 0:e.url,this._ipId=function(e){var t=e;-1===t.indexOf("0x")&&(t="0x"+t);var n=parseInt(t,16);if(isNaN(n))throw new Error(e+" is not a valid number!");return n}((null==e?void 0:e.ipId)||ce.ipId),this._roomId=(null==e?void 0:e.roomId)||ce.roomId,this._tokenSource=(null==e?void 0:e.tokenSource)||ce.tokenSource,this._tokenUrl=(null==e?void 0:e.tokenUrl)||ce.tokenUrl,this._authToken=(null==e?void 0:e.authToken)||ce.authToken},e.getInstance=function(){return void 0===e._instance&&(e._instance=new e),e._instance},Object.defineProperty(e.prototype,"url",{get:function(){var e;return null===(e=this._url)||void 0===e?void 0:e.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ipId",{get:function(){return this._ipId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomId",{get:function(){return this._roomId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"jwt",{get:function(){return this._jwt},set:function(e){this._jwt=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenSource",{get:function(){return this._tokenSource},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenUrl",{get:function(){return this._tokenUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"secureToken",{get:function(){return this._authToken},enumerable:!1,configurable:!0}),e}().getInstance();!function(e){e.AUTHENTICATION_FAILED="AUTHENTICATION_FAILED"}(se||(se={}));var ue=se;function _e(e){E.debug("Received a DEVICE_ROUTER_CONNECT_RESPONSE packet: "+u(e));var t=e.length;if(this.cipClient.state===a.WAIT_CONNECT_RESPONSE){if(t<41)throw new Error("Bad packet received!");var n,o=e[5],r=e[10],s=31&o,c=a.IDLE;if(this.cipClient.virtualConnectionHandle=(e[3]<<8)+e[4],128&o)E.log("Access is allowed for "+s+" days"),c=a.WAIT_CLEAR_ALL,n=s,p(i.CCS_DIAGNOSTICS,l.CCS_TRIAL_PERIOD_DAYS,n);else switch(s){case 0:E.log("Standard connection"),c=a.WAIT_CLEAR_ALL;break;case 1:E.log("Connected with master list entry"),c=a.WAIT_CLEAR_ALL;break;case 2:var _="Connection refused! Rejected with master list entry.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 3:_="Connection refused! Connection timed out.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 4:_="Connection refused! Out of licenses.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 5:_="Connection refused! No writer access.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 6:_="Connection refused! User defined type is not licensed";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 7:E.log("Connection ok"),c=a.WAIT_CLEAR_ALL;break;case 8:break;case 9:E.log("License activation key detected"),c=a.WAIT_CLEAR_ALL;break;case 10:E.error("Connection refused! No license key."),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 11:_="Connection refused! IPID is already allocated";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;default:_="Connection refused! Bits 4-0 of the mode byte cannot be handled.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE)}var C=1&r;if(64&o)return E.warn("Authentication is required"),void T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.AUTHENTICATION_REQUIRED}});if(C)return E.warn("Authentication failed!"),this.cipClient.transitionTo(a.AUTHENTICATION_FAILED),this.cipClient.disconnect("AUTHENTICATION_FAILED"),void T({type:i.INTERNAL_EVENT,payload:{name:ue.AUTHENTICATION_FAILED}});if(c===a.CONNECTION_REFUSED)return this.cipClient.cancelExpectedResponseTimeouts(),this.cipClient.transitionTo(c),void this.cipClient.tryReconnect();c===a.WAIT_CLEAR_ALL&&this.cipClient.resetReconnectTimeout();var N=e[6];this.cipClient.heartBeatSupported=1==(1&N),this.cipClient.isProgramReadySupported=2==(2&N),this.cipClient.isUnicodeSupported=4==(4&N),this.cipClient.extendedLengthSupported=8==(8&N);var I=48&N;16===I?this.cipClient.serialSize=ie:32===I?this.cipClient.serialSize=oe:48===I&&(this.cipClient.serialSize=re);var h=8==(8&r),f=16==(16&r);if(d(l.CCS_LICENSE_SUPPORT_ON),!h&&!f)return E.warn("Licensing is not supported!"),void d(l.CCS_LICENSE_SUPPORT_OFF);E.debug(""+JSON.stringify({supportsHeartbeat:this.cipClient.heartBeatSupported,supportsProgramReady:this.cipClient.isProgramReadySupported,supportsUnicode:this.cipClient.isUnicodeSupported,supportsExtendedLength:this.cipClient.extendedLengthSupported,serialSize:this.cipClient.serialSize})),c===a.WAIT_CLEAR_ALL&&(T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.CONNECT_CIP,eventData:{url:Ee.url,ipId:Ee.ipId,roomId:Ee.roomId,tokenSource:Ee.tokenSource,tokenUrl:Ee.tokenUrl}}}),this.cipClient.initializeUpdateRequest(),this.cipClient.initializeHeartBeat(),d(l.CCS_ONLINE)),this.cipClient.transitionTo(c)}else E.error("Received DEVICE_ROUTER_CONNECT_RESPONSE in an invalid state")}function le(e){E.debug("Received a HEARTBEAT packet: "+u(e)),this.cipClient.sendHeartBeatResponse(e.slice(5))}var Te,Ce=function(){function e(e){this.cipClient=e,this._handleAuthenticateResponse=N.bind(this),this._handleData=M.bind(this),this._handleDeviceRouterConnectResponse=_e.bind(this),this._handleDisconnect=V.bind(this),this._handleDisconnectResponse=j.bind(this),this._handleExtendedData=x.bind(this),this._handleHeartbeatResponse=Y.bind(this),this._handleHeartbeat=le.bind(this),this._handleProgramReady=_.bind(this),this._handleAuthenticateResponse=N.bind(this)}return Object.defineProperty(e.prototype,"receivedDeviceRouterConnectResponse",{get:function(){return this._receivedDeviceRouterConnectResponse},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"receivedLicenseInformationResponse",{get:function(){return this._receivedLicenseInformationResponse},enumerable:!1,configurable:!0}),e.prototype.handle=function(e){var t=e[0];switch(this.cipClient.setLastPackedReceivedAt(),t){case J.AUTHENTICATE_RESPONSE:this._handleAuthenticateResponse(e);break;case J.DATA:this._handleData(e);break;case J.DEVICE_ROUTER_CONNECT_RESPONSE:this._receivedDeviceRouterConnectResponse=!0,this._handleDeviceRouterConnectResponse(e);break;case J.DISCONNECT:this._handleDisconnect(e);break;case J.DISCONNECT_RESPONSE:this._handleDisconnectResponse(e);break;case J.EXTENDED_DATA:this._handleExtendedData(e);break;case J.HEARTBEAT_RESPONSE:this._handleHeartbeatResponse(e),this.cipClient.resetHeartBeatOutgoing();break;case J.PROGRAM_READY:this._handleProgramReady(e),2===e[3]&&this._startDeviceRouterConnectTimeout();break;case J.LICENSE_INFORMATION_RESPONSE:break;case J.HEARTBEAT:this._handleHeartbeat(e);break;case J.DUMMY:E.log("Received a dummy packet");break;default:throw new Error("Event "+(J[t]||t)+" has no handler!")}},e.prototype._startDeviceRouterConnectTimeout=function(){var e=this;this.deviceRouterConnectTimeout||(this.deviceRouterConnectTimeout=setTimeout((function(){e.cipClient.state!==a.WAIT_PROGRAM_READY?(e.receivedDeviceRouterConnectResponse||(E.error("Device router connect response not received within 16 seconds!"),d(l.CCS_LICENSE_SUPPORT_OFF)),e._receivedDeviceRouterConnectResponse=void 0):e._receivedDeviceRouterConnectResponse=void 0}),16e3))},e.prototype.cancelExpectedResponseTimeouts=function(){this.deviceRouterConnectTimeout&&(clearInterval(this.deviceRouterConnectTimeout),this.deviceRouterConnectTimeout=void 0),this.licenseInformationTimeout&&(this.licenseInformationTimeout=void 0,clearInterval(this.licenseInformationTimeout))},e}(),pe={initialState:a.IDLE,transitions:(Te={},Te[a.IDLE]=[a.WAIT_PROGRAM_READY,a.DISCONNECT_PENDING],Te[a.WAIT_PROGRAM_READY]=[a.WAIT_CONNECT_RESPONSE,a.RECONNECT_AFTER_DELAY,a.DISCONNECT_PENDING,a.WAIT_PROGRAM_READY],Te[a.RECONNECT_AFTER_DELAY]=[a.WAIT_PROGRAM_READY],Te[a.DISCONNECT_PENDING]=[a.WAIT_PROGRAM_READY],Te[a.WAIT_CONNECT_RESPONSE]=[a.WAIT_CLEAR_ALL,a.WAIT_AUTHENTICATE_RESPONSE,a.CONNECTION_REFUSED,a.WAIT_PROGRAM_READY,a.IDLE,a.AUTHENTICATION_FAILED],Te[a.WAIT_CLEAR_ALL]=[a.WAIT_PROGRAM_READY,a.DISCONNECT_PENDING],Te[a.WAIT_AUTHENTICATE_RESPONSE]=[a.AUTHENTICATION_FAILED,a.WAIT_CLEAR_ALL],Te[a.AUTHENTICATION_FAILED]=[a.WAIT_AUTHENTICATE_RESPONSE,a.WAIT_PROGRAM_READY],Te[a.CONNECTION_REFUSED]=[a.WAIT_PROGRAM_READY],Te)},de=[J.CRPC_DATA,J.CONNECT,J.CONNECT_DHCP,J.DEVICE_ROUTER_CONNECT];function Ne(e,t,n){void 0===n&&(n=0);var i=de.includes(e)?0:2,o=(t?t.length:0)+i,r=new Uint8Array(o+3),a=0;return r[a++]=e,r[a++]=o>>8,r[a++]=255&o,de.includes(e)||(r[a++]=n>>8,r[a++]=255&n),t&&r.set(t,a),E.log("Built packet:",u(r)),r}function Ie(e){for(var t=e.length,n=new Uint8Array(t),i=0,o=0;o<t;o++)n[i++]=Math.min(e.charCodeAt(o),255);return n}function he(e,t){var n=new Uint8Array(t);return n.set(Ie(e)),n}var fe=function(){function e(e){this._maxHeartBeatAttempts=3,this._internalHeartBeatInterval=1e4,this.maxIntervalBetweenPackets=29e3,this._lastPacketReceivedAt=void 0,this._heartBeatSupported=void 0,this._extendedLengthSupported=void 0,this._unicodeSupported=void 0,this._programReadySupported=void 0,this._serialSize=ae,this._heartBeatTimer=void 0,this._heartBeatOutgoing=0,this._connected=!1,this._state=pe.initialState,this._webSocketClient=e,this._cipPacketHandler=new Ce(this)}return e.prototype.cancelExpectedResponseTimeouts=function(){this._cipPacketHandler.cancelExpectedResponseTimeouts()},e.prototype.incrementHeartBeatOutgoing=function(){this._heartBeatOutgoing++},e.prototype.resetReconnectTimeout=function(){this._webSocketClient.reconnectTimeout=5e3},Object.defineProperty(e.prototype,"heartBeatTimer",{get:function(){return this._heartBeatTimer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heartBeatSupported",{get:function(){return this._heartBeatSupported},set:function(e){this._heartBeatSupported=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extendedLengthSupported",{get:function(){return this._extendedLengthSupported},set:function(e){this._extendedLengthSupported=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUnicodeSupported",{get:function(){return this._unicodeSupported},set:function(e){this._unicodeSupported=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isProgramReadySupported",{get:function(){return this._programReadySupported},set:function(e){this._programReadySupported=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialSize",{get:function(){return this._serialSize},set:function(e){this._serialSize=e},enumerable:!1,configurable:!0}),e.prototype.resetHeartBeatOutgoing=function(){this._heartBeatOutgoing=0},Object.defineProperty(e.prototype,"heartBeatOutgoing",{get:function(){return this._heartBeatOutgoing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webSocketClient",{get:function(){return this._webSocketClient},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return this._connected},set:function(e){E.debug("CIP Connection status changed to:",e),this._connected=e,this.webSocketClient.onCIPConnectionStatusChanged(e)},enumerable:!1,configurable:!0}),e.prototype.setLastPackedReceivedAt=function(){this._lastPacketReceivedAt=(new Date).getTime()},e.prototype.initializeHeartBeat=function(){var e=this.heartBeatSupported;e||void 0===this.heartBeatTimer?e&&void 0===this.heartBeatTimer&&(this._heartBeatTimer=setInterval(this.sendHeartBeat.bind(this),this._internalHeartBeatInterval)):(clearInterval(this.heartBeatTimer),this._heartBeatTimer=void 0,this._lastPacketReceivedAt=void 0)},e.prototype.initializeUpdateRequest=function(){this.sendUpdateRequest()},e.prototype.initializeEndOfJoinStatusResponse=function(){this.sendEndOfJoinStatusResponse()},e.prototype.transitionTo=function(e){var t=pe.transitions[this._state];if(!t||!t.find((function(t){return t===e})))throw new Error("Invalid transition from "+this._state+" to "+e);this._state=e},e.prototype.reset=function(){this._state=pe.initialState},e.prototype.connectToCCS=function(){this.sendDeviceRouterConnect()},e.prototype.handleCIPPacket=function(e){this._cipPacketHandler.handle(new Uint8Array(e))},Object.defineProperty(e.prototype,"virtualConnectionHandle",{get:function(){return this._virtualConnectionHandle},set:function(e){this._virtualConnectionHandle=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cipProgramIdentifier",{get:function(){return this._cipProgramIdentifier},enumerable:!1,configurable:!0}),e.prototype.authenticate=function(){var e=Ee.jwt,t="Crestron:"+Ee.tokenSource+":"+e,n=new Uint8Array(t.length);n.set(Ie(t),0);var i=Ne(J.AUTHENTICATE,n,this._virtualConnectionHandle);this.transitionTo(a.WAIT_AUTHENTICATE_RESPONSE),this.webSocketClient.sendCIPPacketWithoutBuffer(i)},e.prototype.sendDeviceRouterConnect=function(){var e=Ee.ipId,t=Ee.roomId,n=Ee.jwt,i="Crestron:"+Ee.tokenSource+":"+n,o=i.length,r=new Uint8Array(213+o),a=0;E.log("Sending DEVICE_ROUTER_CONNECT_REQUEST to",{ipId:e,roomId:t}),r[a++]=e>>8,r[a++]=255&e,r[a++]=X,r[a++]=K+q+z+Q,r[a++]=Z,r[a++]=0,r[a++]=0,r[a++]=0;var s=0+ee+te;(null==t?void 0:t.length)>0&&(s+=$),o>0&&(s+=ne),r[a++]=s,r.set([0,0,0,0,0,0],a),a+=6;r.set(he("Crestron",50),a),a+=50;r.set(he("WebXPanel",50),a),a+=50,r.set(he(t,32),a),a+=32;r.set(he("Hostname",64),a),a+=64,r[a++]=o>>8,r[a++]=255&o,o>0&&r.set(Ie(i),a),this._cipProgramIdentifier=this.webSocketClient.socket.url+":0x"+e.toString(16)+":"+t;var c=Ne(J.DEVICE_ROUTER_CONNECT,r);this.webSocketClient.sendCIPPacketWithoutBuffer(c)},e.prototype.sendHeartBeat=function(){if(!((new Date).getTime()-this._lastPacketReceivedAt<this.maxIntervalBetweenPackets))if(this.webSocketClient.connected){if(this.heartBeatOutgoing>=this._maxHeartBeatAttempts)return this.sendDisconnect(),clearInterval(this.heartBeatTimer),this._heartBeatTimer=void 0,void this.resetHeartBeatOutgoing();var e=Ne(J.HEARTBEAT,null,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(e),this.incrementHeartBeatOutgoing()}else clearInterval(this.heartBeatTimer)},e.prototype.sendHeartBeatResponse=function(e){var t=Ne(J.HEARTBEAT_RESPONSE,e,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(t)},e.prototype.sendDisconnect=function(){var e=new Uint8Array(2),t=0;e[t++]=0,e[t++]=2;var n=Ne(J.DISCONNECT,e,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(n),this.webSocketClient.closeWebSocket(!0)},e.prototype.sendEndOfJoinStatusResponse=function(){var e=new Uint8Array(3),t=0;e[t++]=2,e[t++]=3,e[t++]=29;var n=Ne(J.DATA,e,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(n),this.connected=!0},e.prototype.sendUpdateRequest=function(){var e=new Uint8Array(3),t=0;e[t++]=2,e[t++]=3,e[t++]=0;var n=Ne(J.DATA,e,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(n)},e.prototype.tryReconnect=function(){this.webSocketClient.tryReconnect()},e.prototype.disconnect=function(e){this.webSocketClient.disconnect(e)},e.sendUpdateTemplatePacketBuilder=function(e,t,n){var i=(n?2:1)+(t?n?7:6:0)+e,o=new Uint8Array(i),r=0;return n?(o[r++]=i-2>>8&255,o[r++]=i-2&255):o[r++]=i-1,t&&(o[r++]=n?I.EXTENDED_SMART_OBJECT:I.SMART_OBJECT,o[r++]=t>>24&255,o[r++]=t>>16&255,o[r++]=t>>8&255,o[r++]=255&t,n?(o[r++]=i-9>>8&255,o[r++]=i-9&255):o[r++]=i-7&255),{packetData:o,offset:r}},e.prototype.sendUpdateString=function(t,n,i){void 0===i&&(i=0);var o=this.isUnicodeSupported?2*t.length:t.length,r=e.sendUpdateTemplatePacketBuilder(o+4,i,this.extendedLengthSupported),a=r.packetData,s=r.offset;a[s++]=this.extendedLengthSupported?I.EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT:I.SERIAL_IO_INDIRECT_TEXT,a[s++]=n>>8&255,a[s++]=255&n,a[s++]=this.isUnicodeSupported?7:3;for(var c=0;c<t.length;c++)if(this.isUnicodeSupported){var E=t.codePointAt(c);a[s++]=255&E,a[s++]=E>>8&255}else a[s++]=t.charCodeAt(c);var u=Ne(this.extendedLengthSupported?J.EXTENDED_DATA:J.DATA,a,this.virtualConnectionHandle);this._webSocketClient.sendCIPPacketWithBuffer(u)},e.prototype.sendUpdateNumber=function(t,n,i){void 0===i&&(i=0);var o=e.sendUpdateTemplatePacketBuilder(5,i,!1),r=o.packetData,a=o.offset;r[a++]=I.SYMMETRICAL_ANALOG_PACKETS,r[a++]=n>>8&255,r[a++]=255&n,r[a++]=t>>8&255,r[a++]=255&t;var s=Ne(J.DATA,r,this.virtualConnectionHandle);this._webSocketClient.sendCIPPacketWithBuffer(s)},e.prototype.sendUpdateBoolean=function(t,n,i,o){void 0===i&&(i=0),void 0===o&&(o=!1);var r=e.sendUpdateTemplatePacketBuilder(3,i,!1),a=r.packetData,s=r.offset;a[s++]=o?I.REPEAT_DIGITAL_IO:I.DIGITAL_IO,!0===t?(a[s++]=255&n,a[s++]=n>>8&255):(a[s++]=255&n,a[s++]=128+(n>>8&255));var c=Ne(J.DATA,a,this.virtualConnectionHandle);this._webSocketClient.sendCIPPacketWithBuffer(c)},e}();function Re(e){var t=function e(t,n,i){if(void 0===n&&(n=0),void 0===i&&(i=1),n>i)return"Object";var o={};for(var r in t){var a=t[r];a instanceof Object&&(a=e(a,n+1,i)),o[r]=a}return n?o:JSON.stringify(o)}(e);return JSON.parse(t)}function Ae(e,t){T({type:i.WEBSOCKET_EVENT,payload:{eventName:e,eventData:Re(t)}})}var Se=function(){function e(){this._items=[],this._isProcessing=!1}return e.prototype.size=function(){return this._items.length},e.prototype.isEmpty=function(){return 0===this._items.length},e.prototype.push=function(e){this._items.push(e)},e.prototype.pop=function(){if(!this.isEmpty())return this._items.shift();this._isProcessing=!1},e.prototype.startProcessing=function(){this._isProcessing=!0},e.prototype.stopProcessing=function(e){void 0===e&&(e=!0),this._isProcessing=!1,e&&this.clear()},Object.defineProperty(e.prototype,"isProcessing",{get:function(){return this._isProcessing},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this._items=[]},e}(),Oe=function(){function e(e,t){this._isReconnecting=!1,this.url=e,this.reconnectTimeout=t||5e3,this.cipClient=new fe(this),this.cipPacketsBuffer=new Se,this.ch5EventsBuffer=new Se,this._attemptReconnect=!1}return Object.defineProperty(e.prototype,"cipClient",{get:function(){return this._cipClient},set:function(e){this._cipClient=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reconnectTimeout",{get:function(){return this._reconnectTimeout},set:function(e){this._reconnectTimeout=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cipPacketsBuffer",{get:function(){return this._cipPacketsBuffer},set:function(e){this._cipPacketsBuffer=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ch5EventsBuffer",{get:function(){return this._ch5EventsBuffer},set:function(e){this._ch5EventsBuffer=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReconnecting",{get:function(){return this._isReconnecting},set:function(e){this._isReconnecting=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},set:function(e){this._socket=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return!!this.socket&&this.socket.readyState===this.socket.OPEN},enumerable:!1,configurable:!0}),e.prototype.tryReconnect=function(){var e=this;this.isReconnecting||(E.warn("Retrying WS Connection in "+this.reconnectTimeout/1e3+" seconds ..."),this.disconnect(),setTimeout((function(){e.isReconnecting=!0,e.connect()}),this.reconnectTimeout),this.increaseReconnectTimeout())},e.prototype.connectAfterDelay=function(e){var t=this;E.warn("Reconnecting WS Connection after "+e/1e3+" seconds delay..."),setTimeout((function(){t.connect()}),e)},e.prototype.authenticate=function(){this.cipClient.authenticate()},e.prototype.connect=function(){E.debug("Trying to establish a WebSocket connection to "+this.url),this.socket&&this.disconnect(),this.socket=new WebSocket(this.url),this.socket.binaryType="arraybuffer",this.initializeListeners(),this.isReconnecting=!1},e.prototype.initializeListeners=function(){this.socket.onopen=this.onConnect.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onerror=e.onError.bind(this),this.socket.onmessage=this.onMessage.bind(this)},e.prototype.onConnect=function(e){E.log("Successfully established WebSocket connection:",e),this.cipClient.transitionTo(a.WAIT_PROGRAM_READY),Ae(l.CONNECT_WS,e)},e.prototype.onClose=function(e){E.log("WebSocket connection closed:",e),this.removeEventListeners(),Ae(l.DISCONNECT_WS,e),e.wasClean?this._attemptReconnect&&(this._attemptReconnect=!1,this.tryReconnect()):this.tryReconnect()},e.onError=function(e){E.log("WebSocket connection error:",e),Ae(l.ERROR_WS,e)},e.prototype.onMessage=function(e){this.cipClient.handleCIPPacket(e.data)},e.prototype.increaseReconnectTimeout=function(){this.reconnectTimeout=2*this.reconnectTimeout%16e4,this.reconnectTimeout=0===this.reconnectTimeout?16e4:this.reconnectTimeout},e.prototype.removeEventListeners=function(){E.debug("Removing all the event listeners..."),this.socket.onopen=function(){return{}},this.socket.onclose=function(){return{}},this.socket.onerror=function(){return{}},this.socket.onmessage=function(){return{}}},e.prototype.disconnect=function(e){E.warn("Disconnecting from WebSocket..."),this.removeEventListeners(),this.socket.close(),this.socket=void 0,T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.DISCONNECT_CIP,eventData:{reason:e}}}),T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.DISCONNECT_WS}}),this.cipPacketsBuffer.stopProcessing()},e.prototype.sendCIPPacketWithBuffer=function(e){if(!this.connected||!this.cipClient.connected)return E.log("Not connected over CIP yet. Adding message to buffer..."),void this.cipPacketsBuffer.push(e);this.cipPacketsBuffer.isEmpty()?this.socket.send(e):this.cipPacketsBuffer.isProcessing?(E.log("Buffer is processing. Adding message to the end of the queue..."),this.cipPacketsBuffer.push(e)):this.startCipBufferProcessing()},e.prototype.sendCIPPacketWithoutBuffer=function(e){this.socket.send(e)},e.prototype.onCIPConnectionStatusChanged=function(e){e?this.startCipBufferProcessing():this.cipPacketsBuffer.stopProcessing()},e.prototype.sendJoinEvent=function(e,t,n){if(t){var i=t.joinId-1;switch(e){case A.BOOLEAN:this.cipClient.sendUpdateBoolean(n,i,t.smartObjectId);break;case A.NUMERIC:this.cipClient.sendUpdateNumber(n,i,t.smartObjectId);break;case A.STRING:this.cipClient.sendUpdateString(n,i,t.smartObjectId);break;case A.REPEAT_DIGITAL:this.cipClient.sendUpdateBoolean(n,i,t.smartObjectId,!0)}}},e.prototype.startCipBufferProcessing=function(){for(this.cipPacketsBuffer.startProcessing();!this.cipPacketsBuffer.isEmpty();){var e=this.cipPacketsBuffer.pop();if(!e)return;this.socket.send(e)}},e.prototype.sendEventToNative=function(e){if(b.initialized)if(this.ch5EventsBuffer.isEmpty()){var t=b.mapEvent(e.eventType,e.eventName);this.sendJoinEvent(e.eventType,t,e.value)}else this.ch5EventsBuffer.push(e),this.ch5EventsBuffer.isProcessing||this.startCh5BufferProcessing();else this.ch5EventsBuffer.push(e)},e.prototype.startCh5BufferProcessing=function(){for(this.ch5EventsBuffer.startProcessing();!this.ch5EventsBuffer.isEmpty();){var e=this.ch5EventsBuffer.pop(),t=b.mapEvent(e.eventType,e.eventName);this.sendJoinEvent(e.eventType,t,e.value)}},e.prototype.closeWebSocket=function(e){E.log("Calling close on websocket. Attempt reconnect ",e),this.socket.close(),this._attemptReconnect=e},e}();var ve,ge=function(){return(ge=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},De=self;De.onmessage=function(e){var t=e.data;switch(t.type){case i.SET_BASE_PATH:var n=t.payload;D.basePath=n.value,D.getInstance().loadContractFile();break;case i.INITIALIZE_WS:var o=t.payload;Ee.setParameters(ge(ge({},o),{url:new URL(o.url)})),be();break;case i.CONNECT_WS:ve.connect();break;case i.DISCONNECT_WS:var r=t.payload.value;ve.disconnect(r);break;case i.SET_JWT:r=t.payload.value;Ee.jwt=r;break;case i.AUTHENTICATE:ve.authenticate();break;case i.LOGGER_EVENT:var a=t.payload,s=a.enabled,c=a.logLevel;s?E.enableDebugging():E.disableDebugging(),E.setLogLevel(c);break;case i.BRIDGE_SEND_BOOLEAN_TO_NATIVE:ve.sendEventToNative({eventType:A.BOOLEAN,eventName:t.payload.signalName,value:t.payload.value}),E.debug("[WORKER] "+i.BRIDGE_SEND_BOOLEAN_TO_NATIVE,t.payload);break;case i.BRIDGE_SEND_INTEGER_TO_NATIVE:ve.sendEventToNative({eventType:A.NUMERIC,eventName:t.payload.signalName,value:t.payload.value}),E.debug("[WORKER] "+i.BRIDGE_SEND_INTEGER_TO_NATIVE,t.payload);break;case i.BRIDGE_SEND_STRING_TO_NATIVE:ve.sendEventToNative({eventType:A.STRING,eventName:t.payload.signalName,value:t.payload.value}),E.debug("[WORKER] "+i.BRIDGE_SEND_STRING_TO_NATIVE,t.payload);break;case i.BRIDGE_SEND_OBJECT_TO_NATIVE:E.debug("[WORKER] "+i.BRIDGE_SEND_OBJECT_TO_NATIVE,t.payload);var u=function(e){try{return JSON.parse(e)}catch(e){E.error(e)}return null}(t.payload.value);u.hasOwnProperty("repeatdigital")&&ve.sendEventToNative({eventType:A.REPEAT_DIGITAL,eventName:t.payload.signalName,value:u.repeatdigital});break;default:E.log("Received "+t.type+" from main thread with payload: "+t.payload)}};var be=function(){try{ve=new Oe(Ee.url)}catch(e){E.log(e,"Could not initialize WebSocket!")}};De.onerror=function(e){E.error("Worker error",e)}}]);`,"_worker","CONNECT_CIP","CCS_LICENSE_INVALID","parse","redirected","ERROR_WS","ws://","bridgeSendStringToNative","externalToInternalConfigParams","initializeWorker","return","toISOString","WebXPanel configuration object is not a valid JSON object!","CCS_DIAGNOSTICS","BRIDGE_SEND_STRING_TO_NATIVE","LOGGER_EVENT","d4412f0cafef4f213591.worker.js","binaryType","[WXP]","bridgeSendIntegerToNative","INTERNAL_EVENT","INVALID_MAC_ADDRESS","bridgeReceiveIntegerFromNative","CCS_LICENSE_VALID","Reconnecting WebXPanel after ","debug","0x03","Received ","Inline worker is not supported","bridgeReceiveStringFromNative","stringify","exports","BRIDGE_SEND_INTEGER_TO_NATIVE","exec","data","pop","processDiagnosticsMessages","wss://","numberBodyStack","BRIDGE_RECEIVE_OBJECT_FROM_NATIVE","NOT_AUTHORIZED","bridgeReceiveObjectFromNative","toStringTag","WebXPanel received configuration object:","/cws/websocket/getWebSocketToken","hasOwnProperty","DEBUG","listenTo","value","increaseReconnectTimeout","connectToWebSocketServer","_reconnectTimeout","startsWith","Your browser does not support Worker!","messageHandlers","CLOSING","object","replace","Unhandled internal event ","sendString","name","LICENSE_WS","CCS_LICENSE_SUPPORT_ON","string","WebXPanel runs in container app; All functionality is cancelled.","done","getLogLevel","addEventListener","Received authentication request from client.","bind","CCS_TRIAL_PERIOD_DAYS","postMessage","origin","WARN","push","createEvent","FETCH_TOKEN_FAILED","CCS_LICENSE_DAYS","bindWorkerListeners","prototype","Trying to dispatch an invalid event.","eventData","amd","WEB_WORKER_FAILED","tokenURL was not provided!","default","AUTHENTICATION_FAILED","WebKitBlobBuilder","iterator","BRIDGE_RECEIVE_INTEGER_FROM_NATIVE","tokenUrl","_boolBodyStack","_diagnosticStringSender","enableDebugging","URL","payload","DISCONNECT_CIP","reconnectTimeout","trys","Module","messageerror","_diagnosticIntegerSender","status","debugging","initialize","logLevel","AUTHENTICATE","call","indexOf","://","Your browser does not support binary WebSocket!","Csig.All_Control_Systems_Online_fb","forEach","CCS_LICENSE_SUPPORT_OFF","initializeWebSocketClient","switchConnectionStatus","open","Number senders may not be initialized yet","catch","processValidationEvents","toLowerCase","BRIDGE_RECEIVE_STRING_FROM_NATIVE","_numberBodyStack","function","_diagnosticBooleanSender","navigator","INITIALIZE_WS","processWebSocketMessages","includes","LOGGER_KEY","runsInContainerApp","Initializing WebXPanel with:","setDiagnosticStringSender","VALIDATION_EVENT","substr","BlobBuilder","bridgeReceiveBooleanFromNative","getJwtToken","_stringBodyStack","bridgeSendBooleanToNative","CCS_NO_LICENCE_REQ","signalName","CCS_OFFLINE","WebSocket","BRIDGE_SEND_OBJECT_TO_NATIVE","Not authorized to fetch WebSocket token. Redirected to ","log","append","CCS_TRIAL_PERIOD_OFF","onWorkerError","Crestron WebXPanel Library version 2.8.0 build date ","disableDebugging","roomId","Error receiving message from worker","[MAIN] String, [","eventName","sendBoolean","setBasePathOnWorker","Generator is already executing.","boolBodyStack","__esModule","Error on WebSocket token retrieval: ","setDiagnosticBooleanSender","url","apply","ops","switchStatus","type","Setting project basepath to ","label","publish","AUTHENTICATION_REQUIRED","Csig.Browser_URL","worker","onWorkerMessageError","false","BRIDGE_SEND_BOOLEAN_TO_NATIVE","authenticate","2.8.0","pathname"," seconds delay...","include","_connectionDiagnostic","ERROR","trim","initializeConnectionDiagnostic","host","WEBSOCKET_EVENT","updateLoggerState","connectionDiagnostic","undefined","next","authToken","hostname","SET_JWT","getBlob","getDebugging","length","slice","throw","port","userAgent","websocketToken","CCS_TRIAL_PERIOD_ON","defineProperty","send","sent","_blank","onWorkerMessage","addCommunicationMethodsToWindow","WebXPanel","then","String senders may not be initialized yet","WebXPanel runs in browser.","location","INVALID_CREDENTIALS","CONTROL_SYSTEM_OFFLINE_ENDPOINT","data:application/javascript,","dispatch","Your browser does not support WebSocket!","keys","CCS_ONLINE","assign","LICENSE_EVENT","CONNECT_WS","CONTROL_SYSTEM_ONLINE_ENDPOINT"];(function(r,s){var a=function(c){for(;--c;)r.push(r.shift())};a(++s)})(n,102);var e=function(r,s){r=r-0;var a=n[r];return a};(function(r,s){e("0xd8")=="object"?i[e("0xbf")]=s():e("0x27")=="undefined"&&(void 0)[e("0xf2")]?(void 0)([],s):e("0xd8")=="object"?t[e("0x7e")]=s():r.WebXPanel=s()})(window,function(){return function(r){var s={};function a(c){if(s[c])return s[c][e("0xbf")];var l=s[c]={i:c,l:!1,exports:{}};return r[c][e("0x17")](l[e("0xbf")],l,l.exports,a),l.l=!0,l.exports}return a.m=r,a.c=s,a.d=function(c,l,T){a.o(c,l)||Object[e("0x78")](c,l,{enumerable:!0,get:T})},a.r=function(c){e("0x6a")!=typeof Symbol&&Symbol[e("0xca")]&&Object[e("0x78")](c,Symbol.toStringTag,{value:e("0xf")}),Object[e("0x78")](c,e("0x4c"),{value:!0})},a.t=function(c,l){if(1&l&&(c=a(c)),8&l||4&l&&typeof c=="object"&&c&&c[e("0x4c")])return c;var T=Object.create(null);if(a.r(T),Object[e("0x78")](T,e("0x1"),{enumerable:!0,value:c}),2&l&&e("0xdf")!=typeof c)for(var E in c)a.d(T,E,(function(p){return c[p]})[e("0xe5")](null,E));return T},a.n=function(c){var l=c&&c[e("0x4c")]?function(){return c[e("0x1")]}:function(){return c};return a.d(l,"a",l),l},a.o=function(c,l){return Object.prototype[e("0xcd")][e("0x17")](c,l)},a.p="",a(a.s=7)}([function(r,s,a){a.d(s,"a",function(){return c});var c,l=function(){for(var E=0,p=0,_=arguments[e("0x71")];p<_;p++)E+=arguments[p][e("0x71")];var y=Array(E),A=0;for(p=0;p<_;p++)for(var D=arguments[p],C=0,b=D[e("0x71")];C<b;C++,A++)y[A]=D[C];return y};(function(E){E[E[e("0x90")]=0]=e("0x90"),E[E[e("0xce")]=1]=e("0xce"),E[E[e("0xe9")]=2]=e("0xe9"),E[E.ERROR=3]=e("0x63")})(c||(c={}));var T=function(){function E(){}return E[e("0xe2")]=function(){return this[e("0x15")]},E[e("0x94")]=function(p){this[e("0x15")]=p},E.enableDebugging=function(){E[e("0x13")]=!0},E[e("0x43")]=function(){E[e("0x13")]=!1},E[e("0x95")]=function(){return E[e("0x13")]},E.log=function(){for(var p=[],_=0;_<arguments[e("0x71")];_++)p[_]=arguments[_];!E[e("0x95")]()||this[e("0x15")]>c[e("0x90")]||console[e("0x3e")][e("0x50")](console,l([E[e("0x2d")],new Date()[e("0xab")]()],p))},E.warn=function(){for(var p=[],_=0;_<arguments.length;_++)p[_]=arguments[_];!E.getDebuggingState()||E[e("0x15")]>c[e("0xe9")]||console[e("0x96")][e("0x50")](console,l([E[e("0x2d")],new Date()[e("0xab")]()],p))},E[e("0x92")]=function(){for(var p=[],_=0;_<arguments[e("0x71")];_++)p[_]=arguments[_];E[e("0x95")]()&&console.error[e("0x50")](console,l([E.LOGGER_KEY,new Date()[e("0xab")]()],p))},E[e("0xb9")]=function(){for(var p=[],_=0;_<arguments.length;_++)p[_]=arguments[_];!E[e("0x95")]()||E[e("0x15")]>c[e("0xce")]||console[e("0xb9")][e("0x50")](console,l([E[e("0x2d")],new Date()[e("0xab")]()],p))},E.LOGGER_KEY=e("0xb2"),E[e("0x15")]=c[e("0xe9")],E[e("0x13")]=!0,E}();s.b=T},function(r,s,a){var c;(function(l){l[e("0x8c")]="CONNECT_WS",l[e("0x91")]="DISCONNECT_WS",l.ERROR_WS="ERROR_WS",l[e("0xf3")]="WEB_WORKER_FAILED",l[e("0xec")]=e("0xec"),l[e("0xa1")]=e("0xa1"),l[e("0xc")]=e("0xc"),l[e("0xb5")]="INVALID_MAC_ADDRESS",l[e("0x83")]=e("0x83"),l[e("0x2")]=e("0x2"),l[e("0x57")]=e("0x57"),l.CCS_OFFLINE=e("0x3a"),l[e("0x89")]="CCS_ONLINE",l[e("0x77")]=e("0x77"),l[e("0x40")]="CCS_TRIAL_PERIOD_OFF",l.CCS_TRIAL_PERIOD_DAYS=e("0xe6"),l.CCS_LICENSE_VALID=e("0xb7"),l[e("0xa2")]=e("0xa2"),l[e("0xde")]="CCS_LICENSE_SUPPORT_ON",l.CCS_LICENSE_SUPPORT_OFF=e("0x1d"),l[e("0xed")]=e("0xed"),l[e("0x38")]=e("0x38"),l[e("0xdd")]=e("0xdd"),l[e("0xc8")]=e("0xc8")})(c||(c={})),s.a=c},function(r,s,a){a.d(s,"a",function(){return c});var c={host:location[e("0x6d")],ipId:e("0xba"),port:49200,roomId:"",tokenUrl:location[e("0xe8")]+e("0xcc"),tokenSource:"CSSelf",authToken:""}},function(r,s,a){r[e("0xbf")]=function(){return a(4)(e("0x9f"),a.p+e("0xb0"))}},function(r,s,a){var c=window[e("0xa")]||window.webkitURL;r[e("0xbf")]=function(l,T){try{try{var E;try{(E=new(window[e("0x33")]||window[e("0x3")]||window.MozBlobBuilder||window[e("0x9a")]))[e("0x3f")](l),E=E[e("0x6f")]()}catch{E=new Blob([l])}return new Worker(c.createObjectURL(E))}catch{return new Worker(e("0x85")+encodeURIComponent(l))}}catch{if(!T)throw Error(e("0xbc"));return new Worker(T)}}},function(r,s,a){a.r(s),a.d(s,e("0x7e"),function(){return c}),a.d(s,e("0x9"),function(){return l}),a.d(s,e("0x43"),function(){return T}),a.d(s,e("0x95"),function(){return E}),a.d(s,"getLogLevel",function(){return p}),a.d(s,e("0x94"),function(){return _});var c={initialize:function(){},addEventListener:function(){}},l=function(){},T=function(){},E=function(){},p=function(){},_=function(){};s.default=c},function(r,s,a){a.r(s),a.d(s,e("0x7e"),function(){return tt}),a.d(s,e("0x9"),function(){return ze}),a.d(s,e("0x43"),function(){return $e}),a.d(s,e("0x95"),function(){return Qe}),a.d(s,"getLogLevel",function(){return Ze}),a.d(s,e("0x94"),function(){return et});var c,l=a(3),T=a.n(l);(function(o){o.INITIALIZE_WS=e("0x2a"),o[e("0x8c")]=e("0x8c"),o[e("0x91")]=e("0x91"),o[e("0x67")]=e("0x67"),o[e("0x99")]=e("0x99"),o[e("0x6e")]=e("0x6e"),o[e("0x16")]=e("0x16"),o.LOGGER_EVENT=e("0xaf"),o[e("0x5c")]="BRIDGE_SEND_BOOLEAN_TO_NATIVE",o[e("0xc0")]=e("0xc0"),o.BRIDGE_SEND_STRING_TO_NATIVE=e("0xae"),o[e("0x3c")]=e("0x3c"),o[e("0x97")]=e("0x97"),o.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE=e("0x5"),o[e("0x25")]=e("0x25"),o[e("0xc7")]=e("0xc7"),o[e("0xad")]="CCS_DIAGNOSTICS",o.LICENSE_EVENT=e("0x8b"),o[e("0x31")]=e("0x31"),o[e("0xb4")]=e("0xb4")})(c||(c={}));var E,p=a(0),_=a(1),y=function(){return(y=Object[e("0x8a")]||function(o){for(var x,h=1,f=arguments[e("0x71")];h<f;h++)for(var u in x=arguments[h])Object[e("0xef")][e("0xcd")][e("0x17")](x,u)&&(o[u]=x[u]);return o})[e("0x50")](this,arguments)},A=function(){function o(){}return o[e("0xeb")]=function(x,h){return new CustomEvent(x,{bubbles:!0,cancelable:!1,composed:!1,detail:y({},h)})},o}(),D=function(){function o(){}return o[e("0xcf")]=function(x,h){window[e("0xe3")](x,h)},o[e("0x86")]=function(x,h){var f=A[e("0xeb")](x,h);return window[e("0x9c")](f),f},o}(),C=a(2);(function(o){o[e("0x8d")]=e("0x1b"),o[e("0x84")]="Csig.Control_Systems_Offline_fb"})(E||(E={}));var b=E,B=function(){function o(){this._boolBodyStack=[],this[e("0x26")]=[],this._stringBodyStack=[]}return o[e("0xef")][e("0x4e")]=function(x){this[e("0x28")]=x},o[e("0xef")][e("0x8f")]=function(x){this[e("0x11")]=x},o.prototype[e("0x30")]=function(x){this[e("0x8")]=x},o[e("0xef")][e("0x56")]=function(){this[e("0x48")](),this[e("0x9d")](),this.sendString()},o.prototype[e("0x1f")]=function(x){this[e("0x52")](b[e("0x8d")],x,b[e("0x84")])},Object[e("0x78")](o[e("0xef")],e("0x4b"),{get:function(){return this[e("0x7")]},enumerable:!1,configurable:!0}),Object[e("0x78")](o.prototype,e("0xc6"),{get:function(){return this[e("0x26")]},enumerable:!1,configurable:!0}),Object[e("0x78")](o[e("0xef")],"stringBodyStack",{get:function(){return this._stringBodyStack},enumerable:!1,configurable:!0}),o[e("0xef")].switchStatus=function(x,h,f){this[e("0x7")][e("0xea")]({endpoint:x,data:h}),this[e("0x7")][e("0xea")]({endpoint:f,data:!h})},o[e("0xef")][e("0x48")]=function(){try{o[e("0x79")](this[e("0x7")],this._diagnosticBooleanSender),this[e("0x7")]=[]}catch(x){p.b[e("0xb9")]("Boolean senders may not be initialized yet",x)}},o[e("0xef")][e("0x9d")]=function(){try{o[e("0x79")](this[e("0x26")],this[e("0x11")]),this._numberBodyStack=[]}catch(x){p.b[e("0xb9")](e("0x21"),x)}},o[e("0xef")][e("0xdb")]=function(){try{o[e("0x79")](this[e("0x36")],this[e("0x8")]),this._stringBodyStack=[]}catch(x){p.b.debug(e("0x80"),x)}},o[e("0x79")]=function(x,h){x[e("0x1c")](function(f){h(f.endpoint,f[e("0xc2")])})},o}();function W(o,x){CrComLib.bridgeReceiveIntegerFromNative(o,x)}function J(o,x){CrComLib.bridgeReceiveBooleanFromNative(o,x)}function X(o,x){CrComLib[e("0xbd")](o,x)}function ne(){return CrComLib[e("0xb6")]!==void 0}function ie(){return CrComLib[e("0x34")]!==void 0}function He(){return CrComLib[e("0xbd")]!==void 0}var re,je=function(o,x,h,f){return new(h||(h=Promise))(function(u,I){function g(S){try{R(f[e("0x6b")](S))}catch(d){I(d)}}function v(S){try{R(f[e("0x73")](S))}catch(d){I(d)}}function R(S){var d;S.done?u(S.value):(d=S[e("0xd0")],d instanceof h?d:new h(function(G){G(d)}))[e("0x7f")](g,v)}R((f=f[e("0x50")](o,[]))[e("0x6b")]())})},Je=function(o,x){var h,f,u,I,g={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return I={next:v(0),throw:v(1),return:v(2)},e("0x27")==typeof Symbol&&(I[Symbol[e("0x4")]]=function(){return this}),I;function v(R){return function(S){return function(d){if(h)throw new TypeError(e("0x4a"));for(;g;)try{if(h=1,f&&(u=2&d[0]?f[e("0xaa")]:d[0]?f[e("0x73")]||((u=f[e("0xaa")])&&u[e("0x17")](f),0):f[e("0x6b")])&&!(u=u[e("0x17")](f,d[1]))[e("0xe1")])return u;switch(f=0,u&&(d=[2&d[0],u[e("0xd0")]]),d[0]){case 0:case 1:u=d;break;case 4:return g[e("0x55")]++,{value:d[1],done:!1};case 5:g[e("0x55")]++,f=d[1],d=[0];continue;case 7:d=g[e("0x51")][e("0xc3")](),g.trys[e("0xc3")]();continue;default:if(u=g[e("0xe")],!((u=u.length>0&&u[u[e("0x71")]-1])||d[0]!==6&&d[0]!==2)){g=0;continue}if(d[0]===3&&(!u||d[1]>u[0]&&d[1]<u[3])){g[e("0x55")]=d[1];break}if(d[0]===6&&g.label<u[1]){g.label=u[1],u=d;break}if(u&&g[e("0x55")]<u[2]){g[e("0x55")]=u[2],g[e("0x51")][e("0xea")](d);break}u[2]&&g[e("0x51")][e("0xc3")](),g[e("0xe")][e("0xc3")]();continue}d=x[e("0x17")](o,g)}catch(G){d=[6,G],f=0}finally{h=u=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([R,S])}}};function Xe(o){return je(this,void 0,void 0,function(){var x,h,f,u;return Je(this,function(I){switch(I[e("0x55")]){case 0:if(!o)throw new Error(e("0x0"));return x=o[e("0x18")]("?")<0?"?":"&",h=""+o+x+"redirectTo="+encodeURIComponent(window[e("0x82")][e("0x93")]),[4,fetch(h,{credentials:e("0x61")})];case 1:if((f=I[e("0x7a")]())[e("0xa4")])return p.b[e("0x3e")]("Received redirect to:",f.url),[2,{redirectTo:f[e("0x4f")]}];I.label=2;case 2:return I[e("0xe")].push([2,4,,5]),[4,f.text()];case 3:return u=I[e("0x7a")](),[3,5];case 4:return I[e("0x7a")](),[3,5];case 5:if(!f.ok)throw{statusText:f.statusText,status:f[e("0x12")],url:f[e("0x4f")]};return[2,u]}})})}(function(o){o[e("0x2")]=e("0x2")})(re||(re={}));var qe=re,F=function(){return(F=Object.assign||function(o){for(var x,h=1,f=arguments.length;h<f;h++)for(var u in x=arguments[h])Object.prototype[e("0xcd")][e("0x17")](x,u)&&(o[u]=x[u]);return o}).apply(this,arguments)},Ye=function(o,x,h,f){return new(h||(h=Promise))(function(u,I){function g(S){try{R(f.next(S))}catch(d){I(d)}}function v(S){try{R(f[e("0x73")](S))}catch(d){I(d)}}function R(S){var d;S[e("0xe1")]?u(S.value):(d=S.value,d instanceof h?d:new h(function(G){G(d)}))[e("0x7f")](g,v)}R((f=f.apply(o,[])).next())})},Ke=function(o,x){var h,f,u,I,g={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return I={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(I[Symbol[e("0x4")]]=function(){return this}),I;function v(R){return function(S){return function(d){if(h)throw new TypeError(e("0x4a"));for(;g;)try{if(h=1,f&&(u=2&d[0]?f[e("0xaa")]:d[0]?f[e("0x73")]||((u=f[e("0xaa")])&&u[e("0x17")](f),0):f[e("0x6b")])&&!(u=u.call(f,d[1]))[e("0xe1")])return u;switch(f=0,u&&(d=[2&d[0],u[e("0xd0")]]),d[0]){case 0:case 1:u=d;break;case 4:return g[e("0x55")]++,{value:d[1],done:!1};case 5:g[e("0x55")]++,f=d[1],d=[0];continue;case 7:d=g[e("0x51")][e("0xc3")](),g.trys[e("0xc3")]();continue;default:if(u=g.trys,!((u=u[e("0x71")]>0&&u[u[e("0x71")]-1])||d[0]!==6&&d[0]!==2)){g=0;continue}if(d[0]===3&&(!u||d[1]>u[0]&&d[1]<u[3])){g[e("0x55")]=d[1];break}if(d[0]===6&&g[e("0x55")]<u[1]){g[e("0x55")]=u[1],u=d;break}if(u&&g.label<u[2]){g.label=u[2],g[e("0x51")][e("0xea")](d);break}u[2]&&g.ops[e("0xc3")](),g[e("0xe")].pop();continue}d=x[e("0x17")](o,g)}catch(G){d=[6,G],f=0}finally{h=u=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([R,S])}}},M=function(){function o(){this.websocketToken="",this[e("0xd3")]=5e3,this[e("0x62")]=new B}return Object.defineProperty(o[e("0xef")],e("0xd"),{get:function(){return this[e("0xd3")]},set:function(x){this[e("0xd3")]=x},enumerable:!1,configurable:!0}),Object[e("0x78")](o[e("0xef")],e("0x59"),{get:function(){return this[e("0xa0")]},enumerable:!1,configurable:!0}),Object[e("0x78")](o.prototype,"connectionDiagnostic",{get:function(){return this[e("0x62")]},enumerable:!1,configurable:!0}),o[e("0x8e")]=function(){return o[e("0x9e")]===void 0&&(o.instance=new o),o[e("0x9e")]},o.prototype[e("0x14")]=function(x){p.b.debug(e("0xcb"),x),x.authToken&&(this[e("0x76")]=x[e("0x6c")]);var h=o[e("0xa8")](x);p.b.debug(e("0x2f"),h),this[e("0xa9")](h),this[e("0x7d")](),this[e("0x65")]()},o[e("0xa8")]=function(x){var h,f;x===void 0&&(x={});try{h=JSON[e("0xa3")](JSON.stringify(x)),f=h,Object[e("0x88")](f).forEach(function(d){f[d]!==null&&f[d]!==void 0&&f[d]!==""||delete f[d]}),(h=f)[e("0x6")]&&(h[e("0x6")]=h[e("0x6")][e("0x64")]())}catch{p.b[e("0x92")](e("0xac"))}var u=F(F({},C.a),h);if(h[e("0x6")]||(u[e("0x6")]="https://"+u[e("0x66")]+"/cws/websocket/getWebSocketToken"),!h[e("0x44")]){var I=/\/VirtualControl\/(MA\/)*Rooms\/(.*)\/XPanel\//i[e("0xc1")](window[e("0x82")][e("0x93")]);I&&I[e("0x71")]>2&&(u[e("0x44")]=I[2])}var g,v,R,S=(g=u[e("0x66")],v=u[e("0x74")],g===void 0&&(g=window[e("0x82")][e("0x6d")]),v===void 0&&(v=C.a[e("0x74")]),(R=g[e("0xd4")]("http")||g[e("0xd4")]("ws")?g:e("0xa6")+(g.includes(e("0x19"))?g[e("0x72")](g[e("0x18")](e("0x19"))+3):g))[e("0x32")](R[e("0x71")]-1)==="/"&&(R=R[e("0x72")](0,-1)),R+":"+v);return S=S[e("0xd9")](/^(http|ws)(s?):\/\//,e("0xc5")),delete u.host,delete u[e("0x74")],F(F({},u),{url:S})},o[e("0xef")][e("0x5d")]=function(){var x=this;p.b[e("0xb9")](e("0xe4")),this[e("0x35")]()[e("0x7f")](function(){x[e("0x59")][e("0xe7")]({type:c.AUTHENTICATE})})[e("0x22")](function(h){p.b[e("0x92")](e("0x4d")+h)})},o.enableDebugging=function(){p.b[e("0x9")](),o[e("0x8e")]()[e("0x59")]&&o.getInstance()[e("0x68")]()},o.disableDebugging=function(){p.b[e("0x43")](),o[e("0x8e")]()[e("0x59")]&&o[e("0x8e")]()[e("0x68")]()},o[e("0x70")]=function(){return p.b.getDebuggingState()},o[e("0xe2")]=function(){return p.b[e("0xe2")]()},o[e("0x94")]=function(x){p.b[e("0x94")](x),o[e("0x8e")]()[e("0x59")]&&o[e("0x8e")]()[e("0x68")]()},o.prototype[e("0xe3")]=function(x,h){D[e("0xcf")](x,h)},o[e("0xef")][e("0x7d")]=function(){var x=this,h={bridgeSendBooleanToNative:function(f,u){p.b.debug("[MAIN] Boolean, ["+f+": "+(u?"true":e("0x5b"))+"]"),x[e("0x59")][e("0xe7")]({type:c.BRIDGE_SEND_BOOLEAN_TO_NATIVE,payload:{value:u,signalName:f}})},bridgeSendIntegerToNative:function(f,u){p.b[e("0xb9")]("[MAIN] Numeric, ["+f+": "+u+"]"),x[e("0x59")].postMessage({type:c.BRIDGE_SEND_INTEGER_TO_NATIVE,payload:{value:u,signalName:f}})},bridgeSendStringToNative:function(f,u){p.b[e("0xb9")](e("0x46")+f+": "+u+"]"),e("0x58")!==f?x[e("0x59")].postMessage({type:c.BRIDGE_SEND_STRING_TO_NATIVE,payload:{value:u,signalName:f}}):function(I){try{var g=new URL(I);window[e("0x20")](g.toString(),e("0x7b"))}catch(v){p.b[e("0x92")](v)}}(u)},bridgeSendObjectToNative:function(f,u){p.b[e("0xb9")]("[MAIN] Object, ["+f+": "+u+"]"),x[e("0x59")][e("0xe7")]({type:c[e("0x3c")],payload:{value:u,signalName:f}})}};Object[e("0x8a")](window,{CommunicationInterface:h})},o[e("0xef")][e("0xa9")]=function(x){if(!window[e("0x98")])return D[e("0x86")](_.a[e("0xf3")]),void p.b[e("0x92")]("Worker is not supported in your browser");this[e("0x6")]=x[e("0x6")],this[e("0xa0")]=new T.a,this[e("0xee")](),this[e("0x68")](),this[e("0x49")](),this[e("0x1e")](x),this[e("0xd2")]()},o[e("0xef")][e("0x35")]=function(){return Ye(this,void 0,void 0,function(){var x;return Ke(this,function(h){switch(h[e("0x55")]){case 0:return this[e("0x76")]!==""?[3,2]:[4,Xe(this[e("0x6")])];case 1:if((x=h.sent())[e("0x9b")])throw D.dispatch(_.a[e("0xc8")],F({},x)),new Error(e("0x3d")+x[e("0x9b")]);return this[e("0x59")][e("0xe7")]({type:c[e("0x6e")],payload:{value:x}}),[3,3];case 2:this[e("0x59")][e("0xe7")]({type:c[e("0x6e")],payload:{value:this[e("0x76")]}}),h[e("0x55")]=3;case 3:return[2]}})})},o.prototype.setBasePathOnWorker=function(){var x,h;this[e("0x59")][e("0xe7")]({type:c.SET_BASE_PATH,payload:{value:(x=location[e("0x5f")].replace(/(.*)(\/(.*\.\w+)?)$/,"$1")+"/",h=""+location[e("0xe8")]+x,p.b[e("0xb9")](e("0x54")+h),h)}})},o[e("0xef")].connectToWebSocketServer=function(){var x=this;this[e("0x35")]()[e("0x7f")](function(){x[e("0x59")].postMessage({type:c[e("0x8c")]})})[e("0x22")](function(h){D.dispatch(_.a[e("0xec")],h),p.b[e("0x92")](e("0x4d")+h)})},o[e("0xef")][e("0x68")]=function(){var x={type:c[e("0xaf")],payload:{enabled:o[e("0x70")](),logLevel:o.getLogLevel()}};this[e("0x59")][e("0xe7")](x)},o[e("0xef")][e("0x1e")]=function(x){var h={type:c.INITIALIZE_WS,payload:F({},x)};this[e("0x59")][e("0xe7")](h)},o[e("0x7c")]=function(x){var h=x[e("0xc2")];o.processWorkerMessage(h)},o.processWorkerMessage=function(x){switch(x[e("0x53")]){case c[e("0x67")]:o.processWebSocketMessages(x);break;case c[e("0xad")]:o[e("0xc4")](x);break;case c[e("0x8b")]:D.dispatch(_.a.LICENSE_WS,x[e("0xb")]);break;case c[e("0x97")]:var h=x.payload;J(h[e("0x39")],h[e("0xd0")]);break;case c[e("0x5")]:var f=x[e("0xb")];W(f[e("0x39")],f[e("0xd0")]);break;case c.BRIDGE_RECEIVE_STRING_FROM_NATIVE:var u=x[e("0xb")];X(u.signalName,u[e("0xd0")]);break;case c[e("0xc7")]:var I=x.payload;(function(v,R){CrComLib[e("0xc9")](v,R)})(I.signalName,function(v){try{return JSON.parse(v)}catch(R){p.b[e("0x92")](R)}return null}(I[e("0xd0")]));break;case c.VALIDATION_EVENT:o[e("0x23")](x);break;case c[e("0xb4")]:var g=x[e("0xb")][e("0xdc")];o.handleInternalEvent(g);break;default:p.b[e("0x3e")](e("0xbb")+x[e("0x53")]+" from Worker thread with payload: "+JSON[e("0xbe")](x[e("0xb")]))}},o.handleInternalEvent=function(x){switch(x){case qe.AUTHENTICATION_FAILED:o.getInstance()[e("0xd1")](),p.b[e("0x96")](e("0xb8")+o[e("0x8e")]()[e("0xd")]/1e3+e("0x60")),setTimeout(function(){o[e("0x8e")]()[e("0xd2")]()},o.getInstance().reconnectTimeout);break;default:p.b[e("0x3e")](e("0xda")+x+"!")}},o[e("0xef")][e("0xd1")]=function(){this.reconnectTimeout=2*this[e("0xd")]>16e4?16e4:2*this[e("0xd")]},o[e("0x2b")]=function(x){var h=x[e("0xb")],f=h[e("0x47")],u=h[e("0xf1")];if(!_.a[f])throw new Error(e("0xf0"));switch(f){case _.a[e("0xa5")]:o[e("0x9e")][e("0x69")][e("0x1f")](!0);break;case _.a[e("0x91")]:o[e("0x9e")][e("0x69")].switchConnectionStatus(!1)}D[e("0x86")](f,u),o[e("0x9e")][e("0x69")].publish()},o[e("0xc4")]=function(x){switch(x.payload[e("0x47")]){case _.a.CCS_ONLINE:o[e("0x9e")][e("0x69")][e("0x1f")](!0);break;case _.a[e("0x77")]:case _.a[e("0x40")]:case _.a[e("0xe6")]:case _.a.CCS_LICENSE_DAYS:case _.a[e("0xb7")]:case _.a[e("0xa2")]:case _.a[e("0x38")]:case _.a[e("0xde")]:case _.a[e("0x1d")]:break;default:o.instance[e("0x69")][e("0x1f")](!1)}o[e("0x9e")][e("0x69")].publish()},o.processValidationEvents=function(x){var h=x.payload.eventName;h in _.a?D[e("0x86")](h):p.b[e("0x3e")](e("0xbb")+x[e("0x53")]+" from Worker thread with payload: "+JSON[e("0xbe")](x[e("0xb")]))},o[e("0x41")]=function(x){p.b[e("0x92")]("Error occurred in the worker:",x)},o[e("0x5a")]=function(x){p.b[e("0x92")](e("0x45"),x)},o[e("0xef")][e("0xee")]=function(){this[e("0x59")][e("0xe3")]("message",o[e("0x7c")][e("0xe5")](this)),this[e("0x59")][e("0xe3")]("error",o[e("0x41")].bind(this)),this[e("0x59")][e("0xe3")](e("0x10"),o[e("0x5a")].bind(this))},o[e("0xef")][e("0x65")]=function(){ne&&this[e("0x69")][e("0x8f")](W),ie&&this[e("0x69")].setDiagnosticBooleanSender(J),He&&this[e("0x69")][e("0x30")](X)},o}(),ze=M[e("0x9")],$e=M.disableDebugging,Qe=M[e("0x70")],Ze=M[e("0xe2")],et=M[e("0x94")],tt=M[e("0x8e")]()},function(r,s,a){function c(){if(window[e("0x29")][e("0x75")][e("0x24")]()[e("0x2c")]("crestron"))return!0;var y=typeof JSInterface<"u"&&e("0x27")==typeof JSInterface[e("0x37")]&&e("0x27")==typeof JSInterface[e("0xb3")]&&typeof JSInterface[e("0xa7")]=="function";return e("0x6a")!=typeof webkit&&webkit[e("0xd6")]!==void 0&&webkit[e("0xd6")].bridgeSendBooleanToNative!==void 0&&webkit[e("0xd6")].bridgeSendIntegerToNative!==void 0&&webkit.messageHandlers[e("0xa7")]!==void 0||y}a.r(s),a.d(s,e("0x1"),function(){return _}),a.d(s,"getWebXPanel",function(){return _}),a.d(s,e("0x2e"),function(){return c});var l=a(0),T=a(1);function E(){(function(){if(!(e("0x98")in window))throw new Error(e("0xd5"))})(),function(){if(!(e("0x3b")in window)||window[e("0x3b")][e("0xd7")]!==2)throw new Error(e("0x87"))}(),function(){if(e("0x3b")in window&&!(e("0xb1")in WebSocket[e("0xef")]))throw new Error(e("0x1a"))}()}var p=a(2);function _(y){var A,D;E();var C=function(){return new Date(1704434735538).toISOString()[e("0x32")](0,10)||"BUILD_DATE_NOT_SET"},b=function(){return e("0x5e")};if(y){l.b[e("0x3e")](e("0x81"));var B=C();console[e("0x3e")](e("0x42")+B),A=a(6),D=!0}else l.b[e("0x3e")](e("0xe0")),A=a(5),D=!1;var W=A.enableDebugging,J=A.disableDebugging,X=A[e("0x95")],ne=A[e("0xe2")],ie=A[e("0x94")];return{WebXPanel:A[e("0x7e")],WebXPanelConfigParams:p.a,WebXPanelEvents:T.a,LogLevel:l.a,enableDebugging:W,disableDebugging:J,getDebuggingState:X,getLogLevel:ne,setLogLevel:ie,isActive:D,getVersion:b,getBuildDate:C}}}])})})(Z,Z.exports);var Ae=Z.exports;const cn=()=>{const i=se(C=>{var b;return(b=C.workingProject)==null?void 0:b.attributes.webXpanel}),[t,n]=O.useState(i),e=O.useMemo(()=>Ae.getWebXPanel(!Ae.runsInContainerApp()),[]),{isActive:r,WebXPanel:s,WebXPanelEvents:a}=e,{xPanelStatus:c,manualStartConnect:l,updateXpanelStore:T}=Ie(),E=ae(C=>C.envState),p=se(C=>{var b;return(b=C.workingProject)==null?void 0:b.attributes.env}),_=se(C=>{var b;return(b=C.workingProject)==null?void 0:b.attributes.selectedEnv}),y=O.useMemo(()=>p==null?void 0:p.find(b=>b.envId===_),[p,_]);O.useEffect(()=>{let C=i;if(_){const b=(y==null?void 0:y.webXpanel)??{};C={...i,...b}}n(b=>ot(b,C)?C:b)},[i,p,_,y]),O.useEffect(()=>{const C=ae.getState().envState;let b=!1;(C==="build"||C==="live")&&(b=!0),T({xPanelStatus:"disconnected",lastErrorMessage:"",manualStartConnect:b}),console.info("XPanel config changed to: ",t)},[t,T]),O.useEffect(()=>{console.info("Current Environment: ",(y==null?void 0:y.envName)??"Default");const C=ae.getState().envState;(C==="editor"||C==="preview")&&T({xPanelStatus:"disconnected",lastErrorMessage:"",manualStartConnect:!1})},[y,T]),O.useEffect(()=>{console.info("xPanelStatus: ",c)},[c]),O.useEffect(()=>{E==="live"&&(r?document.title=`xPanel: ${c},env: ${(y==null?void 0:y.envName)??"Default"}`:document.title="xPanel no active")},[E,r,y,c]);const[A,D]=O.useState("");O.useEffect(()=>{if(!r){T({xPanelStatus:"disconnected",lastErrorMessage:"WebXPanel is not active",manualStartConnect:!1}),console.info("WebXPanel is not active");return}if(!t){T({xPanelStatus:"disconnected",lastErrorMessage:"No xPanel config provided",manualStartConnect:!1}),console.info("No xPanel config provided");return}if(l&&!A&&r){if(T({xPanelStatus:"connecting",lastErrorMessage:""}),!(t!=null&&t.host)){T({xPanelStatus:"disconnected",lastErrorMessage:"No webXpanel connnection host provided",manualStartConnect:!1}),console.info("No webXpanel connnection host provided"),oe.warning("No webXpanel connnection host provided");return}if(!(t!=null&&t.ipId)){T({xPanelStatus:"disconnected",lastErrorMessage:"No webXpanel connnection ipId provided",manualStartConnect:!1}),console.info("No webXpanel connnection ipId provided"),oe.warning("No webXpanel connnection ipId provided");return}console.info("Connection initialization...",t),s.initialize(t)}},[s,r,l,A,T,t]),O.useEffect(()=>{c!=="connecting"&&T({lastErrorMessage:""})},[T,c]),O.useEffect(()=>{s.addEventListener(a.CONNECT_CIP,({detail:C})=>{const{url:b,ipId:B,roomId:W}=C;console.info(`Connected to ${b}, 0x${B.toString(16)}, ${W}`),T({xPanelStatus:"connected",manualStartConnect:!1}),oe.success(`Connected to ${b}, 0x${B.toString(16)}, ${W}`)}),s.addEventListener(a.DISCONNECT_CIP,({detail:C})=>{const{reason:b}=C;Ie.getState().xPanelStatus!=="disconnected"&&(console.info(`Disconnected from CIP. Reason: ${b}`),T({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:`Disconnected from CIP. Reason: ${b}`}))}),s.addEventListener(a.ERROR_WS,()=>{T({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:"WebSocket CIP Error"}),console.warn("xPanel WebSocket Error")}),s.addEventListener(a.FETCH_TOKEN_FAILED,()=>{T({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:"WebSocket CIP FETCH_TOKEN_FAILED"}),console.info("FETCH_TOKEN_FAILED")}),s.addEventListener(a.NOT_AUTHORIZED,({detail:C})=>{const{redirectTo:b}=C;console.log(`Received a redirect to: ${b}`),console.info("Crestron auth needed"),D(b),T({manualStartConnect:!1})})},[s,a.CONNECT_CIP,a.DISCONNECT_CIP,a.ERROR_WS,a.FETCH_TOKEN_FAILED,a.NOT_AUTHORIZED,T]),O.useEffect(()=>{A&&rt({icon:nt.jsx(it,{}),title:"Auth on Crestron Proccessor",content:"In order to continue connecting to Crestron Proccessor you will be redirected to auth page.",okText:"Proceed",cancelText:"Cancel",onOk:()=>{window.location.href=A},onCancel:()=>{console.info("Auth process aborted."),D(""),T({xPanelStatus:"disconnected",manualStartConnect:!1})}})},[A,T])};export{cn as a,sn as b,an as u};
