import{j as e,r as I,a as L}from"./index-BWO8qd00.js";import{u as A,P as B,h as j,a as k}from"./pageAPI-B3I9BgVC.js";import{d as R}from"./deletePage-BqMP05t5.js";import{E as F}from"./EditableCell-CnqTEXkH.js";import{e as V,a as W,h as z,W as O,C as U,B as y}from"./editorApp-BQHhAWNR.js";import{I as T,u as Y,D as _,b as $}from"./useCustomFonts--hfI8X19.js";import{T as q}from"./tableFieldSearchInput-DW8T1Il9.js";import{a as C}from"./dayjs.min-DIl2m-M7.js";import{T as v}from"./index-DQFZSvcF.js";import{R as H}from"./DiffOutlined-4UMKY59v.js";import{T as K}from"./index-BPRdgIWZ.js";import"./localActiveAPI-Dv2O1BDy.js";import"./variablesAPI-D_uU0Jyf.js";import"./___vite-browser-external_commonjs-proxy-FhmH_qOu.js";import"./index-DI0YWsM8.js";const{Title:X}=K,G=[{title:e.jsx(q,{searchType:"subPageSearchString"}),dataIndex:"name",sorter:(o,a)=>{const n=o.name.props.initialValue.toLowerCase(),u=a.name.props.initialValue.toLowerCase();return n<u?-1:n>u?1:0},defaultSortOrder:"ascend"},{title:e.jsx(e.Fragment,{children:"Design paradigm"}),dataIndex:"layoutMode"},{title:"Updated",dataIndex:"updated",sorter:(o,a)=>{const n=C(o.updated),u=C(a.updated);return n.isBefore(u)?-1:n.isAfter(u)?1:0},render:o=>e.jsx(e.Fragment,{children:C(o).format("MMM D, YYYY, h:mm A")})},T.EXPAND_COLUMN,{title:"Where Used",dataIndex:"used"},{title:"Actions",dataIndex:"actions",width:100}],me=()=>{const o=V(),a=W(s=>s.workingProject),{projectId:n}=z(),u=Y(s=>s.subPageSearchString),{setNewPageModalVisible:P}=O(),[w,D]=I.useState(null);I.useEffect(()=>{var c,b,f,m;let s=((c=a==null?void 0:a.attributes.pages.data)==null?void 0:c.filter(l=>l.attributes.isSubpage))||[];const x=((b=a==null?void 0:a.attributes.pages.data)==null?void 0:b.filter(l=>!l.attributes.isSubpage))||[];function S(l){const t=[];return[...x||[]].forEach((i,p)=>{const g=i.attributes.containers;g==null||g.forEach((M,N)=>{M.elements.filter(h=>h.type==="subpage").some(h=>h.subpageId===l)&&t.push(e.jsx(y,{onClick:h=>j({pageId:i.id,navigate:o,evt:h}),type:"dashed",size:"small",children:i.attributes.name},i.id+"_source_"+p+N))})}),t}function d(l){var r,i;return!!((i=(r=s.find(p=>p.id===l))==null?void 0:r.attributes.containers)==null?void 0:i.some(p=>p.elements.some(g=>g.type==="subpage"||g.type==="subpageList")))}if(s){u&&(s=s.filter(t=>{const r=t.attributes.name;if(!r)return!1;const i=r.trim().toLowerCase(),p=u.trim().toLowerCase();return i.includes(p)}));const l=[];for(const t of s)l.push({pageID:t.id,key:`subpage_${t.id}`,name:e.jsx(F,{style:{whiteSpace:"nowrap"},onChange:r=>r&&n&&A({pageId:t.id,inputData:{name:r}}),initialValue:t.attributes.name,value:t.attributes.name,validators:[r=>U({input:r,searchArray:s||[],searchKey:["attributes","name"]}).catch(i=>(L.error(i.message),Promise.reject()))]}),layoutMode:e.jsx(v,{icon:e.jsx(B,{style:{height:"auto",minWidth:"1em",margin:"0 3px -1px 0"},isStatic:(f=t.attributes)==null?void 0:f.isStatic}),children:(m=t.attributes)!=null&&m.isStatic?"adaptive":"responsive"}),updated:t.attributes.updatedAt,used:e.jsx("div",{style:{display:"flex",gap:5,flexWrap:"wrap"},children:S(t.id)}),nestedSubs:d(t.id),actions:e.jsxs(_.Button,{onClick:r=>j({pageId:t.id,navigate:o,evt:r}),menu:{items:[{key:"clonePage",icon:e.jsx(H,{}),label:"Clone SubPage",onClick:()=>n&&k({pageCloneData:t})},{key:"remove",danger:!0,icon:e.jsx($,{}),label:"Delete SubPage",onClick:()=>n&&R({pageId:t.id,projectId:n,isSubpage:t.attributes.isSubpage,name:t.attributes.name})}]},children:[e.jsx("svg",{style:{marginRight:3,marginBottom:-2},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M6 2c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-1.9l10-10V8l-6-6zm7 1.5L18.5 9H13zm7.1 9.5c-.1 0-.3.1-.4.2l-1 1l2.1 2.1l1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-2 1.8L12 20.9V23h2.1l6.1-6.1z"})}),"Open in Editor"]})});D(l)}},[o,n,u,a]);function E(s){const x=a==null?void 0:a.attributes.pages.data.find(d=>d.id===s);if(!x)return null;const S=[];for(const d of x.attributes.containers||[])for(const c of d.elements)(c.type==="subpage"||c.type==="subpageList")&&S.push(c.subpageId);return e.jsx("div",{style:{display:"flex",gap:5,marginTop:10,flexWrap:"wrap"},children:S.map(d=>{var f;const c=(f=a==null?void 0:a.attributes.pages.data.find(m=>m.id===d))==null?void 0:f.attributes.name,b=!c;return e.jsx(y,{onClick:m=>!b&&j({pageId:d,navigate:o,evt:m}),type:"dashed",size:"small",danger:b,children:c||"Deleted"},d)})})}return e.jsxs(e.Fragment,{children:[e.jsx(X,{id:"SubPages",style:{margin:"15px 0"},level:5,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["SubPages",e.jsx(y,{onClick:()=>P("subpage"),children:"Create New SubPage"})]})}),w?e.jsxs(e.Fragment,{children:[e.jsx(T,{expandable:{expandedRowRender:s=>e.jsxs(e.Fragment,{children:[e.jsx(v,{color:"geekblue",children:"1st level nested subpages"}),E(s.pageID)]}),rowExpandable:s=>s.nestedSubs},showSorterTooltip:!1,columns:G,dataSource:w,pagination:!1}),e.jsx(y,{style:{marginTop:15},type:"primary",onClick:()=>P("subpage"),children:"Create New SubPage"})]}):null]})};export{me as default};
