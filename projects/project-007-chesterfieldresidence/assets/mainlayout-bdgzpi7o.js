const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./undoRedo-Cf6cXTP0.js","./index-BWO8qd00.js","./index-CtV2aIBv.css","./editorApp-BQHhAWNR.js","./editorApp-BmhU-YmB.css","./useCustomFonts--hfI8X19.js","./index-BPRdgIWZ.js","./SettingOutlined-BfK-OcKA.js","./pageAPI-B3I9BgVC.js","./localActiveAPI-Dv2O1BDy.js","./variablesAPI-D_uU0Jyf.js","./___vite-browser-external_commonjs-proxy-FhmH_qOu.js","./useWindowAvgatorStudioComposer-LuIThOM1.js","./datasourceTools-CeSl9gC_.js","./useGetElDimensionsStyles-DKp_YFdD.js","./useWebXpanel-BbDsMuZo.js","./index-PlVE70kS.js","./newVariableModal-DGKfnKTN.js","./renderActionTag-DNrT7Mjk.js","./index-DQFZSvcF.js","./index-DI0YWsM8.js","./index-xMIPA-_5.js","./newVariableModal-DbDSgdQa.css","./Styles-BTfwVjr1.js","./datasourceAPI-BARHsYAW.js","./formItemPropsWrapper-BtUXjune.js","./modificatorAPI-CAH1u60t.js","./moment-G82_0lEo.js","./newProjectModal-CuQBeoeS.js","./moveable.esm-CxaKG_HY.js"])))=>i.map(i=>d[i]);
import{r as f,L as le,h as W,j as e,ac as me,R as pe,b as be,af as fn,ad as Je,aj as vt,al as mn,ak as Gt,a as he,g as hn,q as se,ae as gn,am as st}from"./index-BWO8qd00.js";import{i as xt,j as Ht,k as pn,a as V,D as ee,h as ae,e as bt,T as Oe,B as T,l as ut,u as re,m as jt,n as Wt,F as j,I as J,b as $t,o as Ut,p as Kt,q as dt,r as vn,M as ue,t as xn,v as Jt,w as ft,x as bn,y as jn,z as yn,A as wn,C as Ze,E as mt,G as ke,H as Zt,J as Xt,K as Yt,L as wt,O as Ct,f as Cn,P as Sn,g as _n,Q as kn}from"./editorApp-BQHhAWNR.js";import{D as Qt,R as En,u as ie,b as In,c as Me,C as Ne,S as De,d as en,e as tn,f as An,g as nn,r as Tn}from"./useCustomFonts--hfI8X19.js";import{R as ot,a as Fn}from"./SettingOutlined-BfK-OcKA.js";import{M as Ln,R as Pn}from"./index-BPRdgIWZ.js";import{P as ht,c as Rn}from"./pageAPI-B3I9BgVC.js";import{u as St,R as Mn,a as On}from"./useWindowAvgatorStudioComposer-LuIThOM1.js";import{a as Nn,u as Dn,b as Bn}from"./useWebXpanel-BbDsMuZo.js";import{P as fe}from"./index-PlVE70kS.js";import{h as Vn,u as Xe,D as _t,S as zn,a as an,b as qn,N as Gn}from"./newVariableModal-DGKfnKTN.js";import{S as ge}from"./index-xMIPA-_5.js";import{T as yt}from"./index-DQFZSvcF.js";import{I as gt,S as Hn}from"./index-DI0YWsM8.js";import{R as Wn,u as $n}from"./useGetElDimensionsStyles-DKp_YFdD.js";import{A as Un,a as Kn,b as Jn}from"./Styles-BTfwVjr1.js";import{c as Zn,a as Xn}from"./localActiveAPI-Dv2O1BDy.js";import{u as Yn,g as pt,c as Qn}from"./datasourceAPI-BARHsYAW.js";import{d as ye,C as Be,k as ea,F as ta}from"./formItemPropsWrapper-BtUXjune.js";import{a as na,b as aa,f as ra,c as kt,d as sa,e as Et,g as It}from"./datasourceTools-CeSl9gC_.js";import{u as rn,c as oa}from"./modificatorAPI-CAH1u60t.js";import{R as Re}from"./renderActionTag-DNrT7Mjk.js";import{h as ia}from"./moment-G82_0lEo.js";import{u as la}from"./variablesAPI-D_uU0Jyf.js";var ca={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},ua=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:ca}))},da=f.forwardRef(ua),fa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917.7 148.8l-42.4-42.4c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-76.1 76.1a199.27 199.27 0 00-112.1-34.3c-51.2 0-102.4 19.5-141.5 58.6L432.3 308.7a8.03 8.03 0 000 11.3L704 591.7c1.6 1.6 3.6 2.3 5.7 2.3 2 0 4.1-.8 5.7-2.3l101.9-101.9c68.9-69 77-175.7 24.3-253.5l76.1-76.1c3.1-3.2 3.1-8.3 0-11.4zM769.1 441.7l-59.4 59.4-186.8-186.8 59.4-59.4c24.9-24.9 58.1-38.7 93.4-38.7 35.3 0 68.4 13.7 93.4 38.7 24.9 24.9 38.7 58.1 38.7 93.4 0 35.3-13.8 68.4-38.7 93.4zm-190.2 105a8.03 8.03 0 00-11.3 0L501 613.3 410.7 523l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3L441 408.6a8.03 8.03 0 00-11.3 0L363 475.3l-43-43a7.85 7.85 0 00-5.7-2.3c-2 0-4.1.8-5.7 2.3L206.8 534.2c-68.9 69-77 175.7-24.3 253.5l-76.1 76.1a8.03 8.03 0 000 11.3l42.4 42.4c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3l76.1-76.1c33.7 22.9 72.9 34.3 112.1 34.3 51.2 0 102.4-19.5 141.5-58.6l101.9-101.9c3.1-3.1 3.1-8.2 0-11.3l-43-43 66.7-66.7c3.1-3.1 3.1-8.2 0-11.3l-36.6-36.2zM441.7 769.1a131.32 131.32 0 01-93.4 38.7c-35.3 0-68.4-13.7-93.4-38.7a131.32 131.32 0 01-38.7-93.4c0-35.3 13.7-68.4 38.7-93.4l59.4-59.4 186.8 186.8-59.4 59.4z"}}]},name:"api",theme:"outlined"},ma=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:fa}))},ha=f.forwardRef(ma),ga={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},pa=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:ga}))},Ee=f.forwardRef(pa),va={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M956 686.5l-.1-.1-.1-.1C911.7 593 843.4 545 752.5 545s-159.2 48.1-203.4 141.3v.1a42.92 42.92 0 000 36.4C593.3 816 661.6 864 752.5 864s159.2-48.1 203.4-141.3c5.4-11.5 5.4-24.8.1-36.2zM752.5 800c-62.1 0-107.4-30-141.1-95.5C645 639 690.4 609 752.5 609c62.1 0 107.4 30 141.1 95.5C860 770 814.6 800 752.5 800z"}},{tag:"path",attrs:{d:"M697 705a56 56 0 10112 0 56 56 0 10-112 0zM136 232h704v253h72V192c0-17.7-14.3-32-32-32H96c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h352v-72H136V232z"}},{tag:"path",attrs:{d:"M724.9 338.1l-36.8-36.8a8.03 8.03 0 00-11.3 0L493 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L251.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.2-3.1 3.2-8.2 0-11.3z"}}]},name:"fund-view",theme:"outlined"},xa=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:va}))},ba=f.forwardRef(xa),ja={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},ya=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:ja}))},wa=f.forwardRef(ya),Ca={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 732h-70.3c-4.8 0-9.3 2.1-12.3 5.8-7 8.5-14.5 16.7-22.4 24.5a353.84 353.84 0 01-112.7 75.9A352.8 352.8 0 01512.4 866c-47.9 0-94.3-9.4-137.9-27.8a353.84 353.84 0 01-112.7-75.9 353.28 353.28 0 01-76-112.5C167.3 606.2 158 559.9 158 512s9.4-94.2 27.8-137.8c17.8-42.1 43.4-80 76-112.5s70.5-58.1 112.7-75.9c43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 7.9 7.9 15.3 16.1 22.4 24.5 3 3.7 7.6 5.8 12.3 5.8H868c6.3 0 10.2-7 6.7-12.3C798 160.5 663.8 81.6 511.3 82 271.7 82.6 79.6 277.1 82 516.4 84.4 751.9 276.2 942 512.4 942c152.1 0 285.7-78.8 362.3-197.7 3.4-5.3-.4-12.3-6.7-12.3zm88.9-226.3L815 393.7c-5.3-4.2-13-.4-13 6.3v76H488c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h314v76c0 6.7 7.8 10.5 13 6.3l141.9-112a8 8 0 000-12.6z"}}]},name:"logout",theme:"outlined"},Sa=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:Ca}))},_a=f.forwardRef(Sa),ka={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M692.8 412.7l.2-.2-34.6-44.3a7.97 7.97 0 00-11.2-1.4l-50.4 39.3-70.5-90.1a7.97 7.97 0 00-11.2-1.4l-37.9 29.7a7.97 7.97 0 00-1.4 11.2l70.5 90.2-.2.1 34.6 44.3c2.7 3.5 7.7 4.1 11.2 1.4l50.4-39.3 64.1 82c2.7 3.5 7.7 4.1 11.2 1.4l37.9-29.6c3.5-2.7 4.1-7.7 1.4-11.2l-64.1-82.1zM608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5L114.3 856.1a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6C473 696.1 537.7 720 608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644s-118.2-23.7-161.2-66.8C403.7 534.2 380 476.9 380 416s23.7-118.2 66.8-161.2c43-43.1 100.3-66.8 161.2-66.8s118.2 23.7 161.2 66.8c43.1 43 66.8 100.3 66.8 161.2s-23.7 118.2-66.8 161.2z"}}]},name:"monitor",theme:"outlined"},Ea=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:ka}))},it=f.forwardRef(Ea),Ia={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 612c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H298a95.92 95.92 0 00-89-60c-53 0-96 43-96 96s43 96 96 96c40.3 0 74.8-24.8 89-60h150.3v152c0 55.2 44.8 100 100 100H952c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H548.3c-15.5 0-28-12.5-28-28V612H952zM456 344h264v98.2c0 8.1 9.5 12.8 15.8 7.7l172.5-136.2c5-3.9 5-11.4 0-15.3L735.8 162.1c-6.4-5.1-15.8-.5-15.8 7.7V268H456c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8z"}}]},name:"node-expand",theme:"outlined"},Aa=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:Ia}))},Ta=f.forwardRef(Aa),Fa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},La=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:Fa}))},Pa=f.forwardRef(La),Ra={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z"}}]},name:"retweet",theme:"outlined"},Ma=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:Ra}))},Oa=f.forwardRef(Ma),Na={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},Da=function(n,a){return f.createElement(le,W(W({},n),{},{ref:a,icon:Na}))},Ba=f.forwardRef(Da);const Va=async()=>await xt.get("/api/themes?sort=createdAt:asc&populate=deep,3",{headers:Ht()}).then(t=>{var n;return(n=t==null?void 0:t.data)!=null&&n.data?t.data.data:null}).catch(t=>{console.log("Get news error occurred:",t)}),sn=pn(t=>({themesList:[],fetchAndFillThemesList:async()=>{const n=await Va();t({themesList:n||[]})}}));var za="renderAppTopBar_topBarContainer__1ey9s4v0",qa="renderAppTopBar_tabsRow__1ey9s4v1",Ga="renderAppTopBar_pagesTabsArea__1ey9s4v2",Ha="renderAppTopBar_pagesTabsAreaInner__1ey9s4v3",Wa="renderAppTopBar_pagesTabsHolder__1ey9s4v4",$a="renderAppTopBar_envButtonArea__1ey9s4v5",At="renderAppTopBar_tabsAntComponent__1ey9s4v6",Tt="renderAppTopBar_tabContent__1ey9s4v7",Ft="renderAppTopBar_tabIcon__1ey9s4v8",Lt="renderAppTopBar_tabLabel__1ey9s4v9",Ua="renderAppTopBar_tabSubIndicator__1ey9s4va",Pt={saved:"renderAppTopBar_saveIndicator_saved__1ey9s4vc renderAppTopBar_tabUnsaved__1ey9s4vb",unsaved:"renderAppTopBar_saveIndicator_unsaved__1ey9s4vd renderAppTopBar_tabUnsaved__1ey9s4vb"},Rt="renderAppTopBar_tabClose__1ey9s4ve",Ka="renderAppTopBar_envSelectorButton__1ey9s4vf",Ja="renderAppTopBar_topBarControlsRow__1ey9s4vh",Za="renderAppTopBar_viewLayoutContentBox__1ey9s4vi",lt="renderAppTopBar_viewLayoutContentRow__1ey9s4vj",Xa="renderAppTopBar_testDeviceRadioItem__1ey9s4vl";const Ya=({setEditProjectModalId:t,projectId:n})=>{const a=V(v=>{var m;return(m=v.workingProject)==null?void 0:m.attributes.env}),i=V(v=>{var m;return(m=v.workingProject)==null?void 0:m.attributes.selectedEnv}),x=f.useMemo(()=>{var v;return i?((v=a==null?void 0:a.find(m=>m.envId===i))==null?void 0:v.envName)??"Default":"Default"},[a,i]),o=({envUidToSelect:v})=>{const m=V.getState().updateProjectWithHistory;m({selectedEnv:v},!1)},p=f.useMemo(()=>a!=null&&a.length?a.map(m=>({key:m.envId,label:e.jsx("div",{onClick:()=>o({envUidToSelect:m.envId}),children:m.envName}),icon:e.jsx(ot,{})})):[],[a]),g=[{key:"default",label:e.jsx("div",{onClick:()=>o({envUidToSelect:""}),children:"Default"}),icon:e.jsx(ot,{})},...p??[],{key:"env divider",label:e.jsx(ee,{style:{margin:0}})},{key:"env settings",label:e.jsx("div",{onClick:()=>t(Number(n)),children:"Project ENV settings"}),icon:e.jsx(Fn,{})}];return e.jsx(Qt,{className:"GlobalEnvSelector",dropdownRender:()=>e.jsx(Ln,{items:g,style:{whiteSpace:"nowrap"}}),trigger:["click"],children:e.jsxs("div",{className:Ka,children:[e.jsxs("span",{children:[e.jsx(ot,{style:{marginRight:5}}),x]}),e.jsx(En,{})]})})},We="mainProjectTab",Qa=()=>{const{pageId:t}=ae(),{projectId:n}=ae(),a=bt(),i=V(u=>u.tabs),x=V(u=>u.pagesHashes),o=V(u=>{var M;return(M=u.workingProject)==null?void 0:M.attributes.pages.data})??[],p=V(u=>u.currentProjectHash),g=V(u=>u.savedProjectHash),v=p===g,{removeTab:m}=V.getState();function w(u){async function M(){a(`/projects/${n}`)}t===u&&M().then(()=>{m(u)}),m(u)}const y=u=>{a(u===We?`/projects/${n}`:`/projects/${n}/page/${u}`)},S=[];for(const u of i){const M=o.find(B=>String(B.id)===u.pageId);if(!M)return console.log("targetPage is not found"),null;const R=x.find(B=>String(B.pageId)===String(u.pageId)),{name:q,isSubpage:G,isStatic:te}=M.attributes,$=R?R.currentHash!==R.savedHash:!1;S.push({label:e.jsxs("div",{className:Tt,children:[e.jsx("div",{className:Ft,children:e.jsx(ht,{style:{height:"auto",width:"1em"},isStatic:te})}),e.jsx("div",{className:Ua,children:G?"sub":null}),e.jsx("div",{className:Pt[$?"unsaved":"saved"]}),e.jsx("div",{className:Lt,children:q}),e.jsx("div",{onClick:B=>{B.stopPropagation(),w(u.pageId)},className:Rt,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.3em",height:"1.3em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m7 7l10 10M7 17L17 7"})})})]}),key:u.pageId})}const _={label:e.jsxs("div",{className:Tt,children:[e.jsx("div",{className:Ft,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 15 15",children:e.jsx("path",{fill:"currentColor",d:"M1.5 0A1.5 1.5 0 0 0 0 1.5v4A1.5 1.5 0 0 0 1.5 7h4A1.5 1.5 0 0 0 7 5.5v-4A1.5 1.5 0 0 0 5.5 0zm8 0A1.5 1.5 0 0 0 8 1.5v4A1.5 1.5 0 0 0 9.5 7h4A1.5 1.5 0 0 0 15 5.5v-4A1.5 1.5 0 0 0 13.5 0zm-8 8A1.5 1.5 0 0 0 0 9.5v4A1.5 1.5 0 0 0 1.5 15h4A1.5 1.5 0 0 0 7 13.5v-4A1.5 1.5 0 0 0 5.5 8zm8 0A1.5 1.5 0 0 0 8 9.5v4A1.5 1.5 0 0 0 9.5 15h4a1.5 1.5 0 0 0 1.5-1.5v-4A1.5 1.5 0 0 0 13.5 8z"})})}),e.jsx("div",{className:Pt[v?"saved":"unsaved"]}),e.jsx("div",{className:Lt,children:"Project"}),e.jsx("div",{onClick:u=>{u.stopPropagation(),a("/projects/")},className:Rt,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.3em",height:"1.3em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m7 7l10 10M7 17L17 7"})})})]}),key:We};return e.jsxs("div",{className:Ha,children:[e.jsx(Oe,{className:At,activeKey:t??We,onChange:y,items:[_]}),e.jsx("div",{className:Wa,children:e.jsx(Oe,{className:At,popupClassName:"pagesTabsPopup",activeKey:t??We,onChange:y,items:S})})]})},er=()=>{Nn();const{xPanelStatus:t="disconnected",lastErrorMessage:n}=St(),a=St.getState().updateXpanelStore;function i(){a({manualStartConnect:!0})}function x(){return t==="disconnected"?n?e.jsx(me,{style:{color:"red"}}):e.jsx(wa,{}):e.jsx(ha,{})}const o=e.jsx(T,{icon:x(),loading:t==="connecting",onClick:()=>i(),children:t.charAt(0).toUpperCase()+t.slice(1)});return n?e.jsx(fe,{placement:"bottomLeft",title:"Last connect message",content:n,trigger:"hover",children:o}):o},tr=pe.memo(()=>{const t=ie.getState().setMainMenuData,n=ie(o=>o.isConsoleOpen),a=ie(o=>o.consoleLogs),i=(a==null?void 0:a.length)??0,x=i>100?"100+":i;return e.jsx("div",{"data-counter":x,className:x?"customBadge":"",children:e.jsx(ut,{title:"Show/Hide Console",children:e.jsx(T,{onFocus:o=>o.target.blur(),type:n?"primary":"default",onClick:()=>{t({isConsoleOpen:!n})},icon:e.jsx(ba,{})})})})}),nr=pe.memo(()=>{const t=()=>{var g,v;const{displayGuidePos:n,showGuides:a,lockGuides:i}=re(m=>m.guidesOptions),x=re.getState().updateEnvGuidesOptions,o=V(m=>{var w;return(w=m.workingProject)==null?void 0:w.attributes.guides}),p=!!((g=o==null?void 0:o.horizontal)!=null&&g.length)||!!((v=o==null?void 0:o.vertical)!=null&&v.length);return e.jsxs("div",{className:Za,children:[e.jsxs("div",{className:lt,children:[e.jsx(ge,{size:"small",checked:a,onChange:()=>{x({showGuides:!a})}}),"Show Guides"]}),e.jsxs("div",{className:lt,children:[e.jsx(ge,{disabled:!a,size:"small",checked:n,onChange:()=>{x({displayGuidePos:!n})}}),"Display Guides Positions"]}),e.jsxs("div",{className:lt,children:[e.jsx(ge,{size:"small",checked:i,onChange:()=>{x({lockGuides:!i})}}),"Lock Guides"]}),e.jsx(ee,{style:{margin:"5px 0"}}),e.jsx(T,{disabled:!p,icon:e.jsx(In,{}),onClick:()=>{Vn()},children:"Delete all Guides"})]})};return e.jsx(fe,{placement:"bottomLeft",content:e.jsx(t,{}),trigger:"hover",children:e.jsx(T,{onFocus:n=>n.target.blur(),onClick:()=>{},icon:e.jsx("svg",{style:{translate:"-0.3em 0.1em"},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 14 14",children:e.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",d:"M12.5.5h-11a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-11a1 1 0 0 0-1-1m-12 3h13m-9 0v10m9-5h-9"})}),children:"View"})})}),ar=({projectName:t,isProfilePage:n})=>{const{projectId:a}=ae(),i=jt(o=>{var p;return(p=o.user)==null?void 0:p.email});let x="My Projects";return a?x=t||e.jsx(be,{}):n&&(x=e.jsxs(e.Fragment,{children:[e.jsx(Wt,{}),i]})),e.jsx(e.Fragment,{children:x})},Mt=({deviceItem:t,editable:n=!1})=>{const{name:a,width:i,height:x,uid:o}=t,p=g=>{g.stopPropagation(),g.preventDefault();const v=Xe.getState().removeUserTestDevice;v(o)};return e.jsx(Me,{value:o,children:e.jsxs("div",{className:Xa,children:[a,e.jsxs(yt,{style:{fontSize:11,padding:2,lineHeight:"1em"},children:[i," x ",x]}),n&&e.jsx(fn,{style:{color:"red"},className:"close",onClick:p})]})})};var Ot="testDeviceButton_dimensionsPopTitle__88rnak0",Nt="testDeviceButton_dimensionsPopTitleSmall__88rnak1",rr="testDeviceButton_dimensionsDeviceListScroll__88rnak2",sr="testDeviceButton_addUserDeviceForm__88rnak3";const or=()=>{const t=re.getInitialState().updateEnvStore,n=re(y=>y.selectedTestDevice),{userDefinedTestDevices:a,predefinedTestDevices:i}=Xe(y=>y),x=y=>{let S=y.target.value;S=S==="none"?null:S;const _=[...a,...i].find(u=>u.uid===S);if(_){const{fitEditor:u}=re.getState();t({selectedTestDevice:_}),u()}else throw new Error("Test device not found")},o=f.useMemo(()=>a.map(y=>e.jsx(Mt,{editable:!0,deviceItem:y},y.uid)),[a]),p=f.useMemo(()=>i.map(y=>e.jsx(Mt,{editable:!1,deviceItem:y},y.uid)),[i]),[g]=j.useForm(),[v,m]=pe.useState(!1),w=y=>{m(!0);const S=Xe.getState().createUserTestDevice;S(y).then(()=>{g.resetFields(),m(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(Me.Group,{onChange:x,value:n==null?void 0:n.uid,children:e.jsx(Ne,{style:{width:400},direction:"vertical",children:e.jsxs("div",{className:rr,children:[e.jsxs(_t,{initialOpen:!0,summary:"My devices",children:[...o]}),e.jsxs(_t,{initialOpen:!0,summary:"Predefined devices",children:[...p]})]})})}),e.jsx(ee,{style:{margin:"10px 0"}}),e.jsx(j,{form:g,onFinish:w,onFinishFailed:()=>m(!1),className:sr,layout:"vertical",children:e.jsxs(Ne,{children:[e.jsx(j.Item,{required:!1,name:"name",rules:[{required:!0,message:"Required"}],label:"Name",children:e.jsx(J,{style:{width:100},placeholder:"Name"})}),e.jsx(j.Item,{required:!1,name:"width",rules:[{required:!0,message:"Required"}],label:"Width",children:e.jsx(gt,{min:0,style:{width:100},placeholder:"Width"})}),e.jsx(j.Item,{required:!1,name:"height",rules:[{required:!0,message:"Required"}],label:"Height",children:e.jsx(gt,{min:0,style:{width:100},placeholder:"Height"})}),e.jsx(j.Item,{label:" ",children:e.jsx(T,{loading:v,htmlType:"submit",block:!0,icon:e.jsx(Wn,{}),children:"Add device"})})]})})]})},ir=()=>{const t=ie(o=>o.isSubpageEditor),n=re(o=>o.selectedTestDevice),a=re(o=>o.isTestDeviceRotated),i=()=>{const o=re.getState().updateEnvStore;o({isTestDeviceRotated:!a})},x=t?e.jsxs("div",{className:Ot,children:["Subpage editor - no test devices available here",e.jsxs("small",{className:Nt,children:[e.jsx(Je,{})," Subpage is a reusable component - it has own size and there is no sense to test it on different devices in fullscreen mode."]})]}):e.jsxs("div",{className:Ot,children:["Test device selector",e.jsxs("small",{className:Nt,children:[e.jsx(Je,{})," It's not a project setting, just preview option to see how page looks on different devices."]})]});return e.jsxs(Ne.Compact,{block:!0,children:[e.jsx(fe,{placement:"bottomLeft",title:x,content:t?null:e.jsx(or,{}),trigger:t?"hover":"click",children:e.jsx(T,{disabled:t,onFocus:o=>o.target.blur(),icon:e.jsx("svg",{style:{translate:"-0.3em 0.1em"},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 32 32",children:e.jsx("path",{fill:"currentColor",d:"M13 3H7.5A4.5 4.5 0 0 0 3 7.5V9a1 1 0 0 0 2 0V7.5A2.5 2.5 0 0 1 7.5 5H13a1 1 0 1 0 0-2m2.5 26a4.5 4.5 0 0 0 4.5-4.5v-8a4.5 4.5 0 0 0-4.5-4.5h-8A4.5 4.5 0 0 0 3 16.5v8A4.5 4.5 0 0 0 7.5 29zm6.5-1a1 1 0 0 1 1-1h1.5a2.5 2.5 0 0 0 2.5-2.5V19a1 1 0 1 1 2 0v5.5a4.5 4.5 0 0 1-4.5 4.5H23a1 1 0 0 1-1-1m7-15V7.5A4.5 4.5 0 0 0 24.5 3H19a1 1 0 1 0 0 2h5.5A2.5 2.5 0 0 1 27 7.5V13a1 1 0 1 0 2 0"})}),children:n==null?void 0:n.name})}),e.jsx(T,{disabled:t,onFocus:o=>o.target.blur(),onClick:i,type:a?"primary":"default",icon:e.jsx("svg",{style:{translate:"0 2px"},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M16.26 1.874a.75.75 0 0 1 .866-.613c3.2.544 5.624 3.36 5.624 6.74a.75.75 0 0 1-1.17.62l-1.5-1.014a.75.75 0 1 1 .84-1.242l.1.067c-.577-1.91-2.18-3.358-4.146-3.693a.75.75 0 0 1-.613-.865M8.319 3.316c-.579.442-1.257 1.118-2.232 2.092l-.678.679c-.974.974-1.65 1.652-2.092 2.232c-.429.561-.566.941-.566 1.307s.137.746.566 1.308c.442.579 1.118 1.257 2.092 2.232l5.427 5.426c.974.974 1.652 1.65 2.231 2.092c.563.43.942.566 1.308.566s.746-.137 1.308-.566c.579-.442 1.257-1.118 2.232-2.092l.678-.678c.974-.975 1.65-1.653 2.092-2.232c.429-.562.566-.942.566-1.308s-.137-.745-.566-1.307c-.442-.58-1.118-1.258-2.092-2.232l-5.427-5.427c-.974-.974-1.652-1.65-2.231-2.092c-.562-.429-.942-.566-1.308-.566s-.746.137-1.308.566m-.91-1.193c.696-.53 1.392-.873 2.218-.873s1.522.343 2.217.873c.67.51 1.418 1.26 2.345 2.186l5.503 5.504c.927.926 1.676 1.675 2.186 2.344c.53.695.873 1.391.873 2.217s-.343 1.522-.873 2.218c-.51.668-1.26 1.417-2.186 2.344l-.755.755c-.927.927-1.676 1.676-2.344 2.186c-.696.53-1.392.873-2.218.873s-1.522-.343-2.217-.873c-.67-.51-1.418-1.26-2.344-2.186L4.31 14.188c-.927-.927-1.676-1.676-2.186-2.344c-.53-.696-.873-1.392-.873-2.218s.343-1.522.873-2.217c.51-.67 1.26-1.418 2.186-2.344l.755-.756c.927-.926 1.676-1.675 2.345-2.186m2.07 2.903a.75.75 0 0 1 0 1.06L6.086 9.479a.75.75 0 1 1-1.06-1.06l3.391-3.392a.75.75 0 0 1 1.06 0m6.74 10.218a.689.689 0 1 0-.974.974a.689.689 0 0 0 .974-.974m-2.035-1.06a2.189 2.189 0 1 1 3.096 3.095a2.189 2.189 0 0 1-3.096-3.096M1.648 15.337a.75.75 0 0 1 .772.04l1.5 1.015a.75.75 0 0 1-.84 1.242l-.1-.067c.577 1.91 2.18 3.358 4.146 3.693a.75.75 0 0 1-.252 1.479c-3.2-.545-5.624-3.361-5.624-6.74a.75.75 0 0 1 .398-.662",clipRule:"evenodd"})})})]})},lr=pe.memo(({subPageHeight:t,subPageWidth:n})=>{const a=re(m=>m.editorZoom),i=Number.parseFloat((a*100).toFixed(0)),x=({value:m})=>{const w=Number(m)||1,{updateEditorZoom:y}=re.getState();y(w/100)},{resetEditorZoom:o,centerViewer:p,fitEditor:g}=re.getState(),v=()=>{n&&t?g(n,t):g()};return e.jsxs(Ne,{style:{minWidth:250},direction:"vertical",size:"small",children:[e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("div",{style:{flexGrow:1},children:e.jsx(zn,{min:1,max:100,value:i,onChange:m=>{x({value:m})}})}),e.jsx(J,{addonAfter:"%",style:{width:87},value:i,onChange:m=>{x({value:m.target.value})}})]}),e.jsxs(Ne.Compact,{block:!0,children:[e.jsx(T,{style:{flexGrow:1},onClick:v,children:"Fit"}),e.jsx(T,{style:{flexGrow:1},onClick:p,children:"Center"}),e.jsx(T,{style:{flexGrow:1},onClick:o,children:"Reset"})]})]})}),cr=()=>{const{pageId:t}=ae(),n=(re(p=>p.editorZoom)*100).toFixed(0),a=an({pageId:t}),i=ie(p=>p.isSubpageEditor),{width:x,height:o}=$n({width:a==null?void 0:a.attributes.width,height:a==null?void 0:a.attributes.height});return e.jsx(e.Fragment,{children:e.jsx(fe,{placement:"bottomLeft",title:"Zoom controls",content:e.jsx(lr,{subPageHeight:i?o:void 0,subPageWidth:i?x:void 0}),trigger:"click",children:e.jsxs(T,{onFocus:p=>p.target.blur(),icon:e.jsxs("svg",{style:{translate:"-0.3em 0.1em",scale:"1.2"},width:"1em",height:"1em",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("g",{clipPath:"url(#clip0_224_4)",children:[e.jsx("path",{d:"M9.7 9.7L11 11M10.35 7.425C10.35 7.04088 10.2743 6.66053 10.1273 6.30565C9.98035 5.95077 9.7649 5.62832 9.49329 5.35671C9.22168 5.0851 8.89923 4.86965 8.54435 4.72265C8.18947 4.57566 7.80912 4.5 7.425 4.5C7.04088 4.5 6.66053 4.57566 6.30565 4.72265C5.95077 4.86965 5.62832 5.0851 5.35671 5.35671C5.0851 5.62832 4.86965 5.95077 4.72265 6.30565C4.57566 6.66053 4.5 7.04088 4.5 7.425C4.5 8.20076 4.80817 8.94474 5.35671 9.49329C5.90526 10.0418 6.64924 10.35 7.425 10.35C8.20076 10.35 8.94474 10.0418 9.49329 9.49329C10.0418 8.94474 10.35 8.20076 10.35 7.425Z",stroke:"black",strokeWidth:"0.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9.5375 9.5375L11 11M1 3C1.065 2.3325 1.213 1.883 1.548 1.548C1.883 1.213 2.3325 1.0655 3 1M3 11C2.3325 10.935 1.883 10.787 1.548 10.452C1.213 10.117 1.0655 9.6675 1 9M11 3C10.935 2.3325 10.787 1.883 10.452 1.548C10.117 1.213 9.6675 1.0655 9 1M1 5V7M7 1H5M10.35 7.425C10.35 6.64924 10.0418 5.90526 9.49329 5.35671C8.94474 4.80817 8.20076 4.5 7.425 4.5C6.64924 4.5 5.90526 4.80817 5.35671 5.35671C4.80817 5.90526 4.5 6.64924 4.5 7.425C4.5 8.20076 4.80817 8.94474 5.35671 9.49329C5.90526 10.0418 6.64924 10.35 7.425 10.35C8.20076 10.35 8.94474 10.0418 9.49329 9.49329C10.0418 8.94474 10.35 8.20076 10.35 7.425Z",stroke:"black",strokeWidth:"0.75",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_224_4",children:e.jsx("rect",{width:"12",height:"12",fill:"white"})})})]}),children:[n,"%"]})})})},ur=pe.lazy(()=>vt(()=>import("./undoRedo-Cf6cXTP0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]),import.meta.url)),dr=pe.lazy(()=>vt(()=>import("./newProjectModal-CuQBeoeS.js"),__vite__mapDeps([28,1,2,3,4,27,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url)),fr=({setEditProjectModalId:t})=>{const n=bt(),{projectId:a}=ae(),{pageId:i}=ae(),o=$t().pathname.includes("profile"),p=V(y=>y.workingProject),g=ie(y=>y.showBoundingBox),{setMainMenuData:v}=ie.getState(),[m,w]=f.useState(!1);return e.jsxs("div",{className:za,onContextMenu:y=>y.preventDefault(),children:[a&&p?e.jsxs("div",{className:qa,children:[e.jsx("div",{className:Ga,children:e.jsx(Qa,{})}),e.jsx("div",{className:$a,children:e.jsx(Ya,{projectId:a,setEditProjectModalId:t})})]}):null,e.jsxs("div",{className:Ja,style:g?{}:{backgroundColor:"rgb(66, 32, 201)",color:"#fff"},children:[e.jsxs("section",{className:"left",style:{fontSize:14},children:[e.jsx("img",{onClick:()=>n("/projects"),style:{width:"auto",height:23,cursor:"pointer"},src:mn,alt:"avgator studio"}),e.jsx(ar,{isProfilePage:o,projectName:p==null?void 0:p.attributes.name})]}),e.jsx("section",{className:"center",children:i?e.jsxs(e.Fragment,{children:[e.jsx(nr,{}),e.jsx(ir,{}),e.jsx(cr,{}),e.jsxs(Me.Group,{style:{whiteSpace:"nowrap"},value:g,onChange:y=>v({showBoundingBox:y.target.value}),buttonStyle:"solid",children:[e.jsxs(Me.Button,{value:!0,children:[e.jsx(Pn,{})," Editor"]}),e.jsxs(Me.Button,{style:g?{}:{backgroundColor:"red",color:"#fff",borderColor:"red"},className:"previewButton",value:!1,children:[e.jsx(Ut,{})," Preview"]})]}),e.jsx(er,{}),e.jsx(tr,{})]}):null}),e.jsxs("section",{className:"right",style:{display:"flex",gap:5},children:[!a&&!o?e.jsx(T,{icon:e.jsx(Kt,{}),onClick:()=>w(!0),type:"primary",children:"New Project"}):null,!a&&!o&&e.jsx(Qt,{menu:{items:[{key:"Profile",label:e.jsx("div",{onClick:()=>n("/profile"),children:"Profile"})},{key:"Logout",label:e.jsx("div",{onClick:()=>dt(),children:"Change Account"})}]},placement:"bottomRight",arrow:!0,children:e.jsx(T,{icon:e.jsx(Wt,{})})}),o&&e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:e.jsx(da,{}),onClick:()=>n("/projects"),children:"Back to projects"}),e.jsx(T,{onClick:()=>dt(),icon:e.jsx(_a,{}),children:"Logout"})]}),a&&e.jsx(f.Suspense,{fallback:null,children:e.jsx(ur,{})})]}),e.jsx("div",{style:{position:"absolute"},children:m?e.jsx(f.Suspense,{fallback:e.jsx(Gt,{}),children:e.jsx(dr,{setOpenNewProjectModal:w})}):null})]})]})};function mr(t){const n=/\/projects\/(\d+)/;return!!t.match(n)}const hr=()=>{const t=jt(v=>v.jwt),n=V(v=>v.currentProjectHash),a=V(v=>v.savedProjectHash),i=V.getState().resetWorkingProject,{projectId:x}=ae(),o=!!t&&!!x&&n!==a,p=vn(({nextLocation:v})=>{const m=mr(v.pathname);return!!(o&&!m)});return f.useEffect(()=>{const v=m=>{o&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",v),()=>{window.removeEventListener("beforeunload",v)}},[p.state,o]),{ConfirmModal:()=>{function v(){p!=null&&p.reset&&p.reset()}function m(){i().then(()=>{var _;(_=p==null?void 0:p.proceed)==null||_.call(p)})}function w(){S(!0);const _=V.getState().workingProject;_?xn({projectData:_}).then(()=>{he.success("Project saved successfully"),p!=null&&p.proceed&&p.proceed(),i()}).catch(u=>{console.error(u),he.error("Error while saving project")}):(he.error("Error while saving project: not found"),S(!1))}const[y,S]=f.useState(!1);return p.state==="blocked"?e.jsx(ue,{maskClosable:!1,title:e.jsxs("div",{style:{color:"rgb(255 113 77)"},children:[e.jsx(me,{})," Unsaved changes"]}),open:!0,onCancel:()=>{v()},footer:[e.jsx(T,{onClick:()=>v(),children:"Stay here"},"back"),e.jsx(T,{loading:y,type:"primary",onClick:()=>w(),children:"Save and exit"},"saveAndExit"),e.jsx(T,{type:"primary",danger:!0,onClick:()=>m(),children:"Leave without saving"},"submit")],children:e.jsx("div",{children:"Are you really want to leave editor? All unsaved changes will be lost."})}):null}}},gr=({cloneItemModal:t,setCloneItemModal:n,onFinish:a})=>{const[i]=j.useForm(),x=()=>{i.submit()};return e.jsx(ue,{destroyOnClose:!0,afterClose:()=>i.resetFields(),maskClosable:!1,title:`Cloning ${t.nodeType}`,open:!!t,onOk:x,onCancel:()=>n(null),footer:[e.jsx(T,{onClick:()=>n(null),children:"Cancel"},"back"),e.jsxs(T,{type:"primary",onClick:x,children:["Clone ",t.nodeType]},"submit")],children:e.jsx(j,{labelCol:{xs:{span:6}},wrapperCol:{xs:{span:16}},form:i,onFinish:o=>a(o),initialValues:{copiesCount:1},scrollToFirstError:!0,children:e.jsx(j.Item,{colon:!1,required:!1,name:"copiesCount",label:"How many copies",rules:[{required:!0,message:"This field is required."}],children:e.jsx(gt,{min:1,max:10})})})})},pr=()=>{const[t,n]=f.useState(null),{pageId:a}=ae(),i=({copiesCount:o})=>{const{containerIndex:p,elementIndex:g,nodeType:v,isGlobal:m}=t||{};p!==void 0&&(v==="container"?Zn({action:"clone",containerIndex:p,copiesCount:o,pageId:a}).then(()=>n(null)):g!==void 0&&Xn({containerIndex:p,elementIndex:g,copiesCount:o,isGlobal:m,pageId:a,action:"clone"}).then(()=>n(null)))};return{CloneModal:t?e.jsx(gr,{onFinish:i,setCloneItemModal:n,cloneItemModal:t}):null,setCloneItemModal:n}},Dt={sourceContainerIndex:null,sourceContainerType:null,destinationContainerIndex:null,destinationContainerType:null,sourceElementIndex:null,destinationElementIndex:null,destinationElementCorner:null,destinationContainerFlow:null},$e=Jt((t,n)=>({selectedElementRef:null,staticEementsGuidesClasses:[],activeStaticElementKey:null,dragData:Dt,updateDragStore:a=>{const i=n().dragData,x={...i,...a};ft.isEqual(i,x)||t(()=>({dragData:x}))},resetDragStore:()=>{t(()=>({dragData:Dt}))},setSelectedElementRef:a=>{t(()=>({selectedElementRef:a}))},setActiveStaticElementKey:a=>{t(()=>({activeStaticElementKey:a}))},setStaticEementsGuidesClasses:a=>{t(i=>{const x=i.staticEementsGuidesClasses;return x.includes(a)?i:{staticEementsGuidesClasses:[...x,a]}})}}),ft.isEqual);var on={},ln={},cn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){for(var x=arguments.length,o=new Array(x),p=0;p<x;p++)o[p]=arguments[p];if(typeof window<"u"){var g;typeof window.gtag>"u"&&(window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)}),(g=window).gtag.apply(g,o)}},a=n;t.default=a})(cn);var un={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=p;var n=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;function a(g){return g.toString().trim().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(v,m,w){return m>0&&m+v.length!==w.length&&v.search(n)>-1&&w.charAt(m-2)!==":"&&(w.charAt(m+v.length)!=="-"||w.charAt(m-1)==="-")&&w.charAt(m-1).search(/[^\s-]/)<0?v.toLowerCase():v.substr(1).search(/[A-Z]|\../)>-1?v:v.charAt(0).toUpperCase()+v.substr(1)})}function i(g){return typeof g=="string"&&g.indexOf("@")!==-1}var x="REDACTED (Potential Email Address)";function o(g){return i(g)?(console.warn("This arg looks like an email address, redacting."),x):g}function p(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,w=g||"";return v&&(w=a(g)),m&&(w=o(w)),w}})(un);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.GA4=void 0;var n=g(cn),a=g(un),i=["eventCategory","eventAction","eventLabel","eventValue","hitType"],x=["title","location"],o=["page","hitType"],p=["action","category","label","value","nonInteraction","transport"];function g(d){return d&&d.__esModule?d:{default:d}}function v(d,s){if(d==null)return{};var r=m(d,s),l,h;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(d);for(h=0;h<c.length;h++)l=c[h],!(s.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(d,l)&&(r[l]=d[l])}return r}function m(d,s){if(d==null)return{};var r={},l=Object.keys(d),h,c;for(c=0;c<l.length;c++)h=l[c],!(s.indexOf(h)>=0)&&(r[h]=d[h]);return r}function w(d){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?w=function(r){return typeof r}:w=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},w(d)}function y(d){return u(d)||_(d)||te(d)||S()}function S(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _(d){if(typeof Symbol<"u"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}function u(d){if(Array.isArray(d))return $(d)}function M(d,s){var r=Object.keys(d);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(d);s&&(l=l.filter(function(h){return Object.getOwnPropertyDescriptor(d,h).enumerable})),r.push.apply(r,l)}return r}function R(d){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?M(Object(r),!0).forEach(function(l){F(d,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach(function(l){Object.defineProperty(d,l,Object.getOwnPropertyDescriptor(r,l))})}return d}function q(d,s){return ne(d)||B(d,s)||te(d,s)||G()}function G(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function te(d,s){if(d){if(typeof d=="string")return $(d,s);var r=Object.prototype.toString.call(d).slice(8,-1);if(r==="Object"&&d.constructor&&(r=d.constructor.name),r==="Map"||r==="Set")return Array.from(d);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $(d,s)}}function $(d,s){(s==null||s>d.length)&&(s=d.length);for(var r=0,l=new Array(s);r<s;r++)l[r]=d[r];return l}function B(d,s){var r=d==null?null:typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(r!=null){var l=[],h=!0,c=!1,b,k;try{for(r=r.call(d);!(h=(b=r.next()).done)&&(l.push(b.value),!(s&&l.length===s));h=!0);}catch(E){c=!0,k=E}finally{try{!h&&r.return!=null&&r.return()}finally{if(c)throw k}}return l}}function ne(d){if(Array.isArray(d))return d}function K(d,s){if(!(d instanceof s))throw new TypeError("Cannot call a class as a function")}function X(d,s){for(var r=0;r<s.length;r++){var l=s[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,l.key,l)}}function D(d,s,r){return s&&X(d.prototype,s),d}function F(d,s,r){return s in d?Object.defineProperty(d,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):d[s]=r,d}var z=function(){function d(){var s=this;K(this,d),F(this,"reset",function(){s.isInitialized=!1,s._testMode=!1,s._currentMeasurementId,s._hasLoadedGA=!1,s._isQueuing=!1,s._queueGtag=[]}),F(this,"_gtag",function(){for(var r=arguments.length,l=new Array(r),h=0;h<r;h++)l[h]=arguments[h];s._testMode||s._isQueuing?s._queueGtag.push(l):n.default.apply(void 0,l)}),F(this,"_loadGA",function(r,l){if(!(typeof window>"u"||typeof document>"u")&&!s._hasLoadedGA){var h=document.createElement("script");h.async=!0,h.src="https://www.googletagmanager.com/gtag/js?id=".concat(r),l&&h.setAttribute("nonce",l),document.body.appendChild(h),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},s._hasLoadedGA=!0}}),F(this,"_toGtagOptions",function(r){if(r){var l={cookieUpdate:"cookie_update",cookieExpires:"cookie_expires",cookieDomain:"cookie_domain",cookieFlags:"cookie_flags",userId:"user_id",clientId:"client_id",anonymizeIp:"anonymize_ip",contentGroup1:"content_group1",contentGroup2:"content_group2",contentGroup3:"content_group3",contentGroup4:"content_group4",contentGroup5:"content_group5",allowAdFeatures:"allow_google_signals",allowAdPersonalizationSignals:"allow_ad_personalization_signals",nonInteraction:"non_interaction",page:"page_path",hitCallback:"event_callback"},h=Object.entries(r).reduce(function(c,b){var k=q(b,2),E=k[0],O=k[1];return l[E]?c[l[E]]=O:c[E]=O,c},{});return h}}),F(this,"initialize",function(r){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!r)throw new Error("Require GA_MEASUREMENT_ID");var h=typeof r=="string"?[{trackingId:r}]:r;s._currentMeasurementId=h[0].trackingId;var c=l.gaOptions,b=l.gtagOptions,k=l.legacyDimensionMetric,E=k===void 0?!0:k,O=l.nonce,L=l.testMode,P=L===void 0?!1:L;if(s._testMode=P,P||s._loadGA(s._currentMeasurementId,O),s.isInitialized||(s._gtag("js",new Date),h.forEach(function(ce){var we=s._appendCustomMap(R(R(R({send_page_view:!1},s._toGtagOptions(R(R({},c),ce.gaOptions))),b),ce.gtagOptions),E);s._gtag("config",ce.trackingId,we)})),s.isInitialized=!0,!P){var I=y(s._queueGtag);for(s._queueGtag=[],s._isQueuing=!1;I.length;){var H=I.shift();s._gtag.apply(s,y(H)),H[0]==="get"&&(s._isQueuing=!0)}}}),F(this,"set",function(r){if(!r){console.warn("`fieldsObject` is required in .set()");return}if(w(r)!=="object"){console.warn("Expected `fieldsObject` arg to be an Object");return}Object.keys(r).length===0&&console.warn("empty `fieldsObject` given to .set()"),s._gaCommand("set",r)}),F(this,"_gaCommandSendEvent",function(r,l,h,c,b){s._gtag("event",l,R(R({event_category:r,event_label:h,value:c},b&&{non_interaction:b.nonInteraction}),s._toGtagOptions(b)))}),F(this,"_gaCommandSendEventParameters",function(){for(var r=arguments.length,l=new Array(r),h=0;h<r;h++)l[h]=arguments[h];if(typeof l[0]=="string")s._gaCommandSendEvent.apply(s,y(l.slice(1)));else{var c=l[0],b=c.eventCategory,k=c.eventAction,E=c.eventLabel,O=c.eventValue;c.hitType;var L=v(c,i);s._gaCommandSendEvent(b,k,E,O,L)}}),F(this,"_gaCommandSendTiming",function(r,l,h,c){s._gtag("event","timing_complete",{name:l,value:h,event_category:r,event_label:c})}),F(this,"_gaCommandSendPageview",function(r,l){if(l&&Object.keys(l).length){var h=s._toGtagOptions(l),c=h.title,b=h.location,k=v(h,x);s._gtag("event","page_view",R(R(R(R({},r&&{page_path:r}),c&&{page_title:c}),b&&{page_location:b}),k))}else r?s._gtag("event","page_view",{page_path:r}):s._gtag("event","page_view")}),F(this,"_gaCommandSendPageviewParameters",function(){for(var r=arguments.length,l=new Array(r),h=0;h<r;h++)l[h]=arguments[h];if(typeof l[0]=="string")s._gaCommandSendPageview.apply(s,y(l.slice(1)));else{var c=l[0],b=c.page;c.hitType;var k=v(c,o);s._gaCommandSendPageview(b,k)}}),F(this,"_gaCommandSend",function(){for(var r=arguments.length,l=new Array(r),h=0;h<r;h++)l[h]=arguments[h];var c=typeof l[0]=="string"?l[0]:l[0].hitType;switch(c){case"event":s._gaCommandSendEventParameters.apply(s,l);break;case"pageview":s._gaCommandSendPageviewParameters.apply(s,l);break;case"timing":s._gaCommandSendTiming.apply(s,y(l.slice(1)));break;case"screenview":case"transaction":case"item":case"social":case"exception":console.warn("Unsupported send command: ".concat(c));break;default:console.warn("Send command doesn't exist: ".concat(c))}}),F(this,"_gaCommandSet",function(){for(var r=arguments.length,l=new Array(r),h=0;h<r;h++)l[h]=arguments[h];typeof l[0]=="string"&&(l[0]=F({},l[0],l[1])),s._gtag("set",s._toGtagOptions(l[0]))}),F(this,"_gaCommand",function(r){for(var l=arguments.length,h=new Array(l>1?l-1:0),c=1;c<l;c++)h[c-1]=arguments[c];switch(r){case"send":s._gaCommandSend.apply(s,h);break;case"set":s._gaCommandSet.apply(s,h);break;default:console.warn("Command doesn't exist: ".concat(r))}}),F(this,"ga",function(){for(var r=arguments.length,l=new Array(r),h=0;h<r;h++)l[h]=arguments[h];if(typeof l[0]=="string")s._gaCommand.apply(s,l);else{var c=l[0];s._gtag("get",s._currentMeasurementId,"client_id",function(b){s._isQueuing=!1;var k=s._queueGtag;for(c({get:function(L){return L==="clientId"?b:L==="trackingId"?s._currentMeasurementId:L==="apiVersion"?"1":void 0}});k.length;){var E=k.shift();s._gtag.apply(s,y(E))}}),s._isQueuing=!0}return s.ga}),F(this,"event",function(r,l){if(typeof r=="string")s._gtag("event",r,s._toGtagOptions(l));else{var h=r.action,c=r.category,b=r.label,k=r.value,E=r.nonInteraction,O=r.transport,L=v(r,p);if(!c||!h){console.warn("args.category AND args.action are required in event()");return}var P={hitType:"event",eventCategory:(0,a.default)(c),eventAction:(0,a.default)(h)};b&&(P.eventLabel=(0,a.default)(b)),typeof k<"u"&&(typeof k!="number"?console.warn("Expected `args.value` arg to be a Number."):P.eventValue=k),typeof E<"u"&&(typeof E!="boolean"?console.warn("`args.nonInteraction` must be a boolean."):P.nonInteraction=E),typeof O<"u"&&(typeof O!="string"?console.warn("`args.transport` must be a string."):(["beacon","xhr","image"].indexOf(O)===-1&&console.warn("`args.transport` must be either one of these values: `beacon`, `xhr` or `image`"),P.transport=O)),Object.keys(L).filter(function(I){return I.substr(0,9)==="dimension"}).forEach(function(I){P[I]=L[I]}),Object.keys(L).filter(function(I){return I.substr(0,6)==="metric"}).forEach(function(I){P[I]=L[I]}),s._gaCommand("send",P)}}),F(this,"send",function(r){s._gaCommand("send",r)}),F(this,"pageview",function(r,l,h){var c=r==null?void 0:r.trim();if(c===""){console.warn("path cannot be an empty string in .pageview()");return}s._gaCommand("send","pageview",c,{title:h})}),this.reset()}return D(d,[{key:"gtag",value:function(){this._gtag.apply(this,arguments)}},{key:"_appendCustomMap",value:function(r){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!l)return r;r.custom_map||(r.custom_map={});for(var h=1;h<=200;h++)r.custom_map["dimension".concat(h)]||(r.custom_map["dimension".concat(h)]="dimension".concat(h)),r.custom_map["metric".concat(h)]||(r.custom_map["metric".concat(h)]="metric".concat(h));return r}},{key:"outboundLink",value:function(r,l){var h=r.label;if(typeof l!="function"){console.warn("hitCallback function is required");return}if(!h){console.warn("args.label is required in outboundLink()");return}var c={hitType:"event",eventCategory:"Outbound",eventAction:"Click",eventLabel:(0,a.default)(h)},b=!1,k=function(){b=!0,l()},E=setTimeout(k,250),O=function(){clearTimeout(E),b||l()};c.hitCallback=O,this._gaCommand("send",c)}}]),d}();t.GA4=z;var Y=new z;t.default=Y})(ln);(function(t){function n(g){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(m){return typeof m}:n=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},n(g)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ReactGAImplementation=void 0;var a=x(ln);function i(g){if(typeof WeakMap!="function")return null;var v=new WeakMap,m=new WeakMap;return(i=function(y){return y?m:v})(g)}function x(g,v){if(g&&g.__esModule)return g;if(g===null||n(g)!=="object"&&typeof g!="function")return{default:g};var m=i(v);if(m&&m.has(g))return m.get(g);var w={},y=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var S in g)if(S!=="default"&&Object.prototype.hasOwnProperty.call(g,S)){var _=y?Object.getOwnPropertyDescriptor(g,S):null;_&&(_.get||_.set)?Object.defineProperty(w,S,_):w[S]=g[S]}return w.default=g,m&&m.set(g,w),w}var o=a.GA4;t.ReactGAImplementation=o;var p=a.default;t.default=p})(on);const Bt=hn(on),vr=Jt()(bn(t=>({versions:[],fetchVersions:async()=>await xt.get("/api/versions?sort=version:desc",{headers:Ht()}).then(n=>{var a;return(a=n==null?void 0:n.data)!=null&&a.data?(t({versions:n.data.data}),n.data.data):null}).catch(n=>{console.log("Error fetching versions:",n.response),he.error("Error fetching versions")})}),{name:"versionStore",storage:{getItem:jn,setItem:yn,removeItem:wn}}),ft.isEqual),{Panel:xr}=Be,br=se(ue)`
  height: calc(100vh - 4%) !important;
  width: 100% !important;

  .ant-modal-content {
    height: 100%;
    position: relative;
    display: flex;
    flex-flow: column;

    .dsForm {
      height: 100%;
      flex: 1;
      position: relative;
      display: flex;
      flex-flow: column;
    }

    .ant-modal-body {
      flex: 1;
      position: relative;
      padding: 0;
      display: flex;
      flex-flow: column;
    }

    .ant-collapse-header {
      font-weight: normal !important;
      user-select: none;
      text-transform: uppercase;
      font-size: 12px;
    }

    .ant-form-item-label {
      flex-basis: 160px;
    }
  }
`,Ue=se.div`
  position: relative;
  height: 100%;
  padding-top: 17px;
  /* overflow: hidden; */
  min-height: 200px;

  .monaco-editor {
    position: absolute !important;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
  }
`,jr=se(Oe)`
  position: relative;
  flex: 1;

  .ant-tabs-content {
    position: relative;
    height: 100%;
  }

  .ant-tabs-tabpane {
    height: 100%;
    background-color: #1e1e1e;
  }

  .ant-tabs-nav {
    margin: 0;
  }

  .ant-tabs-tab {
    border: 0 !important;

    &.ant-tabs-tab-active {
      background-color: #1e1e1e;

      .ant-tabs-tab-btn {
        color: #fff;
        user-select: none;
      }
    }
  }
`,Vt=se.div`
  color: #fff;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
`,yr=se.div`
  position: relative;
  display: flex;
  color: #fff;
  height: 100%;

  .functionBox {
    min-width: 300px;
    position: relative;
    height: 100%;
    display: flex;
    flex-flow: column;

    .functionBoxControls {
      padding: 17px;
      padding-right: 0;
      padding-bottom: 0;
      font-size: 12px;
      display: flex;
      gap: 5px;
      justify-content: space-between;
    }
  }

  .resultBox {
    flex: 1;
  }
`,wr=({setNewDatasourceVisible:t,newDatasourceVisible:n})=>{var de,oe,Ce,Se,_e,ze,Ae,qe,Ge;const a=typeof n=="number"?n:null,i=(de=V.getState().workingProject)==null?void 0:de.attributes.datasources.data.find(C=>C.id===a),x=(oe=V.getState().workingProject)==null?void 0:oe.attributes.modificators.data,[o]=j.useForm(),{projectId:p}=ae(),g=f.useMemo(()=>{var N;let C=((N=V.getState().workingProject)==null?void 0:N.attributes.datasources.data)??[];return i&&(C=C.filter(U=>U.id!==i.id)),C.map(U=>U.attributes.name)},[i]),v=f.useMemo(()=>{var N;const C=(N=V.getState().workingProject)==null?void 0:N.attributes.modificators.data;return(C==null?void 0:C.map(U=>({value:U.id,label:U.attributes.name})))??[]},[]),{headerKey:m,headerValue:w,hostname:y}=na()??{},[S,_]=f.useState("local"),[u,M]=f.useState(null),[R,q]=f.useState(null),G=j.useWatch("sourceLink",o),te=j.useWatch("useBaseUrl",o),$=j.useWatch("headerKey",o),B=j.useWatch("headerValue",o),ne=$!==null,K=B!==null,X=j.useWatch("sourceObject",o),D=j.useWatch("modificatorId",o),F=!!G||!!te,[z,Y]=f.useState(!1),[d,s]=f.useState(!1),[r,l]=f.useState("local"),h=aa({data:{useBaseUrl:te,sourceLink:G,headerKey:$,headerValue:B}}),c=f.useMemo(()=>F&&!X?"remote":F&&X?"mixed":"local",[F,X]),b=f.useMemo(()=>D?x==null?void 0:x.find(C=>C.id===D):null,[D,x]),k=f.useCallback(()=>{b&&(o.setFieldValue("modificatorFunctionString",b.attributes.function),s(!1))},[o,b]);f.useEffect(()=>{k()},[k]);const[E,O]=f.useState(!1),[L,P]=f.useState([]),[I,H]=f.useState([]),ce=C=>{P(C)},we=C=>{H(C)},Ie=({formKey:C,value:Q})=>{const N=o.getFieldValue(C);function U(){o.setFieldsValue({[C]:Q?"":null})}!Q&&N?nn({icon:e.jsx(me,{}),title:"Are you sure?",content:"Disabling this option will clear the value of the field. Are you sure you want to proceed?",okButtonProps:{danger:!0},okText:"Proceed",cancelText:"Cancel",onOk:()=>{U()},onCancel:()=>{}}):U()},Ye=async C=>{if(!p)return;const{name:Q,sourceLink:N,useBaseUrl:U,headerKey:je,headerValue:Te,modificatorId:at,sourceObject:rt,modificatorFunctionString:Fe,isImagePreloadSource:Le}=C;console.log("formData",C);let Pe={name:Q||"New datasouce",production:{sourceLink:N,useBaseUrl:U,headerKey:je,headerValue:Te,modificatorId:at||null,sourceObject:rt,storageType:c,isImagePreloadSource:Le},uid:Zt()};if(O(!0),d&&(b!=null&&b.id)&&await rn({function:Fe},b.id).catch(()=>{he.error("Failed to update function"),O(!1)}),i){const{uid:He,...dn}=Pe;Yn({...dn},i.id).then(()=>t(!1)).then(()=>pt()).finally(()=>O(!1))}else Qn(p,Pe).then(()=>t(!1)).then(()=>pt()).finally(()=>O(!1))},Ve=f.useCallback(()=>L.length>0?e.jsx(fe,{trigger:"hover",title:"invalid JSON",content:"JSON data contains errors",children:e.jsx(me,{style:{fontSize:14,margin:"0 0 0 5px",color:"red",cursor:"help"}})}):null,[L.length]);function Qe(){const C=new Date,Q=C.getFullYear(),N=String(C.getMonth()+1).padStart(2,"0"),U=String(C.getDate()).padStart(2,"0"),je=String(C.getHours()).padStart(2,"0"),Te=String(C.getMinutes()).padStart(2,"0");return`${Q}-${N}-${U}_${je}-${Te}`}const et=Qe(),tt=i?{name:i.attributes.name,sourceLink:((Ce=i.attributes.production)==null?void 0:Ce.sourceLink)??"",useBaseUrl:((Se=i.attributes.production)==null?void 0:Se.useBaseUrl)??!1,headerKey:((_e=i.attributes.production)==null?void 0:_e.headerKey)??null,headerValue:((ze=i.attributes.production)==null?void 0:ze.headerValue)??null,modificatorId:((Ae=i.attributes.production)==null?void 0:Ae.modificatorId)??0,sourceObject:((qe=i.attributes.production)==null?void 0:qe.sourceObject)??"",modificatorFunctionString:"",isImagePreloadSource:((Ge=i.attributes.production)==null?void 0:Ge.isImagePreloadSource)??!1}:{name:"New datasource "+et,sourceLink:"",useBaseUrl:!1,headerKey:null,headerValue:null,modificatorId:0,sourceObject:"",modificatorFunctionString:"",isImagePreloadSource:!1},ve=f.useCallback(async({beforeFetch:C,successFetch:Q,errorFetch:N,finallyFetch:U,applyFunction:je})=>{C();const{sourceLink:Te,headerKey:at,headerValue:rt}=h;try{await ra(Te,at,rt).then(Fe=>{let Le="";if(je){const Pe=o.getFieldValue("modificatorFunctionString");if(Pe)try{const He=kt([Fe],null,void 0,Pe);console.log("dataAfterFunctionApply",He),Le=JSON.stringify(He,null,2)}catch{}}else Le=JSON.stringify(Fe,null,2);Q(Le)})}catch{he.error("Failed to fetch data"),N()}finally{U==null||U()}},[h,o]);f.useEffect(()=>{S==="remote"&&!F&&_("local"),S==="modified"&&!D&&_("local"),q(null)},[S,F,D]);const nt=f.useMemo(()=>{const C=()=>{q("loading");try{const N=o.getFieldValue("modificatorFunctionString"),U=JSON.parse(X),je=kt([U],null,void 0,N);q(JSON.stringify(je,null,2))}catch(N){console.log(N),q(null)}},Q=()=>{if(r==="local")return X?e.jsx(T,{style:{textTransform:"capitalize"},icon:e.jsx(it,{}),loading:R==="loading",onClick:()=>{C()},ghost:!0,children:"Calculate Local Modified Data"}):e.jsx("p",{children:"Your local source is empty"});if(r==="remote")return F?e.jsx(T,{style:{textTransform:"capitalize"},icon:e.jsx(it,{}),loading:R==="loading",onClick:()=>ve({applyFunction:!0,beforeFetch:()=>{q("loading")},successFetch:N=>{q(N)},errorFetch:()=>{q(null)}}),ghost:!0,children:"Calculate Remote Modified Data"}):e.jsx("p",{children:"Remote URL is not presented in ENV or datasource settings"})};return[{label:e.jsxs(e.Fragment,{children:["Set Local Source ",Ve()]}),key:"local",children:e.jsx(Ue,{hasErrors:!!L.length,children:e.jsx(j.Item,{noStyle:!0,name:"sourceObject",validateStatus:L.length?"error":void 0,rules:[()=>({validator(N,U){return L.length?Promise.reject():Promise.resolve()}})],normalize:N=>N===void 0?"":N,children:e.jsx(ye,{className:"monaco-editor",language:"json",loading:e.jsx(be,{}),options:{readOnly:!1,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"json",onValidate:ce})})})},{label:"Test Remote Source",disabled:!F,key:"remote",children:u===null||u==="loading"?e.jsx(Vt,{children:e.jsx(T,{icon:e.jsx(it,{}),loading:u==="loading",onClick:()=>ve({beforeFetch:()=>{M("loading")},successFetch:N=>{M(N)},errorFetch:()=>{M(null)}}),ghost:!0,children:"Retreive Remote Data"})}):e.jsx(Ue,{hasErrors:!!L.length,children:e.jsx(ye,{className:"monaco-editor",language:"json",loading:e.jsx(be,{}),options:{readOnly:!0,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"json",value:u})})},{label:e.jsxs(e.Fragment,{children:["Test Function",!!I.length&&e.jsx(fe,{trigger:"hover",title:"invalid Function",content:"Function contains errors",children:e.jsx(me,{style:{fontSize:14,margin:"0 0 0 5px",color:"red",cursor:"help"}})})]}),disabled:!D,key:"modified",children:e.jsxs(yr,{children:[e.jsx("div",{className:"functionBox",children:e.jsx("div",{style:{flex:1},children:e.jsx(Ue,{hasErrors:!1,children:e.jsx(j.Item,{name:"modificatorFunctionString",validateStatus:I.length?"error":void 0,rules:[()=>({validator(N,U){return I.length?Promise.reject():Promise.resolve()}})],normalize:N=>N===void 0?"":N,noStyle:!0,children:e.jsx(ye,{className:"monaco-editor",language:"json",loading:e.jsx(be,{}),options:{readOnly:!1,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",lineNumbers:"off",wordWrap:"on",glyphMargin:!1,folding:!0,lineDecorationsWidth:0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"javascript",onValidate:we})})})})}),e.jsx("div",{className:"resultBox",children:R===null||R==="loading"?e.jsx(Vt,{children:e.jsx(Q,{})}):e.jsx(Ue,{hasErrors:!!L.length,children:e.jsx(ye,{className:"monaco-editor",language:"json",loading:e.jsx(be,{}),options:{readOnly:!0,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"json",value:R})})})]})}]},[L.length,Ve,o,I.length,ve,F,D,R,r,X,u]),A=f.useMemo(()=>{switch(S){case"local":return e.jsxs(e.Fragment,{children:[e.jsx(T,{size:"small",disabled:!F,icon:e.jsx(Ta,{}),type:"dashed",style:{marginLeft:10},loading:z,onClick:()=>ve({beforeFetch:()=>{Y(!0)},successFetch:C=>{o.setFieldsValue({sourceObject:C})},errorFetch:()=>{},finallyFetch:()=>{Y(!1)}}),children:"Fill from remote source"}),e.jsx(T,{size:"small",onClick:()=>{o.setFieldsValue({sourceObject:null})},disabled:!(X&&!z),danger:!0,icon:e.jsx(Ee,{}),type:"dashed",style:{marginLeft:10},children:"Clear"})]});case"remote":return e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:()=>ve({beforeFetch:()=>{M("loading")},successFetch:C=>{M(C)},errorFetch:()=>{M(null)}}),loading:u==="loading",size:"small",icon:e.jsx(Pa,{}),type:"dashed",style:{marginLeft:10},disabled:u===null||u==="loading",children:"Refresh Remote Data"}),e.jsx(T,{size:"small",onClick:()=>{M(null)},disabled:u===null||u==="loading",danger:!0,icon:e.jsx(Ee,{}),type:"dashed",style:{marginLeft:10},children:"Clear Preview"})]});case"modified":return e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:()=>q(null),loading:R==="loading",size:"small",icon:e.jsx(Ee,{}),type:"dashed",style:{marginLeft:10},disabled:R===null||R==="loading",children:"Clear"}),e.jsx(T,{size:"small",onClick:()=>k(),disabled:!d,danger:!0,icon:e.jsx(Ee,{}),type:"dashed",style:{marginLeft:10},children:"Discard function changes"}),e.jsx(De,{size:"small",value:r,style:{marginLeft:10},onChange:C=>{l(C),q(null)},options:[{value:"local",label:"Use Local Source"},{value:"remote",label:"Use Remote Source"}]})]});default:return null}},[S,z,o,ve,d,F,R,r,k,X,u]),Z=C=>{const Q=Object.keys(C);Q.includes("modificatorFunctionString")&&!d&&s(!0),Q.includes("modificatorId")&&(s(!1),q(null))};return e.jsx(br,{destroyOnClose:!0,maskClosable:!1,centered:!0,title:i?`Edit datasource: ${i.attributes.name}`:"Add new datasource",open:!0,onCancel:()=>t(!1),footer:[e.jsx(T,{onClick:()=>t(!1),children:"Cancel"},"back"),e.jsxs(T,{loading:E,type:"primary",onClick:()=>{o.submit()},children:[i?"Save datasource":"Add datasource"," ",d?"& Update Function":""]},"submit")],children:e.jsxs(j,{onValuesChange:Z,onFinish:Ye,className:"dsForm",form:o,initialValues:tt,scrollToFirstError:!0,children:[e.jsx(Be,{destroyInactivePanel:!1,expandIcon:({isActive:C})=>C?e.jsx(en,{}):e.jsx(tn,{}),defaultActiveKey:a?[]:["form"],ghost:!0,children:e.jsxs(xr,{forceRender:!0,extra:e.jsx(yt,{color:c==="local"?"gold":"green",style:{marginInlineEnd:0,textTransform:"none"},children:c}),header:"DataSource Settings",children:[e.jsx(j.Item,{colon:!1,required:!1,label:"Name",name:"name",rules:[{required:!0,message:"This field is required."},()=>({validator(C,Q){return Promise.all([Ze({input:Q,searchArray:g})])}})],children:e.jsx(J,{})}),e.jsx(ee,{plain:!0,orientationMargin:160,orientation:"left",children:"Remote fetch settings"}),e.jsx(j.Item,{colon:!1,required:!1,label:"Remote URL",name:"sourceLink",children:e.jsx(j.Item,{noStyle:!0,colon:!1,required:!1,name:"sourceLink",normalize:C=>C===void 0?"":C,children:e.jsx(J,{allowClear:!0,spellCheck:!1,placeholder:te?"End of URL":"URL",addonBefore:e.jsxs(e.Fragment,{children:[e.jsx(j.Item,{valuePropName:"checked",name:"useBaseUrl",noStyle:!0,children:e.jsx(An,{children:e.jsx("span",{style:{userSelect:"none"},children:"Include Base Url"})})}),e.jsx(fe,{content:e.jsxs(e.Fragment,{children:["BaseUrl: ",y||"Empty"]}),children:e.jsx(Ut,{})})]})})})}),F&&e.jsxs(e.Fragment,{children:[e.jsx(j.Item,{label:"Request Header key",colon:!1,children:e.jsxs(mt,{gutter:8,children:[e.jsx(ke,{flex:"auto",children:e.jsx(j.Item,{colon:!1,required:!1,noStyle:!0,name:"headerKey",normalize:C=>C===void 0?"":C,children:e.jsx(J,{addonBefore:e.jsx("div",{style:{textTransform:"uppercase",fontSize:9,color:"gray",width:70,cursor:"default"},children:ne?"custom key":e.jsx(ut,{placement:"topLeft",title:"Value inherited from Project Environment settings",arrowPointAtCenter:!0,children:"inherited"})}),placeholder:ne?"Empty":m||"Empty",allowClear:!0,spellCheck:!1,disabled:!ne})})}),e.jsx(ke,{style:{alignSelf:"center"},children:e.jsx(j.Item,{noStyle:!0,colon:!1,required:!1,valuePropName:"checked",children:e.jsx(ge,{onChange:C=>{Ie({formKey:"headerKey",value:C})},checked:ne,size:"small"})})})]})}),e.jsx(j.Item,{label:"Request Header value",colon:!1,children:e.jsxs(mt,{gutter:8,children:[e.jsx(ke,{flex:"auto",children:e.jsx(j.Item,{colon:!1,required:!1,noStyle:!0,name:"headerValue",normalize:C=>C===void 0?"":C,children:e.jsx(J,{addonBefore:e.jsx("div",{style:{textTransform:"uppercase",fontSize:9,color:"gray",width:70,cursor:"default"},children:K?"custom value":e.jsx(ut,{placement:"topLeft",title:"Value inherited from Project Environment settings",arrowPointAtCenter:!0,children:"inherited"})}),placeholder:K?"Empty":w||"Empty",allowClear:!0,spellCheck:!1,disabled:!K})})}),e.jsx(ke,{style:{alignSelf:"center"},children:e.jsx(j.Item,{noStyle:!0,colon:!1,required:!1,valuePropName:"checked",children:e.jsx(ge,{onChange:C=>{Ie({formKey:"headerValue",value:C})},checked:K,size:"small"})})})]})})]}),e.jsx(ee,{plain:!0,orientationMargin:160,orientation:"left",children:"Datasource postprocessing & manipulation"}),e.jsx(j.Item,{colon:!1,required:!1,label:"Modify Function",name:"modificatorId",children:e.jsx(De,{options:[{value:0,label:"None"},...v]})}),e.jsx(j.Item,{colon:!1,required:!1,label:e.jsxs("div",{style:{width:200},children:["Image preload",e.jsx(fe,{placement:"topLeft",title:"Datasource for Image preloading",content:"URLs array will be used to preload & cache images",trigger:"hover",arrowPointAtCenter:!0,children:e.jsx(Je,{style:{marginLeft:7}})})]}),name:"isImagePreloadSource",valuePropName:"checked",children:e.jsx(ge,{})})]},"form")}),e.jsx(jr,{activeKey:S,onChange:C=>{_(C)},tabBarExtraContent:{right:e.jsx("div",{style:{paddingRight:17},children:A})},animated:!1,type:"card",items:nt})]})})},{Option:Cr}=De,xe=pe.memo(({name:t,envIndex:n,label:a,placeholder:i,rules:x,addonAfter:o,form:p,setIsFormChanged:g})=>{const v=typeof n!="number",m=p.getFieldValue(["env",n,...t]),[w,y]=f.useState(m!==void 0),S=_=>{_?p.setFieldValue(["env",n,...t],""):p.setFieldValue(["env",n,...t],void 0),y(_),g(!0)};return v?e.jsx(j.Item,{isListField:!1,label:a,colon:!1,required:!1,name:[...t],rules:x,children:e.jsx(J,{addonAfter:o,placeholder:i})}):e.jsx(j.Item,{colon:!1,label:a,children:e.jsxs(mt,{style:{flexWrap:"nowrap"},gutter:8,children:[e.jsx(ke,{flex:"auto",children:e.jsx(j.Item,{noStyle:!0,isListField:w,label:a,colon:!1,required:!1,name:w?["env",n,...t]:t,rules:x,children:e.jsx(J,{disabled:!w,addonAfter:o,placeholder:i,addonBefore:w?null:e.jsx("div",{style:{textTransform:"uppercase",fontSize:9,color:"gray"},children:"inherited"})})})}),e.jsx(ke,{style:{alignSelf:"center"},children:e.jsx(ge,{onChange:_=>{S(_)},checked:w,size:"small"})})]})})}),zt=pe.memo(({form:t,envIndex:n,setIsFormChanged:a})=>{const i=typeof n!="number";return e.jsxs(e.Fragment,{children:[i?e.jsx(j.Item,{colon:!0,label:"Environment name",children:e.jsx("div",{children:"Default"})}):e.jsx(j.Item,{isListField:!0,colon:!1,required:!1,name:["env",n,"envName"],label:"Environment name",children:e.jsx(J,{placeholder:"Environment name"})}),e.jsx(ee,{plain:!0,orientation:"left",children:e.jsx("span",{style:{textTransform:"uppercase",fontSize:10,opacity:.7},children:"Build Options"})}),e.jsx(j.Item,{isListField:!i,colon:!1,required:!1,label:"Enable console",valuePropName:"checked",name:i?["debugOptions","showConsoleOnLoad"]:["env",n,"debugOptions","showConsoleOnLoad"],children:e.jsx(ge,{})}),e.jsx(xe,{setIsFormChanged:a,form:t,label:"Archive Name",placeholder:"Archive Name",envIndex:n,name:["archiveName"],rules:[()=>({validator(x,o){return Xt(o)}})],addonAfter:".ch5z"}),e.jsx(ee,{plain:!0,orientation:"left",children:e.jsx("span",{style:{textTransform:"uppercase",fontSize:10,opacity:.7},children:"Connection Options"})}),e.jsx(xe,{setIsFormChanged:a,form:t,label:"Host",placeholder:"Ip or Hostname",envIndex:n,name:["webXpanel","host"]}),e.jsx(xe,{setIsFormChanged:a,label:"ipId",form:t,placeholder:"IpId",envIndex:n,name:["webXpanel","ipId"]}),e.jsx(xe,{setIsFormChanged:a,label:"Room ID",form:t,placeholder:"Room ID",envIndex:n,name:["webXpanel","roomId"]}),e.jsx(xe,{setIsFormChanged:a,label:"Auth Token",form:t,placeholder:"Auth Token",envIndex:n,name:["webXpanel","authToken"]}),e.jsx(ee,{plain:!0,orientation:"left",children:e.jsx("span",{style:{textTransform:"uppercase",fontSize:10,opacity:.7},children:"Dataset Options"})}),e.jsx(xe,{setIsFormChanged:a,label:"Dataset base URL",placeholder:"Dataset base URL",form:t,envIndex:n,name:["datasetOptions","hostname"]}),e.jsx(xe,{setIsFormChanged:a,label:"Authorization header key",placeholder:"Authorization header key",form:t,envIndex:n,name:["datasetOptions","headerKey"]}),e.jsx(xe,{setIsFormChanged:a,label:"Authorization header value",placeholder:"Authorization header value",form:t,envIndex:n,name:["datasetOptions","headerValue"]})]})}),Sr=pe.memo(({editProjectModalId:t,setEditProjectModalId:n})=>{const a=sn(D=>D.themesList),i=V.getState().workingProject,{name:x,theme:o,env:p,webXpanel:g,datasetOptions:v,debugOptions:m,archiveName:w,globalJoins:y}=(i==null?void 0:i.attributes)??{},S={env:p,webXpanel:g,datasetOptions:v,debugOptions:m,archiveName:w,globalJoins:y,name:x,theme:o==null?void 0:o.data.id},[_]=j.useForm(),u=j.useWatch("env",_),[M,R]=f.useState(!1),[q,G]=f.useState(!1),te=D=>{R(!0),t&&Yt({projectId:t,inputData:D}).then(()=>{G(!1),he.success("Project settings saved")}).finally(()=>R(!1))},$=()=>{q?nn({icon:e.jsx(me,{}),title:"Exit project settings?",content:"Close without saving project settings?",okText:"Close without save",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>{R(!1),n(null)},onCancel:()=>{R(!1)}}):n(null)},{refreshSingleDataSource_signal_s_fb:B}=(i==null?void 0:i.attributes.globalJoins)||{},ne=()=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{children:"Project Settings"}),e.jsx(T,{icon:e.jsx(Ba,{}),loading:M,disabled:!q,onClick:()=>{_.submit()},type:"primary",children:"Save Project Settings"})]}),K=(D,F)=>{if(!i||!t)return;const z=[...u??[]];if(F==="add"){const Y=ia().format("YYYY-MM-DD_HH-mm"),d=Zt(),r={envName:"ENV_"+Y,envId:d};z.push(r),_.setFieldValue("env",z),G(!0)}else if(F==="remove"&&typeof D=="string")try{const Y=Number(D);z.splice(Y,1),_.setFieldValue("env",z),G(!0)}catch(Y){console.log(Y)}},X=()=>{const D={label:"Default",key:"Default",forceRender:!0,children:e.jsx(zt,{setIsFormChanged:G,form:_})},z=(u??[]).map((Y,d)=>({label:Y.envName||"no_name",key:String(d),forceRender:!0,children:e.jsx(zt,{setIsFormChanged:G,form:_,envIndex:d})}));return[D,...z]};return i?e.jsx(qn,{closable:!0,maskClosable:!0,width:"min(600px, 85vw)",title:e.jsx(ne,{}),placement:"right",onClose:()=>{$()},destroyOnClose:!0,open:t!==null,children:e.jsxs(j,{onValuesChange:D=>{G(!0),console.log(_.getFieldsValue())},style:{maxHeight:"100%",overflowY:"auto"},labelCol:{xs:{span:8}},wrapperCol:{xs:{span:14}},form:_,initialValues:S,onFinish:te,scrollToFirstError:!0,children:[e.jsx(j.Item,{colon:!1,required:!1,name:"name",label:"Name",rules:[{required:!0,message:"This field is required."}],children:e.jsx(J,{})}),e.jsx(j.Item,{colon:!1,required:!1,name:"theme",label:"Theme",rules:[{required:!0,message:"This field is required."}],children:e.jsx(De,{children:a==null?void 0:a.map(D=>e.jsx(Cr,{value:D.id,children:D.attributes.name},D.id))})}),e.jsx(ee,{plain:!0,orientation:"left",children:e.jsx("span",{style:{textTransform:"uppercase",fontSize:10,opacity:.7},children:"Global joins"})}),e.jsx(j.Item,{colon:!1,required:!1,name:["globalJoins","analogPageFlip_signal_a_fb"],label:"Analog flip page signal",children:e.jsx(J,{addonBefore:e.jsx("div",{style:{marginRight:0,marginTop:-2},children:e.jsx(Re,{style:{margin:0},type:"a"})}),placeholder:"Analog signal name"})}),e.jsx(j.Item,{colon:!1,required:!1,name:["globalJoins","serialPageFlip_signal_s_fb"],label:"Serial flip page signal",children:e.jsx(J,{addonBefore:e.jsx("div",{style:{marginRight:0,marginTop:-2},children:e.jsx(Re,{style:{margin:0},type:"s"})}),placeholder:"Serial signal name"})}),e.jsx(j.Item,{colon:!1,required:!1,name:["globalJoins","notification_signal_s_fb"],label:"Notification signal",children:e.jsx(J,{addonBefore:e.jsx("div",{style:{marginRight:0,marginTop:-2},children:e.jsx(Re,{style:{margin:0},type:"s"})}),placeholder:"Serial signal name"})}),e.jsx(j.Item,{colon:!1,required:!1,name:["globalJoins","refreshDataSources_signal_d_fb"],label:"Refresh All DataSources",children:e.jsx(J,{addonBefore:e.jsx("div",{style:{marginRight:0,marginTop:-2},children:e.jsx(Re,{style:{margin:0},type:"d"})}),placeholder:"Digital signal name"})}),e.jsx(j.Item,{colon:!1,initialValue:B,required:!1,name:["globalJoins","refreshSingleDataSource_signal_s_fb"],label:"Refresh Single DataSource",children:e.jsx(J,{addonBefore:e.jsx("div",{style:{marginRight:0,marginTop:-2},children:e.jsx(Re,{style:{margin:0},type:"s"})}),placeholder:"Serial signal name"})}),e.jsx(ee,{plain:!0}),e.jsx("div",{style:{fontSize:14,fontWeight:500,paddingBottom:20},children:"Project Environments"}),e.jsx(j.List,{name:"env",children:()=>null}),e.jsx(Oe,{destroyInactiveTabPane:!1,className:"envProjectTabs",size:"small",type:"editable-card",onEdit:K,items:X()})]})}):null}),_r=({setNewGlobalContainerVisible:t,newGlobalContainerVisible:n})=>{const{projectId:a}=ae(),[i,x]=f.useState(!1),o=V(y=>y.workingProject),p=o==null?void 0:o.attributes.globalContainers;function g(y){return!(p!=null&&p.some(S=>S.name===y))}const[v]=j.useForm(),m=()=>{v.submit()},w=({name:y,visibleByDefault:S,position:_})=>{x(!0);let M=[{name:y||"Global Container",visibleByDefault:S===void 0?!0:S,visibleOnPages:[],hiddenOnPages:[],elements:[],useOrientation:!1,cssClass:"globalContainer",landscapePosition:_||"top",portraitPosition:_||"top",landscape:{flow:"row",padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},align:"center",distribution:"center",border:null,size:{manualMode:!1,value:void 0,unit:"%"},backgroundColor:""},portrait:{flow:"row",padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},align:"center",distribution:"center",border:null,size:{manualMode:!1,value:void 0,unit:"%"},backgroundColor:""}}];p&&Array.isArray(p)&&(M=[...p,...M]),a&&Yt({projectId:a,inputData:{globalContainers:M}}).then(()=>{t(!1)}).finally(()=>{x(!1)})};return e.jsx("div",{onKeyUp:y=>{y.key==="Enter"&&m()},children:e.jsx(ue,{afterClose:()=>v.resetFields(),maskClosable:!1,title:"Add New Global Container",open:!0,onCancel:()=>t(!1),footer:[e.jsx(T,{onClick:()=>t(!1),children:"Cancel"},"back"),e.jsx(T,{loading:i,type:"primary",onClick:m,children:"Add global container"},"submit")],children:e.jsxs(j,{labelCol:{xs:{span:8}},wrapperCol:{xs:{span:14}},form:v,onFinish:w,initialValues:{name:"Global Container",visibleByDefault:!0},scrollToFirstError:!0,children:[e.jsx(j.Item,{colon:!1,required:!1,label:"Name",name:"name",rules:[{required:!0,message:"This field is required."},()=>({validator(y,S){return S&&g(S)?Promise.resolve():Promise.reject(new Error("Container name must be unique"))}})],children:e.jsx(J,{})}),e.jsx(j.Item,{colon:!1,required:!1,name:"position",label:"Default Position",initialValue:"top",children:e.jsx(De,{style:{width:"100%"},options:[{value:"top",label:"Top"},{value:"right",label:"Right"},{value:"bottom",label:"Bottom"},{value:"left",label:"Left"}]})}),e.jsx(j.Item,{colon:!1,required:!1,name:"visibleByDefault",label:"Default Visibility",valuePropName:"checked",children:e.jsx(ge,{checkedChildren:"Visible",unCheckedChildren:"Hidden"})})]})})})},{Panel:qt}=Be,kr=se(Oe)`
  position: relative;
  flex: 1;

  .ant-tabs-content {
    position: relative;
    height: 100%;
  }

  .ant-tabs-tabpane {
    height: 100%;
    background-color: #1e1e1e;
  }

  .ant-tabs-nav {
    margin: 0;
  }

  .ant-tabs-tab {
    border: 0 !important;
    min-width: 70px;

    &.ant-tabs-tab-active {
      background-color: #1e1e1e;

      .ant-tabs-tab-btn {
        color: #fff;
        user-select: none;
      }
    }
  }
`,Ke=function(n){return n.trim().toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(a,i)=>i.toUpperCase())},Er=se(ue)`
  height: calc(100vh - 4%) !important;
  width: 100% !important;

  .ant-modal-content {
    height: 100%;
    position: relative;
    display: flex;
    flex-flow: column;

    .modificatorForm {
      height: 100%;
      flex: 1;
      position: relative;
      display: flex;
      flex-flow: column;
    }

    .ant-modal-body {
      flex: 1;
      position: relative;
      padding: 0;
      display: flex;
      flex-flow: column;
    }

    .ant-collapse-header {
      font-weight: normal !important;
      user-select: none;
      text-transform: uppercase;
      font-size: 12px;
    }

    .ant-form-item-label {
      flex-basis: 160px;
    }
  }
`,ct=se.div`
  position: relative;
  flex: 1;
  height: 100%;
  /* overflow: hidden; */
  min-height: 200px;
  border-top: 10px rgb(30, 30, 30) solid;
  background-color: rgb(30, 30, 30);

  .monaco-editor {
    position: absolute !important;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;



  }



  .monaco-editor.showUnused .squiggly-inline-unnecessary {
    text-decoration: underline;
    text-decoration-style: wavy;
    text-decoration-color: #ff0000;
    opacity: 1;
  }
`,Ir=se.div`
  position: relative;
  display: flex;
  height: 100%;
`,Ar=se.div`
  display: flex;
  flex-flow: column;
  flex: 1;
`,Tr=se.div`
  display: flex;
  flex-flow: column;
  width: 40vw;
`,Fr=se.div`
  position: relative;

  small {
    position: absolute;
    bottom: 17px;
    text-transform: uppercase;
    font-size: 7px;
  }
`,Lr=({setNewModificatorVisible:t,newModificatorVisible:n})=>{var h;const a=typeof n=="number"?n:null,i=(h=V.getState().workingProject)==null?void 0:h.attributes.modificators.data.find(c=>c.id===a),[x,o]=f.useState(!1),{projectId:p}=ae(),[g,v]=f.useState([]),[m]=j.useForm(),w=j.useWatch("name",m),y="RunFunction",[S,_]=f.useState(y),u=j.useWatch("argumentsTestData",m),{addValueToStore:M,getValueFromStore:R}=sa.getState(),{setVariableNewValue:q}=la.getState(),G=f.useRef(null),te=c=>{G.current=c,c.onKeyDown(b=>{const k=G.current&&G.current.getPosition().lineNumber,E=G.current&&G.current.getModel().getLineCount(),O=G.current.getSelection(),{startLineNumber:L,endLineNumber:P,selectionStartLineNumber:I}=O;(k===1||k===E||L===1||L===E||P===1||P===E||I===1||I===E)&&(b.stopPropagation(),b.preventDefault())})},$=f.useRef(null),B=c=>{$.current=c},ne=()=>`arg${u.length+1}`,K=c=>{try{const b=[...u];b[c].testData="",m.setFieldsValue({argumentsTestData:b})}catch(b){console.log(b)}},X=()=>new Promise((c,b)=>{var L,P;const k=m.getFieldValue("function");if(!k){b(new Error("No function found."));return}let E=!0;const O=(u==null?void 0:u.map(I=>{I!=null&&I.testData||(E=!1);const H=I==null?void 0:I.testData;try{return JSON.parse(H)}catch{return H}}))||[];try{const I=Et(k);if(console.log("userFunction",I),E){let H=I(...O,It(),M,R,q);typeof H=="object"?H=JSON.stringify(H):H=String(H),(L=$.current)==null||L.getModel().setValue(H),c(H)}else c("No arguments")}catch(I){console.error("Error when calling finalFunction:",I);const H=`Error when calling ${Ke(w??"")}: ${I==null?void 0:I.message}`;(P=$.current)==null||P.getModel().setValue(H),b(I)}}),D=()=>new Promise((c,b)=>{var O,L;const k=m.getFieldValue("function");if(!k){b(new Error("No function found."));return}const E=(u==null?void 0:u.map(P=>{const I=P==null?void 0:P.testData;try{return JSON.parse(I)}catch{return I}}))||[];try{let I=Et(k)(...E,It(),M,R,q);typeof I=="object"?I=JSON.stringify(I):I=String(I),(O=$.current)==null||O.getModel().setValue(I),c(I)}catch(P){console.error("Error when calling finalFunction:",P);const I=`Error when calling ${Ke(w??"")}: ${P==null?void 0:P.message}`;(L=$.current)==null||L.getModel().setValue(I),b(P)}}),F=()=>{var k;if(S===y)return e.jsxs("div",{style:{paddingRight:17,display:"flex",gap:5},children:[e.jsx(T,{onClick:()=>{D().catch(E=>{console.log(E)})},icon:e.jsx(Oa,{}),ghost:!0,type:"primary",children:"Run"}),e.jsx(T,{onClick:()=>{var E;(E=$.current)==null||E.getModel().setValue("")},danger:!0,icon:e.jsx(Ee,{}),type:"dashed"})]});const c=Number(S.split("_")[1]),b=!!((k=u==null?void 0:u[c])!=null&&k.testData);return e.jsx("div",{style:{paddingRight:17},children:e.jsx(T,{disabled:!b,onClick:()=>{K(c)},danger:!0,icon:e.jsx(Ee,{}),type:"dashed"})})};f.useEffect(()=>{if(S===y)return;const c=Number(S.split("_")[1]);u!=null&&u[c]||_(y)},[u,S]),f.useEffect(()=>{if(!w)return;const c=m.getFieldValue("function");if(!c)return;const b=(u==null?void 0:u.map(O=>O.name))??[],k=c.split(`
`),E=`function ${Ke(w)}(${b.join(",")}){`;k[0]=E,m.setFieldsValue({function:k.join(`
`)})},[m,w,u]);const z=f.useMemo(()=>{let c=[];return!(u!=null&&u.length)||u!=null&&u.some(b=>b===void 0)?c=[]:c=u==null?void 0:u.map((b,k)=>({label:e.jsxs(Fr,{children:[e.jsx("small",{children:"test data"}),b.name]}),key:`argument_${k}`,children:e.jsx(ct,{hasErrors:!1,children:e.jsx(j.Item,{isListField:!0,preserve:!1,noStyle:!0,name:["argumentsTestData",k,"testData"],validateStatus:"success",normalize:E=>E===void 0?"":E,children:e.jsx(ye,{className:"monaco-editor",loading:e.jsx(be,{}),options:{readOnly:!1,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark"})},k)})})),[{label:"Test Function",key:"RunFunction",children:e.jsx(ct,{hasErrors:!1,children:e.jsx(ye,{value:"",onMount:B,className:"monaco-editor",language:"javascript",loading:e.jsx(be,{}),options:{readOnly:!0,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0}},theme:"vs-dark",defaultLanguage:"javascript"})},"RunFunctionKey")},...c??[]]},[u]),Y=()=>{m.submit()},d=({name:c,function:b,argumentsTestData:k})=>{o(!0),X().then(()=>{const E={name:c||"New function",function:b};a?rn({...E},a).then(()=>{t(!1)}):p&&oa(p,{...E,argumentsTestData:k}).then(()=>{t(!1)})}).catch(E=>{_(y),he.error(`Function test failed: ${E.message}`),console.log(E)}).finally(()=>{o(!1)})},s=i?{name:i.attributes.name,function:i.attributes.function,argumentsTestData:i.attributes.function.substring(i.attributes.function.indexOf("(")+1,i.attributes.function.indexOf(")")).trim()===""?[]:i.attributes.function.substring(i.attributes.function.indexOf("(")+1,i.attributes.function.indexOf(")")).split(",").map(c=>({name:c.trim(),testData:null}))}:{name:"My function",function:[`function ${Ke("My function")}(){`,"//write your code here","","}"].join(`
`),argumentsTestData:[]},r=()=>g.length>0?e.jsx(fe,{trigger:"hover",title:"Validation error",content:"Function contains errors",children:e.jsx(me,{style:{fontSize:14,margin:"0 0 0 5px",color:"red",cursor:"help"}})}):null,l=[{name:"Navigate",content:`
    //navigate - function to navigate to a specific page
    window?.avgatorStudio?.navigate("/pageName")
    `},{name:"Events",content:`
    //publishAnalog - function to publish analog signal
    window?.avgatorStudio?.publishAnalog({ signalName: "signalName", value: 1 })
    //publishDigital - function to publish digital signal
    window?.avgatorStudio?.publishDigital({ signalName: "signalName", value: true })
    //publishSerial - function to publish serial signal
    window?.avgatorStudio?.publishSerial({ signalName: "signalName", value: "value" })
    //getInstantDigitalFb - get instant digital feedback value
    window?.avgatorStudio?.getInstantDigitalFb({ signalName: "signalName", defaultValue: false })
    //getInstantAnalogFb - get instant analog feedback value
    window?.avgatorStudio?.getInstantAnalogFb({ signalName: "signalName", defaultValue: 0 })
    //getInstantSerialFb - get instant serial feedback value
    window?.avgatorStudio?.getInstantSerialFb({ signalName: "signalName", defaultValue: "text" })
      `},{name:"Get Datasource",content:`
    //getDatasource - function to get datasource value by uid. if no uid provided, returns all datasources
    const dataSource = window?.avgatorStudio?.getDatasource({ uid: '1234' });
      `},{name:"Variables",content:`
      //getVariableByName - function to get variable value by name
      const variableValue = window?.avgatorStudio?.getVariableByName({ name: 'variableName' });
      
      //setVariableByName - function to set variable value by name
      window?.avgatorStudio?.setVariableByName({ name: 'variableName', value: 'newValue' });
      `}];return e.jsx(Er,{destroyOnClose:!0,maskClosable:!1,centered:!0,title:"Add new function",open:!0,onCancel:()=>t(!1),onOk:Y,footer:[e.jsx(T,{onClick:()=>t(!1),children:"Cancel"},"back"),e.jsx(T,{disabled:g.length>0,loading:x,type:"primary",onClick:()=>{m.submit()},children:g.length>0?"Function contains errors":"Save"},"submit")],children:e.jsxs(j,{onFinish:d,className:"modificatorForm",form:m,initialValues:s,scrollToFirstError:!0,children:[e.jsx(Be,{destroyInactivePanel:!1,expandIcon:({isActive:c})=>c?e.jsx(en,{}):e.jsx(tn,{}),defaultActiveKey:["form"],ghost:!0,children:e.jsx(qt,{forceRender:!0,header:"Function Settings",children:e.jsxs("div",{style:{display:"flex",gap:20,alignItems:"stretch",height:"100%",position:"relative"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx(j.Item,{colon:!1,required:!1,label:"Name",name:"name",rules:[{required:!0,message:"This field is required."},()=>({validator(c,b){return Promise.all([Ze({input:b,searchArray:[]}),wt(b),Ct(b||"")])}})],children:e.jsx(J,{spellCheck:!1})}),e.jsx(ee,{plain:!0,orientationMargin:160,orientation:"left",children:"Function Arguments"}),e.jsx(j.List,{name:"argumentsTestData",children:(c,{add:b,remove:k})=>e.jsxs(e.Fragment,{children:[c.map((E,O)=>e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"flex-start",marginBottom:15},children:[e.jsx(j.Item,{...E,label:`Argument #${O+1}`,name:[E.name,"name"],validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."},()=>({validator(L,P){return Promise.all([Ze({input:P,searchArray:u.filter((I,H)=>H!==O)||[],searchKey:"name"}),Xt(P),wt(P),Ct(P||"")])}})],style:{marginBottom:0,flex:1},children:e.jsx(J,{spellCheck:!1,autoFocus:!0})}),e.jsx(Mn,{style:{marginTop:10},onClick:()=>k(E.name)})]},E.key)),e.jsx(j.Item,{label:" ",colon:!1,children:e.jsx(T,{type:"dashed",onClick:()=>b({name:ne(),testData:void 0}),style:{width:"100%"},block:!0,icon:e.jsx(Kt,{}),children:"Add Function Argument"})})]})})]}),e.jsx("div",{style:{minWidth:"50%",width:"50%",position:"relative",overflow:"auto",translate:"0 -10px"},children:e.jsx(Be,{ghost:!0,accordion:!0,children:l.map(c=>e.jsx(qt,{header:c.name,children:e.jsx(ea,{wrapLongLines:!0,lineNumberContainerStyle:{display:"none"},lineNumberStyle:{display:"none"},style:{position:"relative",maxWidth:"100% !important",borderRadius:"3px"},language:"JavaScript",theme:"AtomOneDark",copy:!1,suppressContentWarning:!0,children:c.content})},c.name))})})]})},"form")}),e.jsxs(Ir,{children:[e.jsxs(Ar,{children:[e.jsxs(ee,{plain:!0,orientationMargin:17,style:{paddingRight:17,marginBottom:9.5},orientation:"left",children:["Function Body editor",e.jsx(r,{})]}),e.jsx(ct,{hasErrors:!!g.length,children:e.jsx(j.Item,{noStyle:!0,name:"function",dependencies:["name"],validateStatus:g.length?"error":void 0,rules:[()=>({validator(c,b){return g.length?Promise.reject():Promise.resolve()}})],normalize:c=>c===void 0?"":c,children:e.jsx(ye,{onMount:te,className:"monaco-editor",language:"javascript",loading:e.jsx(be,{}),options:{readOnly:!1,automaticLayout:!0,hideCursorInOverviewRuler:!0,matchBrackets:"always",wordWrap:"on",glyphMargin:!1,folding:!0,lineNumbersMinChars:3,minimap:{enabled:!0},showUnused:!0},theme:"vs-dark",defaultLanguage:"javascript",onValidate:c=>{v(c)}})})})]}),e.jsx(Tr,{children:e.jsx(kr,{activeKey:S,onChange:c=>{_(c)},tabBarExtraContent:{right:e.jsx(F,{})},animated:!1,type:"card",items:z})})]})]})})},Pr=({setNewPageModalVisible:t,newPageModalVisible:n})=>{var y;const a=((y=V.getState().workingProject)==null?void 0:y.attributes.pages.data)||[],{projectId:i}=ae(),[x,o]=f.useState(!1),[p]=j.useForm(),g=()=>{p.submit()},v=n==="subpage",m=j.useWatch("isStatic",p),w=({name:S,isStatic:_})=>{if(o(!0),!i)return Promise.reject("No projectId");const u=v&&_?200:void 0;return Rn({name:S,project:i,isSubpage:v,isStatic:!!_,width:{width:{value:u,unit:"px"}},height:{height:{value:u,unit:"px"}}}).then(()=>t(null)).finally(()=>o(!1))};return e.jsx(ue,{width:600,afterClose:()=>p.resetFields(),maskClosable:!1,title:`Add new ${n}`,open:!0,onCancel:()=>t(null),footer:[e.jsx(T,{onClick:()=>t(null),children:"Cancel"},"back"),e.jsxs(T,{loading:x,type:"primary",onClick:g,children:["Add new ",n]},"submit")],children:e.jsxs(j,{labelCol:{xs:{span:9}},wrapperCol:{xs:{span:12}},form:p,initialValues:{name:"page name",url:"mypage"},onFinish:w,scrollToFirstError:!0,children:[e.jsx(j.Item,{colon:!1,required:!1,name:"name",label:"Name",rules:[{required:!0,message:"This field is required."},()=>({validator(S,_){return Ze({input:_,searchArray:a,searchKey:["attributes","name"]})}})],children:e.jsx(J,{})}),e.jsx(ee,{}),e.jsx(j.Item,{colon:!1,required:!1,name:"isStatic",initialValue:!0,label:"Design paradigm",children:e.jsx(ta,{children:({onChange:S,value:_,...u})=>e.jsx(Hn,{block:!0,style:{userSelect:"none"},onChange:M=>S(M==="true"),value:_?"true":"false",options:[{label:"Adaptive",value:"true",icon:e.jsx(ht,{style:{height:"auto",minWidth:"1em",margin:"0 3px -1px 0"},isStatic:!0})},{label:"Responsive",value:"false",icon:e.jsx(ht,{style:{height:"auto",minWidth:"1em",margin:"0 3px -1px 0"},isStatic:!1})}],...u})})}),e.jsx(ee,{}),e.jsxs("div",{style:{color:"var(--ant-primary-5)",fontSize:12,marginBottom:4},children:[e.jsx(Je,{style:{fontSize:14}})," How"," ",m?"adaptive":"responsive"," page layout works"]}),m?e.jsx("p",{style:{fontSize:12},children:"Adaptive page layout allow you arrange elements manually by dragging ones. Element's position & size doesn't affect each other but optionally may depends on screen size and still be adaptive."}):e.jsx("p",{style:{fontSize:12},children:"Responsive page layout based on flexbox css model and all containers on the page with all elements inside are responsive."})]})})},Rr=f.lazy(()=>vt(()=>import("./moveable.esm-CxaKG_HY.js").then(t=>t.A),__vite__mapDeps([29,1,2]),import.meta.url)),Mr=()=>{const t=jt(A=>A.jwt),n=$t(),a=bt(),[i,x]=Cn();On(),f.useEffect(()=>{if(i.size){let A=function(){x({})};const Z=i.get("paymentFeedback");if(Z)switch(Z){case"buyBuildError":ue.error({icon:null,maskClosable:!1,content:e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"red",paddingBottom:5},children:e.jsx(me,{})}),"We can't process your payment. Please try again later."]}),okText:"Close",onOk:()=>A()});break;case"buyBuildOk":ue.success({icon:null,maskClosable:!1,content:e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"green",paddingBottom:5},children:e.jsx(gn,{})}),"Thank you for your purchase! Now project have unlimited builds."]}),okText:"Close",onOk:()=>A()});break;default:ue.error({icon:null,maskClosable:!1,content:e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"red",paddingBottom:5},children:e.jsx(me,{})}),"Unknown payment feedback: ",Z]}),okText:"Close",onOk:()=>A()}),console.error("Unknown payment feedback: ",Z);break}}return()=>{ue.destroyAll()}},[i,x]);const o=f.useMemo(()=>t?Sn(t):void 0,[t]);xt.interceptors.response.use(A=>A.data&&((A==null?void 0:A.status)===200||(A==null?void 0:A.status)===201)?A:Promise.reject(A),A=>{var Z;return((Z=A.response)==null?void 0:Z.status)===401&&dt(),Promise.reject(A)});const p=window.location.hostname;f.useEffect(()=>{p==="avstudio.app"&&Bt.initialize("G-CJ806X6F1C")},[p]),f.useEffect(()=>{n.pathname&&p==="avstudio.app"&&Bt.send({hitType:"pageview",page:n.pathname})},[p,n.pathname]),f.useEffect(()=>{t||a("/login")},[n.pathname,t,a]);const{projectId:g}=ae(),{pageId:v}=ae(),{ConfirmModal:m}=hr(),{fillProjectsList:w}=_n.getState(),{fetchAndFill:y,resetWorkingProject:S,clearHistory:_}=V.getState(),u=V(A=>A.workingProject),M=u==null?void 0:u.attributes.datasources.data,[R,q]=f.useState(!1),[G,te]=f.useState(!1),$=f.useRef(!1);f.useEffect(()=>{function A(){st.destroy(),$.current=!1}async function Z(de){await fetch(de,{headers:{Pragma:"no-cache",Expires:"-1","Cache-Control":"no-cache"}}),window.location.href=de,window.location.reload()}if(!g&&t&&!$.current){const de=vr.getState().fetchVersions;try{de().then(oe=>{if(oe!=null&&oe.length){const Ce="2.0.1",Se=oe==null?void 0:oe[0],{version:_e,text:ze}=(Se==null?void 0:Se.attributes)??{};if(!Ce||!_e)return;let Ae=!1;const qe=Number(Ce.replace(/\./g,"")),Ge=Number(_e.replace(/\./g,""));qe<Ge&&(Ae=!0),Ae&&($.current=!0,st.destroy(),st.info({message:"New version available",onClose:A,description:e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5},children:e.jsxs(yt,{children:["Current ",Ce," => New ",_e]})}),ze," ",e.jsx(ee,{style:{margin:"15px 0"}})," ",e.jsx(T,{onClick:()=>{Z(window.location.href)},style:{marginRight:5},type:"primary",children:"Refresh to update"}),e.jsx(T,{onClick:()=>A(),children:"Later"})]}),onClick:()=>{},placement:"top",duration:null}))}})}catch(oe){console.log(oe)}}},[g,t]),Dn({initVariableArr:u==null?void 0:u.attributes.variables}),f.useEffect(()=>{M!=null&&M.length&&!R&&!G&&(q(!0),pt().then(()=>{te(!0),q(!1)}))},[M]);const B=an({pageId:v}),ne=ie(A=>A.showBoundingBox),{setMainMenuData:K}=ie.getState(),{addNewTab:X,clearTabs:D}=V.getState(),F=re.getState().setEnvState,z=Bn({projectId:o,isEditor:!0,jwt:t,autoConnect:!0}),Y=ie(A=>A.selectedMenuSection.elementIndex);f.useEffect(()=>{if(Y===null){const A=$e.getState().setSelectedElementRef;A({current:null})}},[Y]),f.useEffect(()=>{K({pageSearchString:void 0,subPageSearchString:void 0})},[g,K]),f.useEffect(()=>{B!=null&&B.attributes.isSubpage?K({isSubpageEditor:!0}):K({isSubpageEditor:!1})},[B==null?void 0:B.attributes.isSubpage,K]),f.useEffect(()=>{B!=null&&B.attributes.isStatic?(K({isStaticEditor:!0}),he.info({content:"You are in adaptive editor mode",style:{position:"fixed",bottom:"50px",left:"50%",translate:"-50% 0"}})):K({isStaticEditor:!1})},[B==null?void 0:B.attributes.isStatic,K]);const d=f.useRef();f.useEffect(()=>(z&&o&&(console.log("liveUid-instance",o),z.on("connect",()=>{console.log("Socket EDITOR connected!")}),z.on("disconnect",()=>{console.log("Socket EDITOR disconnected!")}),z.on("requestProject",A=>{const Z=V.getState().workingProject;Z&&(d.current=setTimeout(()=>{clearTimeout(d.current),z.emit("project",{...Z,id:o}),console.log("requestProject initiated - initial data project pushed to: ",o,"requested from",A)},500))})),()=>{d.current&&clearTimeout(d.current)}),[z,o]),f.useEffect(()=>(z&&u&&o&&(d.current=setTimeout(()=>{clearTimeout(d.current),z.emit("project",{...u,id:o}),console.log("project data pushed to: ",o)},500)),()=>{d.current&&clearTimeout(d.current)}),[o,z,u]),f.useEffect(()=>{v&&F(ne?"editor":"preview")},[v,F,ne]),f.useEffect(()=>{v&&u&&X(v)},[X,v,u]),f.useLayoutEffect(()=>{if(!t)return;const A=sn.getState().fetchAndFillThemesList;A();const Z=Xe.getState().fetchTestDevices;Z()},[t]),f.useEffect(()=>{_()},[_,v]),f.useEffect(()=>{g||Tn()},[g]);const s=f.useRef(!1);f.useLayoutEffect(()=>{t&&(g?(u&&String(u.id)!==g&&S(),!u&&!s.current&&(s.current=!0,y(g).then(()=>{s.current=!1}))):(w(),D(),_()))},[y,w,g,S,u==null?void 0:u.id,D,_,u,t]);const[r,l]=f.useState(null),[h,c]=f.useState(null),[b,k]=f.useState(!1),[E,O]=f.useState(!1),[L,P]=f.useState(!1),[I,H]=f.useState(null),[ce,we]=f.useState(!1),{CloneModal:Ie,setCloneItemModal:Ye}=pr(),Ve={editProjectModalId:r,setEditProjectModalId:l,newPageModalVisible:h,setNewPageModalVisible:c,newGlobalContainerVisible:ce,setNewGlobalContainerVisible:we,setNewDatasourceVisible:O,newDatasourceVisible:E,setNewModificatorVisible:P,newModificatorVisible:L,setEditModificator:H,editModificator:I,newVariableModalVisible:b,setNewVariableModalVisible:k,CloneModal:Ie,setCloneItemModal:Ye},Qe=$e(A=>A.selectedElementRef),et=ie(A=>A.isStaticEditor),tt=$e(A=>A.staticEementsGuidesClasses),ve=$e(A=>A.activeStaticElementKey),nt=tt.filter(A=>A!==ve);return e.jsxs(e.Fragment,{children:[e.jsxs(Un,{children:[e.jsx(Kn,{children:e.jsx(fr,{setEditProjectModalId:l})}),e.jsx(Jn,{children:e.jsx(kn,{context:Ve})})]}),r&&e.jsx(Sr,{editProjectModalId:r,setEditProjectModalId:l},g+"_EditProjectModal"),h&&e.jsx(Pr,{newPageModalVisible:h,setNewPageModalVisible:c},g+"_NewPageModal"),b&&e.jsx(Gn,{setNewVariableModalVisible:k},g+"_NewVariableModal"),ce&&e.jsx(_r,{setNewGlobalContainerVisible:we,newGlobalContainerVisible:ce},g+"_NewGlobalContainerModal"),L&&e.jsx(Lr,{setNewModificatorVisible:P,newModificatorVisible:L},g+"_NewModificatorModal"),E&&e.jsx(wr,{setNewDatasourceVisible:O,newDatasourceVisible:E},g+"_NewDatasourceModal"),Ie,e.jsx(m,{}),et&&e.jsx(f.Suspense,{fallback:e.jsx(Gt,{}),children:e.jsx(Rr,{target:ne?Qe:null,zoom:1,snappable:!0,snapThreshold:5,snapContainer:".page",bounds:{left:0,top:0,right:0,bottom:0,position:"css"},isDisplaySnapDigit:!0,isDisplayInnerSnapDigit:!1,snapGap:!0,snapDirections:{top:!0,left:!0,bottom:!0,right:!0,center:!0,middle:!0},elementSnapDirections:{top:!0,left:!0,bottom:!0,right:!0,center:!0,middle:!0},dragTargetSelf:!1,elementGuidelines:nt,useMutationObserver:!0,origin:!1,throttleResize:0,throttleDrag:0,throttleRotate:0,startDragRotate:0,throttleDragRotate:0,draggable:!0,resizable:!1,scalable:!1,keepRatio:!0,rotatable:!1,padding:10,onDrag:A=>{const{target:Z,transform:de}=A;Z.style.transform=de}})})]})},ss=Object.freeze(Object.defineProperty({__proto__:null,default:Mr},Symbol.toStringTag,{value:"Module"}));export{Ee as R,ss as m,sn as u};
