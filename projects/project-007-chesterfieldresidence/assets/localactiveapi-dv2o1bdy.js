import{a as E}from"./editorApp-BQHhAWNR.js";import{u as N}from"./useCustomFonts--hfI8X19.js";import{a as B}from"./index-BWO8qd00.js";function R(r){const i=[];for(let t=1;t<r+1;t++){const l={[`sourceItemTitle_${t}_signal_s_fb`]:"",[`sourceItemImage_${t}_signal_s_fb`]:"",[`sourceItemSelect_${t}_signal_d`]:""};i.push(l)}return i}function L(r,i){var l;return i===void 0?r:(l=r==null?void 0:r.staticListOverrides)==null?void 0:l[i]}const F=({elements:r,oldIndex:i,newIndex:t})=>{if(i<0||i>=r.length||t<0)return console.log("Invalid indexes, return original array",i,t,r.length),r;const l=structuredClone(r),o=l.splice(i,1)[0];return l.splice(t,0,o),l},T=({isStatic:r})=>({name:r?"Static elements":"Container",isStatic:r,cssClass:"container",useOrientation:!1,landscape:{padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},backgroundColor:"",flow:"column",align:"center",distribution:"center",size:{manualMode:!1,value:void 0,unit:"%"},border:null},portrait:{padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},backgroundColor:"",flow:"column",align:"center",distribution:"center",size:{manualMode:!1,value:void 0,unit:"%"},border:null},elements:[]});function W({calculatedNewElementPosition:r,destinationContainerIndex:i,destinationContainerType:t,resolve:l}){const o=N.getState().setMainMenuData;let n=`container-${i}-element-${r}`;t==="global"&&(n=`globalContainer-${i}-element-${r}`),o({selectedMenuSection:{key:"",containerIndex:i,elementIndex:null,pageActionIndex:null,isGlobalContainer:!1}}),setTimeout(()=>{l(),o({selectedMenuSection:{key:n,containerIndex:i,elementIndex:r,pageActionIndex:null,isGlobalContainer:t==="global"}})},100)}const V=async({pageId:r,draggedElement:i,dragDestination:t})=>new Promise((l,o)=>{var n;try{const{sourceContainerIndex:g,sourceElementIndex:f,sourceContainerType:s}=i,{destinationContainerIndex:c,destinationElementPosition:d,destinationContainerType:u}=t,w=E.getState().workingProject;if(!w)return o(new Error("workingProject is not defined"));const b=structuredClone(w.attributes.pages.data.find(a=>a.id===r));if(!b)return o(new Error("currentPageData is not available"));if(!b.attributes.containers||!((n=b.attributes.containers)!=null&&n.length))return o(new Error("No containers are available"));if(g===c&&s===u){if(console.log("drop to the same container"),d===f)return console.log("No reorder needed"),l();if(u==="normal"){const a=b.attributes.containers[c].elements;if(!a||!(a!=null&&a.length))return o(new Error("elementsToChange is not available"));let p=d;p>f&&(p=p-1);const C=F({elements:a,oldIndex:f,newIndex:p});b.attributes.containers[c].elements=C,j({pageId:r,newPageAttributes:b.attributes}).then(()=>W({calculatedNewElementPosition:p,destinationContainerIndex:c,destinationContainerType:u,resolve:l}))}else if(u==="global"){console.log("reorder inside global container");const a=structuredClone(w),p=a.attributes.globalContainers[c].elements;if(!p||!(p!=null&&p.length))return o(new Error("elementsToChange is not available"));let C=d;C>f&&(C=C-1);const v=F({elements:p,oldIndex:f,newIndex:C});a.attributes.globalContainers[c].elements=v;const y=E.getState().updateProjectWithHistory;y(a.attributes).then(()=>W({calculatedNewElementPosition:d,destinationContainerIndex:c,destinationContainerType:u,resolve:l}))}}else{console.log("drop to new container");const a=structuredClone(w);let p=null;if(s==="global"){const v=a.attributes.globalContainers[g].elements.splice(f,1);if(v.length>0)p=v[0];else return o(new Error("cant remove element from global container"))}else a.attributes.pages.data.map(v=>{if(v.id===r){const y=v.attributes.containers;if(y){const P=y[g];if(P){const S=P.elements.splice(f,1);if(S.length>0)p=S[0];else return o(new Error("cant remove element from regular container"))}}else return o(new Error("cant remove element - no containers found"))}return v});if(u==="global"){if(p===null)return o(new Error("No removed element found"));a.attributes.globalContainers[c].elements.splice(d,0,p)}else a.attributes.pages.data.map(v=>{if(v.id===r&&p){const y=v.attributes.containers;if(y){const P=y[c];P&&P.elements.splice(d,0,p)}else return o(new Error("cant add element - no container found or element to inject"))}return v});const C=E.getState().updateProjectWithHistory;C(a.attributes).then(()=>W({calculatedNewElementPosition:d,destinationContainerIndex:c,destinationContainerType:u,resolve:l}))}}catch(g){console.error(g)}}),X=async({from:r,to:i,pageId:t})=>new Promise(function(l,o){const n=E.getState().workingProject,g=structuredClone(n==null?void 0:n.attributes.pages.data.find(c=>c.id===t));if(!g)return o(new Error("No currentPageData"));const f=g.attributes.containers;if(!(f!=null&&f.length))return o(new Error("No containers"));const s=F({elements:f,oldIndex:r.containerIndex,newIndex:i.containerIndex});j({newPageAttributes:{containers:s},pageId:t}).then(()=>{l("ok")})});function Y({staticListElementIndex:r,key:i,subKey:t,updateObj:l,element:o,containerIndex:n,elementIndex:g,isGlobalContainer:f,pageId:s}){var w,b,a;const c={...(w=L(o,r))==null?void 0:w[i]};let d,u;i==="width"?(d=c,u=t,d[u]={...d[u],...l},(b=d==null?void 0:d[u])!=null&&b.unit||(d[u]={...d[u],unit:"%"})):(d=c,u=t,d[u]={...d[u],...l},(a=d==null?void 0:d[u])!=null&&a.unit||(d[u]={...d[u],unit:"%"})),q({staticListElementIndex:r,action:"update",containerIndex:n,elementIndex:g,dataToUpdate:{[i]:d},pageId:s,isGlobal:f})}function G(r,i){let t="no_url";return i==="build"?t="."+r:t=void 0+r,t}const Z=({imageId:r,project:i,renderEnvtype:t})=>{let l="",o=null;if(i){const n=i.attributes.media.data;n&&n.length&&(o=n.find(g=>String(g.id)===String(r))||null),o&&(l=G(o.attributes.url,t))}return{url:l,mediaFile:o}},I=async({pageId:r,elementToPaste:i})=>new Promise(()=>{var c;const t=N.getState().selectedMenuSection,{containerIndex:l,elementIndex:o,isGlobalContainer:n}=t;if(l==null)throw new Error("No containerIndex");const{workingProject:g,updateProjectWithHistory:f}=E.getState();if(!g)throw new Error("No working project");let s;if(n?s=structuredClone(g.attributes.globalContainers):s=structuredClone((c=g.attributes.pages.data.find(d=>String(d.id)===r))==null?void 0:c.attributes.containers),!(s!=null&&s.length))throw new Error("No containersToModify");return o!=null?s[l].elements.splice(o+1,0,i):s[l].elements=[...s[l].elements,i],n?f({globalContainers:s}):j({pageId:r,newPageAttributes:{containers:s}})}),q=async({containerIndex:r,elementData:i,isGlobal:t,pageId:l,action:o,elementIndex:n,copiesCount:g,staticListElementIndex:f,dataToUpdate:s,ignoreModeIndex:c,updateFunction:d})=>{var p,C,v,y,P,S;const{workingProject:u,updateProjectWithHistory:w}=E.getState();if(!u)throw new Error("No working project");if(!t&&!l)throw new Error("No page id");const b=structuredClone(u.attributes);let a;if(t?a=b.globalContainers[r]:a=(C=(p=b.pages.data.find(e=>String(e.id)===l))==null?void 0:p.attributes.containers)==null?void 0:C[r],!a)throw new Error("No targetContainer");if(o==="create"){if(!i)throw new Error("Element data is empty");let e={...i};switch(e.type){case"button":e={...e,type:"button",size:"normal",iconPosition:"left",cssClass:"buttonElement",actions:[],iconName:null,text:"Button"};break;case"buttonList":e={...e,type:"buttonList",size:"normal",iconPosition:"left",cssClass:"buttonElementList",actions:[],iconName:null,text:"Button"};break;case"text":e={...e,type:"text",size:"normal",text:"Text element",cssClass:"textElement"};break;case"keypad":e={...e,type:"keypad",cssClass:"keypadElement"};break;case"slider":e={...e,type:"slider",size:"normal",cssClass:"sliderElement"};break;case"input":e={...e,type:"input",size:"normal",cssClass:"inputElement"};break;case"spacer":e={...e,type:"spacer",cssClass:"spacerElement",width:{width:{value:100,unit:"px"}},height:{height:{value:100,unit:"px"}}};break;case"switch":e={...e,type:"switch",cssClass:"switchElement",size:"normal",text:"Switch"};break;case"checkbox":e={...e,type:"checkbox",cssClass:"checkboxElement",size:"normal",text:"Checkbox"};break;case"clock":e={...e,type:"clock",cssClass:"clockWidget",width:{width:{value:200,unit:"px"}},height:{height:{value:200,unit:"px"}},isWidget:!0};break;case"dateTime":e={...e,type:"dateTime",cssClass:"dateTimeWidget",isWidget:!0};break;case"htmlblock":e={...e,type:"htmlblock",cssClass:"htmlblockWidget",width:{width:{value:200,unit:"px"}},height:{height:{value:200,unit:"px"}},isWidget:!0};break;case"toggle":e={...e,type:"toggle",cssClass:"toggleWidget",isWidget:!0};break;case"shades":e={...e,type:"shades",cssClass:"shadesWidget",isWidget:!0,headerLeftText:"Title",headerRightText:"%",shaderBackgroundBlur:3,shaderBackgroundColor:"rgba(255,255,255,0.6)"};break;case"circleSlider":e={...e,type:"circleSlider",cssClass:"circleSliderWidget",isWidget:!0,textTitle:"Title",textDescription:" Description",width:{width:{value:250,unit:"px"}}};break;case"player":e={...e,type:"player",cssClass:"playerWidget",isWidget:!0,headerTextLeft:"Player Name",headerTextCenter:"1 of 2",headerTextRight:"Next: Track Name",sourceItems:R((e==null?void 0:e.playerMaxSources)||30)};break;case"subpage":e={...e,type:"subpage",cssClass:"subpageElement"};break;case"video":e={...e,type:"video",cssClass:"videoElement"};break;case"dpad":e={...e,type:"dpad",cssClass:"dpadElement",width:{width:{value:250,unit:"px"}},height:{height:{value:250,unit:"px"}},thickness:1,cornersRaduis:20};break;case"image":e={...e,type:"image",cssClass:"imageElement",width:{width:{value:100,unit:"px"}},height:{height:{value:100,unit:"px"}}};break;default:console.log("Error creating element - no element type mathes");break}try{a.elements.push(e)}catch(h){console.error(h);return}}if(o==="delete"){if(n==null)throw new Error("No element index provided");try{a.elements.splice(n,1);const{setMainMenuData:e,selectedMenuSection:{elementIndex:h,containerIndex:k,isGlobalContainer:m}}=N.getState();n===h&&r===k&&!!m==!!t&&e({selectedMenuSection:{key:"",containerIndex:null,elementIndex:null,pageActionIndex:null,isGlobalContainer:!!t}})}catch(e){console.error(e)}}if(o==="clone"){if(g==null)throw new Error("No copies count provided");if(n==null)throw new Error("No elementIndex");try{for(let e=0;e<g;e++){let h=structuredClone(a.elements[n]);const k=h.name;h={...h,name:k+`_clone_${e}`},a.elements.push(h)}}catch(e){console.error(e)}}if(o==="update"){const e=c||(v=N.getState().selectedMenuSection)==null?void 0:v.modeIndex;if(n==null)throw new Error("No elementIndex");const h=a.elements[n];if(!h)throw new Error("No targetElement");if(!s)throw new Error("No dataToUpdate");if(f!==void 0)(y=h.staticListOverrides)!=null&&y[f]?a.elements[n].staticListOverrides[f]={...a.elements[n].staticListOverrides[f],...s}:a.elements[n].staticListOverrides={...h.staticListOverrides,[f]:s};else if(e!==void 0&&((P=h==null?void 0:h.modes)!=null&&P.length))if(d){console.log("update function!!");const k=h.modes.map((m,x)=>{var _,A,z,H,$,D;if(x===e){if(s&&s.modificatorId===void 0&&(_=m.modeProps)!=null&&_.attachedFunctions&&((z=(A=m.modeProps)==null?void 0:A.attachedFunctions)==null?void 0:z.length)>0){const M=m.modeProps.attachedFunctions.filter(O=>O.name!==s.name);return{...m,modeProps:{...m.modeProps,attachedFunctions:M}}}if(s&&s.modificatorId!==void 0)if((H=m.modeProps)!=null&&H.attachedFunctions&&((D=($=m.modeProps)==null?void 0:$.attachedFunctions)==null?void 0:D.length)>0){const M=[...m.modeProps.attachedFunctions,{...s}];return{...m,modeProps:{...m.modeProps,attachedFunctions:M}}}else return{...m,modeProps:{...m.modeProps,attachedFunctions:[s]}};return{...m,modeProps:{...m.modeProps,...s}}}return m});a.elements[n]={...h,modes:k}}else{const k=h.modes.map((m,x)=>x===e?{...m,modeProps:{...m.modeProps,...s}}:m);a.elements[n]={...h,modes:k}}else if(d)if(h!=null&&h.attachedFunctions&&((S=h==null?void 0:h.attachedFunctions)==null?void 0:S.length)>0)if(s&&s.modificatorId===void 0){const k=h.attachedFunctions.filter(m=>m.name!==s.name);a.elements[n]={...h,attachedFunctions:k}}else{const k=[...h.attachedFunctions,{...s}];a.elements[n]={...h,attachedFunctions:k}}else a.elements[n]={...h,attachedFunctions:[s]};else a.elements[n]={...h,...s}}return w(b)},U=async({action:r,containerFormData:i,containerIndex:t,pageId:l,copiesCount:o,isGlobal:n})=>{var d;const{workingProject:g,updateProjectWithHistory:f}=E.getState();if(!g)throw new Error("No working project");if(!n&&!l)throw new Error("No page id");const s=structuredClone(g.attributes);let c;if(n?c=s.globalContainers:c=(d=s.pages.data.find(u=>String(u.id)===l))==null?void 0:d.attributes.containers,!c)throw new Error("No targetContainers");if(r==="create"){const u={...T({isStatic:!1}),...i};try{c.push(u)}catch(w){console.error(w);return}}if(r==="clone"){if(t===void 0)throw new Error("No container index");try{if(!c[t])throw new Error("No containerToClone");if(o==null)throw new Error("No copies count provided");if(t==null)throw new Error("No container index provided");for(let w=0;w<o;w++){let b=structuredClone(c[t]);const a=b.name;b={...b,name:a+`_clone_${w}`},c.push(b)}}catch(u){console.error(u);return}}if(r==="update")try{if(t==null)throw new Error("No container index provided");c[t]={...c[t],...i}}catch(u){console.error(u);return}if(r==="delete"){if(t==null)throw new Error("No container index provided");if(!(c!=null&&c.length)){B.error("No containers found");return}if(c.length<2){B.error("At least one container should exist!");return}try{c.splice(t,1)}catch(u){console.error(u);return}}return f(s)},j=async({newPageAttributes:r,pageId:i})=>{const{workingProject:t,updateProjectWithHistory:l}=E.getState();if(!t)throw new Error("No working project");if(!i)throw new Error("No page id");const o=structuredClone(t.attributes);return o.pages.data.map(n=>(String(n.id)===i&&(n.attributes={...n.attributes,...r}),n)),l(o)};export{q as a,j as b,U as c,L as d,I as e,V as f,Z as g,T as i,X as l,Y as u};
