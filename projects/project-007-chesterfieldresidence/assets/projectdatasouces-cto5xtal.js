import{r as s,M as L,w as D,F as x,l as y,o as Q,k as de,C as fe,a as X,j as f}from"./index-BWO8qd00.js";import{u as pe,D as ve,b as ye,g as Ce,I as be}from"./useCustomFonts--hfI8X19.js";import{E as ge}from"./EditableCell-CnqTEXkH.js";import{d as xe,c as he,u as Ne}from"./datasourceAPI-BARHsYAW.js";import{h as Se}from"./moment-G82_0lEo.js";import{a$ as we,U as te,h as Pe,a as je,W as Ee,B as _,H as De}from"./editorApp-BQHhAWNR.js";import{T as Te}from"./tableFieldSearchInput-DW8T1Il9.js";import{R as $e}from"./DiffOutlined-4UMKY59v.js";import{T as ke}from"./index-BPRdgIWZ.js";import{P as Re}from"./index-PlVE70kS.js";import{R as Oe}from"./PictureOutlined-C1bPwfBs.js";import"./index-DQFZSvcF.js";import"./index-DI0YWsM8.js";import"./datasourceTools-CeSl9gC_.js";import"./variablesAPI-D_uU0Jyf.js";import"./___vite-browser-external_commonjs-proxy-FhmH_qOu.js";function A(a){return we.includes(a)}var Ie=function(e){var i=e.className,t=e.prefixCls,r=e.style,l=e.color,m=e.children,u=e.text,b=e.placement,g=b===void 0?"end":b,o=s.useContext(L),c=o.getPrefixCls,d=o.direction,n=c("ribbon",t),C=A(l),p=D(n,"".concat(n,"-placement-").concat(g),x(x({},"".concat(n,"-rtl"),d==="rtl"),"".concat(n,"-color-").concat(l),C),i),h={},N={};return l&&!C&&(h.background=l,N.color=l),s.createElement("div",{className:"".concat(n,"-wrapper")},m,s.createElement("div",{className:p,style:y(y({},h),r)},s.createElement("span",{className:"".concat(n,"-text")},u),s.createElement("div",{className:"".concat(n,"-corner"),style:N})))};function ee(a){var e=a.prefixCls,i=a.value,t=a.current,r=a.offset,l=r===void 0?0:r,m;return l&&(m={position:"absolute",top:"".concat(l,"00%"),left:0}),s.createElement("span",{style:m,className:D("".concat(e,"-only-unit"),{current:t})},i)}function Ae(a,e,i){for(var t=a,r=0;(t+10)%10!==e;)t+=i,r+=i;return r}function Me(a){var e=a.prefixCls,i=a.count,t=a.value,r=Number(t),l=Math.abs(i),m=s.useState(r),u=Q(m,2),b=u[0],g=u[1],o=s.useState(l),c=Q(o,2),d=c[0],n=c[1],C=function(){g(r),n(l)};s.useEffect(function(){var P=setTimeout(function(){C()},1e3);return function(){clearTimeout(P)}},[r]);var p,h;if(b===r||Number.isNaN(r)||Number.isNaN(b))p=[s.createElement(ee,y({},a,{key:r,current:!0}))],h={transition:"none"};else{p=[];for(var N=r+10,w=[],S=r;S<=N;S+=1)w.push(S);var E=w.findIndex(function(P){return P%10===b});p=w.map(function(P,O){var M=P%10;return s.createElement(ee,y({},a,{key:P,value:M,offset:O-E,current:O===E}))});var R=d<l?1:-1;h={transform:"translateY(".concat(-Ae(b,r,R),"00%)")}}return s.createElement("span",{className:"".concat(e,"-only"),style:h,onTransitionEnd:C},p)}var ze=function(a,e){var i={};for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&e.indexOf(t)<0&&(i[t]=a[t]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(a);r<t.length;r++)e.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(a,t[r])&&(i[t[r]]=a[t[r]]);return i},Be=function(e){var i=e.prefixCls,t=e.count,r=e.className,l=e.motionClassName,m=e.style,u=e.title,b=e.show,g=e.component,o=g===void 0?"sup":g,c=e.children,d=ze(e,["prefixCls","count","className","motionClassName","style","title","show","component","children"]),n=s.useContext(L),C=n.getPrefixCls,p=C("scroll-number",i),h=y(y({},d),{"data-show":b,style:m,className:D(p,r,l),title:u}),N=t;if(t&&Number(t)%1===0){var w=String(t).split("");N=w.map(function(S,E){return s.createElement(Me,{prefixCls:p,count:Number(t),value:S,key:w.length-E})})}return m&&m.borderColor&&(h.style=y(y({},m),{boxShadow:"0 0 0 1px ".concat(m.borderColor," inset")})),c?te(c,function(S){return{className:D("".concat(p,"-custom-component"),S==null?void 0:S.className,l)}}):s.createElement(o,h,N)},Ue=function(a,e){var i={};for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&e.indexOf(t)<0&&(i[t]=a[t]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(a);r<t.length;r++)e.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(a,t[r])&&(i[t[r]]=a[t[r]]);return i},re=function(e){var i=e.prefixCls,t=e.scrollNumberPrefixCls,r=e.children,l=e.status,m=e.text,u=e.color,b=e.count,g=b===void 0?null:b,o=e.overflowCount,c=o===void 0?99:o,d=e.dot,n=d===void 0?!1:d,C=e.size,p=C===void 0?"default":C,h=e.title,N=e.offset,w=e.style,S=e.className,E=e.showZero,R=E===void 0?!1:E,P=Ue(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","showZero"]),O=s.useContext(L),M=O.getPrefixCls,F=O.direction,v=M("badge",i),V=g>c?"".concat(c,"+"):g,z=V==="0"||V===0,ae=g===null||z&&!R,Y=(l!=null||u!=null)&&ae,I=n&&!z,T=I?"":V,$=s.useMemo(function(){var j=T==null||T==="";return(j||z&&!R)&&!I},[T,z,R,I]),H=s.useRef(g);$||(H.current=g);var k=H.current,W=s.useRef(T);$||(W.current=T);var Z=W.current,G=s.useRef(I);$||(G.current=I);var B=s.useMemo(function(){if(!N)return y({},w);var j={marginTop:N[1]};return F==="rtl"?j.left=parseInt(N[0],10):j.right=-parseInt(N[0],10),y(y({},j),w)},[F,N,w]),oe=h??(typeof k=="string"||typeof k=="number"?k:void 0),ne=$||!m?null:s.createElement("span",{className:"".concat(v,"-status-text")},m),se=!k||de(k)!=="object"?void 0:te(k,function(j){return{style:y(y({},B),j.style)}}),ce=D(x(x(x({},"".concat(v,"-status-dot"),Y),"".concat(v,"-status-").concat(l),!!l),"".concat(v,"-status-").concat(u),A(u))),J={};u&&!A(u)&&(J.background=u);var K=D(v,x(x(x({},"".concat(v,"-status"),Y),"".concat(v,"-not-a-wrapper"),!r),"".concat(v,"-rtl"),F==="rtl"),S);if(!r&&Y){var le=B.color;return s.createElement("span",y({},P,{className:K,style:B}),s.createElement("span",{className:ce,style:J}),m&&s.createElement("span",{style:{color:le},className:"".concat(v,"-status-text")},m))}return s.createElement("span",y({},P,{className:K}),r,s.createElement(fe,{visible:!$,motionName:"".concat(v,"-zoom"),motionAppear:!1,motionDeadline:1e3},function(j){var ie=j.className,ue=M("scroll-number",t),q=G.current,me=D(x(x(x(x(x(x({},"".concat(v,"-dot"),q),"".concat(v,"-count"),!q),"".concat(v,"-count-sm"),p==="small"),"".concat(v,"-multiple-words"),!q&&Z&&Z.toString().length>1),"".concat(v,"-status-").concat(l),!!l),"".concat(v,"-status-").concat(u),A(u))),U=y({},B);return u&&!A(u)&&(U=U||{},U.background=u),s.createElement(Be,{prefixCls:ue,show:!$,motionClassName:ie,className:me,count:Z,title:oe,style:U,key:"scrollNumber"},se)}),ne)};re.Ribbon=Ie;const{Title:Fe}=ke,at=()=>{const{projectId:a}=Pe(),e=je(o=>o.workingProject),i=pe(o=>o.dataSourceSearchString),t=s.useMemo(()=>{var o,c;return((c=(o=e==null?void 0:e.attributes)==null?void 0:o.datasources)==null?void 0:c.data)||[]},[e]),{setNewDatasourceVisible:r}=Ee(),[l,m]=s.useState(),u=s.useCallback(o=>t!=null&&t.some(c=>c.attributes.name===o)?(X.error("Datasource's name must be unique"),!1):!0,[t]);s.useEffect(()=>{function o(c,d){const n=p=>u(`${p}_clone`)?`${p}_clone`:n(`${p}_clone`);if(!t)return null;const C={name:n(d),production:t[c].attributes.production,uid:De()};a&&he(a,C)}if(a)if(t&&Array.isArray(t)){const c=[];(i?t.filter(n=>n.attributes.name.toLowerCase().includes(i.toLowerCase())):t).forEach((n,C)=>{c.push({key:`datasource_${n.id}`,order:C+1,name:n,updated:Se(n.attributes.updatedAt).format("MMM Do YYYY, h:mm a")||"",storageType:f.jsx("div",{children:f.jsx(re,{status:n.attributes.production.storageType==="none"?"error":"success",text:n.attributes.production.storageType})}),datasourcesActions:f.jsx(ve.Button,{onClick:()=>{r(n.id)},menu:{items:[{key:"copy",icon:f.jsx($e,{}),label:"Clone datasource",onClick:()=>o(C,n.attributes.name)},{key:"delete",icon:f.jsx(ye,{}),label:"Delete datasource",danger:!0,onClick:()=>Ce({title:`Delete datasource ${n.attributes.name} ?`,content:`This will remove datasource ${n.attributes.name} and all it's assignments. This action can not be undone.`,okText:"Delete datasource",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>xe(n.id),onCancel:()=>console.log("cancel datasource delete")})}]},children:"Edit"})})}),m(c)}else m([])},[a,t,r,u,i]);async function b(o,c,d){if(o===c)return c;if(!u(o))return X.error("Datasource's name must be unique"),c;if(o&&a)return Ne({name:o},d)}const g=[{title:f.jsx(Te,{searchType:"dataSourceSearchString"}),dataIndex:"name",sorter:(o,c)=>{try{const d=o.name.attributes.name.toLowerCase(),n=c.name.attributes.name.toLowerCase();if(d<n)return-1;if(d>n)return 1}catch(d){console.log(d)}return 0},defaultSortOrder:"ascend",render:o=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[o.attributes.production.isImagePreloadSource?f.jsx(Re,{placement:"topLeft",title:"Datasource for Image preloading",content:"URLs array will be used to preload & cache images",trigger:"hover",arrowPointAtCenter:!0,children:f.jsx(Oe,{})}):null,f.jsx(ge,{onChange:c=>b(c,o.attributes.name,o.id),initialValue:o.attributes.name,value:o.attributes.name})]})},{title:"Updated",dataIndex:"updated"},{title:"Source",dataIndex:"storageType"},{title:"Actions",width:"100px",dataIndex:"datasourcesActions"}];return f.jsxs(f.Fragment,{children:[f.jsx(Fe,{id:"Data sources",style:{margin:"15px 0"},level:5,children:f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsxs("span",{children:["Data sources (",(l==null?void 0:l.length)||0,")"]}),f.jsx(_,{onClick:()=>r(!0),children:"Add Datasource"})]})}),f.jsx(be,{columns:g,dataSource:l,pagination:!1}),f.jsx(_,{style:{marginTop:15},type:"primary",onClick:()=>r(!0),children:"Add Datasource"},"submit")]})};export{at as default};
