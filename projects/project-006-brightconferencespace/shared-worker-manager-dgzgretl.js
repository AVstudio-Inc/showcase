import{u as X,g as ce}from"./variablesAPI-BLoTBpai.js";import{r as A,a as H,j as ue,ab as Ee}from"./index-CR7MAnCp.js";import{f as le}from"./confirm-D0g1-wZ1.js";import{u as Y}from"./useAddNavigateToWindow-CDeW-InD.js";import{u as j,a as J,t as fe}from"./editorApp-DLWlunXz.js";import{i as de,u as pe}from"./datasourceTools-eZTvAFyf.js";import{a as Te,b as Ce,c as _e,p as Ie,d as Ne,e as he}from"./getLocalUrlFromString-DptiwCQQ.js";const ye=({initVariableArr:h})=>{const g=A.useMemo(()=>h?.length?h.filter(e=>e.joinValueSetter_signal_fb):[],[h]);A.useEffect(()=>{const e=X.getState().setInitialVariablesArray;e(h??[])},[h]);const D=A.useCallback((e,T)=>{const l=X.getState().setVariableNewValue;l({name:e,currentValue:T})},[]);A.useEffect(()=>{const e=[];if(g?.length){for(const T of g){let l;e.push({subscribe:function(){l=CrComLib.subscribeState(T.type,T.joinValueSetter_signal_fb,c=>{D(T.name,c)})},unsubscribe:function(){CrComLib.unsubscribeState(T.type,T.joinValueSetter_signal_fb,l)}})}return e.map(T=>T.subscribe()),()=>{e.map(T=>T.unsubscribe())}}},[D,g])};var U={exports:{}};U.exports;(function(h,g){var D=["getInstance","setDiagnosticIntegerSender","LOG","DISCONNECT_WS","error","href","setLogLevel","getDebuggingState","warn","BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE","Worker","SET_BASE_PATH","MSBlobBuilder","redirectTo","dispatchEvent","sendNumber","instance",`/*!
 * Copyright (C) 2020 to the present, Crestron Electronics, Inc.
 * All rights reserved.
 * No part of this software may be reproduced in any form, machine
 * or natural, without the express written consent of Crestron Electronics.
 * Use of this source code is subject to the terms of the Crestron Software License Agreement
 * under which you licensed this source code.
 * 
 * 
 */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var i,o;n.r(t),function(e){e.INITIALIZE_WS="INITIALIZE_WS",e.CONNECT_WS="CONNECT_WS",e.DISCONNECT_WS="DISCONNECT_WS",e.WEBSOCKET_EVENT="WEBSOCKET_EVENT",e.SET_BASE_PATH="SET_BASE_PATH",e.SET_JWT="SET_JWT",e.AUTHENTICATE="AUTHENTICATE",e.LOGGER_EVENT="LOGGER_EVENT",e.BRIDGE_SEND_BOOLEAN_TO_NATIVE="BRIDGE_SEND_BOOLEAN_TO_NATIVE",e.BRIDGE_SEND_INTEGER_TO_NATIVE="BRIDGE_SEND_INTEGER_TO_NATIVE",e.BRIDGE_SEND_STRING_TO_NATIVE="BRIDGE_SEND_STRING_TO_NATIVE",e.BRIDGE_SEND_OBJECT_TO_NATIVE="BRIDGE_SEND_OBJECT_TO_NATIVE",e.BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE="BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE",e.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE="BRIDGE_RECEIVE_INTEGER_FROM_NATIVE",e.BRIDGE_RECEIVE_STRING_FROM_NATIVE="BRIDGE_RECEIVE_STRING_FROM_NATIVE",e.BRIDGE_RECEIVE_OBJECT_FROM_NATIVE="BRIDGE_RECEIVE_OBJECT_FROM_NATIVE",e.CCS_DIAGNOSTICS="CCS_DIAGNOSTICS",e.LICENSE_EVENT="LICENSE_EVENT",e.VALIDATION_EVENT="VALIDATION_EVENT",e.INTERNAL_EVENT="INTERNAL_EVENT"}(i||(i={})),function(e){e.IDLE="IDLE",e.WAIT_PROGRAM_READY="WAIT_PROGRAM_READY",e.WAIT_CONNECT_RESPONSE="WAIT_CONNECT_RESPONSE",e.WAIT_AUTHENTICATE_RESPONSE="WAIT_AUTHENTICATE_RESPONSE",e.RECONNECT_AFTER_DELAY="RECONNECT_AFTER_DELAY",e.WAIT_CLEAR_ALL="WAIT_CLEAR_ALL",e.CONNECTION_REFUSED="CONNECTION_REFUSED",e.CONNECTION_FAILED="CONNECTION_FAILED",e.SSL_HANDSHAKE_FAILED="SSL_HANDSHAKE_FAILED",e.READ_FAILED="READ_FAILED",e.AUTHENTICATION_FAILED="AUTHENTICATION_FAILED",e.IN_UPDATE="IN_UPDATE",e.HEARTBEAT_EXPIRED="HEARTBEAT_EXPIRED",e.CONNECTED="CONNECTED",e.DISCONNECT_PENDING="DISCONNECT_PENDING",e.DISCONNECT_REQUESTED="DISCONNECT_REQUESTED"}(o||(o={}));var r,a=o,s=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],a=0,s=r.length;a<s;a++,o++)i[o]=r[a];return i};!function(e){e[e.LOG=0]="LOG",e[e.DEBUG=1]="DEBUG",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(r||(r={}));var c,E=function(){function e(){}return e.getLogLevel=function(){return this.logLevel},e.setLogLevel=function(e){this.logLevel=e},e.enableDebugging=function(){e.debugging=!0},e.disableDebugging=function(){e.debugging=!1},e.getDebuggingState=function(){return e.debugging},e.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!e.getDebuggingState()||this.logLevel>r.LOG||console.log.apply(console,s([e.LOGGER_KEY,(new Date).toISOString()],t))},e.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!e.getDebuggingState()||e.logLevel>r.WARN||console.warn.apply(console,s([e.LOGGER_KEY,(new Date).toISOString()],t))},e.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.getDebuggingState()&&console.error.apply(console,s([e.LOGGER_KEY,(new Date).toISOString()],t))},e.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!e.getDebuggingState()||e.logLevel>r.DEBUG||console.debug.apply(console,s([e.LOGGER_KEY,(new Date).toISOString()],t))},e.LOGGER_KEY="[WXP]",e.logLevel=r.WARN,e.debugging=!0,e}();function u(e){for(var t="",n=e.length,i=0;i<n;i++){var o=e[i].toString(16);1===o.length&&(o="0"+o),t+=o+" "}return t}function _(e){if(E.debug("Received a PROGRAM_READY packet: "+u(e)),this.cipClient.state===a.WAIT_PROGRAM_READY)switch(e[3]){case 0:E.debug("Status 0x00: Reconnecting after 15s delay"),this.cipClient.transitionTo(a.RECONNECT_AFTER_DELAY),this.cipClient.webSocketClient.disconnect("CONTROL_SYSTEM_NOT_READY"),this.cipClient.webSocketClient.connectAfterDelay(15e3);break;case 1:E.debug("Status 0x01: Waiting for another PROGRAM_READY...");break;case 2:E.debug("Status 0x02: Sending connect event"),this.cipClient.connectToCCS(),this.cipClient.transitionTo(a.WAIT_CONNECT_RESPONSE);break;default:throw new Error("Received an invalid status for PROGRAM_READY")}else E.error("Received PROGRAM_READY in an invalid state!")}!function(e){e.CONNECT_WS="CONNECT_WS",e.DISCONNECT_WS="DISCONNECT_WS",e.ERROR_WS="ERROR_WS",e.WEB_WORKER_FAILED="WEB_WORKER_FAILED",e.FETCH_TOKEN_FAILED="FETCH_TOKEN_FAILED",e.CONNECT_CIP="CONNECT_CIP",e.DISCONNECT_CIP="DISCONNECT_CIP",e.INVALID_MAC_ADDRESS="INVALID_MAC_ADDRESS",e.INVALID_CREDENTIALS="INVALID_CREDENTIALS",e.AUTHENTICATION_FAILED="AUTHENTICATION_FAILED",e.AUTHENTICATION_REQUIRED="AUTHENTICATION_REQUIRED",e.CCS_OFFLINE="CCS_OFFLINE",e.CCS_ONLINE="CCS_ONLINE",e.CCS_TRIAL_PERIOD_ON="CCS_TRIAL_PERIOD_ON",e.CCS_TRIAL_PERIOD_OFF="CCS_TRIAL_PERIOD_OFF",e.CCS_TRIAL_PERIOD_DAYS="CCS_TRIAL_PERIOD_DAYS",e.CCS_LICENSE_VALID="CCS_LICENSE_VALID",e.CCS_LICENSE_INVALID="CCS_LICENSE_INVALID",e.CCS_LICENSE_SUPPORT_ON="CCS_LICENSE_SUPPORT_ON",e.CCS_LICENSE_SUPPORT_OFF="CCS_LICENSE_SUPPORT_OFF",e.CCS_LICENSE_DAYS="CCS_LICENSE_DAYS",e.CCS_NO_LICENCE_REQ="CCS_NO_LICENCE_REQ",e.LICENSE_WS="LICENSE_WS",e.NOT_AUTHORIZED="NOT_AUTHORIZED"}(c||(c={}));var l=c;function T(e){postMessage(e)}var C,p=function(e,t,n){T({type:e,payload:{eventName:t,data:n}})},d=function(e){p(i.CCS_DIAGNOSTICS,e)};function N(e){if(E.debug("Received an AUTHENTICATE packet: "+u(e)),this.cipClient.state!==a.WAIT_AUTHENTICATE_RESPONSE)return E.error("Received an AUTHENTICATE_RESPONSE packet in an invalid state!"),void d(l.CCS_OFFLINE);var t=e[5];switch(t){case 0:E.error("CIP Authentication failed!"),this.cipClient.transitionTo(a.AUTHENTICATION_FAILED),T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.AUTHENTICATION_FAILED}}),d(l.CCS_OFFLINE);break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:E.log("Authentication succeeded. Access level is "+t),this.cipClient.transitionTo(a.WAIT_CLEAR_ALL),this.cipClient.initializeUpdateRequest(),this.cipClient.initializeHeartBeat(),d(l.CCS_ONLINE);break;default:throw d(l.CCS_OFFLINE),new Error("Invalid access level received on AUTHENTICATE_RESPONSE!")}}!function(e){e[e.DIGITAL_IO=0]="DIGITAL_IO",e[e.ANALOG_IO=1]="ANALOG_IO",e[e.COMMAND_PACKETS=3]="COMMAND_PACKETS",e[e.SYMMETRICAL_ANALOG_PACKETS=20]="SYMMETRICAL_ANALOG_PACKETS",e[e.SERIAL_IO_INDIRECT_TEXT=21]="SERIAL_IO_INDIRECT_TEXT",e[e.REPEAT_DIGITAL_IO=39]="REPEAT_DIGITAL_IO",e[e.GENERAL_RCB=30]="GENERAL_RCB",e[e.EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT=52]="EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT",e[e.UNMANGLED_INDIRECT_TEXT_SUPPORT=42]="UNMANGLED_INDIRECT_TEXT_SUPPORT",e[e.SMART_OBJECT=56]="SMART_OBJECT",e[e.EXTENDED_SMART_OBJECT=57]="EXTENDED_SMART_OBJECT",e[e.TIME_AND_DATE=8]="TIME_AND_DATE"}(C||(C={}));var I=C,h=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},f=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};function R(e){return h(this,void 0,void 0,(function(){var t,n,i;return f(this,(function(o){switch(o.label){case 0:return t=e+"config/contract.cse2j",[4,fetch(t)];case 1:n=o.sent(),o.label=2;case 2:return o.trys.push([2,5,,6]),n.ok?[4,n.json()]:[3,4];case 3:return i=o.sent(),E.debug("Contract file loaded successfully."),[2,i];case 4:return[2,Promise.reject(new Error("Contract file not found at "+t+"."))];case 5:return o.sent(),[2,Promise.reject(new Error("Contract file contains invalid JSON."))];case 6:return[2]}}))}))}var A,S=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},O=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};!function(e){e.NUMERIC="numeric",e.BOOLEAN="boolean",e.STRING="string",e.REPEAT_DIGITAL="repeatdigital"}(A||(A={}));var v={boolean:{0:{18494:"Csig.All_Control_Systems_Online_fb",18495:"Csig.Control_Systems_Offline_fb"}}},g={string:{"Csig.Browser_URL":{joinId:28601,smartObjectId:0}}},D=function(){function e(){}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.loadContractFile=function(){var e=this;this.setContractFile().catch((function(t){E.warn(t.message,"Using empty contract file."),e.contract={signals:{events:{},states:{}}}})).finally((function(){e.initialized=!0}))},e.prototype.setContractFile=function(){return S(this,void 0,void 0,(function(){var t;return O(this,(function(n){switch(n.label){case 0:return t=this,[4,R(e.basePath)];case 1:return t.contract=n.sent(),[2]}}))}))},e.prototype.mapEvent=function(e,t){var n,i;if(!this.initialized)throw new Error("Contract file not loaded!");var o=e===A.REPEAT_DIGITAL?A.BOOLEAN:e,r=(null===(n=g[o])||void 0===n?void 0:n[t])||(null===(i=this.contract.signals.events[o])||void 0===i?void 0:i[t]);if(!r){var a=parseInt(t,10);return isNaN(a)||a<0?(E.debug("Event "+t+" not found in the contract file!"),null):{joinId:a,smartObjectId:0}}return r},e.prototype.mapState=function(e,t,n){var i,o,r,a;if(void 0===t&&(t=0),!this.initialized)throw new Error("Contract file not loaded!");var s=(null===(o=null===(i=v[e])||void 0===i?void 0:i[t])||void 0===o?void 0:o[n])||(null===(a=null===(r=this.contract.signals.states[e])||void 0===r?void 0:r[t])||void 0===a?void 0:a[n]);return s||"fb"+n},e}(),b=D.getInstance(),y=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],a=0,s=r.length;a<s;a++,o++)i[o]=r[a];return i};function P(e,t){return t?(e[0]<<8)+e[1]:e[0]}function L(e,t){void 0===t&&(t=0);for(var n=P(e,!1),o=2;o<n;o+=2){var r=((127&e[o+1])<<8)+e[o]+1,a=b.mapState(A.BOOLEAN,t,r);128&e[o+1]?(E.log("0x00 - handleDigitalIO",{signalName:a,value:!1,joinId:r,smartObjectId:t}),T({type:i.BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE,payload:{signalName:a,value:!1}})):(E.log("0x00 - handleDigitalIO",{signalName:a,value:!0,joinId:r,smartObjectId:t}),T({type:i.BRIDGE_RECEIVE_BOOLEAN_FROM_NATIVE,payload:{signalName:a,value:!0}}))}}function m(e,t){void 0===t&&(t=0);var n,o,r=P(e,!1),a=!1;switch(r){case 3:n=e[3],o=e[2]+1;break;case 4:n=(e[3]<<8)+e[4],o=e[2]+1;break;case 5:n=(e[4]<<8)+e[5],o=(e[2]<<8)+e[3]+1;break;default:a=!0;for(var s=2;s<r;s+=4){n=(e[s+2]<<8)+e[s+3],o=(e[s]<<8)+e[s+1]+1;var c=b.mapState(A.NUMERIC,t,o);E.log("0x01 - handleAnalogIO",{signalName:c,value:n,joinId:o}),T({type:i.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE,payload:{signalName:c,value:n}})}}if(!a){c=b.mapState(A.NUMERIC,t,o);E.log("0x01 - handleAnalogIO",{signalName:c,value:n,joinId:o}),T({type:i.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE,payload:{signalName:c,value:n}})}}function k(e,t,n){E.log("handleStateSynchronization");var o={id:e.cipProgramIdentifier,state:t,value:n};T({type:i.BRIDGE_RECEIVE_OBJECT_FROM_NATIVE,payload:{signalName:"Csig.State_Synchronization",value:JSON.stringify(o)}})}function B(e,t){void 0===t&&(t=0);for(var n=P(e,!1),o=2;o<n;o+=4){var r=(e[o]<<8)+e[o+1]+1,a=(e[o+2]<<8)+e[o+3],s=b.mapState(A.NUMERIC,t,r);E.log("0x14 - symmetricalAnalogPackets",{signalName:s,value:a,joinId:r}),T({type:i.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE,payload:{signalName:s,value:a}})}}var U={};function G(e,t){void 0===t&&(t=0);for(var n="",o=P(e,!0),r=(e[3]<<8)+e[4]+1,a=e[5],s=b.mapState(A.STRING,t,r),c=6;c<o+2;c+=4&a?2:1){var E=void 0;E=4&a?(e[c+1]<<8)+e[c]:e[c],n+=String.fromCharCode(E)}U[s]=1&a?n:U[s]?U[s]+n:n,2&a&&T({type:i.BRIDGE_RECEIVE_STRING_FROM_NATIVE,payload:{signalName:s,value:U[s]}})}function w(e,t){void 0===t&&(t=0),E.log("0x15 - serialIOIndirecttext, handled by 0x34"),G(new Uint8Array(y([0],e)),t)}function W(e,t){void 0===t&&(t=0);for(var n=P(e,!1),o={0:"1",1:"0"},r=10*((e[2]<<24)+(e[3]<<16)+(e[4]<<8)+e[5]),a=6;a<n;a+=5){var s=(e[a]<<8)+e[a+1]+1,c=e[a+4],u=void 0;if(1&c)u=(e[a+2]<<8)+e[a+3],"1"===("0".repeat(16-u.toString(2).length)+u.toString(2))[0]&&(u=-1*(parseInt(u.toString(2).replace(/0|1/gi,(function(e){return o[e]})),2)+1));else u=(e[a+2]<<8)+e[a+3];var _=b.mapState(A.NUMERIC,t,s);E.log("0x1E - handleGeneralRCB",{signalName:_,time:r,value:u,joinId:s,flags:c}),T({type:i.BRIDGE_RECEIVE_OBJECT_FROM_NATIVE,payload:{signalName:_,value:JSON.stringify({rcb:{value:u,time:r}})}})}}var F,H={};function M(e){switch(E.debug("Received a DATA packet: "+u(e)+"."),e[6]){case I.DIGITAL_IO:L(e.slice(5));break;case I.ANALOG_IO:m(e.slice(5));break;case I.COMMAND_PACKETS:!function(e,t){switch(t[2]){case 0:E.log("START OF UPDATE"),k(e,"StartOfUpdate",{excludePrefixes:["Csig"]});break;case 22:E.log("END OF UPDATE"),k(e,"EndOfUpdate");break;case 25:case 26:case 27:break;case 28:E.log("End of join status query"),e.initializeEndOfJoinStatusResponse()}}(this.cipClient,e.slice(5));break;case I.SYMMETRICAL_ANALOG_PACKETS:B(e.slice(5));break;case I.SERIAL_IO_INDIRECT_TEXT:w(e.slice(5));break;case I.GENERAL_RCB:W(e.slice(5));break;case I.UNMANGLED_INDIRECT_TEXT_SUPPORT:!function(e){for(var t="",n=P(e,!1),o=(e[2]<<8)+e[3]+1,r=e[4],a=b.mapState(A.STRING,0,o),s=5;s<=n;s++)t+=String.fromCharCode(e[s]);E.log("0x2A - unmangledIndirectTextSupport",{signalName:a,joinId:o,flags:r,extendedUnmangledIndirectText:t}),H[a]=1&r?t:H[a]?H[a]+t:t,T({type:i.BRIDGE_RECEIVE_STRING_FROM_NATIVE,payload:{signalName:a,value:H[a]}})}(e.slice(5));break;case I.SMART_OBJECT:!function(e){E.log("0x38 - Smart Object");for(var t=e[0],n=2;n<t;){var i=(e[n]<<24)+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3],o=e[n+4],r=e[n+5],a=n+4,s=a+o+1,c=e.slice(a,s);switch(r){case I.DIGITAL_IO:L(c,i);break;case I.ANALOG_IO:m(c,i);break;case I.SYMMETRICAL_ANALOG_PACKETS:B(c,i);break;case I.SERIAL_IO_INDIRECT_TEXT:w(c,i);break;case I.GENERAL_RCB:W(c,i);break;default:E.error("0x38, unhandled packet "+u(e))}n+=o+4+1}}(e.slice(5));break;case I.TIME_AND_DATE:break;default:E.error("Unknown packet received in DATA: "+u(e))}}function V(e){E.debug("Received a DISCONNECT packet: "+u(e)),T({type:i.CCS_DIAGNOSTICS,payload:{connectionStatus:!1}}),this.cipClient.tryReconnect()}function j(e){E.debug("Received a DISCONNECT_RESPONSE packet: "+u(e));var t=e[6];this.cipClient.transitionTo(a.DISCONNECT_PENDING),this.cipClient.webSocketClient.disconnect(t.toString()),this.cipClient.tryReconnect()}function x(e){switch(E.debug("Received an EXTENDED_DATA packet: "+u(e)),e[7]){case I.EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT:G(e.slice(5));break;case I.EXTENDED_SMART_OBJECT:!function(e){E.log("0x39 - Extended Smart Object");for(var t=P(e,!0),n=3;n<t;){var i=(e[n]<<24)+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3],o=(e[n+4]<<8)+e[n+5],r=e[n+6],a=n+4,s=a+o+2,c=e.slice(a,s);switch(r){case I.EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT:G(c,i);break;default:E.error("0x39, unhandled packet "+u(e))}n+=o+6}}(e.slice(5));break;default:E.warn("Unknown packet received in EXTENDED DATA "+u(e))}}function Y(e){E.debug("Received a HEARTBEAT_RESPONSE packet: "+u(e))}!function(e){e[e.DUMMY=0]="DUMMY",e[e.CONNECT=1]="CONNECT",e[e.CONNECT_RESPONSE=2]="CONNECT_RESPONSE",e[e.DISCONNECT=3]="DISCONNECT",e[e.DISCONNECT_RESPONSE=4]="DISCONNECT_RESPONSE",e[e.DATA=5]="DATA",e[e.CONNECT_DHCP=10]="CONNECT_DHCP",e[e.AUTHENTICATE=11]="AUTHENTICATE",e[e.AUTHENTICATE_RESPONSE=12]="AUTHENTICATE_RESPONSE",e[e.HEARTBEAT=13]="HEARTBEAT",e[e.HEARTBEAT_RESPONSE=14]="HEARTBEAT_RESPONSE",e[e.PROGRAM_READY=15]="PROGRAM_READY",e[e.CRESNET_DATA=16]="CRESNET_DATA",e[e.EXTENDED_DATA=18]="EXTENDED_DATA",e[e.DEVICE_ROUTER_CONNECT=38]="DEVICE_ROUTER_CONNECT",e[e.DEVICE_ROUTER_CONNECT_RESPONSE=39]="DEVICE_ROUTER_CONNECT_RESPONSE",e[e.LICENSE_INFORMATION_RESPONSE=42]="LICENSE_INFORMATION_RESPONSE",e[e.CRPC_CONNECT=19]="CRPC_CONNECT",e[e.CRPC_DATA=20]="CRPC_DATA"}(F||(F={}));var J=F,X=64,K=1,z=64,q=128,Q=48,Z=1,$=1,ee=16,te=32,ne=64,ie=1024,oe=2048,re=4096,ae=256;var se,ce={host:location.hostname,ipId:"0x03",port:49200,roomId:"",tokenUrl:location.origin+"/cws/websocket/getWebSocketToken",tokenSource:"CSSelf",authToken:""},Ee=function(){function e(){this.setParameters()}return e.prototype.setParameters=function(e){this._url=null==e?void 0:e.url,this._ipId=function(e){var t=e;-1===t.indexOf("0x")&&(t="0x"+t);var n=parseInt(t,16);if(isNaN(n))throw new Error(e+" is not a valid number!");return n}((null==e?void 0:e.ipId)||ce.ipId),this._roomId=(null==e?void 0:e.roomId)||ce.roomId,this._tokenSource=(null==e?void 0:e.tokenSource)||ce.tokenSource,this._tokenUrl=(null==e?void 0:e.tokenUrl)||ce.tokenUrl,this._authToken=(null==e?void 0:e.authToken)||ce.authToken},e.getInstance=function(){return void 0===e._instance&&(e._instance=new e),e._instance},Object.defineProperty(e.prototype,"url",{get:function(){var e;return null===(e=this._url)||void 0===e?void 0:e.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ipId",{get:function(){return this._ipId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomId",{get:function(){return this._roomId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"jwt",{get:function(){return this._jwt},set:function(e){this._jwt=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenSource",{get:function(){return this._tokenSource},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenUrl",{get:function(){return this._tokenUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"secureToken",{get:function(){return this._authToken},enumerable:!1,configurable:!0}),e}().getInstance();!function(e){e.AUTHENTICATION_FAILED="AUTHENTICATION_FAILED"}(se||(se={}));var ue=se;function _e(e){E.debug("Received a DEVICE_ROUTER_CONNECT_RESPONSE packet: "+u(e));var t=e.length;if(this.cipClient.state===a.WAIT_CONNECT_RESPONSE){if(t<41)throw new Error("Bad packet received!");var n,o=e[5],r=e[10],s=31&o,c=a.IDLE;if(this.cipClient.virtualConnectionHandle=(e[3]<<8)+e[4],128&o)E.log("Access is allowed for "+s+" days"),c=a.WAIT_CLEAR_ALL,n=s,p(i.CCS_DIAGNOSTICS,l.CCS_TRIAL_PERIOD_DAYS,n);else switch(s){case 0:E.log("Standard connection"),c=a.WAIT_CLEAR_ALL;break;case 1:E.log("Connected with master list entry"),c=a.WAIT_CLEAR_ALL;break;case 2:var _="Connection refused! Rejected with master list entry.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 3:_="Connection refused! Connection timed out.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 4:_="Connection refused! Out of licenses.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 5:_="Connection refused! No writer access.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 6:_="Connection refused! User defined type is not licensed";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 7:E.log("Connection ok"),c=a.WAIT_CLEAR_ALL;break;case 8:break;case 9:E.log("License activation key detected"),c=a.WAIT_CLEAR_ALL;break;case 10:E.error("Connection refused! No license key."),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;case 11:_="Connection refused! IPID is already allocated";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE);break;default:_="Connection refused! Bits 4-0 of the mode byte cannot be handled.";E.error(_),c=a.CONNECTION_REFUSED,d(l.CCS_OFFLINE)}var C=1&r;if(64&o)return E.warn("Authentication is required"),void T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.AUTHENTICATION_REQUIRED}});if(C)return E.warn("Authentication failed!"),this.cipClient.transitionTo(a.AUTHENTICATION_FAILED),this.cipClient.disconnect("AUTHENTICATION_FAILED"),void T({type:i.INTERNAL_EVENT,payload:{name:ue.AUTHENTICATION_FAILED}});if(c===a.CONNECTION_REFUSED)return this.cipClient.cancelExpectedResponseTimeouts(),this.cipClient.transitionTo(c),void this.cipClient.tryReconnect();c===a.WAIT_CLEAR_ALL&&this.cipClient.resetReconnectTimeout();var N=e[6];this.cipClient.heartBeatSupported=1==(1&N),this.cipClient.isProgramReadySupported=2==(2&N),this.cipClient.isUnicodeSupported=4==(4&N),this.cipClient.extendedLengthSupported=8==(8&N);var I=48&N;16===I?this.cipClient.serialSize=ie:32===I?this.cipClient.serialSize=oe:48===I&&(this.cipClient.serialSize=re);var h=8==(8&r),f=16==(16&r);if(d(l.CCS_LICENSE_SUPPORT_ON),!h&&!f)return E.warn("Licensing is not supported!"),void d(l.CCS_LICENSE_SUPPORT_OFF);E.debug(""+JSON.stringify({supportsHeartbeat:this.cipClient.heartBeatSupported,supportsProgramReady:this.cipClient.isProgramReadySupported,supportsUnicode:this.cipClient.isUnicodeSupported,supportsExtendedLength:this.cipClient.extendedLengthSupported,serialSize:this.cipClient.serialSize})),c===a.WAIT_CLEAR_ALL&&(T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.CONNECT_CIP,eventData:{url:Ee.url,ipId:Ee.ipId,roomId:Ee.roomId,tokenSource:Ee.tokenSource,tokenUrl:Ee.tokenUrl}}}),this.cipClient.initializeUpdateRequest(),this.cipClient.initializeHeartBeat(),d(l.CCS_ONLINE)),this.cipClient.transitionTo(c)}else E.error("Received DEVICE_ROUTER_CONNECT_RESPONSE in an invalid state")}function le(e){E.debug("Received a HEARTBEAT packet: "+u(e)),this.cipClient.sendHeartBeatResponse(e.slice(5))}var Te,Ce=function(){function e(e){this.cipClient=e,this._handleAuthenticateResponse=N.bind(this),this._handleData=M.bind(this),this._handleDeviceRouterConnectResponse=_e.bind(this),this._handleDisconnect=V.bind(this),this._handleDisconnectResponse=j.bind(this),this._handleExtendedData=x.bind(this),this._handleHeartbeatResponse=Y.bind(this),this._handleHeartbeat=le.bind(this),this._handleProgramReady=_.bind(this),this._handleAuthenticateResponse=N.bind(this)}return Object.defineProperty(e.prototype,"receivedDeviceRouterConnectResponse",{get:function(){return this._receivedDeviceRouterConnectResponse},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"receivedLicenseInformationResponse",{get:function(){return this._receivedLicenseInformationResponse},enumerable:!1,configurable:!0}),e.prototype.handle=function(e){var t=e[0];switch(this.cipClient.setLastPackedReceivedAt(),t){case J.AUTHENTICATE_RESPONSE:this._handleAuthenticateResponse(e);break;case J.DATA:this._handleData(e);break;case J.DEVICE_ROUTER_CONNECT_RESPONSE:this._receivedDeviceRouterConnectResponse=!0,this._handleDeviceRouterConnectResponse(e);break;case J.DISCONNECT:this._handleDisconnect(e);break;case J.DISCONNECT_RESPONSE:this._handleDisconnectResponse(e);break;case J.EXTENDED_DATA:this._handleExtendedData(e);break;case J.HEARTBEAT_RESPONSE:this._handleHeartbeatResponse(e),this.cipClient.resetHeartBeatOutgoing();break;case J.PROGRAM_READY:this._handleProgramReady(e),2===e[3]&&this._startDeviceRouterConnectTimeout();break;case J.LICENSE_INFORMATION_RESPONSE:break;case J.HEARTBEAT:this._handleHeartbeat(e);break;case J.DUMMY:E.log("Received a dummy packet");break;default:throw new Error("Event "+(J[t]||t)+" has no handler!")}},e.prototype._startDeviceRouterConnectTimeout=function(){var e=this;this.deviceRouterConnectTimeout||(this.deviceRouterConnectTimeout=setTimeout((function(){e.cipClient.state!==a.WAIT_PROGRAM_READY?(e.receivedDeviceRouterConnectResponse||(E.error("Device router connect response not received within 16 seconds!"),d(l.CCS_LICENSE_SUPPORT_OFF)),e._receivedDeviceRouterConnectResponse=void 0):e._receivedDeviceRouterConnectResponse=void 0}),16e3))},e.prototype.cancelExpectedResponseTimeouts=function(){this.deviceRouterConnectTimeout&&(clearInterval(this.deviceRouterConnectTimeout),this.deviceRouterConnectTimeout=void 0),this.licenseInformationTimeout&&(this.licenseInformationTimeout=void 0,clearInterval(this.licenseInformationTimeout))},e}(),pe={initialState:a.IDLE,transitions:(Te={},Te[a.IDLE]=[a.WAIT_PROGRAM_READY,a.DISCONNECT_PENDING],Te[a.WAIT_PROGRAM_READY]=[a.WAIT_CONNECT_RESPONSE,a.RECONNECT_AFTER_DELAY,a.DISCONNECT_PENDING,a.WAIT_PROGRAM_READY],Te[a.RECONNECT_AFTER_DELAY]=[a.WAIT_PROGRAM_READY],Te[a.DISCONNECT_PENDING]=[a.WAIT_PROGRAM_READY],Te[a.WAIT_CONNECT_RESPONSE]=[a.WAIT_CLEAR_ALL,a.WAIT_AUTHENTICATE_RESPONSE,a.CONNECTION_REFUSED,a.WAIT_PROGRAM_READY,a.IDLE,a.AUTHENTICATION_FAILED],Te[a.WAIT_CLEAR_ALL]=[a.WAIT_PROGRAM_READY,a.DISCONNECT_PENDING],Te[a.WAIT_AUTHENTICATE_RESPONSE]=[a.AUTHENTICATION_FAILED,a.WAIT_CLEAR_ALL],Te[a.AUTHENTICATION_FAILED]=[a.WAIT_AUTHENTICATE_RESPONSE,a.WAIT_PROGRAM_READY],Te[a.CONNECTION_REFUSED]=[a.WAIT_PROGRAM_READY],Te)},de=[J.CRPC_DATA,J.CONNECT,J.CONNECT_DHCP,J.DEVICE_ROUTER_CONNECT];function Ne(e,t,n){void 0===n&&(n=0);var i=de.includes(e)?0:2,o=(t?t.length:0)+i,r=new Uint8Array(o+3),a=0;return r[a++]=e,r[a++]=o>>8,r[a++]=255&o,de.includes(e)||(r[a++]=n>>8,r[a++]=255&n),t&&r.set(t,a),E.log("Built packet:",u(r)),r}function Ie(e){for(var t=e.length,n=new Uint8Array(t),i=0,o=0;o<t;o++)n[i++]=Math.min(e.charCodeAt(o),255);return n}function he(e,t){var n=new Uint8Array(t);return n.set(Ie(e)),n}var fe=function(){function e(e){this._maxHeartBeatAttempts=3,this._internalHeartBeatInterval=1e4,this.maxIntervalBetweenPackets=29e3,this._lastPacketReceivedAt=void 0,this._heartBeatSupported=void 0,this._extendedLengthSupported=void 0,this._unicodeSupported=void 0,this._programReadySupported=void 0,this._serialSize=ae,this._heartBeatTimer=void 0,this._heartBeatOutgoing=0,this._connected=!1,this._state=pe.initialState,this._webSocketClient=e,this._cipPacketHandler=new Ce(this)}return e.prototype.cancelExpectedResponseTimeouts=function(){this._cipPacketHandler.cancelExpectedResponseTimeouts()},e.prototype.incrementHeartBeatOutgoing=function(){this._heartBeatOutgoing++},e.prototype.resetReconnectTimeout=function(){this._webSocketClient.reconnectTimeout=5e3},Object.defineProperty(e.prototype,"heartBeatTimer",{get:function(){return this._heartBeatTimer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heartBeatSupported",{get:function(){return this._heartBeatSupported},set:function(e){this._heartBeatSupported=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extendedLengthSupported",{get:function(){return this._extendedLengthSupported},set:function(e){this._extendedLengthSupported=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUnicodeSupported",{get:function(){return this._unicodeSupported},set:function(e){this._unicodeSupported=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isProgramReadySupported",{get:function(){return this._programReadySupported},set:function(e){this._programReadySupported=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialSize",{get:function(){return this._serialSize},set:function(e){this._serialSize=e},enumerable:!1,configurable:!0}),e.prototype.resetHeartBeatOutgoing=function(){this._heartBeatOutgoing=0},Object.defineProperty(e.prototype,"heartBeatOutgoing",{get:function(){return this._heartBeatOutgoing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webSocketClient",{get:function(){return this._webSocketClient},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return this._connected},set:function(e){E.debug("CIP Connection status changed to:",e),this._connected=e,this.webSocketClient.onCIPConnectionStatusChanged(e)},enumerable:!1,configurable:!0}),e.prototype.setLastPackedReceivedAt=function(){this._lastPacketReceivedAt=(new Date).getTime()},e.prototype.initializeHeartBeat=function(){var e=this.heartBeatSupported;e||void 0===this.heartBeatTimer?e&&void 0===this.heartBeatTimer&&(this._heartBeatTimer=setInterval(this.sendHeartBeat.bind(this),this._internalHeartBeatInterval)):(clearInterval(this.heartBeatTimer),this._heartBeatTimer=void 0,this._lastPacketReceivedAt=void 0)},e.prototype.initializeUpdateRequest=function(){this.sendUpdateRequest()},e.prototype.initializeEndOfJoinStatusResponse=function(){this.sendEndOfJoinStatusResponse()},e.prototype.transitionTo=function(e){var t=pe.transitions[this._state];if(!t||!t.find((function(t){return t===e})))throw new Error("Invalid transition from "+this._state+" to "+e);this._state=e},e.prototype.reset=function(){this._state=pe.initialState},e.prototype.connectToCCS=function(){this.sendDeviceRouterConnect()},e.prototype.handleCIPPacket=function(e){this._cipPacketHandler.handle(new Uint8Array(e))},Object.defineProperty(e.prototype,"virtualConnectionHandle",{get:function(){return this._virtualConnectionHandle},set:function(e){this._virtualConnectionHandle=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cipProgramIdentifier",{get:function(){return this._cipProgramIdentifier},enumerable:!1,configurable:!0}),e.prototype.authenticate=function(){var e=Ee.jwt,t="Crestron:"+Ee.tokenSource+":"+e,n=new Uint8Array(t.length);n.set(Ie(t),0);var i=Ne(J.AUTHENTICATE,n,this._virtualConnectionHandle);this.transitionTo(a.WAIT_AUTHENTICATE_RESPONSE),this.webSocketClient.sendCIPPacketWithoutBuffer(i)},e.prototype.sendDeviceRouterConnect=function(){var e=Ee.ipId,t=Ee.roomId,n=Ee.jwt,i="Crestron:"+Ee.tokenSource+":"+n,o=i.length,r=new Uint8Array(213+o),a=0;E.log("Sending DEVICE_ROUTER_CONNECT_REQUEST to",{ipId:e,roomId:t}),r[a++]=e>>8,r[a++]=255&e,r[a++]=X,r[a++]=K+q+z+Q,r[a++]=Z,r[a++]=0,r[a++]=0,r[a++]=0;var s=0+ee+te;(null==t?void 0:t.length)>0&&(s+=$),o>0&&(s+=ne),r[a++]=s,r.set([0,0,0,0,0,0],a),a+=6;r.set(he("Crestron",50),a),a+=50;r.set(he("WebXPanel",50),a),a+=50,r.set(he(t,32),a),a+=32;r.set(he("Hostname",64),a),a+=64,r[a++]=o>>8,r[a++]=255&o,o>0&&r.set(Ie(i),a),this._cipProgramIdentifier=this.webSocketClient.socket.url+":0x"+e.toString(16)+":"+t;var c=Ne(J.DEVICE_ROUTER_CONNECT,r);this.webSocketClient.sendCIPPacketWithoutBuffer(c)},e.prototype.sendHeartBeat=function(){if(!((new Date).getTime()-this._lastPacketReceivedAt<this.maxIntervalBetweenPackets))if(this.webSocketClient.connected){if(this.heartBeatOutgoing>=this._maxHeartBeatAttempts)return this.sendDisconnect(),clearInterval(this.heartBeatTimer),this._heartBeatTimer=void 0,void this.resetHeartBeatOutgoing();var e=Ne(J.HEARTBEAT,null,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(e),this.incrementHeartBeatOutgoing()}else clearInterval(this.heartBeatTimer)},e.prototype.sendHeartBeatResponse=function(e){var t=Ne(J.HEARTBEAT_RESPONSE,e,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(t)},e.prototype.sendDisconnect=function(){var e=new Uint8Array(2),t=0;e[t++]=0,e[t++]=2;var n=Ne(J.DISCONNECT,e,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(n),this.webSocketClient.closeWebSocket(!0)},e.prototype.sendEndOfJoinStatusResponse=function(){var e=new Uint8Array(3),t=0;e[t++]=2,e[t++]=3,e[t++]=29;var n=Ne(J.DATA,e,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(n),this.connected=!0},e.prototype.sendUpdateRequest=function(){var e=new Uint8Array(3),t=0;e[t++]=2,e[t++]=3,e[t++]=0;var n=Ne(J.DATA,e,this._virtualConnectionHandle);this.webSocketClient.sendCIPPacketWithoutBuffer(n)},e.prototype.tryReconnect=function(){this.webSocketClient.tryReconnect()},e.prototype.disconnect=function(e){this.webSocketClient.disconnect(e)},e.sendUpdateTemplatePacketBuilder=function(e,t,n){var i=(n?2:1)+(t?n?7:6:0)+e,o=new Uint8Array(i),r=0;return n?(o[r++]=i-2>>8&255,o[r++]=i-2&255):o[r++]=i-1,t&&(o[r++]=n?I.EXTENDED_SMART_OBJECT:I.SMART_OBJECT,o[r++]=t>>24&255,o[r++]=t>>16&255,o[r++]=t>>8&255,o[r++]=255&t,n?(o[r++]=i-9>>8&255,o[r++]=i-9&255):o[r++]=i-7&255),{packetData:o,offset:r}},e.prototype.sendUpdateString=function(t,n,i){void 0===i&&(i=0);var o=this.isUnicodeSupported?2*t.length:t.length,r=e.sendUpdateTemplatePacketBuilder(o+4,i,this.extendedLengthSupported),a=r.packetData,s=r.offset;a[s++]=this.extendedLengthSupported?I.EXTENDED_LENGTH_SERIAL_INDIRECT_TEXT:I.SERIAL_IO_INDIRECT_TEXT,a[s++]=n>>8&255,a[s++]=255&n,a[s++]=this.isUnicodeSupported?7:3;for(var c=0;c<t.length;c++)if(this.isUnicodeSupported){var E=t.codePointAt(c);a[s++]=255&E,a[s++]=E>>8&255}else a[s++]=t.charCodeAt(c);var u=Ne(this.extendedLengthSupported?J.EXTENDED_DATA:J.DATA,a,this.virtualConnectionHandle);this._webSocketClient.sendCIPPacketWithBuffer(u)},e.prototype.sendUpdateNumber=function(t,n,i){void 0===i&&(i=0);var o=e.sendUpdateTemplatePacketBuilder(5,i,!1),r=o.packetData,a=o.offset;r[a++]=I.SYMMETRICAL_ANALOG_PACKETS,r[a++]=n>>8&255,r[a++]=255&n,r[a++]=t>>8&255,r[a++]=255&t;var s=Ne(J.DATA,r,this.virtualConnectionHandle);this._webSocketClient.sendCIPPacketWithBuffer(s)},e.prototype.sendUpdateBoolean=function(t,n,i,o){void 0===i&&(i=0),void 0===o&&(o=!1);var r=e.sendUpdateTemplatePacketBuilder(3,i,!1),a=r.packetData,s=r.offset;a[s++]=o?I.REPEAT_DIGITAL_IO:I.DIGITAL_IO,!0===t?(a[s++]=255&n,a[s++]=n>>8&255):(a[s++]=255&n,a[s++]=128+(n>>8&255));var c=Ne(J.DATA,a,this.virtualConnectionHandle);this._webSocketClient.sendCIPPacketWithBuffer(c)},e}();function Re(e){var t=function e(t,n,i){if(void 0===n&&(n=0),void 0===i&&(i=1),n>i)return"Object";var o={};for(var r in t){var a=t[r];a instanceof Object&&(a=e(a,n+1,i)),o[r]=a}return n?o:JSON.stringify(o)}(e);return JSON.parse(t)}function Ae(e,t){T({type:i.WEBSOCKET_EVENT,payload:{eventName:e,eventData:Re(t)}})}var Se=function(){function e(){this._items=[],this._isProcessing=!1}return e.prototype.size=function(){return this._items.length},e.prototype.isEmpty=function(){return 0===this._items.length},e.prototype.push=function(e){this._items.push(e)},e.prototype.pop=function(){if(!this.isEmpty())return this._items.shift();this._isProcessing=!1},e.prototype.startProcessing=function(){this._isProcessing=!0},e.prototype.stopProcessing=function(e){void 0===e&&(e=!0),this._isProcessing=!1,e&&this.clear()},Object.defineProperty(e.prototype,"isProcessing",{get:function(){return this._isProcessing},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this._items=[]},e}(),Oe=function(){function e(e,t){this._isReconnecting=!1,this.url=e,this.reconnectTimeout=t||5e3,this.cipClient=new fe(this),this.cipPacketsBuffer=new Se,this.ch5EventsBuffer=new Se,this._attemptReconnect=!1}return Object.defineProperty(e.prototype,"cipClient",{get:function(){return this._cipClient},set:function(e){this._cipClient=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reconnectTimeout",{get:function(){return this._reconnectTimeout},set:function(e){this._reconnectTimeout=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cipPacketsBuffer",{get:function(){return this._cipPacketsBuffer},set:function(e){this._cipPacketsBuffer=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ch5EventsBuffer",{get:function(){return this._ch5EventsBuffer},set:function(e){this._ch5EventsBuffer=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReconnecting",{get:function(){return this._isReconnecting},set:function(e){this._isReconnecting=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},set:function(e){this._socket=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return!!this.socket&&this.socket.readyState===this.socket.OPEN},enumerable:!1,configurable:!0}),e.prototype.tryReconnect=function(){var e=this;this.isReconnecting||(E.warn("Retrying WS Connection in "+this.reconnectTimeout/1e3+" seconds ..."),this.disconnect(),setTimeout((function(){e.isReconnecting=!0,e.connect()}),this.reconnectTimeout),this.increaseReconnectTimeout())},e.prototype.connectAfterDelay=function(e){var t=this;E.warn("Reconnecting WS Connection after "+e/1e3+" seconds delay..."),setTimeout((function(){t.connect()}),e)},e.prototype.authenticate=function(){this.cipClient.authenticate()},e.prototype.connect=function(){E.debug("Trying to establish a WebSocket connection to "+this.url),this.socket&&this.disconnect(),this.socket=new WebSocket(this.url),this.socket.binaryType="arraybuffer",this.initializeListeners(),this.isReconnecting=!1},e.prototype.initializeListeners=function(){this.socket.onopen=this.onConnect.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onerror=e.onError.bind(this),this.socket.onmessage=this.onMessage.bind(this)},e.prototype.onConnect=function(e){E.log("Successfully established WebSocket connection:",e),this.cipClient.transitionTo(a.WAIT_PROGRAM_READY),Ae(l.CONNECT_WS,e)},e.prototype.onClose=function(e){E.log("WebSocket connection closed:",e),this.removeEventListeners(),Ae(l.DISCONNECT_WS,e),e.wasClean?this._attemptReconnect&&(this._attemptReconnect=!1,this.tryReconnect()):this.tryReconnect()},e.onError=function(e){E.log("WebSocket connection error:",e),Ae(l.ERROR_WS,e)},e.prototype.onMessage=function(e){this.cipClient.handleCIPPacket(e.data)},e.prototype.increaseReconnectTimeout=function(){this.reconnectTimeout=2*this.reconnectTimeout%16e4,this.reconnectTimeout=0===this.reconnectTimeout?16e4:this.reconnectTimeout},e.prototype.removeEventListeners=function(){E.debug("Removing all the event listeners..."),this.socket.onopen=function(){return{}},this.socket.onclose=function(){return{}},this.socket.onerror=function(){return{}},this.socket.onmessage=function(){return{}}},e.prototype.disconnect=function(e){E.warn("Disconnecting from WebSocket..."),this.removeEventListeners(),this.socket.close(),this.socket=void 0,T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.DISCONNECT_CIP,eventData:{reason:e}}}),T({type:i.WEBSOCKET_EVENT,payload:{eventName:l.DISCONNECT_WS}}),this.cipPacketsBuffer.stopProcessing()},e.prototype.sendCIPPacketWithBuffer=function(e){if(!this.connected||!this.cipClient.connected)return E.log("Not connected over CIP yet. Adding message to buffer..."),void this.cipPacketsBuffer.push(e);this.cipPacketsBuffer.isEmpty()?this.socket.send(e):this.cipPacketsBuffer.isProcessing?(E.log("Buffer is processing. Adding message to the end of the queue..."),this.cipPacketsBuffer.push(e)):this.startCipBufferProcessing()},e.prototype.sendCIPPacketWithoutBuffer=function(e){this.socket.send(e)},e.prototype.onCIPConnectionStatusChanged=function(e){e?this.startCipBufferProcessing():this.cipPacketsBuffer.stopProcessing()},e.prototype.sendJoinEvent=function(e,t,n){if(t){var i=t.joinId-1;switch(e){case A.BOOLEAN:this.cipClient.sendUpdateBoolean(n,i,t.smartObjectId);break;case A.NUMERIC:this.cipClient.sendUpdateNumber(n,i,t.smartObjectId);break;case A.STRING:this.cipClient.sendUpdateString(n,i,t.smartObjectId);break;case A.REPEAT_DIGITAL:this.cipClient.sendUpdateBoolean(n,i,t.smartObjectId,!0)}}},e.prototype.startCipBufferProcessing=function(){for(this.cipPacketsBuffer.startProcessing();!this.cipPacketsBuffer.isEmpty();){var e=this.cipPacketsBuffer.pop();if(!e)return;this.socket.send(e)}},e.prototype.sendEventToNative=function(e){if(b.initialized)if(this.ch5EventsBuffer.isEmpty()){var t=b.mapEvent(e.eventType,e.eventName);this.sendJoinEvent(e.eventType,t,e.value)}else this.ch5EventsBuffer.push(e),this.ch5EventsBuffer.isProcessing||this.startCh5BufferProcessing();else this.ch5EventsBuffer.push(e)},e.prototype.startCh5BufferProcessing=function(){for(this.ch5EventsBuffer.startProcessing();!this.ch5EventsBuffer.isEmpty();){var e=this.ch5EventsBuffer.pop(),t=b.mapEvent(e.eventType,e.eventName);this.sendJoinEvent(e.eventType,t,e.value)}},e.prototype.closeWebSocket=function(e){E.log("Calling close on websocket. Attempt reconnect ",e),this.socket.close(),this._attemptReconnect=e},e}();var ve,ge=function(){return(ge=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},De=self;De.onmessage=function(e){var t=e.data;switch(t.type){case i.SET_BASE_PATH:var n=t.payload;D.basePath=n.value,D.getInstance().loadContractFile();break;case i.INITIALIZE_WS:var o=t.payload;Ee.setParameters(ge(ge({},o),{url:new URL(o.url)})),be();break;case i.CONNECT_WS:ve.connect();break;case i.DISCONNECT_WS:var r=t.payload.value;ve.disconnect(r);break;case i.SET_JWT:r=t.payload.value;Ee.jwt=r;break;case i.AUTHENTICATE:ve.authenticate();break;case i.LOGGER_EVENT:var a=t.payload,s=a.enabled,c=a.logLevel;s?E.enableDebugging():E.disableDebugging(),E.setLogLevel(c);break;case i.BRIDGE_SEND_BOOLEAN_TO_NATIVE:ve.sendEventToNative({eventType:A.BOOLEAN,eventName:t.payload.signalName,value:t.payload.value}),E.debug("[WORKER] "+i.BRIDGE_SEND_BOOLEAN_TO_NATIVE,t.payload);break;case i.BRIDGE_SEND_INTEGER_TO_NATIVE:ve.sendEventToNative({eventType:A.NUMERIC,eventName:t.payload.signalName,value:t.payload.value}),E.debug("[WORKER] "+i.BRIDGE_SEND_INTEGER_TO_NATIVE,t.payload);break;case i.BRIDGE_SEND_STRING_TO_NATIVE:ve.sendEventToNative({eventType:A.STRING,eventName:t.payload.signalName,value:t.payload.value}),E.debug("[WORKER] "+i.BRIDGE_SEND_STRING_TO_NATIVE,t.payload);break;case i.BRIDGE_SEND_OBJECT_TO_NATIVE:E.debug("[WORKER] "+i.BRIDGE_SEND_OBJECT_TO_NATIVE,t.payload);var u=function(e){try{return JSON.parse(e)}catch(e){E.error(e)}return null}(t.payload.value);u.hasOwnProperty("repeatdigital")&&ve.sendEventToNative({eventType:A.REPEAT_DIGITAL,eventName:t.payload.signalName,value:u.repeatdigital});break;default:E.log("Received "+t.type+" from main thread with payload: "+t.payload)}};var be=function(){try{ve=new Oe(Ee.url)}catch(e){E.log(e,"Could not initialize WebSocket!")}};De.onerror=function(e){E.error("Worker error",e)}}]);`,"_worker","CONNECT_CIP","CCS_LICENSE_INVALID","parse","redirected","ERROR_WS","ws://","bridgeSendStringToNative","externalToInternalConfigParams","initializeWorker","return","toISOString","WebXPanel configuration object is not a valid JSON object!","CCS_DIAGNOSTICS","BRIDGE_SEND_STRING_TO_NATIVE","LOGGER_EVENT","d4412f0cafef4f213591.worker.js","binaryType","[WXP]","bridgeSendIntegerToNative","INTERNAL_EVENT","INVALID_MAC_ADDRESS","bridgeReceiveIntegerFromNative","CCS_LICENSE_VALID","Reconnecting WebXPanel after ","debug","0x03","Received ","Inline worker is not supported","bridgeReceiveStringFromNative","stringify","exports","BRIDGE_SEND_INTEGER_TO_NATIVE","exec","data","pop","processDiagnosticsMessages","wss://","numberBodyStack","BRIDGE_RECEIVE_OBJECT_FROM_NATIVE","NOT_AUTHORIZED","bridgeReceiveObjectFromNative","toStringTag","WebXPanel received configuration object:","/cws/websocket/getWebSocketToken","hasOwnProperty","DEBUG","listenTo","value","increaseReconnectTimeout","connectToWebSocketServer","_reconnectTimeout","startsWith","Your browser does not support Worker!","messageHandlers","CLOSING","object","replace","Unhandled internal event ","sendString","name","LICENSE_WS","CCS_LICENSE_SUPPORT_ON","string","WebXPanel runs in container app; All functionality is cancelled.","done","getLogLevel","addEventListener","Received authentication request from client.","bind","CCS_TRIAL_PERIOD_DAYS","postMessage","origin","WARN","push","createEvent","FETCH_TOKEN_FAILED","CCS_LICENSE_DAYS","bindWorkerListeners","prototype","Trying to dispatch an invalid event.","eventData","amd","WEB_WORKER_FAILED","tokenURL was not provided!","default","AUTHENTICATION_FAILED","WebKitBlobBuilder","iterator","BRIDGE_RECEIVE_INTEGER_FROM_NATIVE","tokenUrl","_boolBodyStack","_diagnosticStringSender","enableDebugging","URL","payload","DISCONNECT_CIP","reconnectTimeout","trys","Module","messageerror","_diagnosticIntegerSender","status","debugging","initialize","logLevel","AUTHENTICATE","call","indexOf","://","Your browser does not support binary WebSocket!","Csig.All_Control_Systems_Online_fb","forEach","CCS_LICENSE_SUPPORT_OFF","initializeWebSocketClient","switchConnectionStatus","open","Number senders may not be initialized yet","catch","processValidationEvents","toLowerCase","BRIDGE_RECEIVE_STRING_FROM_NATIVE","_numberBodyStack","function","_diagnosticBooleanSender","navigator","INITIALIZE_WS","processWebSocketMessages","includes","LOGGER_KEY","runsInContainerApp","Initializing WebXPanel with:","setDiagnosticStringSender","VALIDATION_EVENT","substr","BlobBuilder","bridgeReceiveBooleanFromNative","getJwtToken","_stringBodyStack","bridgeSendBooleanToNative","CCS_NO_LICENCE_REQ","signalName","CCS_OFFLINE","WebSocket","BRIDGE_SEND_OBJECT_TO_NATIVE","Not authorized to fetch WebSocket token. Redirected to ","log","append","CCS_TRIAL_PERIOD_OFF","onWorkerError","Crestron WebXPanel Library version 2.8.0 build date ","disableDebugging","roomId","Error receiving message from worker","[MAIN] String, [","eventName","sendBoolean","setBasePathOnWorker","Generator is already executing.","boolBodyStack","__esModule","Error on WebSocket token retrieval: ","setDiagnosticBooleanSender","url","apply","ops","switchStatus","type","Setting project basepath to ","label","publish","AUTHENTICATION_REQUIRED","Csig.Browser_URL","worker","onWorkerMessageError","false","BRIDGE_SEND_BOOLEAN_TO_NATIVE","authenticate","2.8.0","pathname"," seconds delay...","include","_connectionDiagnostic","ERROR","trim","initializeConnectionDiagnostic","host","WEBSOCKET_EVENT","updateLoggerState","connectionDiagnostic","undefined","next","authToken","hostname","SET_JWT","getBlob","getDebugging","length","slice","throw","port","userAgent","websocketToken","CCS_TRIAL_PERIOD_ON","defineProperty","send","sent","_blank","onWorkerMessage","addCommunicationMethodsToWindow","WebXPanel","then","String senders may not be initialized yet","WebXPanel runs in browser.","location","INVALID_CREDENTIALS","CONTROL_SYSTEM_OFFLINE_ENDPOINT","data:application/javascript,","dispatch","Your browser does not support WebSocket!","keys","CCS_ONLINE","assign","LICENSE_EVENT","CONNECT_WS","CONTROL_SYSTEM_ONLINE_ENDPOINT"];(function(T,l){var c=function(i){for(;--i;)T.push(T.shift())};c(++l)})(D,102);var e=function(T,l){T=T-0;var c=D[T];return c};(function(T,l){e("0xd8")=="object"?h[e("0xbf")]=l():e("0x27")=="undefined"&&(void 0)[e("0xf2")]?(void 0)([],l):e("0xd8")=="object"?g[e("0x7e")]=l():T.WebXPanel=l()})(window,function(){return function(T){var l={};function c(i){if(l[i])return l[i][e("0xbf")];var x=l[i]={i,l:!1,exports:{}};return T[i][e("0x17")](x[e("0xbf")],x,x.exports,c),x.l=!0,x.exports}return c.m=T,c.c=l,c.d=function(i,x,p){c.o(i,x)||Object[e("0x78")](i,x,{enumerable:!0,get:p})},c.r=function(i){e("0x6a")!=typeof Symbol&&Symbol[e("0xca")]&&Object[e("0x78")](i,Symbol.toStringTag,{value:e("0xf")}),Object[e("0x78")](i,e("0x4c"),{value:!0})},c.t=function(i,x){if(1&x&&(i=c(i)),8&x||4&x&&typeof i=="object"&&i&&i[e("0x4c")])return i;var p=Object.create(null);if(c.r(p),Object[e("0x78")](p,e("0x1"),{enumerable:!0,value:i}),2&x&&e("0xdf")!=typeof i)for(var E in i)c.d(p,E,function(u){return i[u]}[e("0xe5")](null,E));return p},c.n=function(i){var x=i&&i[e("0x4c")]?function(){return i[e("0x1")]}:function(){return i};return c.d(x,"a",x),x},c.o=function(i,x){return Object.prototype[e("0xcd")][e("0x17")](i,x)},c.p="",c(c.s=7)}([function(T,l,c){c.d(l,"a",function(){return i});var i,x=function(){for(var E=0,u=0,f=arguments[e("0x71")];u<f;u++)E+=arguments[u][e("0x71")];var O=Array(E),R=0;for(u=0;u<f;u++)for(var v=arguments[u],C=0,I=v[e("0x71")];C<I;C++,R++)O[R]=v[C];return O};(function(E){E[E[e("0x90")]=0]=e("0x90"),E[E[e("0xce")]=1]=e("0xce"),E[E[e("0xe9")]=2]=e("0xe9"),E[E.ERROR=3]=e("0x63")})(i||(i={}));var p=function(){function E(){}return E[e("0xe2")]=function(){return this[e("0x15")]},E[e("0x94")]=function(u){this[e("0x15")]=u},E.enableDebugging=function(){E[e("0x13")]=!0},E[e("0x43")]=function(){E[e("0x13")]=!1},E[e("0x95")]=function(){return E[e("0x13")]},E.log=function(){for(var u=[],f=0;f<arguments[e("0x71")];f++)u[f]=arguments[f];!E[e("0x95")]()||this[e("0x15")]>i[e("0x90")]||console[e("0x3e")][e("0x50")](console,x([E[e("0x2d")],new Date()[e("0xab")]()],u))},E.warn=function(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];!E.getDebuggingState()||E[e("0x15")]>i[e("0xe9")]||console[e("0x96")][e("0x50")](console,x([E[e("0x2d")],new Date()[e("0xab")]()],u))},E[e("0x92")]=function(){for(var u=[],f=0;f<arguments[e("0x71")];f++)u[f]=arguments[f];E[e("0x95")]()&&console.error[e("0x50")](console,x([E.LOGGER_KEY,new Date()[e("0xab")]()],u))},E[e("0xb9")]=function(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];!E[e("0x95")]()||E[e("0x15")]>i[e("0xce")]||console[e("0xb9")][e("0x50")](console,x([E[e("0x2d")],new Date()[e("0xab")]()],u))},E.LOGGER_KEY=e("0xb2"),E[e("0x15")]=i[e("0xe9")],E[e("0x13")]=!0,E}();l.b=p},function(T,l,c){var i;(function(x){x[e("0x8c")]="CONNECT_WS",x[e("0x91")]="DISCONNECT_WS",x.ERROR_WS="ERROR_WS",x[e("0xf3")]="WEB_WORKER_FAILED",x[e("0xec")]=e("0xec"),x[e("0xa1")]=e("0xa1"),x[e("0xc")]=e("0xc"),x[e("0xb5")]="INVALID_MAC_ADDRESS",x[e("0x83")]=e("0x83"),x[e("0x2")]=e("0x2"),x[e("0x57")]=e("0x57"),x.CCS_OFFLINE=e("0x3a"),x[e("0x89")]="CCS_ONLINE",x[e("0x77")]=e("0x77"),x[e("0x40")]="CCS_TRIAL_PERIOD_OFF",x.CCS_TRIAL_PERIOD_DAYS=e("0xe6"),x.CCS_LICENSE_VALID=e("0xb7"),x[e("0xa2")]=e("0xa2"),x[e("0xde")]="CCS_LICENSE_SUPPORT_ON",x.CCS_LICENSE_SUPPORT_OFF=e("0x1d"),x[e("0xed")]=e("0xed"),x[e("0x38")]=e("0x38"),x[e("0xdd")]=e("0xdd"),x[e("0xc8")]=e("0xc8")})(i||(i={})),l.a=i},function(T,l,c){c.d(l,"a",function(){return i});var i={host:location[e("0x6d")],ipId:e("0xba"),port:49200,roomId:"",tokenUrl:location[e("0xe8")]+e("0xcc"),tokenSource:"CSSelf",authToken:""}},function(T,l,c){T[e("0xbf")]=function(){return c(4)(e("0x9f"),c.p+e("0xb0"))}},function(T,l,c){var i=window[e("0xa")]||window.webkitURL;T[e("0xbf")]=function(x,p){try{try{var E;try{(E=new(window[e("0x33")]||window[e("0x3")]||window.MozBlobBuilder||window[e("0x9a")]))[e("0x3f")](x),E=E[e("0x6f")]()}catch{E=new Blob([x])}return new Worker(i.createObjectURL(E))}catch{return new Worker(e("0x85")+encodeURIComponent(x))}}catch{if(!p)throw Error(e("0xbc"));return new Worker(p)}}},function(T,l,c){c.r(l),c.d(l,e("0x7e"),function(){return i}),c.d(l,e("0x9"),function(){return x}),c.d(l,e("0x43"),function(){return p}),c.d(l,e("0x95"),function(){return E}),c.d(l,"getLogLevel",function(){return u}),c.d(l,e("0x94"),function(){return f});var i={initialize:function(){},addEventListener:function(){}},x=function(){},p=function(){},E=function(){},u=function(){},f=function(){};l.default=i},function(T,l,c){c.r(l),c.d(l,e("0x7e"),function(){return se}),c.d(l,e("0x9"),function(){return oe}),c.d(l,e("0x43"),function(){return ie}),c.d(l,e("0x95"),function(){return re}),c.d(l,"getLogLevel",function(){return ae}),c.d(l,e("0x94"),function(){return xe});var i,x=c(3),p=c.n(x);(function(t){t.INITIALIZE_WS=e("0x2a"),t[e("0x8c")]=e("0x8c"),t[e("0x91")]=e("0x91"),t[e("0x67")]=e("0x67"),t[e("0x99")]=e("0x99"),t[e("0x6e")]=e("0x6e"),t[e("0x16")]=e("0x16"),t.LOGGER_EVENT=e("0xaf"),t[e("0x5c")]="BRIDGE_SEND_BOOLEAN_TO_NATIVE",t[e("0xc0")]=e("0xc0"),t.BRIDGE_SEND_STRING_TO_NATIVE=e("0xae"),t[e("0x3c")]=e("0x3c"),t[e("0x97")]=e("0x97"),t.BRIDGE_RECEIVE_INTEGER_FROM_NATIVE=e("0x5"),t[e("0x25")]=e("0x25"),t[e("0xc7")]=e("0xc7"),t[e("0xad")]="CCS_DIAGNOSTICS",t.LICENSE_EVENT=e("0x8b"),t[e("0x31")]=e("0x31"),t[e("0xb4")]=e("0xb4")})(i||(i={}));var E,u=c(0),f=c(1),O=function(){return(O=Object[e("0x8a")]||function(t){for(var n,r=1,a=arguments[e("0x71")];r<a;r++)for(var o in n=arguments[r])Object[e("0xef")][e("0xcd")][e("0x17")](n,o)&&(t[o]=n[o]);return t})[e("0x50")](this,arguments)},R=function(){function t(){}return t[e("0xeb")]=function(n,r){return new CustomEvent(n,{bubbles:!0,cancelable:!1,composed:!1,detail:O({},r)})},t}(),v=function(){function t(){}return t[e("0xcf")]=function(n,r){window[e("0xe3")](n,r)},t[e("0x86")]=function(n,r){var a=R[e("0xeb")](n,r);return window[e("0x9c")](a),a},t}(),C=c(2);(function(t){t[e("0x8d")]=e("0x1b"),t[e("0x84")]="Csig.Control_Systems_Offline_fb"})(E||(E={}));var I=E,y=function(){function t(){this._boolBodyStack=[],this[e("0x26")]=[],this._stringBodyStack=[]}return t[e("0xef")][e("0x4e")]=function(n){this[e("0x28")]=n},t[e("0xef")][e("0x8f")]=function(n){this[e("0x11")]=n},t.prototype[e("0x30")]=function(n){this[e("0x8")]=n},t[e("0xef")][e("0x56")]=function(){this[e("0x48")](),this[e("0x9d")](),this.sendString()},t.prototype[e("0x1f")]=function(n){this[e("0x52")](I[e("0x8d")],n,I[e("0x84")])},Object[e("0x78")](t[e("0xef")],e("0x4b"),{get:function(){return this[e("0x7")]},enumerable:!1,configurable:!0}),Object[e("0x78")](t.prototype,e("0xc6"),{get:function(){return this[e("0x26")]},enumerable:!1,configurable:!0}),Object[e("0x78")](t[e("0xef")],"stringBodyStack",{get:function(){return this._stringBodyStack},enumerable:!1,configurable:!0}),t[e("0xef")].switchStatus=function(n,r,a){this[e("0x7")][e("0xea")]({endpoint:n,data:r}),this[e("0x7")][e("0xea")]({endpoint:a,data:!r})},t[e("0xef")][e("0x48")]=function(){try{t[e("0x79")](this[e("0x7")],this._diagnosticBooleanSender),this[e("0x7")]=[]}catch(n){u.b[e("0xb9")]("Boolean senders may not be initialized yet",n)}},t[e("0xef")][e("0x9d")]=function(){try{t[e("0x79")](this[e("0x26")],this[e("0x11")]),this._numberBodyStack=[]}catch(n){u.b[e("0xb9")](e("0x21"),n)}},t[e("0xef")][e("0xdb")]=function(){try{t[e("0x79")](this[e("0x36")],this[e("0x8")]),this._stringBodyStack=[]}catch(n){u.b.debug(e("0x80"),n)}},t[e("0x79")]=function(n,r){n[e("0x1c")](function(a){r(a.endpoint,a[e("0xc2")])})},t}();function m(t,n){CrComLib.bridgeReceiveIntegerFromNative(t,n)}function W(t,n){CrComLib.bridgeReceiveBooleanFromNative(t,n)}function G(t,n){CrComLib[e("0xbd")](t,n)}function F(){return CrComLib[e("0xb6")]!==void 0}function V(){return CrComLib[e("0x34")]!==void 0}function $(){return CrComLib[e("0xbd")]!==void 0}var M,Z=function(t,n,r,a){return new(r||(r=Promise))(function(o,_){function d(N){try{b(a[e("0x6b")](N))}catch(s){_(s)}}function S(N){try{b(a[e("0x73")](N))}catch(s){_(s)}}function b(N){var s;N.done?o(N.value):(s=N[e("0xd0")],s instanceof r?s:new r(function(L){L(s)}))[e("0x7f")](d,S)}b((a=a[e("0x50")](t,[]))[e("0x6b")]())})},q=function(t,n){var r,a,o,_,d={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return _={next:S(0),throw:S(1),return:S(2)},e("0x27")==typeof Symbol&&(_[Symbol[e("0x4")]]=function(){return this}),_;function S(b){return function(N){return function(s){if(r)throw new TypeError(e("0x4a"));for(;d;)try{if(r=1,a&&(o=2&s[0]?a[e("0xaa")]:s[0]?a[e("0x73")]||((o=a[e("0xaa")])&&o[e("0x17")](a),0):a[e("0x6b")])&&!(o=o[e("0x17")](a,s[1]))[e("0xe1")])return o;switch(a=0,o&&(s=[2&s[0],o[e("0xd0")]]),s[0]){case 0:case 1:o=s;break;case 4:return d[e("0x55")]++,{value:s[1],done:!1};case 5:d[e("0x55")]++,a=s[1],s=[0];continue;case 7:s=d[e("0x51")][e("0xc3")](),d.trys[e("0xc3")]();continue;default:if(o=d[e("0xe")],!((o=o.length>0&&o[o[e("0x71")]-1])||s[0]!==6&&s[0]!==2)){d=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){d[e("0x55")]=s[1];break}if(s[0]===6&&d.label<o[1]){d.label=o[1],o=s;break}if(o&&d[e("0x55")]<o[2]){d[e("0x55")]=o[2],d[e("0x51")][e("0xea")](s);break}o[2]&&d[e("0x51")][e("0xc3")](),d[e("0xe")][e("0xc3")]();continue}s=n[e("0x17")](t,d)}catch(L){s=[6,L],a=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([b,N])}}};function Q(t){return Z(this,void 0,void 0,function(){var n,r,a,o;return q(this,function(_){switch(_[e("0x55")]){case 0:if(!t)throw new Error(e("0x0"));return n=t[e("0x18")]("?")<0?"?":"&",r=""+t+n+"redirectTo="+encodeURIComponent(window[e("0x82")][e("0x93")]),[4,fetch(r,{credentials:e("0x61")})];case 1:if((a=_[e("0x7a")]())[e("0xa4")])return u.b[e("0x3e")]("Received redirect to:",a.url),[2,{redirectTo:a[e("0x4f")]}];_.label=2;case 2:return _[e("0xe")].push([2,4,,5]),[4,a.text()];case 3:return o=_[e("0x7a")](),[3,5];case 4:return _[e("0x7a")](),[3,5];case 5:if(!a.ok)throw{statusText:a.statusText,status:a[e("0x12")],url:a[e("0x4f")]};return[2,o]}})})}(function(t){t[e("0x2")]=e("0x2")})(M||(M={}));var ee=M,P=function(){return(P=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++)for(var o in n=arguments[r])Object.prototype[e("0xcd")][e("0x17")](n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},te=function(t,n,r,a){return new(r||(r=Promise))(function(o,_){function d(N){try{b(a.next(N))}catch(s){_(s)}}function S(N){try{b(a[e("0x73")](N))}catch(s){_(s)}}function b(N){var s;N[e("0xe1")]?o(N.value):(s=N.value,s instanceof r?s:new r(function(L){L(s)}))[e("0x7f")](d,S)}b((a=a.apply(t,[])).next())})},ne=function(t,n){var r,a,o,_,d={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return _={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(_[Symbol[e("0x4")]]=function(){return this}),_;function S(b){return function(N){return function(s){if(r)throw new TypeError(e("0x4a"));for(;d;)try{if(r=1,a&&(o=2&s[0]?a[e("0xaa")]:s[0]?a[e("0x73")]||((o=a[e("0xaa")])&&o[e("0x17")](a),0):a[e("0x6b")])&&!(o=o.call(a,s[1]))[e("0xe1")])return o;switch(a=0,o&&(s=[2&s[0],o[e("0xd0")]]),s[0]){case 0:case 1:o=s;break;case 4:return d[e("0x55")]++,{value:s[1],done:!1};case 5:d[e("0x55")]++,a=s[1],s=[0];continue;case 7:s=d[e("0x51")][e("0xc3")](),d.trys[e("0xc3")]();continue;default:if(o=d.trys,!((o=o[e("0x71")]>0&&o[o[e("0x71")]-1])||s[0]!==6&&s[0]!==2)){d=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){d[e("0x55")]=s[1];break}if(s[0]===6&&d[e("0x55")]<o[1]){d[e("0x55")]=o[1],o=s;break}if(o&&d.label<o[2]){d.label=o[2],d[e("0x51")][e("0xea")](s);break}o[2]&&d.ops[e("0xc3")](),d[e("0xe")].pop();continue}s=n[e("0x17")](t,d)}catch(L){s=[6,L],a=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([b,N])}}},k=function(){function t(){this.websocketToken="",this[e("0xd3")]=5e3,this[e("0x62")]=new y}return Object.defineProperty(t[e("0xef")],e("0xd"),{get:function(){return this[e("0xd3")]},set:function(n){this[e("0xd3")]=n},enumerable:!1,configurable:!0}),Object[e("0x78")](t[e("0xef")],e("0x59"),{get:function(){return this[e("0xa0")]},enumerable:!1,configurable:!0}),Object[e("0x78")](t.prototype,"connectionDiagnostic",{get:function(){return this[e("0x62")]},enumerable:!1,configurable:!0}),t[e("0x8e")]=function(){return t[e("0x9e")]===void 0&&(t.instance=new t),t[e("0x9e")]},t.prototype[e("0x14")]=function(n){u.b.debug(e("0xcb"),n),n.authToken&&(this[e("0x76")]=n[e("0x6c")]);var r=t[e("0xa8")](n);u.b.debug(e("0x2f"),r),this[e("0xa9")](r),this[e("0x7d")](),this[e("0x65")]()},t[e("0xa8")]=function(n){var r,a;n===void 0&&(n={});try{r=JSON[e("0xa3")](JSON.stringify(n)),a=r,Object[e("0x88")](a).forEach(function(s){a[s]!==null&&a[s]!==void 0&&a[s]!==""||delete a[s]}),(r=a)[e("0x6")]&&(r[e("0x6")]=r[e("0x6")][e("0x64")]())}catch{u.b[e("0x92")](e("0xac"))}var o=P(P({},C.a),r);if(r[e("0x6")]||(o[e("0x6")]="https://"+o[e("0x66")]+"/cws/websocket/getWebSocketToken"),!r[e("0x44")]){var _=/\/VirtualControl\/(MA\/)*Rooms\/(.*)\/XPanel\//i[e("0xc1")](window[e("0x82")][e("0x93")]);_&&_[e("0x71")]>2&&(o[e("0x44")]=_[2])}var d,S,b,N=(d=o[e("0x66")],S=o[e("0x74")],d===void 0&&(d=window[e("0x82")][e("0x6d")]),S===void 0&&(S=C.a[e("0x74")]),(b=d[e("0xd4")]("http")||d[e("0xd4")]("ws")?d:e("0xa6")+(d.includes(e("0x19"))?d[e("0x72")](d[e("0x18")](e("0x19"))+3):d))[e("0x32")](b[e("0x71")]-1)==="/"&&(b=b[e("0x72")](0,-1)),b+":"+S);return N=N[e("0xd9")](/^(http|ws)(s?):\/\//,e("0xc5")),delete o.host,delete o[e("0x74")],P(P({},o),{url:N})},t[e("0xef")][e("0x5d")]=function(){var n=this;u.b[e("0xb9")](e("0xe4")),this[e("0x35")]()[e("0x7f")](function(){n[e("0x59")][e("0xe7")]({type:i.AUTHENTICATE})})[e("0x22")](function(r){u.b[e("0x92")](e("0x4d")+r)})},t.enableDebugging=function(){u.b[e("0x9")](),t[e("0x8e")]()[e("0x59")]&&t.getInstance()[e("0x68")]()},t.disableDebugging=function(){u.b[e("0x43")](),t[e("0x8e")]()[e("0x59")]&&t[e("0x8e")]()[e("0x68")]()},t[e("0x70")]=function(){return u.b.getDebuggingState()},t[e("0xe2")]=function(){return u.b[e("0xe2")]()},t[e("0x94")]=function(n){u.b[e("0x94")](n),t[e("0x8e")]()[e("0x59")]&&t[e("0x8e")]()[e("0x68")]()},t.prototype[e("0xe3")]=function(n,r){v[e("0xcf")](n,r)},t[e("0xef")][e("0x7d")]=function(){var n=this,r={bridgeSendBooleanToNative:function(a,o){u.b.debug("[MAIN] Boolean, ["+a+": "+(o?"true":e("0x5b"))+"]"),n[e("0x59")][e("0xe7")]({type:i.BRIDGE_SEND_BOOLEAN_TO_NATIVE,payload:{value:o,signalName:a}})},bridgeSendIntegerToNative:function(a,o){u.b[e("0xb9")]("[MAIN] Numeric, ["+a+": "+o+"]"),n[e("0x59")].postMessage({type:i.BRIDGE_SEND_INTEGER_TO_NATIVE,payload:{value:o,signalName:a}})},bridgeSendStringToNative:function(a,o){u.b[e("0xb9")](e("0x46")+a+": "+o+"]"),e("0x58")!==a?n[e("0x59")].postMessage({type:i.BRIDGE_SEND_STRING_TO_NATIVE,payload:{value:o,signalName:a}}):function(_){try{var d=new URL(_);window[e("0x20")](d.toString(),e("0x7b"))}catch(S){u.b[e("0x92")](S)}}(o)},bridgeSendObjectToNative:function(a,o){u.b[e("0xb9")]("[MAIN] Object, ["+a+": "+o+"]"),n[e("0x59")][e("0xe7")]({type:i[e("0x3c")],payload:{value:o,signalName:a}})}};Object[e("0x8a")](window,{CommunicationInterface:r})},t[e("0xef")][e("0xa9")]=function(n){if(!window[e("0x98")])return v[e("0x86")](f.a[e("0xf3")]),void u.b[e("0x92")]("Worker is not supported in your browser");this[e("0x6")]=n[e("0x6")],this[e("0xa0")]=new p.a,this[e("0xee")](),this[e("0x68")](),this[e("0x49")](),this[e("0x1e")](n),this[e("0xd2")]()},t[e("0xef")][e("0x35")]=function(){return te(this,void 0,void 0,function(){var n;return ne(this,function(r){switch(r[e("0x55")]){case 0:return this[e("0x76")]!==""?[3,2]:[4,Q(this[e("0x6")])];case 1:if((n=r.sent())[e("0x9b")])throw v.dispatch(f.a[e("0xc8")],P({},n)),new Error(e("0x3d")+n[e("0x9b")]);return this[e("0x59")][e("0xe7")]({type:i[e("0x6e")],payload:{value:n}}),[3,3];case 2:this[e("0x59")][e("0xe7")]({type:i[e("0x6e")],payload:{value:this[e("0x76")]}}),r[e("0x55")]=3;case 3:return[2]}})})},t.prototype.setBasePathOnWorker=function(){var n,r;this[e("0x59")][e("0xe7")]({type:i.SET_BASE_PATH,payload:{value:(n=location[e("0x5f")].replace(/(.*)(\/(.*\.\w+)?)$/,"$1")+"/",r=""+location[e("0xe8")]+n,u.b[e("0xb9")](e("0x54")+r),r)}})},t[e("0xef")].connectToWebSocketServer=function(){var n=this;this[e("0x35")]()[e("0x7f")](function(){n[e("0x59")].postMessage({type:i[e("0x8c")]})})[e("0x22")](function(r){v.dispatch(f.a[e("0xec")],r),u.b[e("0x92")](e("0x4d")+r)})},t[e("0xef")][e("0x68")]=function(){var n={type:i[e("0xaf")],payload:{enabled:t[e("0x70")](),logLevel:t.getLogLevel()}};this[e("0x59")][e("0xe7")](n)},t[e("0xef")][e("0x1e")]=function(n){var r={type:i.INITIALIZE_WS,payload:P({},n)};this[e("0x59")][e("0xe7")](r)},t[e("0x7c")]=function(n){var r=n[e("0xc2")];t.processWorkerMessage(r)},t.processWorkerMessage=function(n){switch(n[e("0x53")]){case i[e("0x67")]:t.processWebSocketMessages(n);break;case i[e("0xad")]:t[e("0xc4")](n);break;case i[e("0x8b")]:v.dispatch(f.a.LICENSE_WS,n[e("0xb")]);break;case i[e("0x97")]:var r=n.payload;W(r[e("0x39")],r[e("0xd0")]);break;case i[e("0x5")]:var a=n[e("0xb")];m(a[e("0x39")],a[e("0xd0")]);break;case i.BRIDGE_RECEIVE_STRING_FROM_NATIVE:var o=n[e("0xb")];G(o.signalName,o[e("0xd0")]);break;case i[e("0xc7")]:var _=n.payload;(function(S,b){CrComLib[e("0xc9")](S,b)})(_.signalName,function(S){try{return JSON.parse(S)}catch(b){u.b[e("0x92")](b)}return null}(_[e("0xd0")]));break;case i.VALIDATION_EVENT:t[e("0x23")](n);break;case i[e("0xb4")]:var d=n[e("0xb")][e("0xdc")];t.handleInternalEvent(d);break;default:u.b[e("0x3e")](e("0xbb")+n[e("0x53")]+" from Worker thread with payload: "+JSON[e("0xbe")](n[e("0xb")]))}},t.handleInternalEvent=function(n){switch(n){case ee.AUTHENTICATION_FAILED:t.getInstance()[e("0xd1")](),u.b[e("0x96")](e("0xb8")+t[e("0x8e")]()[e("0xd")]/1e3+e("0x60")),setTimeout(function(){t[e("0x8e")]()[e("0xd2")]()},t.getInstance().reconnectTimeout);break;default:u.b[e("0x3e")](e("0xda")+n+"!")}},t[e("0xef")][e("0xd1")]=function(){this.reconnectTimeout=2*this[e("0xd")]>16e4?16e4:2*this[e("0xd")]},t[e("0x2b")]=function(n){var r=n[e("0xb")],a=r[e("0x47")],o=r[e("0xf1")];if(!f.a[a])throw new Error(e("0xf0"));switch(a){case f.a[e("0xa5")]:t[e("0x9e")][e("0x69")][e("0x1f")](!0);break;case f.a[e("0x91")]:t[e("0x9e")][e("0x69")].switchConnectionStatus(!1)}v[e("0x86")](a,o),t[e("0x9e")][e("0x69")].publish()},t[e("0xc4")]=function(n){switch(n.payload[e("0x47")]){case f.a.CCS_ONLINE:t[e("0x9e")][e("0x69")][e("0x1f")](!0);break;case f.a[e("0x77")]:case f.a[e("0x40")]:case f.a[e("0xe6")]:case f.a.CCS_LICENSE_DAYS:case f.a[e("0xb7")]:case f.a[e("0xa2")]:case f.a[e("0x38")]:case f.a[e("0xde")]:case f.a[e("0x1d")]:break;default:t.instance[e("0x69")][e("0x1f")](!1)}t[e("0x9e")][e("0x69")].publish()},t.processValidationEvents=function(n){var r=n.payload.eventName;r in f.a?v[e("0x86")](r):u.b[e("0x3e")](e("0xbb")+n[e("0x53")]+" from Worker thread with payload: "+JSON[e("0xbe")](n[e("0xb")]))},t[e("0x41")]=function(n){u.b[e("0x92")]("Error occurred in the worker:",n)},t[e("0x5a")]=function(n){u.b[e("0x92")](e("0x45"),n)},t[e("0xef")][e("0xee")]=function(){this[e("0x59")][e("0xe3")]("message",t[e("0x7c")][e("0xe5")](this)),this[e("0x59")][e("0xe3")]("error",t[e("0x41")].bind(this)),this[e("0x59")][e("0xe3")](e("0x10"),t[e("0x5a")].bind(this))},t[e("0xef")][e("0x65")]=function(){F&&this[e("0x69")][e("0x8f")](m),V&&this[e("0x69")].setDiagnosticBooleanSender(W),$&&this[e("0x69")][e("0x30")](G)},t}(),oe=k[e("0x9")],ie=k.disableDebugging,re=k[e("0x70")],ae=k[e("0xe2")],xe=k[e("0x94")],se=k[e("0x8e")]()},function(T,l,c){function i(){if(window[e("0x29")][e("0x75")][e("0x24")]()[e("0x2c")]("crestron"))return!0;var O=typeof JSInterface<"u"&&e("0x27")==typeof JSInterface[e("0x37")]&&e("0x27")==typeof JSInterface[e("0xb3")]&&typeof JSInterface[e("0xa7")]=="function";return e("0x6a")!=typeof webkit&&webkit[e("0xd6")]!==void 0&&webkit[e("0xd6")].bridgeSendBooleanToNative!==void 0&&webkit[e("0xd6")].bridgeSendIntegerToNative!==void 0&&webkit.messageHandlers[e("0xa7")]!==void 0||O}c.r(l),c.d(l,e("0x1"),function(){return f}),c.d(l,"getWebXPanel",function(){return f}),c.d(l,e("0x2e"),function(){return i});var x=c(0),p=c(1);function E(){(function(){if(!(e("0x98")in window))throw new Error(e("0xd5"))})(),function(){if(!(e("0x3b")in window)||window[e("0x3b")][e("0xd7")]!==2)throw new Error(e("0x87"))}(),function(){if(e("0x3b")in window&&!(e("0xb1")in WebSocket[e("0xef")]))throw new Error(e("0x1a"))}()}var u=c(2);function f(O){var R,v;E();var C=function(){return new Date(1704434735538).toISOString()[e("0x32")](0,10)||"BUILD_DATE_NOT_SET"},I=function(){return e("0x5e")};if(O){x.b[e("0x3e")](e("0x81"));var y=C();console[e("0x3e")](e("0x42")+y),R=c(6),v=!0}else x.b[e("0x3e")](e("0xe0")),R=c(5),v=!1;var m=R.enableDebugging,W=R.disableDebugging,G=R[e("0x95")],F=R[e("0xe2")],V=R[e("0x94")];return{WebXPanel:R[e("0x7e")],WebXPanelConfigParams:u.a,WebXPanelEvents:p.a,LogLevel:x.a,enableDebugging:m,disableDebugging:W,getDebuggingState:G,getLogLevel:F,setLogLevel:V,isActive:v,getVersion:I,getBuildDate:C}}}])})})(U,U.exports);var K=U.exports;const me=()=>{const h=j(C=>C.workingProject?.attributes.webXpanel),[g,D]=A.useState(h),e=A.useMemo(()=>K.getWebXPanel(!K.runsInContainerApp()),[]),{isActive:T,WebXPanel:l,WebXPanelEvents:c}=e,{xPanelStatus:i,manualStartConnect:x,updateXpanelStore:p}=Y(),E=J(C=>C.envState),u=j(C=>C.workingProject?.attributes.env),f=j(C=>C.workingProject?.attributes.selectedEnv),O=A.useMemo(()=>u?.find(I=>I.envId===f),[u,f]);A.useEffect(()=>{let C=h;if(f){const I=O?.webXpanel??{};C={...h,...I}}D(I=>!fe.isEqual(I,C)?C:I)},[h,u,f,O]),A.useEffect(()=>{const C=J.getState().envState;let I=!1;(C==="build"||C==="live")&&(I=!0),p({xPanelStatus:"disconnected",lastErrorMessage:"",manualStartConnect:I}),console.info("XPanel config changed to: ",g)},[g,p]),A.useEffect(()=>{console.info("Current Environment: ",O?.envName??"Default");const C=J.getState().envState;(C==="editor"||C==="preview")&&p({xPanelStatus:"disconnected",lastErrorMessage:"",manualStartConnect:!1})},[O,p]),A.useEffect(()=>{console.info("xPanelStatus: ",i)},[i]),A.useEffect(()=>{E==="live"&&(T?document.title=`xPanel: ${i},env: ${O?.envName??"Default"}`:document.title="xPanel no active")},[E,T,O,i]);const[R,v]=A.useState("");A.useEffect(()=>{if(!T){p({xPanelStatus:"disconnected",lastErrorMessage:"WebXPanel is not active",manualStartConnect:!1}),console.info("WebXPanel is not active");return}if(!g){p({xPanelStatus:"disconnected",lastErrorMessage:"No xPanel config provided",manualStartConnect:!1}),console.info("No xPanel config provided");return}if(x&&!R&&T){if(p({xPanelStatus:"connecting",lastErrorMessage:""}),!g?.host){p({xPanelStatus:"disconnected",lastErrorMessage:"No webXpanel connnection host provided",manualStartConnect:!1}),console.info("No webXpanel connnection host provided"),H.warning("No webXpanel connnection host provided");return}if(!g?.ipId){p({xPanelStatus:"disconnected",lastErrorMessage:"No webXpanel connnection ipId provided",manualStartConnect:!1}),console.info("No webXpanel connnection ipId provided"),H.warning("No webXpanel connnection ipId provided");return}console.info("Connection initialization...",g),l.initialize(g)}},[l,T,x,R,p,g]),A.useEffect(()=>{i!=="connecting"&&p({lastErrorMessage:""})},[p,i]),A.useEffect(()=>{l.addEventListener(c.CONNECT_CIP,({detail:C})=>{const{url:I,ipId:y,roomId:m}=C;console.info(`Connected to ${I}, 0x${y.toString(16)}, ${m}`),p({xPanelStatus:"connected",manualStartConnect:!1}),H.success(`Connected to ${I}, 0x${y.toString(16)}, ${m}`)}),l.addEventListener(c.DISCONNECT_CIP,({detail:C})=>{const{reason:I}=C;Y.getState().xPanelStatus!=="disconnected"&&(console.info(`Disconnected from CIP. Reason: ${I}`),p({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:`Disconnected from CIP. Reason: ${I}`}))}),l.addEventListener(c.ERROR_WS,()=>{p({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:"WebSocket CIP Error"}),console.warn("xPanel WebSocket Error")}),l.addEventListener(c.FETCH_TOKEN_FAILED,()=>{p({xPanelStatus:"disconnected",manualStartConnect:!1,lastErrorMessage:"WebSocket CIP FETCH_TOKEN_FAILED"}),console.info("FETCH_TOKEN_FAILED")}),l.addEventListener(c.NOT_AUTHORIZED,({detail:C})=>{const{redirectTo:I}=C;console.log(`Received a redirect to: ${I}`),console.info("Crestron auth needed"),v(I),p({manualStartConnect:!1})})},[l,c.CONNECT_CIP,c.DISCONNECT_CIP,c.ERROR_WS,c.FETCH_TOKEN_FAILED,c.NOT_AUTHORIZED,p]),A.useEffect(()=>{R&&le({icon:ue.jsx(Ee,{}),title:"Auth on Crestron Proccessor",content:"In order to continue connecting to Crestron Proccessor you will be redirected to auth page.",okText:"Proceed",cancelText:"Cancel",onOk:()=>{window.location.href=R},onCancel:()=>{console.info("Auth process aborted."),v(""),p({xPanelStatus:"disconnected",manualStartConnect:!1})}})},[R,p])},Pe=()=>{A.useEffect(()=>{const{setVariableNewValue:h}=X.getState(),{addValueToStore:g,getValueFromStore:D}=de.getState(),e=({uid:x})=>{const p=pe.getState().current;return x?p?.filter(E=>E.uid===x)?.[0]?.value:p},T=({name:x})=>{const p=ce(x),{currentValue:E,defaultValue:u}=p??{};return E===void 0?u:E},l=({name:x,value:p})=>{h({name:x,currentValue:p})},c=({name:x,type:p,joinNumber:E,value:u,scope:f})=>{g({name:x,type:p,joinNumber:E,value:u,scope:f})},i=({name:x,type:p,scope:E})=>D(x,p,E);window.avgatorStudio={navigate:()=>{console.log("navigate isn't ready yet")},navigateToPage:x=>{console.log("navigate to page isn't ready yet, ",x)},publishAnalog:he,publishDigital:Ne,publishSerial:Ie,getInstantDigitalFb:_e,getInstantAnalogFb:Ce,getInstantSerialFb:Te,getDatasource:e,getVariableByName:T,setStoreValue:c,getStoreValue:i,setVariableByName:l}},[])};function Se(h){return new SharedWorker(""+new URL("shared-worker-C8tr1mIH.js",import.meta.url).href,{type:"module",name:h?.name})}let w=null,B=[];function z(){return w||(w=new Se),w}function Le(h){B.push(h);const g=z();g.port.onmessage=D=>{const e=B;for(const T of e)T(D.data)}}function ke(h){B=B.filter(g=>g!==h),B.length===0&&w&&(w.port.onmessage=null)}function we(h){z().port.postMessage(h)}export{Le as a,ye as b,me as c,we as p,ke as r,Pe as u};
