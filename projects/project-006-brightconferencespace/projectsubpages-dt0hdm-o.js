import{r as f,j as e,a as D}from"./index-CR7MAnCp.js";import{a as E,h,P as N,u as L}from"./pageAPI-DIRfwgbE.js";import{d as A}from"./deletePage-CGkEdTDr.js";import{E as B}from"./EditableCell-DPZgJ8kP.js";import{c as M,u as R,f as V,J as F,v as z,B as g}from"./editorApp-DLWlunXz.js";import{T as O}from"./tableFieldSearchInput-DHhK29EX.js";import{a as x}from"./dayjs.min-Bxhb2nNt.js";import{j as y,D as U,a as W}from"./confirm-D0g1-wZ1.js";import{R as Y}from"./DiffOutlined-Jx6x4lKT.js";import{T as P}from"./index-CGbxNHJV.js";import{T as _}from"./index-DZHBlNgy.js";import"./localActiveAPI-BcvpvDpS.js";import"./___vite-browser-external_commonjs-proxy-BMVqCDge.js";import"./index-hYgSyGbc.js";const{Title:$}=_,le=()=>{const p=M(),d=R(a=>a.workingProject),{projectId:l}=V(),[m,w]=f.useState(),C=[{title:e.jsx(O,{value:m,setValue:w}),dataIndex:"name",sorter:(a,u)=>{const o=a.name.props.initialValue.toLowerCase(),n=u.name.props.initialValue.toLowerCase();return o<n?-1:o>n?1:0},defaultSortOrder:"ascend"},{title:e.jsx(e.Fragment,{children:"Design paradigm"}),dataIndex:"layoutMode"},{title:"Updated",dataIndex:"updated",sorter:(a,u)=>{const o=x(a.updated),n=x(u.updated);return o.isBefore(n)?-1:o.isAfter(n)?1:0},render:a=>e.jsx(e.Fragment,{children:x(a).format("MMM D, YYYY, h:mm A")})},y.EXPAND_COLUMN,{title:"Where Used",dataIndex:"used"},{title:"Actions",dataIndex:"actions",width:100}],{setNewPageModalVisible:S}=F(),[j,v]=f.useState(null);f.useEffect(()=>{let a=d?.attributes.pages.data?.filter(r=>r.attributes.isSubpage)||[];const u=d?.attributes.pages.data?.filter(r=>!r.attributes.isSubpage)||[];function o(r){const t=[];return[...u||[]].forEach((i,b)=>{i.attributes.containers?.forEach((k,T)=>{k.elements.filter(c=>c.type==="subpage").some(c=>c.subpageId===r)&&t.push(e.jsx(g,{onClick:c=>h({pageId:i.id,navigate:p,evt:c,projectId:l}),type:"dashed",size:"small",children:i.attributes.name},i.id+"_source_"+b+T))})}),t}function n(r){return!!a.find(s=>s.id===r)?.attributes.containers?.some(s=>s.elements.some(i=>i.type==="subpage"||i.type==="subpageList"))}if(a){m&&(a=a.filter(t=>{const s=t.attributes.name;if(!s)return!1;const i=s.trim().toLowerCase(),b=m.trim().toLowerCase();return i.includes(b)}));const r=[];for(const t of a)r.push({pageID:t.id,key:`subpage_${t.id}`,name:e.jsx(B,{style:{whiteSpace:"nowrap"},onChange:s=>s&&l&&L({pageId:t.id,inputData:{name:s}}),initialValue:t.attributes.name,value:t.attributes.name,validators:[s=>z({input:s,searchArray:a||[],searchKey:["attributes","name"]}).catch(i=>(D.error(i.message),Promise.reject()))]}),layoutMode:e.jsx(P,{icon:e.jsx(N,{style:{height:"auto",minWidth:"1em",margin:"0 3px -1px 0"},isStatic:t.attributes?.isStatic}),children:t.attributes?.isStatic?"adaptive":"responsive"}),updated:t.attributes.updatedAt,used:e.jsx("div",{style:{display:"flex",gap:5,flexWrap:"wrap"},children:o(t.id)}),nestedSubs:n(t.id),actions:e.jsxs(U.Button,{onClick:s=>h({pageId:t.id,navigate:p,evt:s,projectId:l}),menu:{items:[{key:"clonePage",icon:e.jsx(Y,{}),label:"Clone SubPage",onClick:()=>l&&E({pageCloneData:t})},{key:"remove",danger:!0,icon:e.jsx(W,{}),label:"Delete SubPage",onClick:()=>l&&A({pageId:t.id,projectId:l,isSubpage:t.attributes.isSubpage,name:t.attributes.name})}]},children:[e.jsx("svg",{style:{marginRight:3,marginBottom:-2},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M6 2c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-1.9l10-10V8l-6-6zm7 1.5L18.5 9H13zm7.1 9.5c-.1 0-.3.1-.4.2l-1 1l2.1 2.1l1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-2 1.8L12 20.9V23h2.1l6.1-6.1z"})}),"Open in Editor"]})});v(r)}},[p,l,m,d]);function I(a){const u=d?.attributes.pages.data.find(n=>n.id===a);if(!u)return null;const o=[];for(const n of u.attributes.containers||[])for(const r of n.elements)(r.type==="subpage"||r.type==="subpageList")&&o.push(r.subpageId);return e.jsx("div",{style:{display:"flex",gap:5,marginTop:10,flexWrap:"wrap"},children:o.map(n=>{const r=d?.attributes.pages.data.find(s=>s.id===n)?.attributes.name,t=!r;return e.jsx(g,{onClick:s=>!t&&h({pageId:n,navigate:p,evt:s,projectId:l}),type:"dashed",size:"small",danger:t,children:r||"Deleted"},n)})})}return e.jsxs(e.Fragment,{children:[e.jsx($,{id:"SubPages",style:{margin:"15px 0"},level:5,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["SubPages",e.jsx(g,{onClick:()=>S("subpage"),children:"Create New SubPage"})]})}),j?e.jsxs(e.Fragment,{children:[e.jsx(y,{expandable:{expandedRowRender:a=>e.jsxs(e.Fragment,{children:[e.jsx(P,{color:"geekblue",children:"1st level nested subpages"}),I(a.pageID)]}),rowExpandable:a=>a.nestedSubs},showSorterTooltip:!1,columns:C,dataSource:j,pagination:!1}),e.jsx(g,{style:{marginTop:15},type:"primary",onClick:()=>S("subpage"),children:"Create New SubPage"})]}):null]})};export{le as default};
