import{r as f,u as c,y as d}from"./editorApp-DZMui-50.js";import{r as V,a as m}from"./index-CaqiBWD3.js";import{b}from"./localActiveAPI-BM1IHP6l.js";function g(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[a,n]of t)if(!Object.is(n,e.get(a)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const a of t)if(!e.has(a))return!1;return!0}const r=Object.keys(t);if(r.length!==Object.keys(e).length)return!1;for(const a of r)if(!Object.prototype.hasOwnProperty.call(e,a)||!Object.is(t[a],e[a]))return!1;return!0}const o=f((t,e)=>({calculatedVariables:void 0,setInitialVariablesArray:r=>{const a={};for(const n of r)a[n.name]=n;t(()=>({calculatedVariables:a}))},setVariableNewValue:({name:r,currentValue:a})=>{if(!r||a===void 0){console.log("update error, no name or value provided");return}const n=e().calculatedVariables?.[r];if(!n){console.log("VariableToUpdate not found, update error");return}const s={...n};return s.type==="boolean"&&typeof a=="string"?a==="true"?s.currentValue=!0:a==="false"?s.currentValue=!1:a==="toggle"?s.currentValue=!s.currentValue:s.currentValue=!!a:s.currentValue=a,t(l=>({calculatedVariables:{...l.calculatedVariables,[r]:s}}))}}),(t,e)=>g(t,e)),k=({varNamesToSubscribe:t})=>{const e=o(a=>{if(!t||t.length===0||a.calculatedVariables===void 0)return null;if(t==="*")return a.calculatedVariables;const n={};for(const s of t)n[s]=a.calculatedVariables?.[s];return n});return V.useMemo(()=>e?Object.values(e):[],[e])};async function O({actionType:t,projectId:e,pageId:r,variableData:a}){return new Promise(function(n,s){if(!e){s("No projectId");return}let l=[];if(e&&r){const u=c.getState().workingProject?.attributes.pages.data.find(i=>i.id===r)?.attributes.parameters;l=structuredClone(u??[])}else{const u=c.getState().workingProject?.attributes.variables;l=structuredClone(u??[])}if(t==="update"){const u=l?.findIndex(i=>i.name===a.name);if(u<0)return s("No var found by index"),null;l[u]=a}else if(t==="delete")l=l.filter(u=>u.name!==a.name);else if(t==="create"){if(l.some(i=>i.name===a.name))return s("Name must be unique"),null;l.push(a)}if(e&&r)b({pageId:r,newPageAttributes:{parameters:l}}).then(()=>n("Ok"));else return d({projectId:e,inputData:{variables:l}}).then(()=>n("Ok")).catch(u=>(u.response.data?.error?.name==="ValidationError"&&m.error("Name must be unique"),s(u)))})}function v(t){return c.getState().workingProject?.attributes.variables?.find(a=>a.name===t)}function P(t){const e=o.getState().calculatedVariables;if(e)return e?.[t]}function w(t){const e=o(s=>s.calculatedVariables?.[t]);if(!e)return;const{currentValue:r,defaultValue:a}=e;return{calculatedValue:r===void 0||r===""?a:r,targetVariable:e}}export{k as a,w as b,O as c,v as d,P as g,g as s,o as u};
