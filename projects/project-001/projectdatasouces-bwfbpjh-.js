import{r as o,L as q,v as D,E as g,l as b,o as Q,k as de,C as fe,a as X,j as f}from"./index-CaqiBWD3.js";import{D as pe,f as ve,a as ye,j as Ce}from"./confirm-Bux8TUvH.js";import{E as be}from"./EditableCell-BYILAC5w.js";import{v as xe,h as ge,e as he}from"./datasourceTools-BSEF0Knj.js";import{h as Ne}from"./moment-G82_0lEo.js";import{aW as Se,am as te,f as we,u as Pe,J as je,B as _,x as Ee}from"./editorApp-DZMui-50.js";import{T as De}from"./tableFieldSearchInput-CUkkEkpG.js";import{R as ke}from"./DiffOutlined-CoQG7-xX.js";import{T as Te}from"./index-9gNDCDRB.js";import{P as $e}from"./index-DwV6AUp4.js";import{R as Re}from"./PictureOutlined-Bufe_Ges.js";import"./index-BzblAUWm.js";import"./index-vWj0pZVz.js";import"./variablesAPI-C9KILpk_.js";import"./localActiveAPI-BM1IHP6l.js";import"./___vite-browser-external_commonjs-proxy-BovDvJPF.js";function A(a){return Se.includes(a)}var Oe=function(e){var l=e.className,r=e.prefixCls,t=e.style,c=e.color,d=e.children,m=e.text,y=e.placement,x=y===void 0?"end":y,N=o.useContext(q),n=N.getPrefixCls,i=N.direction,u=n("ribbon",r),s=A(c),p=D(u,"".concat(u,"-placement-").concat(x),g(g({},"".concat(u,"-rtl"),i==="rtl"),"".concat(u,"-color-").concat(c),s),l),v={},h={};return c&&!s&&(v.background=c,h.color=c),o.createElement("div",{className:"".concat(u,"-wrapper")},d,o.createElement("div",{className:p,style:b(b({},v),t)},o.createElement("span",{className:"".concat(u,"-text")},m),o.createElement("div",{className:"".concat(u,"-corner"),style:h})))};function ee(a){var e=a.prefixCls,l=a.value,r=a.current,t=a.offset,c=t===void 0?0:t,d;return c&&(d={position:"absolute",top:"".concat(c,"00%"),left:0}),o.createElement("span",{style:d,className:D("".concat(e,"-only-unit"),{current:r})},l)}function Ie(a,e,l){for(var r=a,t=0;(r+10)%10!==e;)r+=l,t+=l;return t}function Ae(a){var e=a.prefixCls,l=a.count,r=a.value,t=Number(r),c=Math.abs(l),d=o.useState(t),m=Q(d,2),y=m[0],x=m[1],N=o.useState(c),n=Q(N,2),i=n[0],u=n[1],s=function(){x(t),u(c)};o.useEffect(function(){var P=setTimeout(function(){s()},1e3);return function(){clearTimeout(P)}},[t]);var p,v;if(y===t||Number.isNaN(t)||Number.isNaN(y))p=[o.createElement(ee,b({},a,{key:t,current:!0}))],v={transition:"none"};else{p=[];for(var h=t+10,w=[],S=t;S<=h;S+=1)w.push(S);var E=w.findIndex(function(P){return P%10===y});p=w.map(function(P,O){var z=P%10;return o.createElement(ee,b({},a,{key:P,value:z,offset:O-E,current:O===E}))});var R=i<c?1:-1;v={transform:"translateY(".concat(-Ie(y,t,R),"00%)")}}return o.createElement("span",{className:"".concat(e,"-only"),style:v,onTransitionEnd:s},p)}var ze=function(a,e){var l={};for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&e.indexOf(r)<0&&(l[r]=a[r]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,r=Object.getOwnPropertySymbols(a);t<r.length;t++)e.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(a,r[t])&&(l[r[t]]=a[r[t]]);return l},Me=function(e){var l=e.prefixCls,r=e.count,t=e.className,c=e.motionClassName,d=e.style,m=e.title,y=e.show,x=e.component,N=x===void 0?"sup":x,n=e.children,i=ze(e,["prefixCls","count","className","motionClassName","style","title","show","component","children"]),u=o.useContext(q),s=u.getPrefixCls,p=s("scroll-number",l),v=b(b({},i),{"data-show":y,style:d,className:D(p,t,c),title:m}),h=r;if(r&&Number(r)%1===0){var w=String(r).split("");h=w.map(function(S,E){return o.createElement(Ae,{prefixCls:p,count:Number(r),value:S,key:w.length-E})})}return d&&d.borderColor&&(v.style=b(b({},d),{boxShadow:"0 0 0 1px ".concat(d.borderColor," inset")})),n?te(n,function(S){return{className:D("".concat(p,"-custom-component"),S?.className,c)}}):o.createElement(N,v,h)},Be=function(a,e){var l={};for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&e.indexOf(r)<0&&(l[r]=a[r]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,r=Object.getOwnPropertySymbols(a);t<r.length;t++)e.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(a,r[t])&&(l[r[t]]=a[r[t]]);return l},re=function(e){var l=e.prefixCls,r=e.scrollNumberPrefixCls,t=e.children,c=e.status,d=e.text,m=e.color,y=e.count,x=y===void 0?null:y,N=e.overflowCount,n=N===void 0?99:N,i=e.dot,u=i===void 0?!1:i,s=e.size,p=s===void 0?"default":s,v=e.title,h=e.offset,w=e.style,S=e.className,E=e.showZero,R=E===void 0?!1:E,P=Be(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","showZero"]),O=o.useContext(q),z=O.getPrefixCls,U=O.direction,C=z("badge",l),Y=x>n?"".concat(n,"+"):x,M=Y==="0"||Y===0,ae=x===null||M&&!R,Z=(c!=null||m!=null)&&ae,I=u&&!M,k=I?"":Y,T=o.useMemo(function(){var j=k==null||k==="";return(j||M&&!R)&&!I},[k,M,R,I]),W=o.useRef(x);T||(W.current=x);var $=W.current,H=o.useRef(k);T||(H.current=k);var F=H.current,J=o.useRef(I);T||(J.current=I);var B=o.useMemo(function(){if(!h)return b({},w);var j={marginTop:h[1]};return U==="rtl"?j.left=parseInt(h[0],10):j.right=-parseInt(h[0],10),b(b({},j),w)},[U,h,w]),oe=v??(typeof $=="string"||typeof $=="number"?$:void 0),ne=T||!d?null:o.createElement("span",{className:"".concat(C,"-status-text")},d),se=!$||de($)!=="object"?void 0:te($,function(j){return{style:b(b({},B),j.style)}}),ce=D(g(g(g({},"".concat(C,"-status-dot"),Z),"".concat(C,"-status-").concat(c),!!c),"".concat(C,"-status-").concat(m),A(m))),G={};m&&!A(m)&&(G.background=m);var K=D(C,g(g(g({},"".concat(C,"-status"),Z),"".concat(C,"-not-a-wrapper"),!t),"".concat(C,"-rtl"),U==="rtl"),S);if(!t&&Z){var le=B.color;return o.createElement("span",b({},P,{className:K,style:B}),o.createElement("span",{className:ce,style:G}),d&&o.createElement("span",{style:{color:le},className:"".concat(C,"-status-text")},d))}return o.createElement("span",b({},P,{className:K}),t,o.createElement(fe,{visible:!T,motionName:"".concat(C,"-zoom"),motionAppear:!1,motionDeadline:1e3},function(j){var ie=j.className,ue=z("scroll-number",r),L=J.current,me=D(g(g(g(g(g(g({},"".concat(C,"-dot"),L),"".concat(C,"-count"),!L),"".concat(C,"-count-sm"),p==="small"),"".concat(C,"-multiple-words"),!L&&F&&F.toString().length>1),"".concat(C,"-status-").concat(c),!!c),"".concat(C,"-status-").concat(m),A(m))),V=b({},B);return m&&!A(m)&&(V=V||{},V.background=m),o.createElement(Me,{prefixCls:ue,show:!T,motionClassName:ie,className:me,count:F,title:oe,style:V,key:"scrollNumber"},se)}),ne)};re.Ribbon=Oe;const{Title:Ve}=Te,rt=()=>{const{projectId:a}=we(),e=Pe(n=>n.workingProject),[l,r]=o.useState(),t=o.useMemo(()=>e?.attributes?.datasources?.data||[],[e]),{setNewDatasourceVisible:c}=je(),[d,m]=o.useState(),y=o.useCallback(n=>t?.some(i=>i.attributes.name===n)?(X.error("Datasource's name must be unique"),!1):!0,[t]);o.useEffect(()=>{function n(i,u){const s=v=>y(`${v}_clone`)?`${v}_clone`:s(`${v}_clone`);if(!t)return null;const p={name:s(u),production:t[i].attributes.production,uid:Ee()};a&&ge(a,p)}if(a)if(t&&Array.isArray(t)){const i=[];(l?t.filter(s=>s.attributes.name.toLowerCase().includes(l.toLowerCase())):t).forEach((s,p)=>{i.push({key:`datasource_${s.id}`,order:p+1,name:s,updated:Ne(s.attributes.updatedAt).format("MMM Do YYYY, h:mm a")||"",storageType:f.jsx("div",{children:f.jsx(re,{status:s.attributes.production.storageType==="none"?"error":"success",text:s.attributes.production.storageType})}),datasourcesActions:f.jsx(pe.Button,{onClick:()=>{c(s.id)},menu:{items:[{key:"copy",icon:f.jsx(ke,{}),label:"Clone datasource",onClick:()=>n(p,s.attributes.name)},{key:"delete",icon:f.jsx(ye,{}),label:"Delete datasource",danger:!0,onClick:()=>ve({title:`Delete datasource ${s.attributes.name} ?`,content:`This will remove datasource ${s.attributes.name} and all it's assignments. This action can not be undone.`,okText:"Delete datasource",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>xe(s.id),onCancel:()=>console.log("cancel datasource delete")})}]},children:"Edit"})})}),m(i)}else m([])},[a,t,c,y,l]);async function x(n,i,u){if(n===i)return i;if(!y(n))return X.error("Datasource's name must be unique"),i;if(n&&a)return he({name:n},u)}const N=[{title:f.jsx(De,{value:l,setValue:r}),dataIndex:"name",sorter:(n,i)=>{try{const u=n.name.attributes.name.toLowerCase(),s=i.name.attributes.name.toLowerCase();if(u<s)return-1;if(u>s)return 1}catch(u){console.log(u)}return 0},defaultSortOrder:"ascend",render:n=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[n.attributes.production.isImagePreloadSource?f.jsx($e,{placement:"topLeft",title:"Datasource for Image preloading",content:"URLs array will be used to preload & cache images",trigger:"hover",arrowPointAtCenter:!0,children:f.jsx(Re,{})}):null,f.jsx(be,{onChange:i=>x(i,n.attributes.name,n.id),initialValue:n.attributes.name,value:n.attributes.name})]})},{title:"Updated",dataIndex:"updated"},{title:"Source",dataIndex:"storageType"},{title:"Actions",width:"100px",dataIndex:"datasourcesActions"}];return f.jsxs(f.Fragment,{children:[f.jsx(Ve,{id:"Data sources",style:{margin:"15px 0"},level:5,children:f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsxs("span",{children:["Data sources (",d?.length||0,")"]}),f.jsx(_,{onClick:()=>c(!0),children:"Add Datasource"})]})}),f.jsx(Ce,{columns:N,dataSource:d,pagination:!1}),f.jsx(_,{style:{marginTop:15},type:"primary",onClick:()=>c(!0),children:"Add Datasource"},"submit")]})};export{rt as default};
