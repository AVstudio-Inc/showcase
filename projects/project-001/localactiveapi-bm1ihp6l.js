import{u as v}from"./editorApp-DZMui-50.js";import{u as E}from"./confirm-Bux8TUvH.js";import{a as M}from"./index-CaqiBWD3.js";function F(o){const s=[];for(let r=1;r<o+1;r++){const d={[`sourceItemTitle_${r}_signal_s_fb`]:"",[`sourceItemImage_${r}_signal_s_fb`]:"",[`sourceItemSelect_${r}_signal_d`]:""};s.push(d)}return s}function D(o,s){return s===void 0?o:o?.staticListOverrides?.[s]}function x(o){const s={variablesUsed:{},statesUsed:{},datasourceUsed:{},parametersUsed:{}},r=[{check:u=>u.startsWith("$")&&u.endsWith("$"),targetObject:s.variablesUsed},{check:u=>u.startsWith("#")&&u.endsWith("#"),targetObject:s.statesUsed},{check:u=>u.startsWith("%")&&u.endsWith("%"),targetObject:s.parametersUsed},{check:u=>{if(u.startsWith("{")&&u.endsWith("}"))try{return JSON.parse(u),!1}catch{return!0}},targetObject:s.datasourceUsed}],d=u=>typeof u=="string"&&u.length>=3,i=(u,t="")=>{for(const[h,a]of Object.entries(u)){const g=t?`${t}.${h}`:h;if(typeof a=="object"&&a!==null)i(a,g);else if(d(a)){for(const{check:b,targetObject:m}of r)if(b(a)){m[g]=a;break}}}},{dynamicDataUsed:n,...f}=o;return i(f),s}const N=({elements:o,oldIndex:s,newIndex:r})=>{if(s<0||s>=o.length||r<0)return console.log("Invalid indexes, return original array",s,r,o.length),o;const d=structuredClone(o),i=d.splice(s,1)[0];return d.splice(r,0,i),d},_=({isStatic:o})=>({name:o?"Static elements":"Container",isStatic:o,cssClass:"container",useOrientation:!1,landscape:{padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},backgroundColor:"",flow:"column",align:"center",distribution:"center",size:{manualMode:!1,value:void 0,unit:"%"},border:null},portrait:{padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},backgroundColor:"",flow:"column",align:"center",distribution:"center",size:{manualMode:!1,value:void 0,unit:"%"},border:null},elements:[]});function S({calculatedNewElementPosition:o,destinationContainerIndex:s,destinationContainerType:r,resolve:d}){const i=E.getState().setMainMenuData;let n=`container-${s}-element-${o}`;r==="global"&&(n=`globalContainer-${s}-element-${o}`),i({selectedMenuSection:{key:"",containerIndex:s,elementIndex:null,pageActionIndex:null,isGlobalContainer:!1}}),setTimeout(()=>{d(),i({selectedMenuSection:{key:n,containerIndex:s,elementIndex:o,pageActionIndex:null,isGlobalContainer:r==="global"}})},100)}const z=async({pageId:o,draggedElement:s,dragDestination:r})=>new Promise((d,i)=>{try{const{sourceContainerIndex:n,sourceElementIndex:f,sourceContainerType:u}=s,{destinationContainerIndex:t,destinationElementPosition:h,destinationContainerType:a}=r,g=v.getState().workingProject;if(!g)return i(new Error("workingProject is not defined"));const b=structuredClone(g.attributes.pages.data.find(m=>m.id===o));if(!b)return i(new Error("currentPageData is not available"));if(!b.attributes.containers||!b.attributes.containers?.length)return i(new Error("No containers are available"));if(n===t&&u===a){if(console.log("drop to the same container"),h===f)return console.log("No reorder needed"),d();if(a==="normal"){const m=b.attributes.containers[t].elements;if(!m||!m?.length)return i(new Error("elementsToChange is not available"));let c=h;c>f&&(c=c-1);const e=N({elements:m,oldIndex:f,newIndex:c});b.attributes.containers[t].elements=e,W({pageId:o,newPageAttributes:b.attributes}).then(()=>S({calculatedNewElementPosition:c,destinationContainerIndex:t,destinationContainerType:a,resolve:d}))}else if(a==="global"){console.log("reorder inside global container");const m=structuredClone(g),c=m.attributes.globalContainers[t].elements;if(!c||!c?.length)return i(new Error("elementsToChange is not available"));let e=h;e>f&&(e=e-1);const l=N({elements:c,oldIndex:f,newIndex:e});m.attributes.globalContainers[t].elements=l;const w=v.getState().updateProjectWithHistory;w(m.attributes).then(()=>S({calculatedNewElementPosition:h,destinationContainerIndex:t,destinationContainerType:a,resolve:d}))}}else{console.log("drop to new container");const m=structuredClone(g);let c=null;if(u==="global"){const l=m.attributes.globalContainers[n].elements.splice(f,1);if(l.length>0)c=l[0];else return i(new Error("cant remove element from global container"))}else m.attributes.pages.data.map(l=>{if(l.id===o){const w=l.attributes.containers;if(w){const C=w[n];if(C){const y=C.elements.splice(f,1);if(y.length>0)c=y[0];else return i(new Error("cant remove element from regular container"))}}else return i(new Error("cant remove element - no containers found"))}return l});if(a==="global"){if(c===null)return i(new Error("No removed element found"));m.attributes.globalContainers[t].elements.splice(h,0,c)}else m.attributes.pages.data.map(l=>{if(l.id===o&&c){const w=l.attributes.containers;if(w){const C=w[t];C&&C.elements.splice(h,0,c)}else return i(new Error("cant add element - no container found or element to inject"))}return l});const e=v.getState().updateProjectWithHistory;e(m.attributes).then(()=>S({calculatedNewElementPosition:h,destinationContainerIndex:t,destinationContainerType:a,resolve:d}))}}catch(n){console.error(n)}}),B=async({from:o,to:s,pageId:r})=>new Promise(function(d,i){const n=v.getState().workingProject,f=structuredClone(n?.attributes.pages.data.find(h=>h.id===r));if(!f)return i(new Error("No currentPageData"));const u=f.attributes.containers;if(!u?.length)return i(new Error("No containers"));const t=N({elements:u,oldIndex:o.containerIndex,newIndex:s.containerIndex});W({newPageAttributes:{containers:t},pageId:r}).then(()=>{d("ok")})});function R({staticListElementIndex:o,key:s,subKey:r,updateObj:d,element:i,containerIndex:n,elementIndex:f,isGlobalContainer:u,pageId:t}){const h={...D(i,o)?.[s]};let a,g;s==="width"?(a=h,g=r,a[g]={...a[g],...d},a?.[g]?.unit||(a[g]={...a[g],unit:"%"})):(a=h,g=r,a[g]={...a[g],...d},a?.[g]?.unit||(a[g]={...a[g],unit:"%"})),A({staticListElementIndex:o,action:"update",containerIndex:n,elementIndex:f,dataToUpdate:{[s]:a},pageId:t,isGlobal:u})}function O(o,s){let r="no_url";return r=void 0+o,r}const L=({imageId:o,project:s,renderEnvtype:r})=>{let d="",i=null;if(s){const n=s.attributes.media.data;n&&n.length&&(i=n.find(f=>String(f.id)===String(o))||null),i&&(d=O(i.attributes.url))}return{url:d,mediaFile:i}},G=async({pageId:o,elementToPaste:s})=>new Promise(()=>{const r=E.getState().selectedMenuSection,{containerIndex:d,elementIndex:i,isGlobalContainer:n}=r;if(d==null)throw new Error("No containerIndex");const{workingProject:f,updateProjectWithHistory:u}=v.getState();if(!f)throw new Error("No working project");let t;if(n?t=structuredClone(f.attributes.globalContainers):t=structuredClone(f.attributes.pages.data.find(h=>String(h.id)===o)?.attributes.containers),!t?.length)throw new Error("No containersToModify");return i!=null?t[d].elements.splice(i+1,0,s):t[d].elements=[...t[d].elements,s],n?u({globalContainers:t}):W({pageId:o,newPageAttributes:{containers:t}})}),A=async({containerIndex:o,elementData:s,isGlobal:r,pageId:d,action:i,elementIndex:n,copiesCount:f,staticListElementIndex:u,dataToUpdate:t,ignoreModeIndex:h,updateFunction:a})=>{const{workingProject:g,updateProjectWithHistory:b}=v.getState();if(!g)throw new Error("No working project");if(!r&&!d)throw new Error("No page id");const m=structuredClone(g.attributes);let c;if(r?c=m.globalContainers[o]:c=m.pages.data.find(e=>String(e.id)===d)?.attributes.containers?.[o],!c)throw new Error("No targetContainer");if(i==="create"){if(!s)throw new Error("Element data is empty");let e={...s};switch(e.type){case"button":e={...e,type:"button",size:"normal",iconPosition:"left",cssClass:"buttonElement",actions:[],iconName:null,text:"Button"};break;case"text":e={...e,type:"text",size:"normal",text:"Text element",cssClass:"textElement"};break;case"keypad":e={...e,type:"keypad",cssClass:"keypadElement"};break;case"slider":e={...e,type:"slider",size:"normal",cssClass:"sliderElement"};break;case"input":e={...e,type:"input",size:"normal",cssClass:"inputElement"};break;case"spacer":e={...e,type:"spacer",cssClass:"spacerElement",width:{width:{value:100,unit:"px"}},height:{height:{value:100,unit:"px"}}};break;case"switch":e={...e,type:"switch",cssClass:"switchElement",size:"normal",text:"Switch"};break;case"checkbox":e={...e,type:"checkbox",cssClass:"checkboxElement",size:"normal",text:"Checkbox"};break;case"clock":e={...e,type:"clock",cssClass:"clockWidget",width:{width:{value:200,unit:"px"}},height:{height:{value:200,unit:"px"}},isWidget:!0};break;case"dateTime":e={...e,type:"dateTime",cssClass:"dateTimeWidget",isWidget:!0};break;case"htmlblock":e={...e,type:"htmlblock",cssClass:"htmlblockWidget",width:{width:{value:200,unit:"px"}},height:{height:{value:200,unit:"px"}},isWidget:!0};break;case"toggle":e={...e,type:"toggle",cssClass:"toggleWidget",isWidget:!0};break;case"shades":e={...e,type:"shades",cssClass:"shadesWidget",isWidget:!0,headerLeftText:"Title",headerRightText:"%",shaderBackgroundBlur:3,shaderBackgroundColor:"rgba(255,255,255,0.6)"};break;case"circleSlider":e={...e,type:"circleSlider",cssClass:"circleSliderWidget",isWidget:!0,textTitle:"Title",textDescription:" Description",width:{width:{value:250,unit:"px"}}};break;case"player":e={...e,type:"player",cssClass:"playerWidget",isWidget:!0,headerTextLeft:"Player Name",headerTextCenter:"1 of 2",headerTextRight:"Next: Track Name",sourceItems:F(e?.playerMaxSources||30)};break;case"subpage":e={...e,type:"subpage",cssClass:"subpageElement"};break;case"video":e={...e,type:"video",cssClass:"videoElement"};break;case"dpad":e={...e,type:"dpad",cssClass:"dpadElement",width:{width:{value:250,unit:"px"}},height:{height:{value:250,unit:"px"}},thickness:1,cornersRaduis:20};break;case"image":e={...e,type:"image",cssClass:"imageElement",width:{width:{value:100,unit:"px"}},height:{height:{value:100,unit:"px"}}};break;default:console.log("Error creating element - no element type mathes");break}try{c.elements.push(e)}catch(l){console.error(l);return}}if(i==="delete"){if(n==null)throw new Error("No element index provided");try{c.elements.splice(n,1);const{setMainMenuData:e,selectedMenuSection:{elementIndex:l,containerIndex:w,isGlobalContainer:C}}=E.getState();n===l&&o===w&&!!C==!!r&&e({selectedMenuSection:{key:"",containerIndex:null,elementIndex:null,pageActionIndex:null,isGlobalContainer:!!r}})}catch(e){console.error(e)}}if(i==="clone"){if(f==null)throw new Error("No copies count provided");if(n==null)throw new Error("No elementIndex");try{for(let e=0;e<f;e++){let l=structuredClone(c.elements[n]);const w=l.name;l={...l,name:w+`_clone_${e}`},c.elements.push(l)}}catch(e){console.error(e)}}if(i==="update"){const e=h?void 0:E.getState().selectedMenuSection?.modeIndex;if(n==null)throw new Error("No elementIndex");const l=c.elements[n];if(!l)throw new Error("No targetElement");if(!t)throw new Error("No dataToUpdate");if(u!==void 0)l.staticListOverrides?.[u]?c.elements[n].staticListOverrides[u]={...c.elements[n].staticListOverrides[u],...t}:c.elements[n].staticListOverrides={...l.staticListOverrides,[u]:t};else if(e!==void 0&&l?.modes?.length)if(a){console.log("update function!!");const y=l.modes.map((p,P)=>{if(P===e){if(t&&t.modificatorId===void 0&&p.modeProps?.attachedFunctions&&p.modeProps?.attachedFunctions?.length>0){const k=p.modeProps.attachedFunctions.filter(j=>j.name!==t.name);return{...p,modeProps:{...p.modeProps,attachedFunctions:k}}}if(t&&t.modificatorId!==void 0)if(p.modeProps?.attachedFunctions&&p.modeProps?.attachedFunctions?.length>0){const k=[...p.modeProps.attachedFunctions,{...t}];return{...p,modeProps:{...p.modeProps,attachedFunctions:k}}}else return{...p,modeProps:{...p.modeProps,attachedFunctions:[t]}};return{...p,modeProps:{...p.modeProps,...t}}}return p});c.elements[n]={...l,modes:y}}else{const y=l.modes.map((p,P)=>P===e?{...p,modeProps:{...p.modeProps,...t}}:p);c.elements[n]={...l,modes:y}}else if(a)if(l?.attachedFunctions&&l?.attachedFunctions?.length>0)if(t&&t.modificatorId===void 0){const y=l.attachedFunctions.filter(p=>p.name!==t.name);c.elements[n]={...l,attachedFunctions:y}}else{const y=[...l.attachedFunctions,{...t}];c.elements[n]={...l,attachedFunctions:y}}else c.elements[n]={...l,attachedFunctions:[t]};else c.elements[n]={...l,...t};const w=c.elements[n],C=x(w);c.elements[n].dynamicDataUsed=C}return b(m)},U=async({action:o,containerFormData:s,containerIndex:r,pageId:d,copiesCount:i,isGlobal:n})=>{const{workingProject:f,updateProjectWithHistory:u}=v.getState();if(!f)throw new Error("No working project");if(!n&&!d)throw new Error("No page id");const t=structuredClone(f.attributes);let h;if(n?h=t.globalContainers:h=t.pages.data.find(a=>String(a.id)===d)?.attributes.containers,!h)throw new Error("No targetContainers");if(o==="create"){const a={..._({isStatic:!1}),...s};try{h.push(a)}catch(g){console.error(g);return}}if(o==="clone"){if(r===void 0)throw new Error("No container index");try{if(!h[r])throw new Error("No containerToClone");if(i==null)throw new Error("No copies count provided");if(r==null)throw new Error("No container index provided");for(let g=0;g<i;g++){let b=structuredClone(h[r]);const m=b.name;b={...b,name:m+`_clone_${g}`},h.push(b)}}catch(a){console.error(a);return}}if(o==="update")try{if(r==null)throw new Error("No container index provided");h[r]={...h[r],...s}}catch(a){console.error(a);return}if(o==="delete"){if(r==null)throw new Error("No container index provided");if(!h?.length){M.error("No containers found");return}if(h.length<2){M.error("At least one container should exist!");return}try{h.splice(r,1)}catch(a){console.error(a);return}}return u(t)},W=async({newPageAttributes:o,pageId:s})=>{const{workingProject:r,updateProjectWithHistory:d}=v.getState();if(!r)throw new Error("No working project");if(!s)throw new Error("No page id");const i=structuredClone(r.attributes);return i.pages.data.map(n=>{if(String(n.id)===s){const f={...n.attributes,...o},{containers:u,dynamicDataUsed:t,...h}=f,a=u?.map(b=>{const{elements:m,...c}=b;return c}),g=x({...h,containers:a});n.attributes={...f,dynamicDataUsed:g}}return n}),d(i)};export{A as a,W as b,U as c,D as d,G as e,z as f,L as g,x as h,_ as i,B as l,R as u};
