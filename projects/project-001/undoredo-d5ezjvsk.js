import{r as a,K as R,f as d,a as y,j as e,aa as K}from"./index-CaqiBWD3.js";import{f as k,u as n,q as E,T as l,B as i}from"./editorApp-DZMui-50.js";import{f as F}from"./confirm-Bux8TUvH.js";import{R as H}from"./mainLayout-CX6TZjFj.js";import"./index-9gNDCDRB.js";import"./SettingOutlined-C1WwUn5q.js";import"./pageAPI-DlCcwu0D.js";import"./localActiveAPI-BM1IHP6l.js";import"./___vite-browser-external_commonjs-proxy-BovDvJPF.js";import"./useAddNavigateToWindow-CzS9wfsG.js";import"./getLocalUrlFromString-MtGJfgQO.js";import"./shared-worker-manager-Bj7aMh3z.js";import"./variablesAPI-C9KILpk_.js";import"./datasourceTools-BSEF0Knj.js";import"./index-DwV6AUp4.js";import"./details-TLFobnpp.js";import"./index-_8W0n6rO.js";import"./index-BzblAUWm.js";import"./index-vWj0pZVz.js";import"./PlusCircleOutlined-Urd2TsKl.js";import"./formItemPropsWrapper-sw6ticMr.js";import"./Styles-BsfcSZ3N.js";import"./useCustomFonts-Bu6XhDHJ.js";import"./calcMediaUrl-BnxoRVw_.js";import"./modificatorAPI-DPI9vIG8.js";import"./renderActionTag-AacAROej.js";import"./moment-G82_0lEo.js";var I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},B=function(r,c){return a.createElement(R,d(d({},r),{},{ref:c,icon:I}))},w=a.forwardRef(B),D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},T=function(r,c){return a.createElement(R,d(d({},r),{},{ref:c,icon:D}))},$=a.forwardRef(T);const me=()=>{const{pageId:s}=k(),{projectId:r}=k(),[c,v]=a.useState(!1),{workingProject:m}=n(),g=n(o=>o.currentProjectHash),x=n(o=>o.savedProjectHash),{pastPatches:P,futurePatches:b,undo:p,redo:f,fetchAndFill:S}=n.getState(),u=P.length>0,h=b.length>0,C=g===x,j=a.useCallback(()=>{m&&(v(!0),E({projectData:m}).then(()=>{y.success("Project saved successfully")}).catch(o=>{console.error(o),y.error("Error while saving project")}).finally(()=>{v(!1)}))},[m]);function z(){r&&F({icon:e.jsx(K,{}),title:"Revert all project changes",content:"All unsaved changes made for this project will be lost. Are you sure you want to proceed?",okButtonProps:{danger:!0},okText:"Proceed",cancelText:"Cancel",onOk:()=>{S(r)},onCancel:()=>{console.info("Clear process aborted.")}})}return a.useEffect(()=>{const o=t=>{if((t.metaKey||t.ctrlKey)&&t.key==="s"&&(t.preventDefault(),j()),(t.metaKey||t.ctrlKey)&&t.shiftKey&&t.key==="z"&&h){t.preventDefault(),f();return}(t.metaKey||t.ctrlKey)&&t.key==="z"&&u&&(t.preventDefault(),p())};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[h,u,j,f,p]),e.jsxs(e.Fragment,{children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(l,{title:"Undo [ctrl/cmd + z]",children:e.jsx(i,{onClick:()=>p(),disabled:!u,icon:e.jsx(w,{})})}),e.jsx(l,{title:"Redo [ctrl/cmd + shift + z]",children:e.jsx(i,{onClick:()=>f(),disabled:!h,icon:e.jsx(w,{style:{transform:"scaleX(-1)"}})})})]}),!s&&r&&e.jsx(l,{title:"Revert all project changes & clear history",children:e.jsx(i,{danger:!0,disabled:C,onClick:()=>z(),icon:e.jsx(H,{})})}),e.jsx(l,{placement:"left",title:"Save project [ctrl/cmd + s]",children:e.jsx(i,{icon:e.jsx($,{}),loading:c,disabled:g===x||c,onClick:()=>{j()},type:"primary",children:"Save project"})})]})};export{me as default};
