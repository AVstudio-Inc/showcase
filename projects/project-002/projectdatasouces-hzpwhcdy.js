import{g as I,f as k,r as u,bS as S,z as j,j as a,as as w,a0 as A,cD as P,Q as Y,Y as M,W as B,cz as p,B as R,O as v,ab as $,a9 as E}from"./main-BKM2fIwG.js";import{E as F}from"./EditableCell-cqK7iS5z.js";import{u as L,T as O}from"./useTableFilter-CF3g0AgZ.js";import{P as U}from"./Styles-CgWqeJi4.js";import{R as N}from"./DiffOutlined-DRn9zohQ.js";import{B as V}from"./index-B2WlvB3G.js";import{R as _}from"./PictureOutlined-JGfrf3Zr.js";import{T as q}from"./index-DxXoshz8.js";import{b as z}from"./Table-DlRpDtjF.js";import"./EditOutlined-_GB9OZ1y.js";import"./index-Aazyqc20.js";import"./DownOutlined-BZ_0tHYf.js";import"./PlusSquareOutlined-DN4XdNMT.js";const{Title:W}=q,ne=()=>{const{projectId:n,pageId:y}=I(),f=k(e=>e.workingProject),[i,D,x,g]=L({key:"dataSourceFilter",projectId:n,pageId:y}),o=u.useMemo(()=>f?.attributes?.datasources?.data||[],[f]),{setNewDatasourceVisible:l}=S(),[b,h]=u.useState(),d=u.useCallback(e=>o?.some(r=>r.attributes.name===e)?(j.error("Datasource's name must be unique"),!1):!0,[o]);u.useEffect(()=>{function e(r,s){const t=m=>d(`${m}_clone`)?`${m}_clone`:t(`${m}_clone`);if(!o)return null;const c={name:t(s),production:o[r].attributes.production,uid:v()};n&&$(n,c)}if(n)if(o&&Array.isArray(o)){const r=[];(i?o.filter(t=>t.attributes.name.toLowerCase().includes(i.toLowerCase())):o).forEach((t,c)=>{r.push({key:`datasource_${t.id}`,order:c+1,name:t,uid:t.attributes.uid,updated:t.attributes.updatedAt,storageType:a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.3em"},children:[a.jsx(V,{status:t.attributes.production.storageType==="none"?"error":"success",text:t.attributes.production.storageType}),t.attributes.production.storageType!=="local"&&a.jsx(M,{placement:"topRight",popContent:"This datasource has remote URL to fetch data.",star:!0})]}),datasourcesActions:a.jsx(w.Button,{onClick:()=>{l(t.id)},menu:{items:[{key:"copy",icon:a.jsx(N,{}),label:"Clone datasource",onClick:()=>e(c,t.attributes.name)},{key:"delete",icon:a.jsx(Y,{}),label:"Delete datasource",danger:!0,onClick:()=>A({title:`Delete datasource ${t.attributes.name} ?`,content:`This will remove datasource ${t.attributes.name} and all it's assignments. This action can not be undone.`,okText:"Delete datasource",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>P(t.id),onCancel:()=>console.log("cancel datasource delete")})}]},children:"Edit"})})}),h(r)}else h([])},[n,o,l,d,i]);async function C(e,r,s){if(e===r)return r;if(!d(e))return j.error("Datasource's name must be unique"),r;if(e&&n)return E({name:e},s)}const T=[{title:a.jsx(O,{value:i,setValue:D}),dataIndex:"name",sorter:(e,r)=>{try{const s=e.name.attributes.name.toLowerCase(),t=r.name.attributes.name.toLowerCase();if(s<t)return-1;if(s>t)return 1}catch(s){console.log(s)}return 0},sortOrder:g("name","ascend"),render:e=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[e.attributes.production.isImagePreloadSource?a.jsx(B,{placement:"topLeft",title:"Datasource for Image preloading",content:"URLs array will be used to preload & cache images",trigger:"hover",arrowPointAtCenter:!0,children:a.jsx(_,{})}):null,a.jsx(F,{onChange:r=>C(r,e.attributes.name,e.id),initialValue:e.attributes.name,value:e.attributes.name})]})},{title:"UID",dataIndex:"uid"},{title:"Updated",dataIndex:"updated",sortOrder:g("updated"),sorter:(e,r)=>{const s=p(e.updated,"MMM D[th] YYYY, h:mm a"),t=p(r.updated,"MMM D[th] YYYY, h:mm a");return s.isBefore(t)?-1:s.isAfter(t)?1:0},render:e=>a.jsx(a.Fragment,{children:p(e).format("MMM D, YYYY, h:mm A")})},{title:"Source",dataIndex:"storageType"},{title:"Actions",width:"100px",dataIndex:"datasourcesActions"}];return a.jsxs(U,{id:"SubPages",children:[a.jsx(W,{id:"Data sources",style:{margin:"15px 0"},level:5,children:a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("span",{children:["Data sources (",b?.length||0,")"]}),a.jsx(R,{type:"primary",onClick:()=>l(!0),children:"Add Datasource"})]})}),a.jsx("div",{className:"scrollingTable",children:a.jsx(z,{className:"showScrollbars",columns:T,dataSource:b,pagination:!1,onChange:(e,r,s)=>{x(s)}})})]})};export{ne as default};
