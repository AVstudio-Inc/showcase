import{g as M,f as T,bS as S,r as m,z as j,j as r,cz as p,as as F,a0 as I,Q as P,B as D,cC as B}from"./main-BKM2fIwG.js";import{E}from"./EditableCell-cqK7iS5z.js";import{d as $,u as O,c as L}from"./modificatorAPI-D74AIDqr.js";import{P as N}from"./Styles-CgWqeJi4.js";import{u as R,T as V}from"./useTableFilter-CF3g0AgZ.js";import{T as Y}from"./index-DxXoshz8.js";import{R as _}from"./DiffOutlined-DRn9zohQ.js";import"./EditOutlined-_GB9OZ1y.js";import"./index-Aazyqc20.js";import"./DownOutlined-BZ_0tHYf.js";const X=()=>{const{projectId:i,pageId:C}=M(),s=T(t=>t.workingProject),[c,y,A,b]=R({key:"modificatorFilter",projectId:i,pageId:C}),{setNewModificatorVisible:u}=S(),[g,h]=m.useState(),l=m.useCallback(t=>s?.attributes?.modificators?.data?.some(e=>e.attributes.name===t)?(j.error("Function's name must be unique"),!1):!0,[s?.attributes?.modificators?.data]),{Title:k}=Y;async function x(t,a,e){if(t===a)return a;if(!l(t))return j.error("Function's name must be unique"),a;if(t&&i)return O({name:t},e)}const w=[{title:r.jsx(V,{value:c,setValue:y}),dataIndex:"name",sortOrder:b("name","ascend"),sorter:(t,a)=>{try{const e=t.name.attributes.name.toLowerCase(),n=a.name.attributes.name.toLowerCase();if(e<n)return-1;if(e>n)return 1}catch(e){console.log(e)}return 0},render:t=>r.jsx(E,{onChange:a=>x(a,t.attributes.name,t.id),initialValue:t.attributes.name,value:t.attributes.name})},{title:"Updated",dataIndex:"updated",sortOrder:b("updated","ascend"),sorter:(t,a)=>{const e=p(t.updated),n=p(a.updated);return e.isBefore(n)?-1:e.isAfter(n)?1:0},render:t=>r.jsx(r.Fragment,{children:p(t).format("MMM D, YYYY, h:mm A")})},{title:"Actions",width:"100px",dataIndex:"modificatorActions"}];return m.useEffect(()=>{const t=s?.attributes?.modificators?.data;function a(e,n){const o=f=>l(`${f}_clone`)?`${f}_clone`:o(`${f}_clone`);if(!t)return null;const d={name:o(n),function:t[e].attributes.function};i&&L(i,d)}if(i)if(t&&Array.isArray(t)){const e=[];(c?t.filter(o=>o.attributes.name.toLowerCase().includes(c.toLowerCase())):t).forEach((o,d)=>{e.push({key:`modificator_${o.id}`,order:d+1,name:o,updated:o.attributes.updatedAt,modificatorActions:r.jsx(F.Button,{onClick:()=>{u(o.id)},menu:{items:[{key:"copy",icon:r.jsx(_,{}),label:"Clone function",onClick:()=>a(d,o.attributes.name)},{key:"delete",icon:r.jsx(P,{}),label:"Delete function",danger:!0,onClick:()=>I({title:`Delete function ${o.attributes.name} ?`,content:`This will remove function ${o.attributes.name} and all it's assignments. This action can not be undone.`,okText:"Delete function",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>$(o.id),onCancel:()=>console.log("cancel function delete")})}]},children:"Edit"})})}),h(e)}else h([])},[c,l,i,u,s?.attributes?.modificators?.data]),r.jsxs(N,{id:"SubPages",children:[r.jsx(k,{id:"Functions",style:{margin:"15px 0"},level:5,children:r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("span",{children:["Functions (",g?.length||0,")"]}),r.jsx(D,{type:"primary",onClick:()=>u(!0),children:"Add Function"})]})}),r.jsx("div",{className:"scrollingTable",children:r.jsx(B,{className:"showScrollbars",columns:w,dataSource:g,pagination:!1,onChange:(t,a,e)=>{A(e)}})})]})};export{X as default};
