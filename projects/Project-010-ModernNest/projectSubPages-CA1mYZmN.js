import{u as A,f as L,g as B,j as e,cO as f,bW as M,r as S,ao as O,cP as R,cQ as h,J as V,T as y,av as F,a2 as W,cR as z,G as U,B as x}from"./main-DkRMjw9y.js";import{E as Y}from"./EditableCell-jNDaMm8d.js";import{d as _}from"./deletePage-CWOLChc4.js";import{u as $,T as q}from"./useTableFilter-Dpb7__Pv.js";import{P as G}from"./Styles-DhTUTepm.js";import{b as P}from"./Table-CGliJgNY.js";import{R as H}from"./DiffOutlined-DEOmSgfY.js";import{T as J}from"./index-Dam0v-Ch.js";import"./EditOutlined-DWCmQkXB.js";import"./index-CMItvqjf.js";import"./PlusSquareOutlined-CabPYtdb.js";const{Title:K}=J,ue=()=>{const p=A(),u=L(a=>a.workingProject),{projectId:l,pageId:w}=B(),[m,C,v,j]=$({key:"subpagesFilter",projectId:l,pageId:w}),I=[{title:e.jsx(q,{value:m,setValue:C}),dataIndex:"name",sorter:(a,d)=>{const i=a.name.props.initialValue.toLowerCase(),n=d.name.props.initialValue.toLowerCase();return i<n?-1:i>n?1:0},sortOrder:j("name","ascend")},{title:e.jsx(e.Fragment,{children:"Design paradigm"}),dataIndex:"layoutMode"},{title:"Updated",dataIndex:"updated",sortOrder:j("updated"),sorter:(a,d)=>{const i=f(a.updated),n=f(d.updated);return i.isBefore(n)?-1:i.isAfter(n)?1:0},render:a=>e.jsx(e.Fragment,{children:f(a).format("MMM D, YYYY, h:mm A")})},P.EXPAND_COLUMN,{title:"Where Used",dataIndex:"used"},{title:"Actions",dataIndex:"actions",width:100}],{setNewPageModalVisible:T}=M(),[g,k]=S.useState(null);S.useEffect(()=>{let a=u?.attributes.pages.data?.filter(r=>r.attributes.isSubpage)||[];const d=u?.attributes.pages.data?.filter(r=>!r.attributes.isSubpage)||[];function i(r){const t=[];return[...d||[]].forEach((o,b)=>{o.attributes.containers?.forEach((N,D)=>{N.elements.filter(c=>c.type==="subpage").some(c=>c.subpageId===r)&&t.push(e.jsx(x,{onClick:c=>h({pageId:o.id,navigate:p,evt:c,projectId:l}),type:"dashed",size:"small",children:o.attributes.name},o.id+"_source_"+b+D))})}),t}function n(r){return!!a.find(s=>s.id===r)?.attributes.containers?.some(s=>s.elements.some(o=>o.type==="subpage"||o.type==="subpageList"))}if(a){m&&(a=a.filter(t=>{const s=t.attributes.name;if(!s)return!1;const o=s.trim().toLowerCase(),b=m.trim().toLowerCase();return o.includes(b)}));const r=[];for(const t of a)r.push({pageID:t.id,key:`subpage_${t.id}`,name:e.jsx(Y,{style:{whiteSpace:"nowrap"},onChange:s=>s&&l&&z({pageId:t.id,inputData:{name:s}}),initialValue:t.attributes.name,value:t.attributes.name,validators:[s=>W({input:s,searchArray:a||[],searchKey:["attributes","name"]}).catch(o=>(U.error(o.message),Promise.reject()))]}),layoutMode:e.jsx(y,{icon:e.jsx(F,{style:{height:"auto",minWidth:"1em",margin:"0 3px -1px 0"},isStatic:t.attributes?.isStatic}),children:t.attributes?.isStatic?"adaptive":"responsive"}),updated:t.attributes.updatedAt,used:e.jsx("div",{style:{display:"flex",gap:5,flexWrap:"wrap"},children:i(t.id)}),nestedSubs:n(t.id),actions:e.jsxs(O.Button,{onClick:s=>h({pageId:t.id,navigate:p,evt:s,projectId:l}),menu:{items:[{key:"clonePage",icon:e.jsx(H,{}),label:"Clone SubPage",onClick:()=>l&&R({pageCloneData:t})},{key:"remove",danger:!0,icon:e.jsx(V,{}),label:"Delete SubPage",onClick:()=>l&&_({pageId:t.id,projectId:l,isSubpage:t.attributes.isSubpage,name:t.attributes.name})}]},children:[e.jsx("svg",{style:{marginRight:3,marginBottom:-2},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M6 2c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-1.9l10-10V8l-6-6zm7 1.5L18.5 9H13zm7.1 9.5c-.1 0-.3.1-.4.2l-1 1l2.1 2.1l1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-2 1.8L12 20.9V23h2.1l6.1-6.1z"})}),"Open in Editor"]})});k(r)}},[p,l,m,u]);function E(a){const d=u?.attributes.pages.data.find(n=>n.id===a);if(!d)return null;const i=[];for(const n of d.attributes.containers||[])for(const r of n.elements)(r.type==="subpage"||r.type==="subpageList")&&i.push(r.subpageId);return e.jsx("div",{style:{display:"flex",gap:5,marginTop:10,flexWrap:"wrap"},children:i.map(n=>{const r=u?.attributes.pages.data.find(s=>s.id===n)?.attributes.name,t=!r;return e.jsx(x,{onClick:s=>!t&&h({pageId:n,navigate:p,evt:s,projectId:l}),type:"dashed",size:"small",danger:t,children:r||"Deleted"},n)})})}return e.jsxs(G,{id:"SubPages",children:[e.jsx(K,{style:{margin:"15px 0"},level:5,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["SubPages (",g?.length,")",e.jsx(x,{type:"primary",onClick:()=>T("subpage"),children:"Create New SubPage"})]})}),e.jsx("div",{className:"scrollingTable",children:g&&e.jsx(P,{className:"showScrollbars",expandable:{expandedRowRender:a=>e.jsxs(e.Fragment,{children:[e.jsx(y,{color:"geekblue",children:"1st level nested subpages"}),E(a.pageID)]}),rowExpandable:a=>a.nestedSubs},showSorterTooltip:!1,columns:I,dataSource:g,pagination:!1,onChange:(a,d,i)=>{v(i)}})})]})};export{ue as default};
