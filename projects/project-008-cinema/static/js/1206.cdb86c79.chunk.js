"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[1206],{33490:(e,t,a)=>{a.d(t,{c:()=>i});var r=a(36373),o=a(41397);const i=(0,r.h)(((e,t)=>({calculatedVariables:[],setInitialVariablesArray:t=>e((()=>({calculatedVariables:t}))),setVariableNewValue:a=>{let{name:r,currentValue:o}=a;console.log("setVariableNewValue",r,o);let i=structuredClone(t().calculatedVariables);if(void 0===r||void 0===o)return void console.log("Variable name or currentValue is undefined");const n=i.findIndex((e=>e.name===r));if(n<0)return void console.log("Variable not found, update error");let d;if(d=void 0!==i[n].currentValue?i[n].currentValue:i[n].defaultValue,"boolean"===i[n].type)switch(o){case"true":case!0:d=!0;break;case"false":case!1:d=!1;break;case"toggle":d=!d}else d=o;return i[n].currentValue!==d&&(i[n]={...i[n],currentValue:d}),e((()=>({calculatedVariables:i})))}})),o.isEqual)},68513:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(44719);const o=e=>r.A.confirm({zIndex:3e3,...e})},581:(e,t,a)=>{a.d(t,{$v:()=>g,B1:()=>f,G4:()=>s,Nf:()=>c,r$:()=>v});var r=a(92759),o=a(13753),i=a(89321),n=a(44358),d=a(18469),u=a(64983),l=a(3215);const s=async(e,t)=>{const a={data:{project:e,...t}};await o.axiosInstance.post("/api/datasources",a,{headers:(0,i.A)()}).then((e=>{const{workingProject:t,updateProjectWithHistory:a}=u.f.getState();if(!t)return;const r=t.attributes.datasources,o=e.data.data;return a({datasources:{data:[...r.data,o]}},!1)})).then((()=>{r.Ay.success("New datasource added")})).catch((e=>{console.log("An error occured during datasource creation:",e.response),r.Ay.error("Error adding new datasource")}))},c=async e=>{await o.axiosInstance.delete("/api/datasources/".concat(e),{headers:(0,i.A)()}).then((()=>{const{workingProject:t,updateProjectWithHistory:a}=u.f.getState();if(!t)return;let r=t.attributes.datasources.data;return r=r.filter((t=>t.id!==e)),a({datasources:{data:r}},!1)})).then((()=>{r.Ay.success("Datasource deleted")})).catch((e=>{console.log("An error occured during datasource removing:",e.response),r.Ay.error("Error deleting datasource")}))},v=async(e,t)=>await o.axiosInstance.put("/api/datasources/".concat(t),{data:e},{headers:(0,i.A)()}).then((e=>{const{workingProject:a,updateProjectWithHistory:r}=u.f.getState();if(!a)return;let o=structuredClone(a.attributes.datasources.data);return o.map((a=>(a.id===t&&(a.attributes=e.data.data.attributes),a))),r({datasources:{data:o}},!1)})).then((()=>{r.Ay.success("Datasource updated")})).catch((e=>{console.log("An error occured during datasource update:",e.response),r.Ay.error("Error updating datasource")})),g=async()=>{var e,t,a,r,o,i,s,c,v,g,f,b,p,h,m;const P=null===(e=u.f.getState().workingProject)||void 0===e?void 0:e.attributes.datasources,I=null===(t=u.f.getState().workingProject)||void 0===t||null===(a=t.attributes)||void 0===a?void 0:a.modificators,{setInitialDatasourceData:y}=l.G.getState(),w=null!==(r=null===(o=u.f.getState().workingProject)||void 0===o||null===(i=o.attributes)||void 0===i||null===(s=i.datasetOptions)||void 0===s?void 0:s.hostname)&&void 0!==r?r:"",S=null!==(c=null===(v=u.f.getState().workingProject)||void 0===v||null===(g=v.attributes)||void 0===g||null===(f=g.datasetOptions)||void 0===f?void 0:f.headerKey)&&void 0!==c?c:"",j=null!==(b=null===(p=u.f.getState().workingProject)||void 0===p||null===(h=p.attributes)||void 0===h||null===(m=h.datasetOptions)||void 0===m?void 0:m.headerValue)&&void 0!==b?b:"";return(async e=>{var t;const a=[],r=(e,t)=>{if(t&&null!==t&&I&&void 0!==I&&I.data.length>0){if(I.data.find((e=>e.id===t)))return(0,n.I_)([e],t,null===I||void 0===I?void 0:I.data)}},o=(null!==(t=null===e||void 0===e?void 0:e.data)&&void 0!==t?t:[]).map((async e=>{const{attributes:{production:{storageType:t,sourceLink:o,sourceObject:i,headerKey:u,headerValue:l,modificatorId:s,useBaseUrl:c,isImagePreloadSource:v}}}=e;let g;if("local"===t)try{var f;g=JSON.parse(i),s&&I&&(g=r(g,s)),a.push({id:e.id,value:g,uid:e.attributes.uid,isImagePreloadSource:!(null===(f=e.attributes.production)||void 0===f||!f.isImagePreloadSource)})}catch(p){console.log("Prefetcher: error parsing datasource",e.id,p)}else{let t=(0,n.Qo)(o);c&&(t=w+t);let i=null!==u&&void 0!==u?u:S,v=null!==l&&void 0!==l?l:j;const f=i&&v?{headers:{[i]:v}}:{};try{const o=await d.A.get(t,f);var b;if(200!==o.status)console.log("Prefetcher: error fetching datasource",e.id,o.status);else g=s&&I?r(o.data,s):o.data,a.push({id:e.id,value:g,uid:e.attributes.uid,hashedUrl:t,isImagePreloadSource:!(null===(b=e.attributes.production)||void 0===b||!b.isImagePreloadSource)})}catch(p){console.log("Prefetcher: error fetching datasource",e.id,p)}}}));return await Promise.allSettled(o),Array.isArray(a)&&a.length>0&&y(a),a})(P)},f=async e=>{var t,a,r,o,i,s,c,v,g,f,b,p,h,m,P,I,y,w,S;const j=null!==(t=null===(a=u.f.getState().workingProject)||void 0===a||null===(r=a.attributes)||void 0===r||null===(o=r.datasources)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.filter((t=>t.attributes.name===e)))&&void 0!==t?t:[],{updateOrCreateDatasourceData:V}=l.G.getState();if(0===j.length)return null;const k=null===(s=u.f.getState().workingProject)||void 0===s||null===(c=s.attributes)||void 0===c?void 0:c.modificators,A=null!==(v=null===(g=u.f.getState().workingProject)||void 0===g||null===(f=g.attributes)||void 0===f||null===(b=f.datasetOptions)||void 0===b?void 0:b.hostname)&&void 0!==v?v:"",N=null!==(p=null===(h=u.f.getState().workingProject)||void 0===h||null===(m=h.attributes)||void 0===m||null===(P=m.datasetOptions)||void 0===P?void 0:P.headerKey)&&void 0!==p?p:"",O=null!==(I=null===(y=u.f.getState().workingProject)||void 0===y||null===(w=y.attributes)||void 0===w||null===(S=w.datasetOptions)||void 0===S?void 0:S.headerValue)&&void 0!==I?I:"",x=j[0],{attributes:{production:{storageType:D,sourceLink:C,sourceObject:Q,headerKey:E,headerValue:U,modificatorId:K,useBaseUrl:B,isImagePreloadSource:G}}}=x;let H;if("local"===D)try{var W,_;return H=JSON.parse(Q),K&&k&&(H=(0,n.I_)([H],K,null===k||void 0===k?void 0:k.data)),V({id:x.id,value:H,uid:x.attributes.uid,isImagePreloadSource:!(null===(W=x.attributes.production)||void 0===W||!W.isImagePreloadSource)}),{id:x.id,value:H,uid:x.attributes.uid,isImagePreloadSource:!(null===(_=x.attributes.production)||void 0===_||!_.isImagePreloadSource)}}catch(J){console.log("Prefetcher: error parsing datasource",x.id,J)}else{let e=(0,n.Qo)(C);B&&(e=A+e);let t=null!==E&&void 0!==E?E:N,a=null!==U&&void 0!==U?U:O;const r=t&&a?{headers:{[t]:a}}:{};try{const t=await d.A.get(e,r);var q,z;if(200===t.status)return H=K&&k?(0,n.I_)([t.data],K,null===k||void 0===k?void 0:k.data):t.data,V({id:x.id,value:H,uid:x.attributes.uid,hashedUrl:e,isImagePreloadSource:!(null===(q=x.attributes.production)||void 0===q||!q.isImagePreloadSource)}),{id:x.id,value:H,uid:x.attributes.uid,hashedUrl:e,isImagePreloadSource:!(null===(z=x.attributes.production)||void 0===z||!z.isImagePreloadSource)};console.log("Prefetcher: error fetching datasource",x.id,t.status)}catch(J){console.log("Prefetcher: error fetching datasource",x.id,J)}}return null}},9418:(e,t,a)=>{a.d(t,{I7:()=>u,N6:()=>f,Pb:()=>v,S1:()=>l,aM:()=>s,l4:()=>g,rz:()=>c});var r=a(92759),o=a(48362),i=a(64983),n=a(33490),d=a(9950);async function u(e){var t;let{updatedVariable:a,projectId:n,pageId:d}=e;const u=null===(t=i.f.getState().workingProject)||void 0===t?void 0:t.attributes.variables;return new Promise((async function(e,t){let i=structuredClone(u);if(!i)return t("Variables are empty"),null;const d=null===i||void 0===i?void 0:i.findIndex((e=>e.name===a.name));return d<0?(t("No variable found by index"),null):(i[d]=a,n?(0,o.Qx)({projectId:n,inputData:{variables:i}}).then((()=>e("Ok"))).catch((e=>{var a,o;return"ValidationError"===(null===(a=e.response.data)||void 0===a||null===(o=a.error)||void 0===o?void 0:o.name)&&r.Ay.error("Name must be unique"),t(e)})):void t("No projectId"))}))}async function l(e){var t;let{variableName:a,projectId:r,pageId:n}=e;const d=null===(t=i.f.getState().workingProject)||void 0===t?void 0:t.attributes.variables;return new Promise((async function(e,t){let i=structuredClone(d);if(!i)return t("variables are empty"),null;i=n&&void 0!==n?i.filter((e=>e.pageId!==n||e.name!==a)):i.filter((e=>e.name!==a)),r?(0,o.Qx)({projectId:r,inputData:{variables:i}}).then((()=>{e("Ok")})).catch((e=>t(e))):t("No projectId")}))}async function s(e){var t;let{projectId:a,pageId:r}=e;const n=null===(t=i.f.getState().workingProject)||void 0===t?void 0:t.attributes.variables;return new Promise((async function(e,t){let i=structuredClone(n);if(!i)return t("variables are empty"),null;i=i.filter((e=>e.pageId!==r)),a?(0,o.Qx)({projectId:a,inputData:{variables:i}}).catch((e=>t(e))):t("No projectId")}))}async function c(e){let{newVariable:t,projectId:a}=e;const{workingProject:r}=i.f.getState();return new Promise((async function(e,i){if(!a)return void i("No projectId");if(!r)return void i("No workingProject");const n=r.attributes.variables;let d=structuredClone(n)||[];d=[...d,t],console.log(d),(0,o.Qx)({projectId:a,inputData:{variables:d}}).then((()=>e("Ok"))).catch((e=>i(e)))}))}function v(e){var t;const a=null===(t=i.f.getState().workingProject)||void 0===t?void 0:t.attributes.variables;return null===a||void 0===a?void 0:a.find((t=>t.name===e))}function g(e){const t=n.c.getState().calculatedVariables;return null===t||void 0===t?void 0:t.find((t=>t.name===e))}function f(e){const t=(0,n.c)((e=>e.calculatedVariables));let a=(0,d.useMemo)((()=>null===t||void 0===t?void 0:t.find((t=>t.name===e))),[t,e]);if(void 0===a)return;const{currentValue:r,defaultValue:o}=a;return{calculatedValue:void 0===r||""===r?o:r,targetVariable:a}}}}]);