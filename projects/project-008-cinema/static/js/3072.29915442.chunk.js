"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[3072],{70403:(e,t,n)=>{n.d(t,{A:()=>o});const o=function(e,t){var n;return void 0===t?e:null===e||void 0===e||null===(n=e.staticListOverrides)||void 0===n?void 0:n[t]}},93072:(e,t,n)=>{n.d(t,{aO:()=>f,ld:()=>v,yd:()=>b,Lb:()=>h,h8:()=>g,GN:()=>d,cK:()=>m,Pb:()=>u,FN:()=>p});var o=n(92759);const r=function(e){const t=[];for(let n=1;n<e+1;n++){const e={["sourceItemTitle_".concat(n,"_signal_s_fb")]:"",["sourceItemImage_".concat(n,"_signal_s_fb")]:"",["sourceItemSelect_".concat(n,"_signal_d")]:""};t.push(e)}return t};var i=n(70403),a=n(64983),s=n(35865);const l=e=>{let{elements:t,oldIndex:n,newIndex:o}=e;if(n<0||n>=t.length||o<0||o>=t.length)return console.log("Invalid indices, return original array"),t;const r=structuredClone(t),i=r.splice(n,1)[0];return r.splice(o,0,i),r},d={name:"Container",cssClass:"container",useOrientation:!1,landscape:{padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},backgroundColor:"",flow:"column",align:"center",distribution:"center",size:{manualMode:!1,value:void 0,unit:"%"},border:null},portrait:{padding:{value:void 0,unit:"%"},gap:{value:void 0,unit:"%"},backgroundColor:"",flow:"column",align:"center",distribution:"center",size:{manualMode:!1,value:void 0,unit:"%"},border:null},elements:[]};function c(e){let{calculatedNewElementPosition:t,destinationContainerIndex:n,destinationContainerType:o,resolve:r}=e;const i=s.x.getState().setMainMenuData;let a="container-".concat(n,"-element-").concat(t);"global"===o&&(a="globalContainer-".concat(n,"-element-").concat(t)),i({selectedMenuSection:{key:"",containerIndex:n,elementIndex:null,pageActionIndex:null,isGlobalContainer:!1}}),setTimeout((()=>{r(),i({selectedMenuSection:{key:a,containerIndex:n,elementIndex:t,pageActionIndex:null,isGlobalContainer:"global"===o}})}),100)}const u=async e=>{let{pageId:t,draggedElement:n,dragDestination:o}=e;return new Promise((async(e,r)=>{try{var i;const{sourceContainerIndex:s,sourceElementIndex:d,sourceContainerType:u}=n,{destinationContainerIndex:m,destinationElementPosition:p,destinationContainerType:g}=o,h=a.f.getState().workingProject;if(!h)return r(new Error("workingProject is not defined"));let v=structuredClone(h.attributes.pages.data.find((e=>e.id===t)));if(!v)return r(new Error("currentPageData is not available"));if(!v.attributes.containers||null===(i=v.attributes.containers)||void 0===i||!i.length)return r(new Error("No containers are available"));if(s===m&&u===g){if(console.log("drop to the same container"),p===d)return console.log("No reorder needed"),e();if("normal"===g){let n=v.attributes.containers[m].elements;if(!n||null===n||void 0===n||!n.length)return r(new Error("elementsToChange is not available"));let o=p;o>d&&(o-=1);const i=l({elements:n,oldIndex:d,newIndex:o});v.attributes.containers[m].elements=i,b({pageId:t,newPageAttributes:v.attributes}).then((()=>c({calculatedNewElementPosition:o,destinationContainerIndex:m,destinationContainerType:g,resolve:e})))}else if("global"===g){console.log("reorder inside global container");let t=structuredClone(h),n=t.attributes.globalContainers[m].elements;if(!n||null===n||void 0===n||!n.length)return r(new Error("elementsToChange is not available"));let o=p;o>d&&(o-=1);const i=l({elements:n,oldIndex:d,newIndex:o});t.attributes.globalContainers[m].elements=i;(0,a.f.getState().updateProjectWithHistory)(t.attributes).then((()=>c({calculatedNewElementPosition:p,destinationContainerIndex:m,destinationContainerType:g,resolve:e})))}}else{console.log("drop to new container");let n=structuredClone(h),o=null;if("global"===u){const e=n.attributes.globalContainers[s].elements.splice(d,1);if(!(e.length>0))return r(new Error("cant remove element from global container"));o=e[0]}else n.attributes.pages.data.map((e=>{if(e.id===t){const t=e.attributes.containers;if(!t)return r(new Error("cant remove element - no containers found"));{const e=t[s];if(e){const t=e.elements.splice(d,1);if(!(t.length>0))return r(new Error("cant remove element from regular container"));o=t[0]}}}return e}));if("global"===g){if(null===o)return r(new Error("No removed element found"));n.attributes.globalContainers[m].elements.splice(p,0,o)}else n.attributes.pages.data.map((e=>{if(e.id===t&&o){const t=e.attributes.containers;if(!t)return r(new Error("cant add element - no container found or element to inject"));{const e=t[m];e&&e.elements.splice(p,0,o)}}return e}));(0,a.f.getState().updateProjectWithHistory)(n.attributes).then((()=>c({calculatedNewElementPosition:p,destinationContainerIndex:m,destinationContainerType:g,resolve:e})))}}catch(s){}}))},m=async e=>{let{from:t,to:n,pageId:o}=e;return new Promise((function(e,r){const i=a.f.getState().workingProject;let s=structuredClone(null===i||void 0===i?void 0:i.attributes.pages.data.find((e=>e.id===o)));if(!s)return r(new Error("No currentPageData"));const d=s.attributes.containers;if(null===d||void 0===d||!d.length)return r(new Error("No containers"));const c=l({elements:d,oldIndex:t.containerIndex,newIndex:n.containerIndex});b({newPageAttributes:{containers:c},pageId:o}).then((()=>{e("ok")}))}))};function p(e){var t;let n,o,{staticListElementIndex:r,key:a,subKey:s,updateObj:l,element:d,containerIndex:c,elementIndex:u,isGlobalContainer:m,pageId:p}=e,g={...null===(t=(0,i.A)(d,r))||void 0===t?void 0:t[a]};var h,f,b,w;"width"===a?(n=g,o=s,n[o]={...n[o],...l},null!==(h=n)&&void 0!==h&&null!==(f=h[o])&&void 0!==f&&f.unit||(n[o]={...n[o],unit:"%"})):(n=g,o=s,n[o]={...n[o],...l},null!==(b=n)&&void 0!==b&&null!==(w=b[o])&&void 0!==w&&w.unit||(n[o]={...n[o],unit:"%"}));v({staticListElementIndex:r,action:"update",containerIndex:c,elementIndex:u,dataToUpdate:{[a]:n},pageId:p,isGlobal:m})}const g=e=>{let{imageId:t,project:n,renderEnvtype:o}=e,r="",i=null;if(n){const e=n.attributes.media.data;e&&e.length&&(i=e.find((e=>String(e.id)===String(t)))||null),i&&(r=function(e,t){let n="no_url";return n="build"===t?"."+e:"http://api.avstudio.local"+e,n}(i.attributes.url,o))}return{url:r,mediaFile:i}},h=async e=>{let{pageId:t,elementToPaste:n}=e;return new Promise((()=>{var e;const o=s.x.getState().selectedMenuSection,{containerIndex:r,elementIndex:i,isGlobalContainer:l}=o;if(null===r||void 0===r)throw new Error("No containerIndex");const{workingProject:d,updateProjectWithHistory:c}=a.f.getState();if(!d)throw new Error("No working project");let u;var m;l?u=structuredClone(d.attributes.globalContainers):u=structuredClone(null===(m=d.attributes.pages.data.find((e=>String(e.id)===t)))||void 0===m?void 0:m.attributes.containers);if(null===(e=u)||void 0===e||!e.length)throw new Error("No containersToModify");return null!==i&&void 0!==i?u[r].elements.splice(i+1,0,n):u[r].elements=[...u[r].elements,n],l?c({globalContainers:u}):b({pageId:t,newPageAttributes:{containers:u}})}))},v=async e=>{var t;let{containerIndex:n,elementData:o,isGlobal:i,pageId:l,action:d,elementIndex:c,copiesCount:u,staticListElementIndex:m,dataToUpdate:p,ignoreModeIndex:g,updateFunction:h}=e;const{workingProject:v,updateProjectWithHistory:f}=a.f.getState();if(!v)throw new Error("No working project");if(!i&&!l)throw new Error("No page id");let b,w=structuredClone(v.attributes);var x,C;i?b=w.globalContainers[n]:b=null===(x=w.pages.data.find((e=>String(e.id)===l)))||void 0===x||null===(C=x.attributes.containers)||void 0===C?void 0:C[n];if(!b)throw new Error("No targetContainer");if("create"===d){if(!o)throw new Error("Element data is empty");let e={...o};switch(e.type){case"button":e={...e,type:"button",size:"normal",iconPosition:"left",cssClass:"buttonElement",actions:[],iconName:null,text:"Button"};break;case"buttonList":e={...e,type:"buttonList",size:"normal",iconPosition:"left",cssClass:"buttonElementList",actions:[],iconName:null,text:"Button"};break;case"text":e={...e,type:"text",size:"normal",text:"Text element",cssClass:"textElement"};break;case"keypad":e={...e,type:"keypad",cssClass:"keypadElement"};break;case"slider":e={...e,type:"slider",size:"normal",cssClass:"sliderElement"};break;case"input":e={...e,type:"input",size:"normal",cssClass:"inputElement"};break;case"spacer":e={...e,type:"spacer",cssClass:"spacerElement",width:{width:{value:100,unit:"px"}},height:{height:{value:100,unit:"px"}}};break;case"switch":e={...e,type:"switch",cssClass:"switchElement",size:"normal",text:"Switch"};break;case"checkbox":e={...e,type:"checkbox",cssClass:"checkboxElement",size:"normal",text:"Checkbox"};break;case"clock":e={...e,type:"clock",cssClass:"clockWidget",width:{width:{value:200,unit:"px"}},height:{height:{value:200,unit:"px"}},isWidget:!0};break;case"dateTime":e={...e,type:"dateTime",cssClass:"dateTimeWidget",isWidget:!0};break;case"htmlblock":e={...e,type:"htmlblock",cssClass:"htmlblockWidget",width:{width:{value:200,unit:"px"}},height:{height:{value:200,unit:"px"}},isWidget:!0};break;case"toggle":e={...e,type:"toggle",cssClass:"toggleWidget",isWidget:!0};break;case"shades":e={...e,type:"shades",cssClass:"shadesWidget",isWidget:!0,headerLeftText:"Title",headerRightText:"%",shaderBackgroundBlur:3,shaderBackgroundColor:"rgba(255,255,255,0.6)"};break;case"circleSlider":e={...e,type:"circleSlider",cssClass:"circleSliderWidget",isWidget:!0,textTitle:"Title",textDescription:" Description",width:{width:{value:250,unit:"px"}}};break;case"player":e={...e,type:"player",cssClass:"playerWidget",isWidget:!0,headerTextLeft:"Player Name",headerTextCenter:"1 of 2",headerTextRight:"Next: Track Name",sourceItems:r((null===(t=e)||void 0===t?void 0:t.playerMaxSources)||30)};break;case"subpage":e={...e,type:"subpage",cssClass:"subpageElement"};break;case"video":e={...e,type:"video",cssClass:"videoElement"};break;case"dpad":e={...e,type:"dpad",cssClass:"dpadElement",width:{width:{value:250,unit:"px"}},height:{height:{value:250,unit:"px"}},thickness:1,cornersRaduis:20};break;case"image":e={...e,type:"image",cssClass:"imageElement",width:{width:{value:100,unit:"px"}},height:{height:{value:100,unit:"px"}}};break;default:console.log("Error creating element - no element type mathes")}try{b.elements.push(e)}catch(P){return void console.error(P)}}if("delete"===d){if(null===c||void 0===c)throw new Error("No element index provided");try{b.elements.splice(c,1)}catch(P){console.error(P)}}if("clone"===d){if(null===u||void 0===u)throw new Error("No copies count provided");if(null===c||void 0===c)throw new Error("No elementIndex");try{for(let e=0;e<u;e++){let t=structuredClone(b.elements[c]),n=t.name;t={...t,name:n+"_clone_".concat(e)},b.elements.push(t)}}catch(P){console.error(P)}}if("update"===d){var y;const e=g||null===(y=s.x.getState().selectedMenuSection)||void 0===y?void 0:y.modeIndex;if(null===c||void 0===c)throw new Error("No elementIndex");let t=b.elements[c];if(!t)throw new Error("No targetElement");if(!p)throw new Error("No dataToUpdate");var E,I,k;if(void 0!==m)null!==(E=t.staticListOverrides)&&void 0!==E&&E[m]?b.elements[c].staticListOverrides[m]={...b.elements[c].staticListOverrides[m],...p}:b.elements[c].staticListOverrides={...t.staticListOverrides,[m]:p};else if(void 0!==e&&null!==t&&void 0!==t&&null!==(I=t.modes)&&void 0!==I&&I.length)if(h){const n=t.modes.map(((t,n)=>{if(n===e){var o,r,i;if(p&&void 0===p.modificatorId)if(null!==(o=t.modeProps)&&void 0!==o&&o.attachedFunctions&&(null===(r=t.modeProps)||void 0===r||null===(i=r.attachedFunctions)||void 0===i?void 0:i.length)>0){const e=t.modeProps.attachedFunctions.filter((e=>e.name!==p.name));return{...t,modeProps:{...t.modeProps,attachedFunctions:e}}}if(p&&void 0!==p.modificatorId){var a,s,l;if(null!==(a=t.modeProps)&&void 0!==a&&a.attachedFunctions&&(null===(s=t.modeProps)||void 0===s||null===(l=s.attachedFunctions)||void 0===l?void 0:l.length)>0){const e=[...t.modeProps.attachedFunctions,{...p}];return{...t,modeProps:{...t.modeProps,attachedFunctions:e}}}return{...t,modeProps:{...t.modeProps,attachedFunctions:[p]}}}return{...t,modeProps:{...t.modeProps,...p}}}return t}));b.elements[c]={...t,modes:n}}else{const n=t.modes.map(((t,n)=>n===e?{...t,modeProps:{...t.modeProps,...p}}:t));b.elements[c]={...t,modes:n}}else if(h)if(null!==t&&void 0!==t&&t.attachedFunctions&&(null===t||void 0===t||null===(k=t.attachedFunctions)||void 0===k?void 0:k.length)>0)if(p&&void 0===p.modificatorId){const e=t.attachedFunctions.filter((e=>e.name!==p.name));b.elements[c]={...t,attachedFunctions:e}}else{const e=[...t.attachedFunctions,{...p}];b.elements[c]={...t,attachedFunctions:e}}else b.elements[c]={...t,attachedFunctions:[p]};else b.elements[c]={...t,...p}}return f(w)},f=async e=>{let{action:t,containerFormData:n,containerIndex:r,pageId:i,copiesCount:s,isGlobal:l}=e;const{workingProject:c,updateProjectWithHistory:u}=a.f.getState();if(!c)throw new Error("No working project");if(!l&&!i)throw new Error("No page id");let m,p=structuredClone(c.attributes);var g;l?m=p.globalContainers:m=null===(g=p.pages.data.find((e=>String(e.id)===i)))||void 0===g?void 0:g.attributes.containers;if(!m)throw new Error("No targetContainers");if("create"===t){let e={...d,...n};try{m.push(e)}catch(v){return void console.error(v)}}if("clone"===t){if(void 0===r)throw new Error("No container index");try{if(!m[r])throw new Error("No containerToClone");if(null===s||void 0===s)throw new Error("No copies count provided");if(null===r||void 0===r)throw new Error("No container index provided");for(let e=0;e<s;e++){let t=structuredClone(m[r]),n=t.name;t={...t,name:n+"_clone_".concat(e)},m.push(t)}}catch(v){return void console.error(v)}}if("update"===t)try{if(null===r||void 0===r)throw new Error("No container index provided");m[r]={...m[r],...n}}catch(v){return void console.error(v)}if("delete"===t){var h;if(null===r||void 0===r)throw new Error("No container index provided");if(null===(h=m)||void 0===h||!h.length)return void o.Ay.error("No containers found");if(m.length<2)return void o.Ay.error("At least one container should exist!");try{m.splice(r,1)}catch(v){return void console.error(v)}}return u(p)},b=async e=>{let{newPageAttributes:t,pageId:n}=e;const{workingProject:o,updateProjectWithHistory:r}=a.f.getState();if(!o)throw new Error("No working project");if(!n)throw new Error("No page id");let i=structuredClone(o.attributes);return i.pages.data.map((e=>(String(e.id)===n&&(e.attributes={...e.attributes,...t}),e))),r(i)}}}]);