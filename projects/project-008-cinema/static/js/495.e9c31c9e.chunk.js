(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[495],{33490:(e,t,a)=>{"use strict";a.d(t,{c:()=>o});var r=a(36373),n=a(41397);const o=(0,r.h)(((e,t)=>({calculatedVariables:[],setInitialVariablesArray:t=>e((()=>({calculatedVariables:t}))),setVariableNewValue:a=>{let{name:r,currentValue:n}=a;console.log("setVariableNewValue",r,n);let o=structuredClone(t().calculatedVariables);if(void 0===r||void 0===n)return void console.log("Variable name or currentValue is undefined");const i=o.findIndex((e=>e.name===r));if(i<0)return void console.log("Variable not found, update error");let s;if(s=void 0!==o[i].currentValue?o[i].currentValue:o[i].defaultValue,"boolean"===o[i].type)switch(n){case"true":case!0:s=!0;break;case"false":case!1:s=!1;break;case"toggle":s=!s}else s=n;return o[i].currentValue!==s&&(o[i]={...o[i],currentValue:s}),e((()=>({calculatedVariables:o})))}})),n.isEqual)},83063:(e,t,a)=>{"use strict";a.d(t,{A:()=>h});var r=a(84649),n=a(48538),o=a(77645),i=a(56952),s=a(92759),l=a(12916),c=a(9950),d=a(2260),u=a(41967),g=a(57560),v=a(24513),p=a(44414);const f=e=>{let{initialValue:t,saveInProgress:a,setIsEditing:s,setSaveInProgress:l,save:v,style:f}=e;const[h,b]=(0,c.useState)(t);switch(typeof t){case"boolean":return(0,p.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1em",...f},children:[a&&(0,p.jsx)(d.A,{}),(0,p.jsx)(r.A,{onChange:e=>{b("true"===e)},value:h?"true":"false",options:["true","false"]}),(0,p.jsxs)("div",{style:{display:"flex"},children:[(0,p.jsx)(n.A,{style:{marginRight:2},type:"dashed",children:(0,p.jsx)(u.A,{onClick:()=>v(h),style:{color:"var(--ant-primary-5)"}})}),(0,p.jsx)(n.A,{onClick:()=>{s(!1),l(!1)},type:"dashed",children:(0,p.jsx)(g.A,{style:{color:"gray"}})})]})]});case"string":return(0,p.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1em",...f},children:[a&&(0,p.jsx)(d.A,{}),(0,p.jsx)(o.A,{spellCheck:!1,autoFocus:!0,onPressEnter:()=>v(h),onBlur:()=>v(h),onChange:e=>{e.stopPropagation(),b(e.target.value)},value:h})]});case"number":case"object":return(0,p.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1em",...f},children:[a&&(0,p.jsx)(d.A,{}),(0,p.jsx)(i.A,{style:{width:"100%"},autoFocus:!0,onPressEnter:()=>v(h),onBlur:()=>v(h),onChange:e=>b(e),value:h})]});default:return null}},h=e=>{let{value:t,onChange:a,initialValue:r,validators:n,style:o}=e;const[i,d]=(0,c.useState)(!1),[u,g]=(0,c.useState)(!1);function h(e){g(!0),a(e).then((()=>{d(!1),g(!1)}))}return(0,c.useEffect)((()=>{const e=e=>{27===e.keyCode&&d(!1)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[r]),i?(0,p.jsx)(f,{initialValue:r,saveInProgress:u,setIsEditing:d,setSaveInProgress:g,save:function(e){if(e===r)return d(!1),void g(!1);if(null!==n&&void 0!==n&&n.length){let t=[];return n.forEach((a=>{t.push(a(e))})),Promise.all(t).then((()=>{h(e)})).catch((e=>{s.Ay.error(e.message)}))}h(e)},style:o}):(0,p.jsxs)("div",{style:{...o},children:["boolean"===typeof t?(0,p.jsx)(l.A,{style:{padding:"3px",lineHeight:"1em"},color:t?"green":"red",children:t?"true":"false"}):t,(0,p.jsx)(v.A,{style:{marginLeft:"0.3em",color:"var(--ant-primary-5)"},onClick:()=>{d(!0)}})]})}},15369:(e,t,a)=>{"use strict";a.d(t,{BG:()=>p,CG:()=>f,I$:()=>b,a3:()=>v,gw:()=>h});var r=a(92759),n=a(13753),o=a(89321),i=a(48362),s=a(93072),l=a(9418),c=a(64983),d=a(18288);const u=a(21215);function g(e){var t,a;return null===(t=c.f.getState().workingProject)||void 0===t||null===(a=t.attributes.pages.data.find((t=>String(t.id)===String(e))))||void 0===a?void 0:a.attributes.numericPageId}const v=async e=>{try{var t,a;const r={data:{containers:[{...s.GN}],...e}},l=await n.axiosInstance.post("/api/pages?&replacePageId=true",r,{headers:(0,o.A)()}),u=null===l||void 0===l||null===(t=l.data)||void 0===t?void 0:t.data;if(!u)throw new Error("No new page data");const{workingProject:g,updateProjectWithHistory:v,addPageHash:p}=c.f.getState();if(!g)throw new Error("No workingProject");const f=structuredClone(g.attributes.pages.data);f.push(u);const h=(0,d.A)(u);p({pageId:u.id,savedHash:h,currentHash:h});const b=u.attributes.parameters;let w=[];null!==b&&void 0!==b&&b.length&&(w=b.map((e=>({...e,pageId:u.id}))));const m=null!==(a=g.attributes.variables)&&void 0!==a?a:[];await(0,i.Qx)({projectId:g.id,inputData:{variables:[...m,...w]}}),await v({pages:{data:f}},!1)}catch(l){console.error("An error occurred while creating a page:",l),r.Ay.error("Error creating new page")}},p=async e=>{let{pageCloneData:t}=e,a=structuredClone(t.attributes);a.name=a.name+"_clone",a.url=a.url+"_clone";const{createdAt:r,updatedAt:n,publishedAt:o,uid:i,...s}=a,l=c.f.getState().workingProject;if(!l)throw new Error("No workingProject");return await v({...s,project:l.id})},f=async(e,t)=>{var a;const s=g(t);if(!s)return void console.error("No numeric page id found for ".concat(t));let d=structuredClone(null===(a=c.f.getState().workingProject)||void 0===a?void 0:a.attributes.globalContainers);d&&d.forEach((e=>{e.hiddenOnPages&&e.hiddenOnPages.length&&(e.hiddenOnPages=e.hiddenOnPages.filter((e=>e!==t))),e.visibleOnPages&&e.visibleOnPages.length&&(e.visibleOnPages=e.visibleOnPages.filter((e=>e!==t)))}));const v=u.stringify({populate:"*"},{encodeValuesOnly:!0});return await n.axiosInstance.delete("/api/pages/".concat(s,"?").concat(v),{headers:(0,o.A)()}).then((()=>{var a;let n={globalContainers:d};(0,i.Qx)({projectId:e,inputData:n}).then((()=>{(0,l.aM)({projectId:e,pageId:t}).then((()=>{r.Ay.success("Page deleted")}))}));const{updateProjectWithHistory:o,workingProject:s}=c.f.getState();if(!s)throw new Error("No workingProject");let u=null===s||void 0===s?void 0:s.attributes.pages.data;if(!u||0===(null===(a=u)||void 0===a?void 0:a.length))throw new Error("No pages data");return u=u.filter((e=>e.id!==t)),o({pages:{data:u}},!1)})).catch((e=>{console.log("DeletePage error occurred:",e.response),r.Ay.error("Error deleting page")}))},h=async e=>{let{projectId:t,pageId:a,inputData:i}=e;const s=g(a);if(!s)return void console.error("No numeric page id found for ".concat(a));const l=u.stringify({populate:"*",replacePageId:"true"},{encodeValuesOnly:!0});return await n.axiosInstance.put("/api/pages/".concat(s,"?").concat(l),{data:i},{headers:(0,o.A)()}).then((e=>{var t;if(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.data){var r;if(null===e||void 0===e||null===(r=e.data)||void 0===r||!r.data)throw new Error("No data returned from server");const{updateProjectWithHistory:t,workingProject:n}=c.f.getState();let o=structuredClone(null===n||void 0===n?void 0:n.attributes.pages.data);if(!o||0===(null===o||void 0===o?void 0:o.length))throw new Error("No pages data returned from server");return null===o||void 0===o||o.map((t=>(t.id===a&&(t.attributes=e.data.data.attributes),t))),t({pages:{data:o}},!1)}})).catch((e=>{console.log("updatePage error occurred:",e.response),r.Ay.error("Error updating page")}))};function b(e){let{evt:t,navigate:a,pageId:r}=e;const n=c.f.getState().addNewTab;t.metaKey||t.ctrlKey?n(r):a("page/".concat(r))}},9418:(e,t,a)=>{"use strict";a.d(t,{I7:()=>l,N6:()=>p,Pb:()=>g,S1:()=>c,aM:()=>d,l4:()=>v,rz:()=>u});var r=a(92759),n=a(48362),o=a(64983),i=a(33490),s=a(9950);async function l(e){var t;let{updatedVariable:a,projectId:i,pageId:s}=e;const l=null===(t=o.f.getState().workingProject)||void 0===t?void 0:t.attributes.variables;return new Promise((async function(e,t){let o=structuredClone(l);if(!o)return t("Variables are empty"),null;const s=null===o||void 0===o?void 0:o.findIndex((e=>e.name===a.name));return s<0?(t("No variable found by index"),null):(o[s]=a,i?(0,n.Qx)({projectId:i,inputData:{variables:o}}).then((()=>e("Ok"))).catch((e=>{var a,n;return"ValidationError"===(null===(a=e.response.data)||void 0===a||null===(n=a.error)||void 0===n?void 0:n.name)&&r.Ay.error("Name must be unique"),t(e)})):void t("No projectId"))}))}async function c(e){var t;let{variableName:a,projectId:r,pageId:i}=e;const s=null===(t=o.f.getState().workingProject)||void 0===t?void 0:t.attributes.variables;return new Promise((async function(e,t){let o=structuredClone(s);if(!o)return t("variables are empty"),null;o=i&&void 0!==i?o.filter((e=>e.pageId!==i||e.name!==a)):o.filter((e=>e.name!==a)),r?(0,n.Qx)({projectId:r,inputData:{variables:o}}).then((()=>{e("Ok")})).catch((e=>t(e))):t("No projectId")}))}async function d(e){var t;let{projectId:a,pageId:r}=e;const i=null===(t=o.f.getState().workingProject)||void 0===t?void 0:t.attributes.variables;return new Promise((async function(e,t){let o=structuredClone(i);if(!o)return t("variables are empty"),null;o=o.filter((e=>e.pageId!==r)),a?(0,n.Qx)({projectId:a,inputData:{variables:o}}).catch((e=>t(e))):t("No projectId")}))}async function u(e){let{newVariable:t,projectId:a}=e;const{workingProject:r}=o.f.getState();return new Promise((async function(e,o){if(!a)return void o("No projectId");if(!r)return void o("No workingProject");const i=r.attributes.variables;let s=structuredClone(i)||[];s=[...s,t],console.log(s),(0,n.Qx)({projectId:a,inputData:{variables:s}}).then((()=>e("Ok"))).catch((e=>o(e)))}))}function g(e){var t;const a=null===(t=o.f.getState().workingProject)||void 0===t?void 0:t.attributes.variables;return null===a||void 0===a?void 0:a.find((t=>t.name===e))}function v(e){const t=i.c.getState().calculatedVariables;return null===t||void 0===t?void 0:t.find((t=>t.name===e))}function p(e){const t=(0,i.c)((e=>e.calculatedVariables));let a=(0,s.useMemo)((()=>null===t||void 0===t?void 0:t.find((t=>t.name===e))),[t,e]);if(void 0===a)return;const{currentValue:r,defaultValue:n}=a;return{calculatedValue:void 0===r||""===r?n:r,targetVariable:a}}},16977:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(44719),n=a(15369),o=a(27379),i=a(44414);const s=e=>{let{pageId:t,projectId:a,isSubpage:s,name:l}=e;r.A.confirm({title:"Delete ".concat(s?"Subpage":"Page",'  "').concat(l,'"?'),icon:(0,i.jsx)(o.A,{}),content:'Are you sure to delete page "'.concat(l,'" with all content inside? It cannot be undone.'),okText:"Delete page",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>(0,n.CG)(a,t),onCancel:()=>console.log("cancel page delete")})}},6317:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(77645),n=a(9950),o=a(60767),i=a(35865),s=a(44414);const l=n.memo((e=>{let{searchType:t}=e;const a=i.x.getState().setMainMenuData,n=(0,i.x)((e=>e.pageSearchString)),l=(0,i.x)((e=>e.subPageSearchString));return(0,s.jsx)("div",{className:"innerBox",onClick:e=>{e.stopPropagation()},children:(0,s.jsx)(r.A,{prefix:(0,s.jsx)(o.A,{}),allowClear:!0,onChange:e=>{return r=e.target.value,void a("pages"===t?{pageSearchString:r}:{subPageSearchString:r});var r},value:"pages"===t?n:l,placeholder:"pages"===t?"Page Name":"SubPage Name"})})}))},44070:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(89379),n=a(9950);const o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};var i=a(25085),s=function(e,t){return n.createElement(i.A,(0,r.A)((0,r.A)({},e),{},{ref:t,icon:o}))};const l=n.forwardRef(s)},37571:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(89379),n=a(9950);const o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M476 399.1c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1V484h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H420v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V540h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H476v-84.9zM560.5 704h-225c-4.1 0-7.5 3.2-7.5 7v42c0 3.8 3.4 7 7.5 7h225c4.1 0 7.5-3.2 7.5-7v-42c0-3.8-3.4-7-7.5-7zm-7.1-502.6c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v704c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32V397.3c0-8.5-3.4-16.6-9.4-22.6L553.4 201.4zM664 888H232V264h282.2L664 413.8V888zm190.2-581.4L611.3 72.9c-6-5.7-13.9-8.9-22.2-8.9H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h277l219 210.6V824c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V329.6c0-8.7-3.5-17-9.8-23z"}}]},name:"diff",theme:"outlined"};var i=a(25085),s=function(e,t){return n.createElement(i.A,(0,r.A)((0,r.A)({},e),{},{ref:t,icon:o}))};const l=n.forwardRef(s)},42634:()=>{}}]);